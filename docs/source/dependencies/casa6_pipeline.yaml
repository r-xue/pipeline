############################################################################
#
# setup:
#
#   Install mambaforge: the recommended minimal Conda installer
#     https://github.com/conda-forge/miniforge#mambaforge
#
#   Step-by-step to reproduce the Pipeline/CASA environment
#     $ mamba env create -f casa6_pipeline.yaml
#     $ mamba activate casa6_pipeline
#
#   Update:
#     $ conda update -n casa6_pipeline --all
#     $ mamba env update -f casa6_pipeline.yaml
#
#   Remove:
#     $ conda env remove -n casa6_pipeline
#
# execute:
#     $ xvfb-run -a python run_pipeline.py
#     $ xvfb-run -a mpirun -n 4 python run_pipeline.py
#
############################################################################

name: casa6_pipeline

channels:
  - conda-forge
  - defaults
  - i4ds

dependencies:
  # core
  - python=3.8.10 # the casa packages wheels are not available for Python 3.9 yet, therefore
    # Python 3.8 is used.
  - ipython=7.15
  - pip
  - conda-ecosystem-user-package-isolation # https://github.com/conda-forge/conda-ecosystem-user-package-isolation-feedstock
    # prevent Python and R from searching for packages outside of the current environment
  - numpy=1.23.5 # Pipeline is not 1.24 compatible yet
  - matplotlib
  - scipy
  - certifi
  - protobuf=3.20 # casatplotms requires ver<=3.20 at this moment
  - grpcio
  - openmpi # do not use the latest mpich which link mpirun to mpiexec.hydra
  - mpi4py
  - pytz
  #- xorg-x11-server-xvfb-cos6-x86_64
  #- xorg-x11-xauth-cos6-x86_64

  # extra/optional
  - astropy
  - jupyterlab
  - future
  - johnnydep
  - line_profiler
  - memory_profiler
  - pylint
  - flake8
  - isort
  - black
  - pytest
  - pydocstyle
  - pycodestyle
  - pytest-cov
  - pytest-pep8

  - cachetools
  - mako
  - pypubsub
  - intervaltree=2.1.0

  - pip:
      # the casa package versions are not specified here therefore the latest versions from the specified channel are used.
      # --index-url https://casa-pip.nrao.edu/repository/pypi-casa-release/simple # latest released version; picking up casa6.5.2
      - --extra-index-url https://casa-pip.nrao.edu/repository/pypi-group/simple # eqauivelent to releaseprep; picking up casa6.5.3-19 as of Nov.24
      - casatools==6.5.3.28
      - casatasks==6.5.3.28
      - casashell==6.5.3.28
      - casadata
      - casaplotms
      - casaviewer
      - casampi
      - almatasks

      - logutils
      - ps_mem
      - bdsf
