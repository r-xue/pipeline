

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pipeline Quality Assurance (QA) Score Class Design &mdash; Pipeline unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/custom_theme.css?v=678032d9" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=3f1b9271"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pipeline developer documentation" href="DeveloperDocumentation.html" />
    <link rel="prev" title="DataType Testing" href="DataType_Testing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Pipeline Tasks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_tasks/pipeline_tasks.html">Pipeline Heuristics Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Task (sphinx-autosummary)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.h.cli.html">pipeline.h.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hif.cli.html">pipeline.hif.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hifa.cli.html">pipeline.hifa.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hifv.cli.html">pipeline.hifv.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hsd.cli.html">pipeline.hsd.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hsdn.cli.html">pipeline.hsdn.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Heuristics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../heuristics/field_parameter.html">Field parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../heuristics/FlaggingTasks.html">Pipeline Flagging Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Releases etc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Pipeline Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modular.html">Run the Pipeline in a Conda environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies.html">Dependencies of <cite>Pipeline</cite></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html#module-pipeline.infrastructure.launcher">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html">pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html#module-pipeline.hif.tasks">pipeline-l2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html#module-pipeline.hif">pipeline-l3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html#pipeline-diagram">pipeline-diagram</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ways_to_run_the_pipeline.html">Ways to run the Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparing_pipeline_executions.html">Comparing pipeline executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_the_pipeline.html">Building the pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="ALMA-Imaging-Workflow.html">ALMA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="VLA-Imaging-Workflow.html">VLA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="VLASS-SE-CONT-Imaging-Workflow.html">VLASS-SE-CONT imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="VLASS-SE-CUBE-Imaging-Workflow.html">VLASS-SE-CUBE imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="selfcal_workflow.html">VLASS Selfcal &amp; Restore workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline_tests.html">Pipeline testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataType_Testing.html">DataType Testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pipeline Quality Assurance (QA) Score Class Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pipeline-qa-handler-class-registration">Pipeline QA “Handler” Class Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reference-on-alma-quality-assurance">Reference on ALMA Quality Assurance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DeveloperDocumentation.html">Pipeline developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="python3_conversion_notes.html">Python 3 conversion notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Pipeline Recipes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples Notes (from Jupyter Notebooks)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/test1.html">test</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notes (from .rst)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/test2.html">Example 1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Pipeline Quality Assurance (QA) Score Class Design</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/develdocmd/QA_scores.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pipeline-quality-assurance-qa-score-class-design">
<h1>Pipeline Quality Assurance (QA) Score Class Design<a class="headerlink" href="#pipeline-quality-assurance-qa-score-class-design" title="Link to this heading"></a></h1>
<p>Pipeline QA scores are represented by the
<code class="docutils literal notranslate"><span class="pre">pipeline/infrastructure/pipelineqa.py::QAScore</span></code> class. The basic setup features
a normalized numerical score (”score”) between 0.0 and 1.0 with the following
numerical ranges, meanings and colors:</p>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">score range</th>
<th style="text-align: left;">color</th>
<th style="text-align: left;">QA level</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">0.00 &lt;= score &lt;= 0.33</td>
<td style="text-align: left;">red</td>
<td style="text-align: left;">error</td>
</tr>
<tr>
<td style="text-align: left;">0.33 &lt; score &lt;= 0.66</td>
<td style="text-align: left;">yellow</td>
<td style="text-align: left;">warning</td>
</tr>
<tr>
<td style="text-align: left;">0.66 &lt; score &lt;= 0.90</td>
<td style="text-align: left;">blue</td>
<td style="text-align: left;">suboptimal</td>
</tr>
<tr>
<td style="text-align: left;">0.90 &lt; score &lt;= 1.00</td>
<td style="text-align: left;">green</td>
<td style="text-align: left;">optimal</td>
</tr>
</tbody>
</table><p>Optionally, <code class="docutils literal notranslate"><span class="pre">score</span></code> can be set to -0.1 if the score calculation encounters any unhandled errors. A score of -0.1 is considered an error score.</p>
<p>A long message (<code class="docutils literal notranslate"><span class="pre">longmsg</span></code>) describes the reason for the given score in detail.
It is rendered in weblog QA score tables. A short message (<code class="docutils literal notranslate"><span class="pre">shortmsg</span></code>) gives
a concise summary for the “By Task” weblog page. It is shown next to the task
name and should thus be short to render well.</p>
<p>The scores are usually calculated from unnormalized metrics using the actual
data. The metric is coded via the <code class="docutils literal notranslate"><span class="pre">QAOrigin</span></code> entity class defined in
<code class="docutils literal notranslate"><span class="pre">pipelineqa.py</span></code>. It has <code class="docutils literal notranslate"><span class="pre">metric_name</span></code>, <code class="docutils literal notranslate"><span class="pre">metric_score</span></code> (which is really the
metric value and <strong>not</strong> any normalized quantity) and “metric_units”. In the
QA score objects the metrics are stored as the <code class="docutils literal notranslate"><span class="pre">origin</span></code> attribute.</p>
<p>Furthermore there is a data selection object stored as <code class="docutils literal notranslate"><span class="pre">applies_to</span></code> attribute
in the main QA score object. The data selection is coded in the
<code class="docutils literal notranslate"><span class="pre">TargetDataSelection</span></code> via the sessions, vis list, scans, spws, fields, intents,
antennas and polarizations that were used to compute the particular metric.</p>
<p>A QA score can be <code class="docutils literal notranslate"><span class="pre">None</span></code>, presented as “N/A”. You can assign an “N/A” QA score
with custom messages. If no score is assigned to the task results, a “N/A” QA
score with a “No QA” message will be attached as a fallback.</p>
<p>The last attribute is the “weblog_location” which is an enum with possible
values “BANNER”, “ACCORDION”, “HIDDEN” and “UNSET”. “BANNER” is the top of a
weblog page, “ACCORDION” used to be the QA score table at the bottom of the
page. PIPE-1481 requested moving this up to the banner area. Previously, the
banner scores were supposed to highlight the main QA findings, in particular
error and warning scores. This will be replaced with display of the task
score and link to all subscores to be shown in the weblog (all except “HIDDEN”).
The difference between “BANNER” and “ACCORDION” will probably no longer be
needed. “UNSET” is for legacy scores from the time before introducing the
banner concept. They were handled like “BANNER” scores.</p>
<p>Every task result has a QA object called “qa” with a “pool” attribute listing
all subscores. The task score is defined by the “representative_score”
attribute. It is often the minimum of all subscores, but it could also be
computed differently, e.g. as mean of subscores. In case “representative_score”
is unset, the pipeline assumes the minimum of the pool scores.</p>
<section id="pipeline-qa-handler-class-registration">
<h2>Pipeline QA “Handler” Class Registration<a class="headerlink" href="#pipeline-qa-handler-class-registration" title="Link to this heading"></a></h2>
<p>Pipeline QA “handler” classes rely on the class inheritance relationship from the <code class="docutils literal notranslate"><span class="pre">QAPlugin</span></code> base class to register and load correctly (see the <code class="docutils literal notranslate"><span class="pre">QARegistry.do_qa</span></code> method).</p>
<p>Individual task QA modules need to be imported into the namespace early so their <code class="docutils literal notranslate"><span class="pre">*QAHandler</span></code> and <code class="docutils literal notranslate"><span class="pre">*ListQAHandler</span></code> classes can be defined and registered. For this reason, it is essential to have <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">.</span> <span class="pre">qa</span></code> inside <code class="docutils literal notranslate"><span class="pre">h*/tasks/*/__init__.py</span></code> for any Pipeline task with a <code class="docutils literal notranslate"><span class="pre">qa.py</span></code> module.</p>
<p>To check the currently registered <code class="docutils literal notranslate"><span class="pre">*QAHandler</span></code> classes, you can try:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CASA</span> <span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">pipeline.infrastructure.pipelineqa</span> <span class="kn">import</span> <span class="n">QAPlugin</span>
<span class="n">CASA</span> <span class="o">&lt;</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">QAPlugin</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
<span class="p">[</span><span class="n">pipeline</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">exportdata</span><span class="o">.</span><span class="n">qa</span><span class="o">.</span><span class="n">ExportDataQAHandler</span><span class="p">,</span>
 <span class="n">pipeline</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">exportdata</span><span class="o">.</span><span class="n">qa</span><span class="o">.</span><span class="n">ExportDataListQAHandler</span><span class="p">,</span>
 <span class="n">pipeline</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">applycal</span><span class="o">.</span><span class="n">qa</span><span class="o">.</span><span class="n">ApplycalQAHandler</span><span class="p">,</span>
 <span class="n">pipeline</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">applycal</span><span class="o">.</span><span class="n">qa</span><span class="o">.</span><span class="n">ApplycalListQAHandler</span><span class="p">,</span>
 <span class="n">pipeline</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">importdata</span><span class="o">.</span><span class="n">qa</span><span class="o">.</span><span class="n">ImportDataQAHandler</span><span class="p">,</span>
 <span class="n">pipeline</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">importdata</span><span class="o">.</span><span class="n">qa</span><span class="o">.</span><span class="n">ImportDataListQAHandler</span><span class="p">,</span>
 <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="reference-on-alma-quality-assurance">
<h2>Reference on ALMA Quality Assurance<a class="headerlink" href="#reference-on-alma-quality-assurance" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://almascience.nrao.edu/processing/qa2-data-products">QA2 Data Products</a></p></li>
<li><p><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2023PASP..135g4501H/abstract">Sec. 7 QA Scores, Hunter et al. 2023 PASP, 135, 074501</a></p></li>
<li><p><a class="reference external" href="https://almascience.nrao.edu/documents-and-tools/cycle11/alma-technical-handbook">Sec. 11 Quality Assurance, ALMA Cycyle 11 Technical Handbook</a></p></li>
<li><p><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2016SPIE.9910E..1HC/abstract">ALMA quality assurance: concepts, procedures, and tools</a></p></li>
<li><p><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2020SPIE11449E..1TN/abstract">Improving ALMA’s data processing efficiency using a holistic approach</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="DataType_Testing.html" class="btn btn-neutral float-left" title="DataType Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="DeveloperDocumentation.html" class="btn btn-neutral float-right" title="Pipeline developer documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020–2024, Pipeline Dev. Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>