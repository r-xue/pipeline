

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pipeline.hifv.heuristics.lib_EVLApipeutils &mdash; Pipeline unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom_theme.css?v=678032d9" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=3f1b9271"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Pipeline Tasks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../pipeline_tasks/pipeline_tasks.html">Pipeline Heuristics Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Task (sphinx-autosummary)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.h.cli.html">pipeline.h.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hif.cli.html">pipeline.hif.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hifa.cli.html">pipeline.hifa.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hifv.cli.html">pipeline.hifv.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hsd.cli.html">pipeline.hsd.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hsdn.cli.html">pipeline.hsdn.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Heuristics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../heuristics/field_parameter.html">Field parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../heuristics/FlaggingTasks.html">Pipeline Flagging Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Releases etc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases.html">Pipeline Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modular.html">Run the Pipeline in a Conda environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dependencies.html">Dependencies of <cite>Pipeline</cite></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../basics.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../basics.html#module-pipeline.infrastructure.launcher">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html">pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html#module-pipeline.hif.tasks">pipeline-l2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html#module-pipeline.hif">pipeline-l3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html#pipeline-diagram">pipeline-diagram</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/ways_to_run_the_pipeline.html">Ways to run the Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/comparing_pipeline_executions.html">Comparing pipeline executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/building_the_pipeline.html">Building the pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/ALMA-Imaging-Workflow.html">ALMA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/VLA-Imaging-Workflow.html">VLA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/VLASS-SE-CONT-Imaging-Workflow.html">VLASS-SE-CONT imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/VLASS-SE-CUBE-Imaging-Workflow.html">VLASS-SE-CUBE imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/selfcal_workflow.html">VLASS Selfcal &amp; Restore workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/pipeline_tests.html">Pipeline testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/DataType_Testing.html">DataType Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/QA_scores.html">Pipeline Quality Assurance (QA) Score Class Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/DeveloperDocumentation.html">Pipeline developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/python3_conversion_notes.html">Python 3 conversion notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/releases.html">Pipeline Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/recipes.html">Pipeline Recipes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples Notes (from Jupyter Notebooks)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/test1.html">test</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notes (from .rst)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/test2.html">Example 1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../pipeline.html">pipeline</a></li>
      <li class="breadcrumb-item active">pipeline.hifv.heuristics.lib_EVLApipeutils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pipeline.hifv.heuristics.lib_EVLApipeutils</h1><div class="highlight"><pre>
<span></span><span class="c1">######################################################################</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2013</span>
<span class="c1"># Associated Universities, Inc. Washington DC, USA,</span>
<span class="c1">#</span>
<span class="c1"># This library is free software; you can redistribute it and/or modify it</span>
<span class="c1"># under the terms of the GNU Library General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 2 of the License, or (at your</span>
<span class="c1"># option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This library is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="c1"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="c1"># FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Library General Public</span>
<span class="c1"># License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU Library General Public License</span>
<span class="c1"># along with this library; if not, write to the Free Software Foundation,</span>
<span class="c1"># Inc., 675 Massachusetts Ave, Cambridge, MA 02139, USA.</span>
<span class="c1">#</span>
<span class="c1"># Correspondence concerning VLA Pipelines should be addressed as follows:</span>
<span class="c1">#    Please register and submit helpdesk tickets via: https://help.nrao.edu</span>
<span class="c1">#    Postal address:</span>
<span class="c1">#              National Radio Astronomy Observatory</span>
<span class="c1">#              VLA Pipeline Support Office</span>
<span class="c1">#              PO Box O</span>
<span class="c1">#              Socorro, NM,  USA</span>
<span class="c1">#</span>
<span class="c1">######################################################################</span>
<span class="c1"># Functions for EVLA pipeline script</span>
<span class="c1"># Runs on CASA 3.4.0</span>
<span class="c1"># 05/01/12 CJC</span>
<span class="c1"># 05/03/12 STM some modified functions</span>
<span class="c1"># 06/19/12 STM handle channel sol flags</span>
<span class="c1"># 09/12/12 STM bug fix, add medians to getCalFlaggedSoln</span>
<span class="c1"># Runs on CASA 4.0.0</span>
<span class="c1"># 11/13/12 STM new SWIG calling method</span>
<span class="c1"># 11/19/12 STM add getCalStatistics function</span>
<span class="c1"># 12/17/12 STM add phases to getCalStatistics</span>
<span class="c1">######################################################################</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">pipeline.infrastructure</span> <span class="k">as</span> <span class="nn">infrastructure</span>
<span class="kn">from</span> <span class="nn">pipeline.infrastructure</span> <span class="kn">import</span> <span class="n">casa_tools</span>

<span class="n">LOG</span> <span class="o">=</span> <span class="n">infrastructure</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="getCalFlaggedSoln">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.lib_EVLApipeutils.getCalFlaggedSoln">[docs]</a>
<span class="k">def</span> <span class="nf">getCalFlaggedSoln</span><span class="p">(</span><span class="n">calTable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Version 2012-05-03 v1.0 STM to 3.4 from original 3.3 version, new dictionary</span>
<span class="sd">    Version 2012-05-03 v1.1 STM indexed by ant, spw also</span>
<span class="sd">    Version 2012-09-11 v1.1 STM correct doc of &lt;polid&gt; indexing, bug fix, median over ant</span>
<span class="sd">    Version 2012-09-12 v1.2 STM median over ant revised</span>
<span class="sd">    Version 2012-11-13 v2.0 STM casa 4.0 version with new call mechanism</span>
<span class="sd">    Version 2013-01-11 v2.1 STM use getvarcol</span>

<span class="sd">    This method will look at the specified calibration table and return the</span>
<span class="sd">    fraction of flagged solutions for each Antenna, SPW, Poln.  This assumes</span>
<span class="sd">    that the specified cal table will not have any channel dependent flagging.</span>

<span class="sd">    return structure is a dictionary with AntennaID and Spectral Window ID</span>
<span class="sd">    as the keys and returns a list of fractional flagging per polarization in</span>
<span class="sd">    the order specified in the Cal Table.</span>

<span class="sd">    STM 2012-05-03 revised dictionary structure:</span>
<span class="sd">    key: &#39;all&#39; all solutions</span>
<span class="sd">             [&#39;all&#39;][&#39;total&#39;] = &lt;number&gt;</span>
<span class="sd">             [&#39;all&#39;][&#39;flagged&#39;] = &lt;number&gt;</span>
<span class="sd">             [&#39;all&#39;][&#39;fraction&#39;] = &lt;fraction&gt;</span>

<span class="sd">         &#39;antspw&#39; indexed by antenna and spectral window id per poln</span>
<span class="sd">             [&#39;antspw&#39;][&lt;antid&gt;][&lt;spwid&gt;][&lt;polid&gt;][&#39;total&#39;] = &lt;total number sols per poln&gt;</span>
<span class="sd">             [&#39;antspw&#39;][&lt;antid&gt;][&lt;spwid&gt;][&lt;polid&gt;][&#39;flagged&#39;] = &lt;flagged number sols per poln&gt;</span>
<span class="sd">             [&#39;antspw&#39;][&lt;antid&gt;][&lt;spwid&gt;][&lt;polid&gt;][&#39;fraction&#39;] = &lt;flagged fraction per poln&gt;</span>

<span class="sd">         &#39;ant&#39; indexed by antenna summed over spectral window per poln</span>
<span class="sd">             [&#39;ant&#39;][&lt;antid&gt;][&lt;polid&gt;][&#39;total&#39;] = &lt;total number sols per poln&gt;</span>
<span class="sd">             [&#39;ant&#39;][&lt;antid&gt;][&lt;polid&gt;][&#39;flagged&#39;] = &lt;flagged number sols per poln&gt;</span>
<span class="sd">             [&#39;ant&#39;][&lt;antid&gt;][&lt;polid&gt;][&#39;fraction&#39;] = &lt;flagged fraction per poln&gt;</span>

<span class="sd">         &#39;spw&#39; indexed by spectral window summed over antenna per poln</span>
<span class="sd">             [&#39;spw&#39;][&lt;spwid&gt;][&lt;polid&gt;][&#39;total&#39;] = &lt;total number sols per poln&gt;</span>
<span class="sd">             [&#39;spw&#39;][&lt;spwid&gt;][&lt;polid&gt;][&#39;flagged&#39;] = &lt;flagged number sols per poln&gt;</span>
<span class="sd">             [&#39;spw&#39;][&lt;spwid&gt;][&lt;polid&gt;][&#39;fraction&#39;] = &lt;flagged fraction per poln&gt;</span>

<span class="sd">         &#39;antmedian&#39; median fractions over antenna summed over spw and polarization</span>
<span class="sd">             [&#39;total&#39;] = median &lt;total number sols per ant&gt;</span>
<span class="sd">             [&#39;flagged&#39;] = median &lt;flagged number sols per ant&gt;</span>
<span class="sd">             [&#39;fraction&#39;] = median &lt;flagged fraction of sols per ant&gt;</span>
<span class="sd">             [&#39;number&#39;] = number of antennas that went into the median</span>

<span class="sd">    Note that fractional numbers flagged per poln are computed as a fraction of channels</span>
<span class="sd">    (thus a full set of channels for a given ant/spw/poln count as 1.0)</span>

<span class="sd">    Example:</span>

<span class="sd">    !cp /home/sandrock2/smyers/casa/pipeline/lib_EVLApipeutils.py .</span>
<span class="sd">    from lib_EVLApipeutils import getCalFlaggedSoln</span>
<span class="sd">    result = getCalFlaggedSoln(&#39;calSN2010FZ.G0&#39;)</span>
<span class="sd">    result[&#39;all&#39;]</span>
<span class="sd">        Out: {&#39;flagged&#39;: 1212, &#39;fraction&#39;: 0.16031746031746033, &#39;total&#39;: 7560}</span>
<span class="sd">    result[&#39;antspw&#39;][21][7]</span>
<span class="sd">        Out: {0: {&#39;flagged&#39;: 3.0, &#39;fraction&#39;: 0.29999999999999999, &#39;total&#39;: 10},</span>
<span class="sd">              1: {&#39;flagged&#39;: 3.0, &#39;fraction&#39;: 0.29999999999999999, &#39;total&#39;: 10}}</span>
<span class="sd">    result[&#39;ant&#39;][15]</span>
<span class="sd">        Out: {0: {&#39;flagged&#39;: 60.0, &#39;fraction&#39;: 0.42857142857142855, &#39;total&#39;: 140},</span>
<span class="sd">              1: {&#39;flagged&#39;: 60.0, &#39;fraction&#39;: 0.42857142857142855, &#39;total&#39;: 140}}</span>
<span class="sd">    result[&#39;spw&#39;][3] </span>
<span class="sd">        Out: {0: {&#39;flagged&#39;: 39.0, &#39;fraction&#39;: 0.14444444444444443, &#39;total&#39;: 270},</span>
<span class="sd">              1: {&#39;flagged&#39;: 39.0, &#39;fraction&#39;: 0.14444444444444443, &#39;total&#39;: 270}}</span>

<span class="sd">    Bresult = getCalFlaggedSoln(&#39;calSN2010FZ.B0&#39;)</span>
<span class="sd">    Bresult[&#39;all&#39;]</span>
<span class="sd">        Out: {&#39;flagged&#39;: 69.171875, &#39;fraction&#39;: 0.091497189153439157, &#39;total&#39;: 756}</span>
<span class="sd">    Bresult[&#39;ant&#39;][15]</span>
<span class="sd">        Out: {0: {&#39;flagged&#39;: 6.03125, &#39;fraction&#39;: 0.43080357142857145, &#39;total&#39;: 14},</span>
<span class="sd">              1: {&#39;flagged&#39;: 6.03125, &#39;fraction&#39;: 0.43080357142857145, &#39;total&#39;: 14}}</span>
<span class="sd">    Bresult[&#39;antmedian&#39;]</span>
<span class="sd">        Out: {&#39;flagged&#39;: 0.0625, &#39;fraction&#39;: 0.002232142857142857, &#39;number&#39;: 27, &#39;total&#39;: 28.0}</span>

<span class="sd">    Another example, to make a list of spws in the caltable that have any</span>
<span class="sd">    unflagged solutions in them:</span>

<span class="sd">    G2result = getCalFlaggedSoln(&#39;calSN2010FZ.G2.2&#39;)</span>
<span class="sd">    goodspw = []</span>
<span class="sd">    for ispw in G2result[&#39;spw&#39;].keys():</span>
<span class="sd">       tot = 0</span>
<span class="sd">       flagd = 0</span>
<span class="sd">       for ipol in G2result[&#39;spw&#39;][ispw].keys():</span>
<span class="sd">          tot += G2result[&#39;spw&#39;][ispw][ipol][&#39;total&#39;]</span>
<span class="sd">          flagd += G2result[&#39;spw&#39;][ispw][ipol][&#39;flagged&#39;]</span>
<span class="sd">       if tot&gt;0:</span>
<span class="sd">          fract = flagd/tot</span>
<span class="sd">          if fract&lt;1.0:</span>
<span class="sd">             goodspw.append(ispw)</span>

<span class="sd">    goodspw</span>
<span class="sd">        Out: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">calTable</span><span class="p">)</span> <span class="k">as</span> <span class="n">mytb</span><span class="p">:</span>
        <span class="n">antCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;ANTENNA1&#39;</span><span class="p">)</span>
        <span class="n">spwCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SPECTRAL_WINDOW_ID&#39;</span><span class="p">)</span>
        <span class="n">fldCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)</span>
        <span class="c1"># flagCol = mytb.getcol(&#39;FLAG&#39;)</span>
        <span class="n">flagVarCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getvarcol</span><span class="p">(</span><span class="s1">&#39;FLAG&#39;</span><span class="p">)</span>

    <span class="c1"># Initialize a list to hold the results</span>
    <span class="c1"># Get shape of FLAG</span>
    <span class="c1"># (np,nc,ni) = flagCol.shape</span>
    <span class="n">rowlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">flagVarCol</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rowlist</span><span class="p">)</span>

    <span class="c1"># Create the output dictionary</span>
    <span class="n">outDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antmedian&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Ok now go through and for each row and possibly channel compile flags</span>
    <span class="n">ntotal</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nflagged</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Lists for median calc</span>
    <span class="n">medDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">medDict</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">medDict</span><span class="p">[</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">medDict</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">rrow</span> <span class="ow">in</span> <span class="n">rowlist</span><span class="p">:</span>
        <span class="n">rown</span> <span class="o">=</span> <span class="n">rrow</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rown</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">antIdx</span> <span class="o">=</span> <span class="n">antCol</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">spwIdx</span> <span class="o">=</span> <span class="n">spwCol</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="n">flagArr</span> <span class="o">=</span> <span class="n">flagVarCol</span><span class="p">[</span><span class="n">rrow</span><span class="p">]</span>
        <span class="c1"># Get the shape of this data row</span>
        <span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">ni</span><span class="p">)</span> <span class="o">=</span> <span class="n">flagArr</span><span class="o">.</span><span class="n">shape</span>
        <span class="c1"># ni should be 1 for this</span>
        <span class="n">iid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#</span>
        <span class="c1"># Set up dictionaries if needed</span>
        <span class="k">if</span> <span class="n">antIdx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">spwIdx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]:</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">spwIdx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">]:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1">#</span>
        <span class="c1"># Sum up the in-row (per pol per chan) flags for this row</span>
        <span class="n">nptotal</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">npflagged</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
            <span class="n">ntotal</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">nptotal</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ncflagged</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">flagArr</span><span class="p">[</span><span class="n">poln</span><span class="p">][</span><span class="n">chan</span><span class="p">][</span><span class="n">iid</span><span class="p">]:</span>
                    <span class="n">ncflagged</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">npflagged</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ncflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="n">nflagged</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ncflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1">#</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">npflagged</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">npflagged</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">npflagged</span>
            <span class="c1">#</span>

    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntotal</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nflagged</span>
    <span class="k">if</span> <span class="n">ntotal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">nflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ntotal</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Go back and get fractions</span>
    <span class="k">for</span> <span class="n">antIdx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">]:</span>
        <span class="n">nptotal</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">npflagged</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]:</span>
            <span class="n">nctotal</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
            <span class="n">ncflagged</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ncflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nctotal</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="n">nptotal</span> <span class="o">+=</span> <span class="n">nctotal</span>
            <span class="n">npflagged</span> <span class="o">+=</span> <span class="n">ncflagged</span>
        <span class="n">medDict</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nptotal</span><span class="p">)</span>
        <span class="n">medDict</span><span class="p">[</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">npflagged</span><span class="p">)</span>
        <span class="n">medDict</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">npflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nptotal</span><span class="p">))</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">spwIdx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">]:</span>
            <span class="n">nptotal</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
            <span class="n">npflagged</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">npflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nptotal</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="k">for</span> <span class="n">antIdx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">spwIdx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">]:</span>
                <span class="n">nptotal</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
                <span class="n">npflagged</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;flagged&#39;</span><span class="p">]</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;fraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">npflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nptotal</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># do medians</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antmedian&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">medDict</span><span class="p">:</span>
        <span class="n">alist</span> <span class="o">=</span> <span class="n">medDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="n">aarr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">alist</span><span class="p">)</span>
        <span class="n">amed</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">aarr</span><span class="p">)</span>
        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antmedian&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">amed</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antmedian&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">medDict</span><span class="p">[</span><span class="s1">&#39;fraction&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">outDict</span></div>



<div class="viewcode-block" id="getBCalStatistics">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.lib_EVLApipeutils.getBCalStatistics">[docs]</a>
<span class="k">def</span> <span class="nf">getBCalStatistics</span><span class="p">(</span><span class="n">calTable</span><span class="p">,</span><span class="n">innerbuff</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Version 2012-11-20 v1.0 STM casa 4.0 version</span>
<span class="sd">    Version 2012-12-17 v1.0 STM casa 4.1 version, phase, real, imag stats</span>

<span class="sd">    This method will look at the specified B calibration table and return the</span>
<span class="sd">    statistics of unflagged solutions for each Antenna, SPW, Poln.  This assumes</span>
<span class="sd">    that the specified cal table will not have any channel dependent flagging.</span>

<span class="sd">    return structure is a dictionary with AntennaID and Spectral Window ID</span>
<span class="sd">    as the keys and returns a list of statistics per polarization in</span>
<span class="sd">    the order specified in the Cal Table.</span>

<span class="sd">    Input:</span>

<span class="sd">         calTable  -  name of MS</span>
<span class="sd">         innerbuff -  fraction of spw bandwidth to ignore at each edge</span>
<span class="sd">                      (&lt;0.5, default=0.1 use inner 80% of channels each spw)</span>

<span class="sd">    Output: OutDict (return value)</span>

<span class="sd">    STM 2012-11-19 dictionary structure:</span>
<span class="sd">    key: &#39;antspw&#39; indexed by antenna and spectral window id per poln</span>
<span class="sd">             [&#39;antspw&#39;][&lt;antid&gt;][&lt;spwid&gt;][&lt;polid&gt;]</span>

<span class="sd">         &#39;antband&#39; indexed by antenna and rx/baseband summed over subbands and poln</span>
<span class="sd">             [&#39;ant&#39;][&lt;antid&gt;][&lt;rxband&gt;][&lt;baseband&gt;]</span>
<span class="sd">             Note: this requires that the spectral window NAME follow JVLA convention of</span>
<span class="sd">                   rxband#baseband#spw (e.g. &#39;EVLA_K#A0C0#48&#39;)</span>

<span class="sd">    For each of these there is a data structure for [&#39;all&#39;] and [&#39;inner&#39;]</span>
<span class="sd">    that contains the fields: [&#39;total&#39;], [&#39;number&#39;], [&#39;mean&#39;], [&#39;min&#39;], [&#39;max&#39;]</span>

<span class="sd">    Some useful indexing dictionaries are also output:</span>
<span class="sd">       [&#39;antDict&#39;][ant] the name of antenna with index ant</span>
<span class="sd">       [&#39;spwDict&#39;][spw] {&#39;RX&#39;:rx, &#39;Baseband&#39;:bb, &#39;Subband&#39;:sb} correspoding to a given spw</span>
<span class="sd">       [&#39;rxBasebandDict&#39;][rx][bb] list of spws corresponding to a given rx and bb</span>

<span class="sd">    Example:</span>

<span class="sd">    !cp /home/sandrock2/smyers/casa/pipeline/pipeline4.1/lib_EVLApipeutils.py .</span>
<span class="sd">    from lib_EVLApipeutils import getBCalStatistics</span>
<span class="sd">    result = getBCalStatistics(&#39;testBPcal.b&#39;)</span>

<span class="sd">    This is a B Jones table, proceeding</span>
<span class="sd">    Found 1 Rx bands</span>
<span class="sd">    Rx band EVLA_K has basebands: [&#39;A0C0&#39;, &#39;B0D0&#39;]</span>
<span class="sd">    Within all channels:</span>
<span class="sd">    Found 864 total solutions with 47824 good (unflagged)</span>
<span class="sd">    Within inner 0.8 of channels:</span>
<span class="sd">    Found 0 total solutions with 42619 good (unflagged)</span>

<span class="sd">        AntID      AntName      Rx-band      Baseband    min/max(all)  min/max(inner) ALERT?</span>
<span class="sd">            0         ea01       EVLA_K         A0C0        0.3541        0.3575 </span>
<span class="sd">            0         ea01       EVLA_K         B0D0        0.4585        0.4591 </span>
<span class="sd">            1         ea02       EVLA_K         A0C0        0.3239        0.3298 </span>
<span class="sd">            1         ea02       EVLA_K         B0D0        0.2130        0.2179 </span>
<span class="sd">            2         ea03       EVLA_K         A0C0        0.3097        0.3124 </span>
<span class="sd">            2         ea03       EVLA_K         B0D0        0.3247        0.3282 </span>
<span class="sd">            3         ea04       EVLA_K         A0C0        0.3029        0.3055 </span>
<span class="sd">            3         ea04       EVLA_K         B0D0        0.2543        0.2543 </span>
<span class="sd">            4         ea05       EVLA_K         A0C0        0.2657        0.2715 </span>
<span class="sd">            4         ea05       EVLA_K         B0D0        0.2336        0.2357 </span>
<span class="sd">            5         ea06       EVLA_K         A0C0        0.3474        0.3501 </span>
<span class="sd">            5         ea06       EVLA_K         B0D0        0.2371        0.2398 </span>
<span class="sd">            6         ea07       EVLA_K         A0C0        0.2294        0.2322 </span>
<span class="sd">            6         ea07       EVLA_K         B0D0        0.3684        0.3690 </span>
<span class="sd">            7         ea08       EVLA_K         A0C0        0.2756        0.2809 </span>
<span class="sd">            7         ea08       EVLA_K         B0D0        0.5269        0.5269 </span>
<span class="sd">            8         ea10       EVLA_K         A0C0        0.2617        0.2686 </span>
<span class="sd">            8         ea10       EVLA_K         B0D0        0.2362        0.2407 </span>
<span class="sd">            9         ea11       EVLA_K         A0C0        0.2594        0.2607 </span>
<span class="sd">            9         ea11       EVLA_K         B0D0        0.3015        0.3111 </span>
<span class="sd">           10         ea12       EVLA_K         A0C0        0.2418        0.2491 </span>
<span class="sd">           10         ea12       EVLA_K         B0D0        0.3839        0.3849 </span>
<span class="sd">           11         ea13       EVLA_K         A0C0        0.3017        0.3156 </span>
<span class="sd">           11         ea13       EVLA_K         B0D0        0.3299        0.3299 </span>
<span class="sd">           12         ea14       EVLA_K         A0C0        0.2385        0.2415 </span>
<span class="sd">           12         ea14       EVLA_K         B0D0        0.2081        0.2101 </span>
<span class="sd">           13         ea15       EVLA_K         A0C0        0.3118        0.3151 </span>
<span class="sd">           13         ea15       EVLA_K         B0D0        0.1749        0.1844 * </span>
<span class="sd">           14         ea16       EVLA_K         A0C0        0.2050        0.2051 </span>
<span class="sd">           14         ea16       EVLA_K         B0D0        0.4386        0.4537 </span>
<span class="sd">           15         ea17       EVLA_K         A0C0        0.4084        0.4107 </span>
<span class="sd">           15         ea17       EVLA_K         B0D0        0.2151        0.2189 </span>
<span class="sd">           16         ea18       EVLA_K         A0C0        0.3124        0.3147 </span>
<span class="sd">           16         ea18       EVLA_K         B0D0        0.3712        0.3730 </span>
<span class="sd">           17         ea19       EVLA_K         A0C0        0.3084        0.3132 </span>
<span class="sd">           17         ea19       EVLA_K         B0D0        0.2453        0.2522 </span>
<span class="sd">           18         ea20       EVLA_K         A0C0        0.4618        0.4672 </span>
<span class="sd">           18         ea20       EVLA_K         B0D0        0.2772        0.2790 </span>
<span class="sd">           19         ea21       EVLA_K         A0C0        0.3971        0.4032 </span>
<span class="sd">           19         ea21       EVLA_K         B0D0        0.2812        0.2818 </span>
<span class="sd">           20         ea22       EVLA_K         A0C0        0.2495        0.2549 </span>
<span class="sd">           20         ea22       EVLA_K         B0D0        0.3777        0.3833 </span>
<span class="sd">           21         ea23       EVLA_K         A0C0        0.3213        0.3371 </span>
<span class="sd">           21         ea23       EVLA_K         B0D0        0.2702        0.2787 </span>
<span class="sd">           22         ea24       EVLA_K         A0C0        0.2470        0.2525 </span>
<span class="sd">           22         ea24       EVLA_K         B0D0        0.0127        0.0127 *** </span>
<span class="sd">           23         ea25       EVLA_K         A0C0        0.3173        0.3205 </span>
<span class="sd">           23         ea25       EVLA_K         B0D0        0.0056        0.0066 *** </span>
<span class="sd">           24         ea26       EVLA_K         A0C0        0.3505        0.3550 </span>
<span class="sd">           24         ea26       EVLA_K         B0D0        0.4028        0.4071 </span>
<span class="sd">           25         ea27       EVLA_K         A0C0        0.3165        0.3244 </span>
<span class="sd">           25         ea27       EVLA_K         B0D0        0.2644        0.2683 </span>
<span class="sd">           26         ea28       EVLA_K         A0C0        0.1695        0.1712 * </span>
<span class="sd">           26         ea28       EVLA_K         B0D0        0.3213        0.3318 </span>

<span class="sd">    result[&#39;antband&#39;][22][&#39;EVLA_K&#39;][&#39;B0D0&#39;]</span>
<span class="sd">       Out: </span>
<span class="sd">         {&#39;all&#39;: {&#39;amp&#39;: {&#39;max&#39;: 3.3507643208628997,</span>
<span class="sd">                          &#39;mean&#39;: 1.2839660621605888,</span>
<span class="sd">                          &#39;min&#39;: 0.042473547230042749,</span>
<span class="sd">                          &#39;var&#39;: 0.42764307104292559},</span>
<span class="sd">                  &#39;imag&#39;: {&#39;max&#39;: array(1.712250828742981),</span>
<span class="sd">                           &#39;mean&#39;: -0.0042696134968516824,</span>
<span class="sd">                           &#39;min&#39;: array(-2.2086853981018066),</span>
<span class="sd">                           &#39;var&#39;: 0.43859873853192027},</span>
<span class="sd">                  &#39;number&#39;: 900,</span>
<span class="sd">                  &#39;phase&#39;: {&#39;max&#39;: 112.32456525225054,</span>
<span class="sd">                            &#39;mean&#39;: -0.70066399447640126,</span>
<span class="sd">                            &#39;min&#39;: -108.23612296337477,</span>
<span class="sd">                            &#39;var&#39;: 1445.9499062237583},</span>
<span class="sd">                  &#39;real&#39;: {&#39;max&#39;: array(3.3105719089508057),</span>
<span class="sd">                           &#39;mean&#39;: 1.0975328904785548,</span>
<span class="sd">                           &#39;min&#39;: array(-0.13342639803886414),</span>
<span class="sd">                           &#39;var&#39;: 0.433613996950728},</span>
<span class="sd">                  &#39;total&#39;: 1024},</span>
<span class="sd">          &#39;inner&#39;: {&#39;amp&#39;: {&#39;max&#39;: 3.3507643208628997,</span>
<span class="sd">                            &#39;mean&#39;: 1.2913493102726084,</span>
<span class="sd">                            &#39;min&#39;: 0.042473547230042749,</span>
<span class="sd">                            &#39;var&#39;: 0.45731194085061877},</span>
<span class="sd">                    &#39;imag&#39;: {&#39;max&#39;: array(1.712250828742981),</span>
<span class="sd">                             &#39;mean&#39;: -0.0019235184823728287,</span>
<span class="sd">                             &#39;min&#39;: array(-2.2086853981018066),</span>
<span class="sd">                             &#39;var&#39;: 0.43650578363669668},</span>
<span class="sd">                    &#39;number&#39;: 802,</span>
<span class="sd">                    &#39;phase&#39;: {&#39;max&#39;: 112.32456525225054,</span>
<span class="sd">                              &#39;mean&#39;: -0.74464737957566107,</span>
<span class="sd">                              &#39;min&#39;: -108.23612296337477,</span>
<span class="sd">                              &#39;var&#39;: 1496.4536912732597},</span>
<span class="sd">                    &#39;real&#39;: {&#39;max&#39;: array(3.3105719089508057),</span>
<span class="sd">                             &#39;mean&#39;: 1.1054519462910002,</span>
<span class="sd">                             &#39;min&#39;: array(-0.13342639803886414),</span>
<span class="sd">                             &#39;var&#39;: 0.4665390728630604},</span>
<span class="sd">                    &#39;total&#39;: 816}}</span>

<span class="sd">    result[&#39;rxBasebandDict&#39;][&#39;EVLA_K&#39;][&#39;B0D0&#39;]</span>
<span class="sd">       Out: [8, 9, 10, 11, 12, 13, 14, 15]</span>


<span class="sd">    result[&#39;antspw&#39;][22][10]</span>
<span class="sd">       Out: </span>
<span class="sd">         {0: {&#39;all&#39;: {&#39;amp&#39;: {&#39;max&#39;: 3.3507643208628997,</span>
<span class="sd">                              &#39;mean&#39;: 1.6887832659451747,</span>
<span class="sd">                              &#39;min&#39;: 0.054888048286296932,</span>
<span class="sd">                              &#39;var&#39;: 0.84305637195708472},</span>
<span class="sd">                      &#39;imag&#39;: {&#39;max&#39;: array(1.4643619060516357),</span>
<span class="sd">                               &#39;mean&#39;: -0.13419617990315968,</span>
<span class="sd">                               &#39;min&#39;: array(-2.2086853981018066),</span>
<span class="sd">                               &#39;var&#39;: 0.97892254522390565},</span>
<span class="sd">                      &#39;number&#39;: 59,</span>
<span class="sd">                      &#39;phase&#39;: {&#39;max&#39;: 112.32456525225054,</span>
<span class="sd">                                &#39;mean&#39;: -1.0111711887628112,</span>
<span class="sd">                                &#39;min&#39;: -102.4143890204484,</span>
<span class="sd">                                &#39;var&#39;: 2885.5110793438112},</span>
<span class="sd">                      &#39;real&#39;: {&#39;max&#39;: array(3.3105719089508057),</span>
<span class="sd">                               &#39;mean&#39;: 1.2845739619253926,</span>
<span class="sd">                               &#39;min&#39;: array(-0.13342639803886414),</span>
<span class="sd">                               &#39;var&#39;: 1.0099576839663802},</span>
<span class="sd">                      &#39;total&#39;: 64},</span>
<span class="sd">              &#39;inner&#39;: {&#39;amp&#39;: {&#39;max&#39;: 3.3507643208628997,</span>
<span class="sd">                                &#39;mean&#39;: 1.1064667538670538,</span>
<span class="sd">                                &#39;min&#39;: 0.054888048286296932,</span>
<span class="sd">                                &#39;var&#39;: 0.94882587512210448},</span>
<span class="sd">                        &#39;imag&#39;: {&#39;max&#39;: array(1.4643619060516357),</span>
<span class="sd">                                 &#39;mean&#39;: 0.056129313275038409,</span>
<span class="sd">                                 &#39;min&#39;: array(-2.2086853981018066),</span>
<span class="sd">                                 &#39;var&#39;: 0.55401604820332395},</span>
<span class="sd">                        &#39;number&#39;: 201,</span>
<span class="sd">                        &#39;phase&#39;: {&#39;max&#39;: 112.32456525225054,</span>
<span class="sd">                                  &#39;mean&#39;: 17.99353823044413,</span>
<span class="sd">                                  &#39;min&#39;: -102.4143890204484,</span>
<span class="sd">                                  &#39;var&#39;: 5065.0038289850836},</span>
<span class="sd">                        &#39;real&#39;: {&#39;max&#39;: array(3.3105719089508057),</span>
<span class="sd">                                 &#39;mean&#39;: 0.75592079894228781,</span>
<span class="sd">                                 &#39;min&#39;: array(-0.13342639803886414),</span>
<span class="sd">                                 &#39;var&#39;: 0.89091406078797231},</span>
<span class="sd">                        &#39;total&#39;: 51}},</span>
<span class="sd">         1: {&#39;all&#39;: {&#39;amp&#39;: {&#39;max&#39;: 1.0603890232940267,</span>
<span class="sd">                              &#39;mean&#39;: 0.9966154059201201,</span>
<span class="sd">                              &#39;min&#39;: 0.92736792814263314,</span>
<span class="sd">                              &#39;var&#39;: 0.032951023002670755},</span>
<span class="sd">                      &#39;imag&#39;: {&#39;max&#39;: array(0.28490364551544189),</span>
<span class="sd">                               &#39;mean&#39;: 0.10552169008859259,</span>
<span class="sd">                               &#39;min&#39;: array(-0.08266795426607132),</span>
<span class="sd">                               &#39;var&#39;: 0.017548692059680165},</span>
<span class="sd">                      &#39;number&#39;: 59,</span>
<span class="sd">                      &#39;phase&#39;: {&#39;max&#39;: 17.237656150196859,</span>
<span class="sd">                                &#39;mean&#39;: 6.0660176622725466,</span>
<span class="sd">                                &#39;min&#39;: -4.9577763029789832,</span>
<span class="sd">                                &#39;var&#39;: 40.224751029787001},</span>
<span class="sd">                      &#39;real&#39;: {&#39;max&#39;: array(1.047441840171814),</span>
<span class="sd">                               &#39;mean&#39;: 0.98505325640662234,</span>
<span class="sd">                               &#39;min&#39;: array(0.90479201078414917),</span>
<span class="sd">                               &#39;var&#39;: 0.032541082320460629},</span>
<span class="sd">                      &#39;total&#39;: 64},</span>
<span class="sd">              &#39;inner&#39;: {&#39;amp&#39;: {&#39;max&#39;: 1.0603890232940267,</span>
<span class="sd">                                &#39;mean&#39;: 1.0327309832106102,</span>
<span class="sd">                                &#39;min&#39;: 0.92837663017787742,</span>
<span class="sd">                                &#39;var&#39;: 0.19543922221719845},</span>
<span class="sd">                        &#39;imag&#39;: {&#39;max&#39;: array(0.26414120197296143),</span>
<span class="sd">                                 &#39;mean&#39;: 0.13256895535348001,</span>
<span class="sd">                                 &#39;min&#39;: array(-0.08266795426607132),</span>
<span class="sd">                                 &#39;var&#39;: 0.036957882304178208},</span>
<span class="sd">                        &#39;number&#39;: 201,</span>
<span class="sd">                        &#39;phase&#39;: {&#39;max&#39;: 15.395755389451365,</span>
<span class="sd">                                  &#39;mean&#39;: 7.3133434743802201,</span>
<span class="sd">                                  &#39;min&#39;: -4.9577763029789832,</span>
<span class="sd">                                  &#39;var&#39;: 18.607793373980815},</span>
<span class="sd">                        &#39;real&#39;: {&#39;max&#39;: array(1.047441840171814),</span>
<span class="sd">                                 &#39;mean&#39;: 1.0216352563400155,</span>
<span class="sd">                                 &#39;min&#39;: array(0.92740714550018311),</span>
<span class="sd">                                 &#39;var&#39;: 0.19275019403126262},</span>
<span class="sd">                        &#39;total&#39;: 51}}}</span>

<span class="sd">    NOTE: You can see the problem is in poln 0 of this spw from the amp range and phase.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># define range for &quot;inner&quot; channels</span>
    <span class="k">if</span> <span class="n">innerbuff</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">innerbuff</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">fcrange</span> <span class="o">=</span> <span class="p">[</span><span class="n">innerbuff</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">innerbuff</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fcrange</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>

    <span class="c1"># Print extra information here?</span>
    <span class="n">doprintall</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Create the output dictionary</span>
    <span class="n">outDict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">calTable</span><span class="p">)</span> <span class="k">as</span> <span class="n">mytb</span><span class="p">:</span>

        <span class="c1"># Check that this is a B Jones table</span>
        <span class="n">caltype</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getkeyword</span><span class="p">(</span><span class="s1">&#39;VisCal&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">caltype</span><span class="o">==</span><span class="s1">&#39;B Jones&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This is a B Jones table, proceeding&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This is NOT a B Jones table, aborting&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">outDict</span>

        <span class="n">antCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;ANTENNA1&#39;</span><span class="p">)</span>
        <span class="n">spwCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SPECTRAL_WINDOW_ID&#39;</span><span class="p">)</span>
        <span class="n">fldCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)</span>

        <span class="c1"># these columns are possibly variable in size</span>
        <span class="n">flagVarCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getvarcol</span><span class="p">(</span><span class="s1">&#39;FLAG&#39;</span><span class="p">)</span>
        <span class="n">dataVarCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getvarcol</span><span class="p">(</span><span class="s1">&#39;CPARAM&#39;</span><span class="p">)</span>

    <span class="c1"># get names from ANTENNA table</span>
    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">calTable</span> <span class="o">+</span> <span class="s1">&#39;/ANTENNA&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mytb</span><span class="p">:</span>
        <span class="n">antNameCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">)</span>
    <span class="n">nant</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">antNameCol</span><span class="p">)</span>

    <span class="n">antDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">iant</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nant</span><span class="p">):</span>
        <span class="n">antDict</span><span class="p">[</span><span class="n">iant</span><span class="p">]</span> <span class="o">=</span> <span class="n">antNameCol</span><span class="p">[</span><span class="n">iant</span><span class="p">]</span>

    <span class="c1"># get names from SPECTRAL_WINDOW table</span>
    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">calTable</span> <span class="o">+</span> <span class="s1">&#39;/SPECTRAL_WINDOW&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mytb</span><span class="p">:</span>
        <span class="n">spwNameCol</span> <span class="o">=</span> <span class="n">mytb</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">)</span>
    <span class="n">nspw</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">spwNameCol</span><span class="p">)</span>

    <span class="c1"># get baseband list</span>
    <span class="n">rxbands</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rxBasebandDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spwDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ispw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nspw</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">sb</span><span class="p">)</span> <span class="o">=</span> <span class="n">spwNameCol</span><span class="p">[</span><span class="n">ispw</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
            <span class="n">bb</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
            <span class="n">sb</span> <span class="o">=</span> <span class="n">ispw</span>
        <span class="n">spwDict</span><span class="p">[</span><span class="n">ispw</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RX&#39;</span><span class="p">:</span><span class="n">rx</span><span class="p">,</span> <span class="s1">&#39;Baseband&#39;</span><span class="p">:</span><span class="n">bb</span><span class="p">,</span> <span class="s1">&#39;Subband&#39;</span><span class="p">:</span><span class="n">sb</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">rxbands</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">rxbands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rx</span> <span class="ow">in</span> <span class="n">rxBasebandDict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bb</span> <span class="ow">in</span> <span class="n">rxBasebandDict</span><span class="p">[</span><span class="n">rx</span><span class="p">]:</span>
                <span class="n">rxBasebandDict</span><span class="p">[</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ispw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rxBasebandDict</span><span class="p">[</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ispw</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rxBasebandDict</span><span class="p">[</span><span class="n">rx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">rxBasebandDict</span><span class="p">[</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ispw</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">{}</span><span class="s1"> Rx bands&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rxbands</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="n">rxBasebandDict</span><span class="p">:</span>
        <span class="n">bblist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rxBasebandDict</span><span class="p">[</span><span class="n">rx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rx band </span><span class="si">{}</span><span class="s1"> has basebands: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">bblist</span><span class="p">))</span>

    <span class="c1"># Initialize a list to hold the results</span>
    <span class="c1"># Get shape of FLAG</span>
    <span class="c1"># (np,nc,ni) = flagCol.shape</span>
    <span class="c1"># Get shape of CPARAM</span>
    <span class="c1"># (np,nc,ni) = dataCol.shape</span>
    <span class="n">rowlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataVarCol</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rowlist</span><span class="p">)</span>

    <span class="c1"># Populate output dictionary structure</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Our fields will be: running &#39;n&#39;,&#39;mean&#39;,&#39;min&#39;,&#39;max&#39; for &#39;amp&#39;</span>
    <span class="c1"># Note - running mean(n+1) = ( n*mean(n) + x(n+1) )/(n+1) = mean(n) + (x(n+1)-mean(n))/(n+1)</span>

    <span class="c1"># Ok now go through for each row and possibly channel</span>
    <span class="n">ntotal</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ninner</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nflagged</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ngood</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ninnergood</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">rrow</span> <span class="ow">in</span> <span class="n">rowlist</span><span class="p">:</span>
        <span class="n">rown</span> <span class="o">=</span> <span class="n">rrow</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rown</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">antIdx</span> <span class="o">=</span> <span class="n">antCol</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">spwIdx</span> <span class="o">=</span> <span class="n">spwCol</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="n">dataArr</span> <span class="o">=</span> <span class="n">dataVarCol</span><span class="p">[</span><span class="n">rrow</span><span class="p">]</span>
        <span class="n">flagArr</span> <span class="o">=</span> <span class="n">flagVarCol</span><span class="p">[</span><span class="n">rrow</span><span class="p">]</span>
        <span class="c1"># Get the shape of this data row</span>
        <span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">ni</span><span class="p">)</span> <span class="o">=</span> <span class="n">dataArr</span><span class="o">.</span><span class="n">shape</span>
        <span class="c1"># ni should be 1 for this</span>
        <span class="n">iid</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># receiver and baseband and subband</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">spwDict</span><span class="p">[</span><span class="n">spwIdx</span><span class="p">][</span><span class="s1">&#39;RX&#39;</span><span class="p">]</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">spwDict</span><span class="p">[</span><span class="n">spwIdx</span><span class="p">][</span><span class="s1">&#39;Baseband&#39;</span><span class="p">]</span>
        <span class="n">sb</span> <span class="o">=</span> <span class="n">spwDict</span><span class="p">[</span><span class="n">spwIdx</span><span class="p">][</span><span class="s1">&#39;Subband&#39;</span><span class="p">]</span>

        <span class="c1"># Set up dictionaries if needed</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;inner&#39;</span><span class="p">]</span>
        <span class="n">quants</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="s1">&#39;imag&#39;</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;var&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">antIdx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">spwIdx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]:</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">rx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">bb</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">]:</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="n">part</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1">#</span>
        <span class="c1"># Sum up the in-row (per pol per chan) flags for this row</span>
        <span class="n">nptotal</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">npflagged</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">poln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="p">):</span>
            <span class="n">ntotal</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">nptotal</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ncflagged</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ncgood</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ncinnergood</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1">#</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">nc</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">fc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chan</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fc</span><span class="o">&gt;=</span><span class="n">fcrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fc</span><span class="o">&lt;</span><span class="n">fcrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1">#</span>
                <span class="k">if</span> <span class="n">flagArr</span><span class="p">[</span><span class="n">poln</span><span class="p">][</span><span class="n">chan</span><span class="p">][</span><span class="n">iid</span><span class="p">]:</span>
                    <span class="c1"># a flagged data point</span>
                    <span class="n">ncflagged</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cx</span> <span class="o">=</span> <span class="n">dataArr</span><span class="p">[</span><span class="n">poln</span><span class="p">][</span><span class="n">chan</span><span class="p">][</span><span class="n">iid</span><span class="p">]</span>
                    <span class="c1"># get quantities from complex data</span>
                    <span class="n">ampx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span>
                    <span class="n">phasx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">realx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span>
                    <span class="n">imagx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">cx</span><span class="p">)</span>
                    <span class="c1">#</span>
                    <span class="c1"># put in dictionary</span>
                    <span class="n">cdict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ampx</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phasx</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;real&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">realx</span>
                    <span class="n">cdict</span><span class="p">[</span><span class="s1">&#39;imag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">imagx</span>
                    <span class="c1"># an unflagged data point</span>
                    <span class="n">ncgood</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># Data stats</span>
                    <span class="c1"># By antspw per poln</span>
                    <span class="n">nx</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">nx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                            <span class="n">vx</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">vx</span><span class="o">&gt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vx</span>
                            <span class="k">if</span> <span class="n">vx</span><span class="o">&lt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vx</span>
                            <span class="c1"># Running mean(n+1) = mean(n) + (x(n+1)-mean(n))/(n+1)</span>
                            <span class="n">meanx</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
                            <span class="n">runx</span> <span class="o">=</span> <span class="n">meanx</span> <span class="o">+</span> <span class="p">(</span><span class="n">vx</span> <span class="o">-</span> <span class="n">meanx</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runx</span>
                            <span class="c1"># Running var(n+1) = {n*var(n)+[x(n+1)-mean(n)][x(n+1)-mean(n+1)]}/(n+1)</span>
                            <span class="n">varx</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
                            <span class="n">qx</span> <span class="o">=</span> <span class="n">nx</span><span class="o">*</span><span class="n">varx</span> <span class="o">+</span> <span class="p">(</span><span class="n">vx</span><span class="o">-</span><span class="n">meanx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vx</span><span class="o">-</span><span class="n">runx</span><span class="p">)</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qx</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># Now the rx-band stats</span>
                    <span class="n">ny</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ny</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                            <span class="n">vy</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">vy</span><span class="o">&gt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vy</span>
                            <span class="k">if</span> <span class="n">vy</span><span class="o">&lt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]:</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vy</span>
                            <span class="c1"># Running mean(n+1) = mean(n) + (x(n+1)-mean(n))/(n+1)</span>
                            <span class="n">meany</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
                            <span class="n">runy</span> <span class="o">=</span> <span class="n">meany</span> <span class="o">+</span> <span class="p">(</span><span class="n">vy</span> <span class="o">-</span> <span class="n">meany</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runy</span>
                            <span class="c1"># Running var(n+1) = {n*var(n)+[x(n+1)-mean(n)][x(n+1)-mean(n+1)]}/(n+1)</span>
                            <span class="n">vary</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
                            <span class="n">qy</span> <span class="o">=</span> <span class="n">ny</span><span class="o">*</span><span class="n">vary</span> <span class="o">+</span> <span class="p">(</span><span class="n">vy</span><span class="o">-</span><span class="n">meany</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vy</span><span class="o">-</span><span class="n">runy</span><span class="p">)</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qy</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1">#</span>
                    <span class="k">if</span> <span class="n">fc</span> <span class="o">&gt;=</span> <span class="n">fcrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fc</span> <span class="o">&lt;</span> <span class="n">fcrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="c1"># this chan lies in the &quot;inner&quot; part of the spw</span>
                        <span class="n">ncinnergood</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="c1"># Data stats</span>
                        <span class="c1"># By antspw per poln</span>
                        <span class="n">nx</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">nx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                                <span class="n">vx</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">vx</span><span class="o">&gt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
                                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vx</span>
                                <span class="k">if</span> <span class="n">vx</span><span class="o">&lt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]:</span>
                                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vx</span>
                                <span class="c1"># Running mean(n+1) = mean(n) + (x(n+1)-mean(n))/(n+1)</span>
                                <span class="n">meanx</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
                                <span class="n">runx</span> <span class="o">=</span> <span class="n">meanx</span> <span class="o">+</span> <span class="p">(</span><span class="n">vx</span> <span class="o">-</span> <span class="n">meanx</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runx</span>
                                <span class="c1"># Running var(n+1) = {n*var(n)+[x(n+1)-mean(n)][x(n+1)-mean(n+1)]}/(n+1)</span>
                                <span class="n">varx</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
                                <span class="n">qx</span> <span class="o">=</span> <span class="n">nx</span><span class="o">*</span><span class="n">varx</span> <span class="o">+</span> <span class="p">(</span><span class="n">vx</span><span class="o">-</span><span class="n">meanx</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vx</span><span class="o">-</span><span class="n">runx</span><span class="p">)</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qx</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antspw&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">spwIdx</span><span class="p">][</span><span class="n">poln</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="c1"># Now the rx-band stats</span>
                        <span class="n">ny</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">ny</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">quan</span> <span class="ow">in</span> <span class="n">quants</span><span class="p">:</span>
                                <span class="n">vy</span> <span class="o">=</span> <span class="n">cdict</span><span class="p">[</span><span class="n">quan</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">vy</span><span class="o">&gt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
                                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vy</span>
                                <span class="k">if</span> <span class="n">vy</span><span class="o">&lt;</span><span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]:</span>
                                    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vy</span>
                                <span class="c1"># Running mean(n+1) = mean(n) + (x(n+1)-mean(n))/(n+1)</span>
                                <span class="n">meany</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
                                <span class="n">runy</span> <span class="o">=</span> <span class="n">meany</span> <span class="o">+</span> <span class="p">(</span><span class="n">vy</span> <span class="o">-</span> <span class="n">meany</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runy</span>
                                <span class="c1"># Running var(n+1) = {n*var(n)+[x(n+1)-mean(n)][x(n+1)-mean(n+1)]}/(n+1)</span>
                                <span class="n">vary</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
                                <span class="n">qy</span> <span class="o">=</span> <span class="n">ny</span><span class="o">*</span><span class="n">vary</span> <span class="o">+</span> <span class="p">(</span><span class="n">vy</span><span class="o">-</span><span class="n">meany</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vy</span><span class="o">-</span><span class="n">runy</span><span class="p">)</span>
                                <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="n">quan</span><span class="p">][</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qy</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">antIdx</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;number&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">npflagged</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ncflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="n">nflagged</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ncflagged</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="n">ngood</span> <span class="o">+=</span> <span class="n">ncgood</span>
            <span class="n">ninnergood</span> <span class="o">+=</span> <span class="n">ncinnergood</span>

    <span class="c1"># Assemble rest of dictionary</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antDict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">antDict</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;spwDict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spwDict</span>
    <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;rxBasebandDict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxBasebandDict</span>

    <span class="c1"># Print summary</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Within all channels:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">{}</span><span class="s1"> total solutions with </span><span class="si">{}</span><span class="s1"> good (unflagged)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ntotal</span><span class="p">,</span> <span class="n">ngood</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Within inner </span><span class="si">{}</span><span class="s1"> of channels:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fcrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fcrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">{}</span><span class="s1"> total solutions with </span><span class="si">{}</span><span class="s1"> good (unflagged)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ninner</span><span class="p">,</span> <span class="n">ninnergood</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        AntID      AntName      Rx-band      Baseband    min/max(all)  min/max(inner) ALERT?&#39;</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># Print more?</span>
    <span class="k">if</span> <span class="n">doprintall</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ant</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">]:</span>
            <span class="n">antName</span> <span class="o">=</span> <span class="n">antDict</span><span class="p">[</span><span class="n">ant</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">ant</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">bb</span> <span class="ow">in</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">ant</span><span class="p">][</span><span class="n">rx</span><span class="p">]:</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">ant</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">ant</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;all&#39;</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
                    <span class="n">ymin</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">ant</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span>
                    <span class="n">ymax</span> <span class="o">=</span> <span class="n">outDict</span><span class="p">[</span><span class="s1">&#39;antband&#39;</span><span class="p">][</span><span class="n">ant</span><span class="p">][</span><span class="n">rx</span><span class="p">][</span><span class="n">bb</span><span class="p">][</span><span class="s1">&#39;inner&#39;</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">xmax</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">xrat</span> <span class="o">=</span> <span class="n">xmin</span><span class="o">/</span><span class="n">xmax</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xrat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">ymax</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">yrat</span> <span class="o">=</span> <span class="n">ymin</span><span class="o">/</span><span class="n">ymax</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">yrat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="c1">#</span>
                    <span class="k">if</span> <span class="n">yrat</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1"> *** &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ant</span><span class="p">,</span> <span class="n">antName</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">xrat</span><span class="p">,</span> <span class="n">yrat</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">yrat</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1"> ** &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ant</span><span class="p">,</span> <span class="n">antName</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">xrat</span><span class="p">,</span> <span class="n">yrat</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">yrat</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1"> * &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ant</span><span class="p">,</span> <span class="n">antName</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">xrat</span><span class="p">,</span> <span class="n">yrat</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1">  </span><span class="si">%12.4f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ant</span><span class="p">,</span> <span class="n">antName</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">xrat</span><span class="p">,</span> <span class="n">yrat</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">outDict</span></div>



<div class="viewcode-block" id="set_add_model_column_parameters">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.lib_EVLApipeutils.set_add_model_column_parameters">[docs]</a>
<span class="k">def</span> <span class="nf">set_add_model_column_parameters</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="c1"># get the clean parameters used in the last iteration to create the image products</span>
    <span class="n">imlist</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">sciimlist</span><span class="o">.</span><span class="n">get_imlist</span><span class="p">()</span>
    <span class="n">all_iterations_imaging_parameters</span> <span class="o">=</span> <span class="n">imlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;imaging_params&#39;</span><span class="p">]</span>
    <span class="n">last_iteration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_iterations_imaging_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">imaging_parameters</span> <span class="o">=</span> <span class="n">all_iterations_imaging_parameters</span><span class="p">[</span><span class="n">last_iteration</span><span class="p">]</span>

    <span class="c1"># update parameter with new values to write model column</span>
    <span class="n">imaging_parameters</span><span class="p">[</span><span class="s1">&#39;startmodel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">imaging_parameters</span><span class="p">[</span><span class="s1">&#39;niter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">imaging_parameters</span><span class="p">[</span><span class="s1">&#39;restoration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">imaging_parameters</span><span class="p">[</span><span class="s1">&#39;savemodel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;modelcolumn&#39;</span>
    <span class="n">imaging_parameters</span><span class="p">[</span><span class="s1">&#39;calcres&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">imaging_parameters</span><span class="p">[</span><span class="s1">&#39;calcpsf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">imaging_parameters</span><span class="p">[</span><span class="s1">&#39;parallel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">imaging_parameters</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020–2024, Pipeline Dev. Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>