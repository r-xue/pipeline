

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pipeline.hifv.heuristics.vlascanheuristics &mdash; Pipeline unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/custom_theme.css?v=678032d9" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=3f1b9271"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Pipeline Tasks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../pipeline_tasks/pipeline_tasks.html">Pipeline Heuristics Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Task (sphinx-autosummary)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.h.cli.html">pipeline.h.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hif.cli.html">pipeline.hif.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hifa.cli.html">pipeline.hifa.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hifv.cli.html">pipeline.hifv.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hsd.cli.html">pipeline.hsd.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.hsdn.cli.html">pipeline.hsdn.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Heuristics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../heuristics/field_parameter.html">Field parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../heuristics/FlaggingTasks.html">Pipeline Flagging Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Releases etc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases.html">Past Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modular.html">Run the Pipeline in a Conda environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dependencies.html">Dependencies of <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../basics.html"><code class="docutils literal notranslate"><span class="pre">pipeline.domain</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../basics.html#module-pipeline.infrastructure.launcher"><code class="docutils literal notranslate"><span class="pre">pipeline.infrastructure.launcher</span></code> module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html"><code class="docutils literal notranslate"><span class="pre">pipeline.hifa.tasks</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html#module-pipeline.hif.tasks"><code class="docutils literal notranslate"><span class="pre">pipeline.hif.tasks</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html#module-pipeline.hif"><code class="docutils literal notranslate"><span class="pre">pipeline.hif</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../task_classes.html#pipeline-inheritance-diagrams">Pipeline Inheritance Diagrams</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/ways_to_run_the_pipeline.html">Ways to run the Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/comparing_pipeline_executions.html">Comparing pipeline executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/building_the_pipeline.html">Building the pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/ALMA-Imaging-Workflow.html">ALMA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/VLA-Imaging-Workflow.html">VLA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/VLASS-SE-CONT-Imaging-Workflow.html">VLASS-SE-CONT imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/VLASS-SE-CUBE-Imaging-Workflow.html">VLASS-SE-CUBE imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/selfcal_workflow.html">VLASS Selfcal &amp; Restore workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/pipeline_tests.html">Pipeline testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/DataType_Testing.html">DataType Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/QA_scores.html">Pipeline Quality Assurance (QA) Score Class Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/DeveloperDocumentation.html">Pipeline developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/python3_conversion_notes.html">Python 3 conversion notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../develdocmd/recipes.html">Pipeline Recipes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples Notes (from Jupyter Notebooks)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/test1.html">test</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notes (from .rst)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/test2.html">Example 1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../pipeline.html">pipeline</a></li>
      <li class="breadcrumb-item active">pipeline.hifv.heuristics.vlascanheuristics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pipeline.hifv.heuristics.vlascanheuristics</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">pipeline.infrastructure.logging</span> <span class="k">as</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pipeline.infrastructure</span> <span class="kn">import</span> <span class="n">casa_tools</span>

<span class="c1"># the logger for this module</span>
<span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="buildscans">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.buildscans">[docs]</a>
<span class="k">def</span> <span class="nf">buildscans</span><span class="p">(</span><span class="n">msfile</span><span class="p">,</span> <span class="n">scd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    buildscans:  compile scan information for msfile</span>

<span class="sd">    Created S.T. Myers 2012-05-07  v1.0</span>
<span class="sd">    Updated S.T. Myers 2012-05-14  v1.1 add corrtype</span>
<span class="sd">    Updated S.T. Myers 2012-06-27  v1.2 add corrdesc lookup</span>
<span class="sd">    Updated S.T. Myers 2012-11-13  v2.0 STM casa 4.0 new calls</span>

<span class="sd">    Usage:</span>
<span class="sd">          from lib_EVLApipeutils import buildscans</span>

<span class="sd">    Input:</span>

<span class="sd">           msfile   -   name of MS</span>

<span class="sd">    Output: scandict (return value)</span>

<span class="sd">    Examples:</span>

<span class="sd">    CASA &lt;2&gt;: from lib_EVLApipeutils import buildscans</span>

<span class="sd">    CASA &lt;3&gt;: msfile = &#39;TRSR0045_sb600507.55900.ms&#39;</span>

<span class="sd">    CASA &lt;4&gt;: myscans = buildscans(msfile)</span>
<span class="sd">    Getting scansummary from MS</span>
<span class="sd">    Found 16 DataDescription IDs</span>
<span class="sd">    Found 4 StateIds</span>
<span class="sd">    Found 3422 times in DD=0</span>
<span class="sd">    Found 3422 times in DD=1</span>
<span class="sd">    Found 3422 times in DD=2</span>
<span class="sd">    Found 3422 times in DD=3</span>
<span class="sd">    Found 3422 times in DD=4</span>
<span class="sd">    Found 3422 times in DD=5</span>
<span class="sd">    Found 3422 times in DD=6</span>
<span class="sd">    Found 3422 times in DD=7</span>
<span class="sd">    Found 3422 times in DD=8</span>
<span class="sd">    Found 3422 times in DD=9</span>
<span class="sd">    Found 3422 times in DD=10</span>
<span class="sd">    Found 3422 times in DD=11</span>
<span class="sd">    Found 3422 times in DD=12</span>
<span class="sd">    Found 3422 times in DD=13</span>
<span class="sd">    Found 3422 times in DD=14</span>
<span class="sd">    Found 3422 times in DD=15</span>
<span class="sd">    Found total 54752 times</span>
<span class="sd">    Found 175 scans min=1 max=180</span>
<span class="sd">    Size of scandict in memory is 248 bytes</span>

<span class="sd">    CASA &lt;5&gt;: myscans[&#39;Scans&#39;][1][&#39;intents&#39;]</span>
<span class="sd">     Out[5]: &#39;CALIBRATE_AMPLI#UNSPECIFIED,UNSPECIFIED#UNSPECIFIED&#39;</span>

<span class="sd">    CASA &lt;6&gt;: myscans[&#39;Scans&#39;][1][&#39;dd&#39;]</span>
<span class="sd">     Out[6]: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</span>

<span class="sd">    CASA &lt;7&gt;: myscans[&#39;DataDescription&#39;][0]</span>
<span class="sd">     Out[7]:</span>
<span class="sd">    {&#39;corrdesc&#39;: [&#39;RR&#39;, &#39;RL&#39;, &#39;LR&#39;&#39;, &#39;LL&#39;],</span>
<span class="sd">    &#39;corrtype&#39;: [5, 6, 7, 8],</span>
<span class="sd">    &#39;ipol&#39;: 0,</span>
<span class="sd">    &#39;nchan&#39;: 64,</span>
<span class="sd">    &#39;npol&#39;: 4,</span>
<span class="sd">    &#39;reffreq&#39;: 994000000.0,</span>
<span class="sd">    &#39;spw&#39;: 0,</span>
<span class="sd">    &#39;spwname&#39;: &#39;Subband:0&#39;}</span>

<span class="sd">    CASA &lt;8&gt;: myscans[&#39;Scans&#39;][1][&#39;times&#39;][0]</span>
<span class="sd">     Out[8]:</span>
<span class="sd">    [4829843281.500001,</span>
<span class="sd">    4829843282.5,</span>
<span class="sd">    4829843283.5,</span>
<span class="sd">    4829843284.5,</span>
<span class="sd">    ...</span>
<span class="sd">    4829843336.5]</span>

<span class="sd">    The last of these returns the integration midpoints for scan 1 DD 0.</span>

<span class="sd">    Note that to get spw and pol info you use the DD indexes from [&#39;dd&#39;]</span>
<span class="sd">    in the &#39;Scans&#39; part to index into the &#39;DataDescription&#39; info.</span>

<span class="sd">    You can also list the keys available in the Scans sub-dictionary:</span>

<span class="sd">    CASA &lt;9&gt;: myscans[&#39;Scans&#39;][1].keys()</span>
<span class="sd">     Out[9]:</span>
<span class="sd">    [&#39;scan_mid&#39;,</span>
<span class="sd">    &#39;intents&#39;,</span>
<span class="sd">    &#39;field&#39;,</span>
<span class="sd">    &#39;dd&#39;,</span>
<span class="sd">    &#39;npol&#39;,</span>
<span class="sd">    &#39;rra&#39;,</span>
<span class="sd">    &#39;spw&#39;,</span>
<span class="sd">    &#39;scan_int&#39;,</span>
<span class="sd">    &#39;scan_start&#39;,</span>
<span class="sd">    &#39;times&#39;,</span>
<span class="sd">    &#39;scan_end&#39;,</span>
<span class="sd">    &#39;rdec&#39;]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># dictionary with lookup for correlation strings</span>
    <span class="c1"># from http://casa.nrao.edu/docs/doxygen/html/classcasa_1_1Stokes.html</span>
    <span class="n">cordesclist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Undefined&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;I&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Q&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;U&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;RR&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;RL&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;LR&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;LL&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;XX&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;XY&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;YX&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;YY&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;RX&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;RY&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;LX&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;LY&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;XR&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;XL&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;YR&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;YL&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;PP&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;PQ&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;QP&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;QQ&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;RCircular&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;LCircular&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Ptotal&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Plinear&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;PFtotal&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;PFlinear&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;Pangle&#39;</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># Usage: find desc for an index, e.g. cordesclist[corrtype]</span>
    <span class="c1">#        find index for a desc, e.g. cordesclist.index(corrdesc)</span>
    <span class="c1">#</span>

    <span class="c1"># ms = casa_tools.ms()</span>
    <span class="n">tb</span> <span class="o">=</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">table</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CACHE&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tb</span><span class="o">.</span><span class="n">showcache</span><span class="p">())</span>

    <span class="c1"># Access the MS</span>
    <span class="c1">####################################</span>
    <span class="c1"># try:</span>
    <span class="c1">#     ms.open(msfile,nomodify=True)</span>
    <span class="c1"># except:</span>
    <span class="c1">#     print &quot;ERROR: failed to open ms tool on file &quot;+msfile</span>
    <span class="c1">#     exit(1)</span>
    <span class="c1">####################################</span>

    <span class="c1"># print &#39;Getting scansummary from MS&#39;</span>
    <span class="c1"># get the scan summary using ms.getscansummary method</span>
    <span class="c1"># mysc = ms.getscansummary()</span>

    <span class="c1"># Already open - uncomment to run getscansummary</span>
    <span class="c1"># scd = ms.getscansummary()</span>

    <span class="c1"># #nscans = len( mysc[&#39;summary&#39;].keys() )</span>
    <span class="c1"># nscans = len( scd.keys() )</span>
    <span class="c1"># print &#39;Found &#39;+str(nscans)+&#39; scans&#39;</span>

    <span class="c1">#</span>
    <span class="c1"># Find number of data description IDs</span>
    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">msfile</span> <span class="o">+</span> <span class="s1">&#39;/DATA_DESCRIPTION&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">ddspwarr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;SPECTRAL_WINDOW_ID&quot;</span><span class="p">)</span>
        <span class="n">ddpolarr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;POLARIZATION_ID&quot;</span><span class="p">)</span>
    <span class="n">ddspwlist</span> <span class="o">=</span> <span class="n">ddspwarr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ddpollist</span> <span class="o">=</span> <span class="n">ddpolarr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ndd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ddspwlist</span><span class="p">)</span>
    <span class="c1"># print &#39;Found &#39;+str(ndd)+&#39; DataDescription IDs&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># The SPECTRAL_WINDOW table</span>
    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">msfile</span> <span class="o">+</span> <span class="s1">&#39;/SPECTRAL_WINDOW&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">nchanarr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;NUM_CHAN&quot;</span><span class="p">)</span>
        <span class="n">spwnamearr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
        <span class="n">reffreqarr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;REF_FREQUENCY&quot;</span><span class="p">)</span>
    <span class="n">nspw</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nchanarr</span><span class="p">)</span>
    <span class="n">spwlookup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">isp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nspw</span><span class="p">):</span>
        <span class="n">spwlookup</span><span class="p">[</span><span class="n">isp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">spwlookup</span><span class="p">[</span><span class="n">isp</span><span class="p">][</span><span class="s1">&#39;nchan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nchanarr</span><span class="p">[</span><span class="n">isp</span><span class="p">]</span>
        <span class="n">spwlookup</span><span class="p">[</span><span class="n">isp</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span> <span class="n">spwnamearr</span><span class="p">[</span><span class="n">isp</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">spwlookup</span><span class="p">[</span><span class="n">isp</span><span class="p">][</span><span class="s1">&#39;reffreq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reffreqarr</span><span class="p">[</span><span class="n">isp</span><span class="p">]</span>
    <span class="c1"># print &#39;Extracted information for &#39;+str(nspw)+&#39; SpectralWindows&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># Now the polarizations (number of correlations in each pol id</span>

    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">msfile</span> <span class="o">+</span> <span class="s1">&#39;/POLARIZATION&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">ncorarr</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;NUM_CORR&quot;</span><span class="p">)</span>
        <span class="c1"># corr_type is in general variable shape, have to read row-by-row</span>
        <span class="c1"># or use getvarcol to return into dictionary, we will iterate manually</span>
        <span class="n">npols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncorarr</span><span class="p">)</span>
        <span class="n">polindex</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">poldescr</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npols</span><span class="p">):</span>
            <span class="n">cort</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;CORR_TYPE&quot;</span><span class="p">,</span> <span class="n">startrow</span><span class="o">=</span><span class="n">ip</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">nct</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span> <span class="o">=</span> <span class="n">cort</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">cortypes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cordescs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ict</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nct</span><span class="p">):</span>
                <span class="n">cct</span> <span class="o">=</span> <span class="n">cort</span><span class="p">[</span><span class="n">ict</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cde</span> <span class="o">=</span> <span class="n">cordesclist</span><span class="p">[</span><span class="n">cct</span><span class="p">]</span>
                <span class="n">cortypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cct</span><span class="p">)</span>
                <span class="n">cordescs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cde</span><span class="p">)</span>
            <span class="n">polindex</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">cortypes</span>
            <span class="n">poldescr</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span> <span class="o">=</span> <span class="n">cordescs</span>
        <span class="c1"># cortype is an array of npol, e.g. 5,6,7,8 is for RR,RL,LR,LL respectively</span>
        <span class="c1"># for alma this would be 9,10,11,12 for XX,XY,YX,YY respectively</span>
        <span class="c1"># cordesc are the strings associated with the types (enum for casa)</span>

    <span class="c1"># print &#39;Extracted information for &#39;+str(npols)+&#39; Polarization Setups&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># Build the DD index</span>
    <span class="c1">#</span>
    <span class="n">ddindex</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ncorlist</span><span class="o">=</span><span class="n">ncorarr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndd</span><span class="p">):</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">isp</span> <span class="o">=</span> <span class="n">ddspwlist</span><span class="p">[</span><span class="n">idd</span><span class="p">]</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;spw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isp</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;spwname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spwlookup</span><span class="p">[</span><span class="n">isp</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;nchan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spwlookup</span><span class="p">[</span><span class="n">isp</span><span class="p">][</span><span class="s1">&#39;nchan&#39;</span><span class="p">]</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;reffreq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spwlookup</span><span class="p">[</span><span class="n">isp</span><span class="p">][</span><span class="s1">&#39;reffreq&#39;</span><span class="p">]</span>

        <span class="n">ipol</span> <span class="o">=</span> <span class="n">ddpollist</span><span class="p">[</span><span class="n">idd</span><span class="p">]</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;ipol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ipol</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;npol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncorlist</span><span class="p">[</span><span class="n">ipol</span><span class="p">]</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;corrtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polindex</span><span class="p">[</span><span class="n">ipol</span><span class="p">]</span>
        <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;corrdesc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poldescr</span><span class="p">[</span><span class="n">ipol</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># Now get raw scan intents from STATE table</span>
    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">msfile</span> <span class="o">+</span> <span class="s1">&#39;/STATE&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">intentarr</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;OBS_MODE&quot;</span><span class="p">)</span>
        <span class="n">subscanarr</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;SUB_SCAN&quot;</span><span class="p">)</span>
    <span class="n">intentlist</span> <span class="o">=</span> <span class="n">intentarr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">subscanlist</span> <span class="o">=</span> <span class="n">subscanarr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">nstates</span> <span class="o">=</span> <span class="n">intentlist</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()</span>
    <span class="c1"># print &#39;Found &#39;+str(nstates)+&#39; StateIds&#39;</span>
    <span class="c1">#</span>
    <span class="c1"># Now get FIELD table directions</span>
    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="n">msfile</span> <span class="o">+</span> <span class="s1">&#39;/FIELD&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
        <span class="n">fnamearr</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
        <span class="n">fpdirarr</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s2">&quot;PHASE_DIR&quot;</span><span class="p">)</span>
    <span class="n">flist</span> <span class="o">=</span> <span class="n">fnamearr</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">nfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">flist</span><span class="p">)</span>
    <span class="p">(</span><span class="n">nd1</span><span class="p">,</span> <span class="n">nd2</span><span class="p">,</span> <span class="n">npf</span><span class="p">)</span> <span class="o">=</span> <span class="n">fpdirarr</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">fielddict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ifld</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfields</span><span class="p">):</span>
        <span class="n">fielddict</span><span class="p">[</span><span class="n">ifld</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fielddict</span><span class="p">[</span><span class="n">ifld</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flist</span><span class="p">[</span><span class="n">ifld</span><span class="p">]</span>
        <span class="c1"># these are numpy.float64</span>
        <span class="n">fielddict</span><span class="p">[</span><span class="n">ifld</span><span class="p">][</span><span class="s1">&#39;rra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpdirarr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifld</span><span class="p">]</span>
        <span class="n">fielddict</span><span class="p">[</span><span class="n">ifld</span><span class="p">][</span><span class="s1">&#39;rdec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpdirarr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ifld</span><span class="p">]</span>
    <span class="c1">#</span>
    <span class="c1"># Now compile list of visibility times and info</span>
    <span class="c1">#</span>
    <span class="c1"># Extract times from the Main Table</span>
    <span class="c1"># Build lookup for DDs by scan_number</span>
    <span class="n">timdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ddlookup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ddscantimes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ntottimes</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">MSReader</span><span class="p">(</span><span class="n">msfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ms</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndd</span><span class="p">):</span>
            <span class="c1"># Select this DD (after reset if needed)</span>
            <span class="k">if</span> <span class="n">idd</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ms</span><span class="o">.</span><span class="n">selectinit</span><span class="p">(</span><span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ms</span><span class="o">.</span><span class="n">selectinit</span><span class="p">(</span><span class="n">idd</span><span class="p">)</span>
            <span class="c1"># recf = ms.getdata([&quot;flag&quot;])</span>
            <span class="c1"># (nx,nc,ni) = recf[&#39;flag&#39;].shape</span>
            <span class="c1"># get the times</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">getdata</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;field_id&quot;</span><span class="p">,</span> <span class="s2">&quot;scan_number&quot;</span><span class="p">],</span> <span class="n">ifraxis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ntottimes</span> <span class="o">+=</span> <span class="n">nt</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">{}</span><span class="s1"> times in DD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">idd</span><span class="p">))</span>

            <span class="n">timdict</span><span class="p">[</span><span class="n">idd</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">timdict</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
            <span class="n">timdict</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;field_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="s1">&#39;field_id&#39;</span><span class="p">]</span>
            <span class="n">timdict</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;scan_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="s1">&#39;scan_number&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="n">isc</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="s1">&#39;scan_number&#39;</span><span class="p">][</span><span class="n">it</span><span class="p">]</span>
                <span class="n">tim</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">it</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">isc</span> <span class="ow">in</span> <span class="n">ddlookup</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ddlookup</span><span class="p">[</span><span class="n">isc</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">idd</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ddlookup</span><span class="p">[</span><span class="n">isc</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idd</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">idd</span> <span class="ow">in</span> <span class="n">ddscantimes</span><span class="p">[</span><span class="n">isc</span><span class="p">]:</span>
                        <span class="n">ddscantimes</span><span class="p">[</span><span class="n">isc</span><span class="p">][</span><span class="n">idd</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tim</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ddscantimes</span><span class="p">[</span><span class="n">isc</span><span class="p">][</span><span class="n">idd</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tim</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ddlookup</span><span class="p">[</span><span class="n">isc</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">idd</span><span class="p">]</span>
                    <span class="n">ddscantimes</span><span class="p">[</span><span class="n">isc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">ddscantimes</span><span class="p">[</span><span class="n">isc</span><span class="p">][</span><span class="n">idd</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tim</span><span class="p">]</span>

    <span class="c1"># print &#39;Found total &#39;+str(ntottimes)+&#39; times&#39;</span>

    <span class="c1"># ms.close()</span>

    <span class="c1"># compile a list of scan times</span>
    <span class="c1">#</span>
    <span class="c1"># scd = mysc[&#39;summary&#39;]</span>
    <span class="n">scanlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">scanindex</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">scl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scd</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">sscan</span> <span class="ow">in</span> <span class="n">scl</span><span class="p">:</span>
        <span class="n">isc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sscan</span><span class="p">)</span>
        <span class="n">scanlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">isc</span><span class="p">)</span>
        <span class="n">scanindex</span><span class="p">[</span><span class="n">isc</span><span class="p">]</span><span class="o">=</span><span class="n">sscan</span>

    <span class="n">scanlist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">nscans</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scanlist</span><span class="p">)</span>
    <span class="c1"># print &#39;Found &#39;+str(nscans)+&#39; scans min=&#39;+str(min(scanlist))+&#39; max=&#39;+str(max(scanlist))</span>

    <span class="n">scantimes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">scandict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Put DataDescription lookup into dictionary</span>
    <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;DataDescription&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddindex</span>

    <span class="c1"># Put Scan information in dictionary</span>
    <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">isc</span> <span class="ow">in</span> <span class="n">scanlist</span><span class="p">:</span>
        <span class="n">sscan</span> <span class="o">=</span> <span class="n">scanindex</span><span class="p">[</span><span class="n">isc</span><span class="p">]</span>
        <span class="c1"># sub-scans, differentiated by StateId</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scd</span><span class="p">[</span><span class="n">sscan</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">scan_start</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="n">scan_end</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">:</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">scd</span><span class="p">[</span><span class="n">sscan</span><span class="p">][</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;BeginTime&#39;</span><span class="p">]</span>
            <span class="n">et</span> <span class="o">=</span> <span class="n">scd</span><span class="p">[</span><span class="n">sscan</span><span class="p">][</span><span class="n">ss</span><span class="p">][</span><span class="s1">&#39;EndTime&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">scan_start</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bt</span> <span class="o">&lt;</span> <span class="n">scan_start</span><span class="p">:</span>
                    <span class="n">scan_start</span> <span class="o">=</span> <span class="n">bt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scan_start</span> <span class="o">=</span> <span class="n">bt</span>
            <span class="k">if</span> <span class="n">scan_end</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">et</span> <span class="o">&gt;</span> <span class="n">scan_end</span><span class="p">:</span>
                    <span class="n">scan_end</span> <span class="o">=</span> <span class="n">et</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scan_end</span> <span class="o">=</span> <span class="n">et</span>
        <span class="n">scan_mid</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">scan_start</span> <span class="o">+</span> <span class="n">scan_end</span><span class="p">)</span>

        <span class="n">scan_int</span> <span class="o">=</span> <span class="n">scd</span><span class="p">[</span><span class="n">sscan</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;IntegrationTime&#39;</span><span class="p">]</span>

        <span class="n">scantimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scan_mid</span><span class="p">)</span>

        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;scan_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_start</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;scan_end&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_end</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;scan_mid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_mid</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;scan_int&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scan_int</span>

        <span class="n">ifld</span> <span class="o">=</span> <span class="n">scd</span><span class="p">[</span><span class="n">sscan</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;FieldId&#39;</span><span class="p">]</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifld</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;rra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fielddict</span><span class="p">[</span><span class="n">ifld</span><span class="p">][</span><span class="s1">&#39;rra&#39;</span><span class="p">]</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;rdec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fielddict</span><span class="p">[</span><span class="n">ifld</span><span class="p">][</span><span class="s1">&#39;rdec&#39;</span><span class="p">]</span>

        <span class="n">spws</span> <span class="o">=</span> <span class="n">scd</span><span class="p">[</span><span class="n">sscan</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;SpwIds&#39;</span><span class="p">]</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;spw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spws</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># state id of first sub-scan</span>
        <span class="n">stateid</span> <span class="o">=</span> <span class="n">scd</span><span class="p">[</span><span class="n">sscan</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;StateId&#39;</span><span class="p">]</span>
        <span class="c1"># get intents from STATE table</span>
        <span class="n">intents</span> <span class="o">=</span> <span class="n">intentlist</span><span class="p">[</span><span class="n">stateid</span><span class="p">]</span>
        <span class="c1"># this is a string with comma-separated intents</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;intents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intents</span>

        <span class="c1"># DDs for this scan</span>
        <span class="n">ddlist</span> <span class="o">=</span> <span class="n">ddlookup</span><span class="p">[</span><span class="n">isc</span><span class="p">]</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;dd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddlist</span>

        <span class="c1"># number of polarizations for this list of dds</span>
        <span class="n">ddnpollist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="n">ddlist</span><span class="p">:</span>
            <span class="n">npol</span> <span class="o">=</span> <span class="n">ddindex</span><span class="p">[</span><span class="n">idd</span><span class="p">][</span><span class="s1">&#39;npol&#39;</span><span class="p">]</span>
            <span class="n">ddnpollist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">npol</span><span class="p">)</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;npol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddnpollist</span>

        <span class="c1"># visibility times per dd in this scan</span>
        <span class="c1">#</span>
        <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;times&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="n">ddlist</span><span class="p">:</span>
            <span class="n">scandict</span><span class="p">[</span><span class="s1">&#39;Scans&#39;</span><span class="p">][</span><span class="n">isc</span><span class="p">][</span><span class="s1">&#39;times&#39;</span><span class="p">][</span><span class="n">idd</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddscantimes</span><span class="p">[</span><span class="n">isc</span><span class="p">][</span><span class="n">idd</span><span class="p">]</span>

    <span class="n">mysize</span> <span class="o">=</span> <span class="n">scandict</span><span class="o">.</span><span class="n">__sizeof__</span><span class="p">()</span>
    <span class="c1"># print &#39;Size of scandict in memory is &#39;+str(mysize)+&#39; bytes&#39;</span>

    <span class="c1"># print(&#39;CACHE END&#39;)</span>
    <span class="c1"># print(tb.showcache())</span>

    <span class="k">return</span> <span class="n">scandict</span></div>



<div class="viewcode-block" id="VLAScanHeuristics">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.VLAScanHeuristics">[docs]</a>
<span class="k">class</span> <span class="nc">VLAScanHeuristics</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis</span> <span class="o">=</span> <span class="n">vis</span>

<div class="viewcode-block" id="VLAScanHeuristics.makescandict">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.VLAScanHeuristics.makescandict">[docs]</a>
    <span class="k">def</span> <span class="nf">makescandict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run Steve&#39;s buildscans&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">MSReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">ms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_summary</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">getscansummary</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms_summary</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

        <span class="c1"># self.scandict = buildscans(self.vis, self.scan_summary)</span>
        <span class="c1"># self.startdate=float(self.ms_summary[&#39;BeginTime&#39;])</span>

        <span class="c1"># with casa_tools.TableReader(self.inputs.vis) as table:</span>
        <span class="c1">#     self.scanNums = sorted(numpy.unique(table.getcol(&#39;SCAN_NUMBER&#39;)))</span>

        <span class="c1"># These will be needed later in the pipeline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_solint1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_solint2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortsol1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shortsol2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longsolint</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_solint</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_gain_solint1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignorerefant</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fluxscale_sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxscale_flux_densities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluxscale_spws</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flagspw1</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flagspw1b</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flagspw2</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prep string listing of correlations from dictionary created by method buildscans</span>
<span class="sd">        For now, only use the parallel hands.  Cross hands will be implemented later.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.corrstring_list = self.scandict[&#39;DataDescription&#39;][0][&#39;corrdesc&#39;]</span>
        <span class="c1"># self.removal_list = [&#39;RL&#39;, &#39;LR&#39;, &#39;XY&#39;, &#39;YX&#39;]</span>
        <span class="c1"># self.corrstring_list = list(set(self.corrstring_list).difference(set(self.removal_list)))</span>
        <span class="c1"># self.corrstring = string.join(self.corrstring_list,&#39;,&#39;)</span>

        <span class="c1"># Create dictionary of band names from spw ids</span>
        <span class="c1"># self.spw2band = self.convertspw2band()</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="VLAScanHeuristics.calibratorIntentsOld">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.VLAScanHeuristics.calibratorIntentsOld">[docs]</a>
    <span class="k">def</span> <span class="nf">calibratorIntentsOld</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            # Identify scans and fields associated with different calibrator intents</span>

<span class="sd">            # NB: the scan intent definitions changed in the OPT on Feb 21,</span>
<span class="sd">            # 2012.  So test on date:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># tb = casa_tools.table()</span>
        <span class="c1"># print &#39;CAL INTENT CACHE 1:&#39;</span>
        <span class="c1"># print tb.showcache()</span>

        <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span> <span class="o">+</span> <span class="s1">&#39;/SPECTRAL_WINDOW&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;NUM_CHAN&#39;</span><span class="p">)</span>

        <span class="n">numSpws</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">MSReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">ms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms_summary</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

        <span class="n">startdate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_summary</span><span class="p">[</span><span class="s1">&#39;BeginTime&#39;</span><span class="p">])</span>

        <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span> <span class="o">+</span> <span class="s1">&#39;/STATE&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">intents</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;OBS_MODE&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointing_state_IDs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># print &#39;CAL INTENT CACHE 2:&#39;</span>
        <span class="c1"># print tb.showcache()</span>

        <span class="k">if</span> <span class="n">startdate</span> <span class="o">&lt;=</span> <span class="mf">55978.50</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">intents</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span> <span class="o">=</span> <span class="n">intents</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">intent</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span><span class="p">[</span><span class="n">intent</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">subscan_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span><span class="p">[</span><span class="n">intent</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_BANDPASS&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_DELAY&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_AMPLI&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_POLARIZATION&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_PHASE&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_POINTING&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pointing_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>

            <span class="c1"># casa_tools.table.open(self.vis)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># QA_msinfo=&#39;Fail&#39;</span>
                <span class="c1"># logprint(&quot;ERROR: No flux density calibration scans found&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No flux density calibration scans found&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 3:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Flux density calibrator(s) scans are &quot;</span>
                    <span class="c1"># +flux_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Flux density calibrator(s) are fields &quot;</span>
                    <span class="c1"># +flux_field_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 4:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;No bandpass calibration scans defined, using flux density calibrator(s)&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_select_string</span>
                <span class="c1"># logprint (&quot;Bandpass calibrator(s) scans are &quot;</span>
                <span class="c1"># +bandpass_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span>
                <span class="c1"># logprint (&quot;Bandpass calibrator(s) are fields &quot;</span>
                <span class="c1"># +bandpass_field_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 5:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Bandpass calibrator(s) scans are &quot;</span>
                    <span class="c1"># +bandpass_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Bandpass calibrator(s) are fields &quot;</span>
                    <span class="c1"># +bandpass_field_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># logprint (&quot;WARNING: More than one field is defined as the bandpass calibrator.&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: Models are required for all BP calibrators if multiple fields&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: are to be used, not yet implemented; the pipeline will use&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: only the first field.&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 6:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;No delay calibration scans defined, using bandpass calibrator&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span>
                <span class="c1"># logprint (&quot;Delay calibrator(s) scans are &quot;+delay_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span>
                <span class="c1"># logprint (&quot;Delay calibrator(s) are fields &quot;+delay_field_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Delay calibrator(s) scans are &quot;+delay_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Delay calibrator(s) are fields &quot;+delay_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_field_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="c1"># logprint (&quot;WARNING: More than one field is defined as the delay calibrator.&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: Models are required for all delay calibrators if multiple fields&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: are to be used, not yet implemented; the pipeline will use&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: only the first field.&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_field_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 7:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;No polarization calibration scans defined, no polarization calibration possible&quot;,</span>
                <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_select_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_select_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;Warning: polarization calibration scans found,</span>
                <span class="c1"># but polarization calibration not yet implemented&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Polarization calibrator(s) scans are &quot;+polarization_scan_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Polarization calibrator(s) are fields &quot;+polarization_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 8:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># QA_msinfo=&#39;Fail&#39;</span>
                <span class="c1"># logprint(&quot;ERROR: No gain calibration scans found&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No gain calibration scans found&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Phase calibrator(s) scans are &quot;+phase_scan_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Phase calibrator(s) are fields &quot;+phase_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 9:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="c1"># Find all calibrator scans and fields</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

            <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_scan_list</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_field_list</span><span class="p">])</span>
                <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># print &#39;CAL INTENT CACHE 10:&#39;</span>
            <span class="c1"># print tb.showcache()</span>

            <span class="c1"># casa_tools.table.close()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">intents</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span> <span class="o">=</span> <span class="n">intents</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">intent</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span><span class="p">[</span><span class="n">intent</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">subscan_intent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_intents</span><span class="p">[</span><span class="n">intent</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_BANDPASS&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_DELAY&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_FLUX&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_POLARIZATION&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_AMPLI&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">amp_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_PHASE&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_intent</span> <span class="o">==</span> <span class="s1">&#39;CALIBRATE_POINTING&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pointing_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_ID</span><span class="p">)</span>

            <span class="c1"># casa_tools.table.open(self.vis)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># QA_msinfo=&#39;Fail&#39;</span>
                <span class="c1"># logprint(&quot;ERROR: No flux density calibration scans found&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No flux density calibration scans found&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Flux density calibrator(s) scans are &quot;+flux_scan_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Flux density calibrator(s) are fields &quot;+flux_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 11:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;No bandpass calibration scans defined, using flux density calibrator&quot;,</span>
                <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_select_string</span>
                <span class="c1"># logprint (&quot;Bandpass calibrator(s) scans are &quot;+bandpass_scan_select_string,</span>
                <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span>
                <span class="c1"># logprint (&quot;Bandpass calibrator(s) are fields &quot;+bandpass_field_select_string,</span>
                <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Bandpass calibrator(s) scans are &quot;+bandpass_scan_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Bandpass calibrator(s) are fields &quot;+bandpass_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># logprint (&quot;WARNING: More than one field is defined as the bandpass calibrator.&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: Models are required for all BP calibrators if multiple fields&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: are to be used, not yet implemented; the pipeline will use&quot;,</span>
                        <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="c1"># logprint (&quot;WARNING: only the first field.&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 12:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;No delay calibration scans defined, using bandpass calibrator&quot;,</span>
                <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span>
                <span class="c1"># logprint (&quot;Delay calibrator(s) scans are &quot;+delay_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span>
                <span class="c1"># logprint (&quot;Delay calibrator(s) are fields &quot;+delay_field_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Delay calibrator(s) scans are &quot;+delay_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Delay calibrator(s) are fields &quot;+delay_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 13:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;No polarization calibration scans defined, no polarization calibration possible&quot;,</span>
                <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_select_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_select_string</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;Warning: polarization calibration scans found,</span>
                <span class="c1"># but polarization calibration not yet implemented&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polarization_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Polarization calibrator(s) scans are &quot;+polarization_scan_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Polarization calibrator(s) are fields &quot;+polarization_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 14:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># QA_msinfo=&#39;Fail&#39;</span>
                <span class="c1"># logprint(&quot;ERROR: No gain calibration scans found&quot;, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No gain calibration scans found&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Phase calibrator(s) scans are &quot;+phase_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Phase calibrator(s) are fields &quot;+phase_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 15:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_state_IDs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># logprint (&quot;No amplitude calibration scans defined, will use phase calibrator&quot;,</span>
                <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp_scan_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_select_string</span>
                <span class="c1"># logprint (&quot;Amplitude calibrator(s) scans are &quot;+amp_scan_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp_field_select_string</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_select_string</span>
                <span class="c1"># logprint (&quot;Amplitude calibrator(s) are fields &quot;+amp_field_select_string, logfileout=&#39;logs/msinfo.log&#39;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_state_IDs</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">amp_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">amp_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

                <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                    <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">amp_state_select_string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">amp_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">amp_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_scan_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Amplitude calibrator(s) scans are &quot;+amp_scan_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">amp_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">amp_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp_field_list</span><span class="p">])</span>
                    <span class="c1"># logprint (&quot;Amplitude calibrator(s) are fields &quot;+amp_field_select_string,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                    <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># print &#39;CAL INTENT CACHE 16:&#39;</span>
                <span class="c1"># print tb.showcache()</span>

            <span class="c1"># Find all calibrator scans and fields</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;STATE_ID in [</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">state_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_IDs</span><span class="p">[</span><span class="n">state_ID</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span> <span class="o">+=</span> <span class="s1">&#39;]&#39;</span>

            <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">subtable</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibrator_state_select_string</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_scan_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;SCAN_NUMBER&#39;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_scan_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_scan_list</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_field_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">subtable</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;FIELD_ID&#39;</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_field_select_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ii</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_field_list</span><span class="p">])</span>
                <span class="n">subtable</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># print &#39;CAL INTENT CACHE 17:&#39;</span>
            <span class="c1"># print tb.showcache()</span>

            <span class="c1"># casa_tools.table.close()</span>

        <span class="c1"># If there are any pointing state IDs, subtract 2 from the number of</span>
        <span class="c1"># science spws -- needed for QA scores</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointing_state_IDs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numSpws2</span> <span class="o">=</span> <span class="n">numSpws</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numSpws2</span> <span class="o">=</span> <span class="n">numSpws</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testgainscans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testgainscans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkflagfields</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkflagfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkflagfields</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="VLAScanHeuristics.calibratorIntents">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.VLAScanHeuristics.calibratorIntents">[docs]</a>
    <span class="k">def</span> <span class="nf">calibratorIntents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            # Identify scans and fields associated with different calibrator intents</span>

<span class="sd">            # NB: the scan intent definitions changed in the OPT on Feb 21,</span>
<span class="sd">            # 2012.  So test on date:</span>
<span class="sd">            # Test Implementation: JSK April 11, 2016</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">buildSelectionString</span><span class="p">(</span><span class="n">selectionList</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selectionList</span><span class="p">])</span>

        <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">MSMDReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">)</span> <span class="k">as</span> <span class="n">msmd</span><span class="p">:</span>
            <span class="c1"># We used to use CALIBRATE_AMPLI rather than FLUX</span>
            <span class="c1"># Note that in the current epoch we do not use the</span>
            <span class="c1"># CALIBRATE_AMPLI intent for anything.</span>
            <span class="c1"># There is an implicit assumption here that we only have one</span>
            <span class="c1"># observation in the MS</span>
            <span class="c1"># Changed April 2018 so that all flux scans and fields require FLUX,</span>
            <span class="c1">#   even prior to 2013.</span>
            <span class="k">if</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">quanta</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">timerangeforobs</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;begin&#39;</span><span class="p">][</span><span class="s1">&#39;m0&#39;</span><span class="p">],</span>
                                    <span class="n">casa_tools</span><span class="o">.</span><span class="n">quanta</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="s2">&quot;2012/02/21 12:00:00&quot;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">scansforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_FLUX*&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">fieldsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_FLUX*&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">scansforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_FLUX*&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">fieldsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_FLUX*&quot;</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No flux density calibration fields found&quot;</span><span class="p">)</span>

            <span class="c1"># Bandpass Cal Intent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span> <span class="o">=</span> \
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">scansforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_BANDPASS*&quot;</span><span class="p">))</span>
            <span class="n">bpfieldlist</span> <span class="o">=</span> <span class="n">msmd</span><span class="o">.</span><span class="n">fieldsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_BANDPASS*&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bpfieldlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">([</span><span class="n">bpfieldlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;More than one field is defined as the bandpass calibrator.&quot;</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;  Models are required for all BP calibrators if multiple fields &quot;</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;  are to be used, not yet implemented; the pipeline will use &quot;</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;  only the first field.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">bpfieldlist</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="c1"># Default to using the flux scan for bandpass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_scan_select_string</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_field_select_string</span>

            <span class="c1"># Delay Cal Intent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span> <span class="o">=</span> \
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">scansforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_DELAY*&quot;</span><span class="p">))</span>
            <span class="n">delayfieldlist</span> <span class="o">=</span> <span class="n">msmd</span><span class="o">.</span><span class="n">fieldsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_DELAY*&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delayfieldlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">([</span><span class="n">delayfieldlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;More than one field is defined as the delay calibrator.&quot;</span><span class="p">)</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;  The pipeline will use only the first field.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">=</span> \
                    <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">delayfieldlist</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="c1"># Default to using the bandpass for the delay</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span>

            <span class="c1"># Polarization Cal Intent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polarization_scan_select_string</span> <span class="o">=</span> \
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">scansforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_POLARIZATION*&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">polarization_field_select_string</span> <span class="o">=</span>\
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">fieldsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_POLARIZATION*&quot;</span><span class="p">))</span>

            <span class="c1"># Phase Cal Intent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_select_string</span> <span class="o">=</span> \
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">scansforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_PHASE*&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_select_string</span> <span class="o">=</span> \
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">fieldsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_PHASE*&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase_scan_select_string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_field_select_string</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No gain calibration scans found&quot;</span><span class="p">)</span>

            <span class="c1"># Find all calibrator scans and fields</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_scan_select_string</span> <span class="o">=</span> \
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">scansforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE*&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrator_field_select_string</span> <span class="o">=</span> \
                <span class="n">buildSelectionString</span><span class="p">(</span><span class="n">msmd</span><span class="o">.</span><span class="n">fieldsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE*&quot;</span><span class="p">))</span>

            <span class="c1"># JSK: Modifying the heuristic for dealing with the number of</span>
            <span class="c1">#      science SPWs after discussion with Claire 4/12/2016.</span>
            <span class="c1"># New Heuristic is: from numSpws2 subtract the number of spws that</span>
            <span class="c1">#     only appear in pointing scans.</span>
            <span class="c1">#</span>
            <span class="c1"># Here is the Old hueristic</span>
            <span class="c1"># If there are any pointing state IDs, subtract 2 from the number of</span>
            <span class="c1"># science spws -- needed for QA scores</span>
            <span class="c1"># if (len(self.pointing_state_IDs)&gt;0):</span>
            <span class="c1">#     self.numSpws2 = numSpws - 2</span>
            <span class="c1"># else:</span>
            <span class="c1">#     self.numSpws2 = numSpws</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numSpws2</span> <span class="o">=</span> <span class="n">msmd</span><span class="o">.</span><span class="n">nspw</span><span class="p">()</span>
            <span class="n">obsTargetSpws</span> <span class="o">=</span> <span class="n">msmd</span><span class="o">.</span><span class="n">spwsforintent</span><span class="p">(</span><span class="s2">&quot;OBSERVE_TARGET*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">pointingSpws</span> <span class="o">=</span> <span class="n">msmd</span><span class="o">.</span><span class="n">spwsforintent</span><span class="p">(</span><span class="s2">&quot;CALIBRATE_POINTING*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">spw</span> <span class="ow">in</span> <span class="n">pointingSpws</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">obsTargetSpws</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">spw</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">numSpws2</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="c1"># Here we pass through a set construct to get the unique union.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testgainscans</span> <span class="o">=</span> <span class="n">buildSelectionString</span><span class="p">(</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_scan_select_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))),</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkflagfields</span> <span class="o">=</span> <span class="n">buildSelectionString</span><span class="p">(</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))),</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="VLAScanHeuristics.find_3C84">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.VLAScanHeuristics.find_3C84">[docs]</a>
    <span class="k">def</span> <span class="nf">find_3C84</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">):</span>
        <span class="n">MAX_SEPARATION</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mf">2.0e-5</span>
        <span class="n">position_3C84</span> <span class="o">=</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">direction</span><span class="p">(</span><span class="s1">&#39;j2000&#39;</span><span class="p">,</span> <span class="s1">&#39;3h19m48.160&#39;</span><span class="p">,</span> <span class="s1">&#39;41d30m42.106&#39;</span><span class="p">)</span>
        <span class="n">fields_3C84</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">direction</span><span class="p">(</span><span class="s1">&#39;j2000&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;rad&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;rad&#39;</span><span class="p">)</span>
            <span class="n">separation</span> <span class="o">=</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">position_3C84</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
            <span class="k">if</span> <span class="n">separation</span> <span class="o">&lt;</span> <span class="n">MAX_SEPARATION</span><span class="p">:</span>
                <span class="n">fields_3C84</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fields_3C84</span></div>


<div class="viewcode-block" id="VLAScanHeuristics.determine3C84">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.VLAScanHeuristics.determine3C84">[docs]</a>
    <span class="k">def</span> <span class="nf">determine3C84</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #Determine if 3C84 was used as a bandpass or delay calibrator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">casa_tools</span><span class="o">.</span><span class="n">TableReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vis</span> <span class="o">+</span> <span class="s1">&#39;/FIELD&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">table</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">field_positions</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getcol</span><span class="p">(</span><span class="s1">&#39;PHASE_DIR&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">field_positions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_positions</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fields_3C84</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_3C84</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cal3C84_d</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cal3C84_bp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># uvrange3C84 = &#39;0~1800klambda&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uvrange3C84</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields_3C84</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">for</span> <span class="n">field_int</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields_3C84</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_int</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cal3C84_d</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># logprint(&quot;WARNING: 3C84 was observed as a delay calibrator, uvrange limits may be used&quot;,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">field_int</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandpass_field_select_string</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cal3C84_bp</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># logprint(&quot;WARNING: 3C84 was observed as a BP calibrator, uvrange limits may be used&quot;,</span>
                    <span class="c1"># logfileout=&#39;logs/msinfo.log&#39;)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cal3C84_d</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cal3C84_bp</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cal3C84</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cal3C84</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="testCalibratorIntents">
<a class="viewcode-back" href="../../../../_apidoc/pipeline.hifv.heuristics.html#pipeline.hifv.heuristics.vlascanheuristics.testCalibratorIntents">[docs]</a>
<span class="k">def</span> <span class="nf">testCalibratorIntents</span><span class="p">(</span><span class="n">vis</span><span class="p">):</span>
    <span class="c1"># This is a temporary test program to see if the two methods of generating</span>
    <span class="c1"># intents yield the same answers.</span>
    <span class="c1"># To use:</span>
    <span class="c1"># from pipeline.hifv.heuristics.vlascanheuristics import testCalibratorIntents</span>
    <span class="c1"># testCalibratorIntents(&lt;Name of MS&gt;)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing Comparison of: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vis</span><span class="p">))</span>

    <span class="n">origObj</span> <span class="o">=</span> <span class="n">VLAScanHeuristics</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span>
    <span class="n">newObj</span> <span class="o">=</span> <span class="n">VLAScanHeuristics</span><span class="p">(</span><span class="n">vis</span><span class="p">)</span>
    <span class="n">exceptionThrown</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">origObj</span><span class="o">.</span><span class="n">calibratorIntentsOld</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;origObj: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">exceptionThrown</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">newObj</span><span class="o">.</span><span class="n">calibratorIntents</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;newObj: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">exceptionThrown</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Now do the comparison:</span>
    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">flux_scan_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">flux_scan_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flux_scan_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">flux_scan_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">flux_scan_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">flux_field_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">flux_field_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;flux_field_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">flux_field_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">flux_field_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bandpass_scan_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">bandpass_scan_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">bandpass_field_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">bandpass_field_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bandpass_field_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">bandpass_field_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">bandpass_field_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">delay_scan_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">delay_scan_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;delay_scan_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">delay_scan_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">delay_scan_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">delay_field_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;delay_field_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">delay_field_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">polarization_scan_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">polarization_scan_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;polarization_scan_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">polarization_scan_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">polarization_scan_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">polarization_field_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">polarization_field_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;polarization_field_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">polarization_field_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">polarization_field_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">phase_scan_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">phase_scan_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phase_scan_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">phase_scan_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">phase_scan_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">phase_field_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">phase_field_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;phase_field_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">phase_field_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">phase_field_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">calibrator_scan_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">calibrator_scan_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calibrator_scan_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">calibrator_scan_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">calibrator_scan_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">calibrator_field_select_string</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">calibrator_field_select_string</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calibrator_field_select_strings Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">calibrator_field_select_string</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">calibrator_field_select_string</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">testgainscans</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">testgainscans</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;testgainscanss Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">testgainscans</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">testgainscans</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">checkflagfields</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">checkflagfields</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;checkflagfieldss Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">checkflagfields</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">checkflagfields</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">origObj</span><span class="o">.</span><span class="n">numSpws2</span> <span class="o">!=</span> <span class="n">newObj</span><span class="o">.</span><span class="n">numSpws2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;numSpws2 Differ:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Orig: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">origObj</span><span class="o">.</span><span class="n">numSpws2</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">New:  </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">newObj</span><span class="o">.</span><span class="n">numSpws2</span><span class="p">))</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020–2024, Pipeline Dev. Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>