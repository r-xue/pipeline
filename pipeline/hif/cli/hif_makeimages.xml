<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task category="pipeline" name="hif_makeimages" type="function">
<shortdescription>Compute clean map</shortdescription>
<description>
Compute clean results from a list of specified targets.  

Output:

results -- If pipeline mode is 'getinputs' then None is returned. Otherwise
           the results object for the pipeline task is returned.
</description>
<input>

  <param name="vis" subparam="true" type="stringVec">
    <shortdescription>List of input MeasurementSets</shortdescription>
    <description>The list of input MeasurementSets. Defaults to the list of
                 MeasurementSets specified in the h_init or hif_importdata task.
                 '': use all MeasurementSets in the context

                 Examples: 'ngc5921.ms', ['ngc5921a.ms', ngc5921b.ms', 'ngc5921c.ms']
    </description>
    <value/>
  </param>

  <param name="target_list" subparam="true" type="any">
    <any type="variant"/>
    <shortdescription>Dictionary specifying targets to be imaged; blank will read list from context</shortdescription>
    <description>Dictionary specifying targets to be imaged; blank will read list from context</description>
    <value>{}</value>
  </param>

  <param name="hm_masking" type="string">
     <shortdescription>Pipeline heuristics masking mode</shortdescription>
     <description>Clean masking mode. Options are 'centralregion', 'auto',
                  'manual' and 'none'
     </description>
       <value>auto</value>
       <allowed kind="enum">
         <value>auto</value>
         <value>centralregion</value>
         <value>none</value>
         <value>manual</value>
         <value/>
       </allowed>
  </param>

  <param name="hm_sidelobethreshold" subparam="true" type="double">
     <shortdescription>sidelobethreshold * the max sidelobe level</shortdescription>
     <description>sidelobethreshold * the max sidelobe level</description>
     <value>-999.0</value>
  </param>

  <param name="hm_noisethreshold" subparam="true" type="double">
     <shortdescription>noisethreshold * rms in residual image</shortdescription>
     <description>noisethreshold * rms in residual image</description>
     <value>-999.0</value>
  </param>

  <param name="hm_lownoisethreshold" subparam="true" type="double">
     <shortdescription>lownoisethreshold * rms in residual image</shortdescription>
     <description>lownoisethreshold * rms in residual image</description>
     <value>-999.0</value>
  </param>

  <param name="hm_negativethreshold" subparam="true" type="double">
     <shortdescription>negativethreshold * rms in residual image</shortdescription>
     <description>negativethreshold * rms in residual image</description>
     <value>-999.0</value>
  </param>

  <param name="hm_minbeamfrac" subparam="true" type="double">
     <shortdescription>Minimum beam fraction for pruning</shortdescription>
     <description>Minimum beam fraction for pruning</description>
     <value>-999.0</value>
  </param>

  <param name="hm_growiterations" subparam="true" type="int">
     <shortdescription>Number of binary dilation iterations for growing the mask</shortdescription>
     <description>Number of binary dilation iterations for growing the mask</description>
     <value>-999</value>
  </param>

  <param name="hm_dogrowprune" subparam="true" type="any">
    <shortdescription>Do pruning on the grow mask</shortdescription>
    <description>Do pruning on the grow mask

                 Defaults to '' to enable the automatic heuristics calculation.
                 Can be set to True or False manually.
    </description>
    <any type="variant"/>
    <value type="string"/>
  </param>

  <param name="hm_minpercentchange" subparam="true" type="double">
     <shortdescription>Mask size change threshold</shortdescription>
     <description>Mask size change threshold</description>
     <value>-999.0</value>
  </param>

  <param name="hm_fastnoise" type="any">
    <shortdescription>Faster noise calucation for automask or nsigma stopping</shortdescription>
    <description>Faster noise calucation for automask or nsigma stopping

                 Defaults to '' to enable the automatic heuristics calculation.
                 Can be set to True or False manually.
    </description>
    <any type="variant"/>
    <value type="string"/>
  </param>

  <param name="hm_nsigma" type="double">
    <shortdescription>Multiplicative factor for rms-based threshold stopping</shortdescription>
    <description>Multiplicative factor for rms-based threshold stopping</description>
    <value>0.0</value>
  </param>

  <param name="hm_perchanweightdensity" type="any">
    <shortdescription>Calculate the weight density for each channel independently</shortdescription>
    <description>Calculate the weight density for each channel independently

                 Defaults to '' to enable the automatic heuristics calculation.
                 Can be set to True or False manually.
    </description>
    <any type="variant"/>
    <value type="string"/>
  </param>

  <param name="hm_npixels" type="int">
    <shortdescription>Number of pixels to determine uv-cell size for super-uniform weighting</shortdescription>
    <description>Number of pixels to determine uv-cell size for super-uniform weighting</description>
    <value>0</value>
  </param>

  <param name="hm_cyclefactor" type="double">
    <shortdescription>Scaling on PSF sidelobe level to compute the minor-cycle stopping threshold</shortdescription>
    <description>Scaling on PSF sidelobe level to compute the minor-cycle stopping threshold</description>
    <value>-999.0</value>
  </param>

  <param name="hm_minpsffraction" type="double">
    <shortdescription>PSF fraction that marks the max depth of cleaning in the minor cycle</shortdescription>
    <description>PSF fraction that marks the max depth of cleaning in the minor cycle</description>
    <value>-999.0</value>
  </param>

  <param name="hm_maxpsffraction" type="double">
    <shortdescription>PSF fraction that marks the minimum depth of cleaning in the minor cycle</shortdescription>
    <description>PSF fraction that marks the minimum depth of cleaning in the minor cycle</description>
    <value>-999.0</value>
  </param>

  <param name="hm_weighting" type="any">
    <shortdescription>Weighting scheme (natural,uniform,briggs,briggsabs[experimental],briggsbwtaper[experimental])</shortdescription>
    <description>Weighting scheme (natural,uniform,briggs,briggsabs[experimental],briggsbwtaper[experimental])</description>
    <any type="variant"/>
    <value type="string"/>
  </param>

  <param name="hm_cleaning" type="string">
    <shortdescription>Pipeline cleaning mode </shortdescription>
    <description>Pipeline cleaning mode </description>
    <value/>
    <allowed kind="enum">
      <value/>
      <value>rms</value>
      <value>sensitivity</value>
      <value>timesmask</value>
      <value>manual</value>
    </allowed>
  </param>

  <param name="tlimit" subparam="true" type="double">
    <shortdescription>Times the sensitivity limit for cleaning</shortdescription>
    <description>Times the sensitivity limit for cleaning</description>
    <value>2.0</value>
  </param>

  <param name="drcorrect" type="double">
    <shortdescription>Apply a specific dynamic range correction factor instead of the heuristics-based value</shortdescription>
    <description>Apply a specific dynamic range correction factor instead of the heuristics-based value</description>
    <value type="double">-999.0</value>
  </param>

  <param name="masklimit" subparam="true" type="int">
    <shortdescription>Times good mask pixels for cleaning</shortdescription>
    <description>Times good mask pixels for cleaning</description>
    <value>4</value>
  </param>

  <param name="cleancontranges" type="bool">
    <shortdescription>Clean continuum frequency ranges in cubes</shortdescription>
    <description>Clean continuum frequency ranges in cubes</description>
    <value>False</value>
  </param>

  <param name="calcsb" type="bool">
    <shortdescription>Force (re-)calculation of sensitivities and beams</shortdescription>
    <description>Force (re-)calculation of sensitivities and beams</description>
    <value>False</value>
  </param>

  <param name="hm_mosweight" type="any">
    <shortdescription>Mosaic weighting</shortdescription>
    <description>Mosaic weighting

                 Defaults to '' to enable the automatic heuristics calculation.
                 Can be set to True or False manually.
    </description>
    <any type="variant"/>
    <value type="string"/>
  </param>

  <param name="overwrite_on_export" type="bool">
    <shortdescription>Replace existing image products</shortdescription>
    <description>Replace existing image products when h/hifa/hifv_exportdata is
                 called.
                 If False, images that would have the same FITS name on export,
                 are amended to include a version number.  For example, if
                 oussid.J1248-4559_ph.spw21.mfs.I.pbcor.fits would already be
                 exported by a previous call to hif_makeimags, then
                 'oussid.J1248-4559_ph.spw21.mfs.I.pbcor.v2.fits' would also be
                 exported to the products/ directory. The first exported
                 product retains the same name.  Additional products start
                 counting with 'v2', 'v3', etc.
    </description>
    <value>True</value>
  </param>

  <param name="parallel" type="string">
    <shortdescription>Clean images using MPI cluster</shortdescription>
    <description>Clean images using MPI cluster</description>
    <value>automatic</value>
    <allowed kind="enum">
      <value>automatic</value>
      <value>true</value>
      <value>false</value>
    </allowed>
  </param>

  <param name="pipelinemode" type="string">
    <shortdescription>The pipeline operating mode</shortdescription>
    <description>The pipeline operating mode.
                 In 'automatic' mode the pipeline determines the values of all
                 context defined pipeline inputs automatically.
                 In 'interactive' mode the user can set the pipeline context
                 defined parameters manually.
                 In 'getinputs' mode the user can check the settings of all
                 pipeline parameters without running the task.
    </description>
    <value>automatic</value>
    <allowed kind="enum">
      <value>automatic</value>
      <value>interactive</value>
      <value>getinputs</value>
    </allowed>
  </param>

  <param name="dryrun" subparam="true" type="bool">
    <shortdescription>Run the task (False) or just display the command (True)
    </shortdescription>
    <description>Run the task (False) or just display the command (True)
    </description>
    <value>False</value>
  </param>

  <param name="acceptresults" subparam="true" type="bool">
    <shortdescription>Add the results to the pipeline context</shortdescription>
    <description>Add the results to the pipeline context</description>
   <value>True</value>
  </param>


  <constraints>

    <when param="pipelinemode">
      <equals type="string" value="automatic"/>
      <equals type="string" value="interactive">
        <default param="vis"><value type="stringVec"/></default>
        <default param="target_list"><value>{}</value></default>
        <default param="dryrun"><value type="bool">False</value></default>
        <default param="acceptresults"><value type="bool">True</value></default>
      </equals>
      <equals type="string" value="getinputs">
        <default param="vis"><value type="stringVec"/></default>
        <default param="target_list"><value>{}</value></default>
      </equals>
    </when>

    <when param="hm_masking">
      <equals value="auto">
        <default param="hm_sidelobethreshold"><value type="double">-999.0</value></default>
        <default param="hm_noisethreshold"><value type="double">-999.0</value></default>
        <default param="hm_lownoisethreshold"><value type="double">-999.0</value></default>
        <default param="hm_negativethreshold"><value type="double">-999.0</value></default>
        <default param="hm_minbeamfrac"><value type="double">-999.0</value></default>
        <default param="hm_growiterations"><value type="int">-999</value></default>
        <default param="hm_dogrowprune"><value type="bool">True</value></default>
        <default param="hm_minpercentchange"><value type="double">-999.0</value></default>
      </equals>
      <equals value="centralregion">
      </equals>
      <equals value="none">
      </equals>
      <equals value="">
      </equals>
    </when>

    <when param="hm_cleaning">
      <equals value="">
      </equals>
      <equals value="rms">
        <default param="tlimit"><value type="double">2.0</value></default>
      </equals>
      <equals value="sensitivity">
        <default param="tlimit"><value type="double">2.0</value></default>
      </equals>
      <equals value="timesmask">
        <default param="masklimit"><value type="int">4</value></default>
      </equals>
    </when>

  </constraints>

</input>


<returns>any</returns>


<example>
</example>

</task>
</casaxml>
