<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
		 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		 xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task type="function" name="hif_makecleanlist" category="pipeline">
<shortdescription>Compute list of clean images to be produced</shortdescription>
<description>
Create a a list of images to be cleaned.
</description>
<input>

  <param type="stringArray" name="vis" subparam="true">
    <description>List of input measurement sets</description>
    <value></value>
  </param>

  <param type="string" name="intent" subparam="true">
    <description>Set of data selection intents</description>
    <value>TARGET</value>
  </param>

  <param type="string" name="field" subparam="true">
    <description>Set of data selection field names or ids</description>
    <value></value>
  </param>

  <param type="string" name="spw" subparam="true">
    <description>Set of data selection spectral window/channels</description>
    <value></value>
  </param>

  <param type="string" name="imagename" subparam="true">
     <description>Prefix for image filenames</description>
     <value></value>
  </param>

  <param type="string" name="mode">
     <description>Spectral gridding type (mfs, velocity, frequency)</description>
     <value></value>
       <allowed kind="enum">
         <value></value>
         <value>mfs</value>
         <value>velocity</value>
         <value>frequency</value>
       </allowed>
  </param>

  <param type="string" name="outframe" subparam="true">
     <description>velocity frame of output image</description>
     <value></value>
       <allowed kind="enum">
         <value></value>
         <value>LSRK</value>
         <value>LSRD</value>
         <value>BARY</value>
         <value>GEO</value>
         <value>TOPO</value>
         <value>GALACTO</value>
         <value>LGROUP</value>
         <value>CMB</value>
       </allowed>
  </param>

  <param type="intArray" name="imsize">
    <description>x and y image size in pixels. Single value same: same for both. Heuristic default</description>
    <value></value>
  </param>

  <param type="stringArray" name="cell">
    <description>x and y cell size(s). Single value:same for both. Heuristic default</description>
    <value></value>
  </param>

  <param type="any" name="phasecenter" subparam="true">
    <description>Image center: direction or field index. Heuristic default</description>
    <any type="variant"/>
    <value type="string"></value>
  </param>

  <param type="any" name="start" subparam="true">
    <description>Channel start</description>
    <any type="variant"/>
    <value type="string"></value>
  </param>

  <param type="any" name="width" subparam="true">
    <description>Channel width</description>
    <any type="variant"/>
    <value type="string"></value>
  </param>

  <param type="any" name="nchan" subparam="true">
    <description>Number of channels</description>
    <any type="variant"/>
    <value type="string">default</value>
  </param>

  <param type="any" name="restfreq" subparam="true">
    <description>Rest frequency</description>
    <any type="variant"/>
    <value type="string"></value>
  </param>

  <param type="string" name="weighting" subparam="true">
    <description>Weighting</description>
    <value type="string">default</value>
  </param>

  <param type="any" name="robust" subparam="true">
    <description>Briggs robust parameter</description>
    <any type="variant"/>
    <value type="string">default</value>
  </param>

  <param type="any" name="noise" subparam="true">
    <description>Weighting noise</description>
    <any type="variant"/>
    <value type="string">default</value>
  </param>

  <param type="any" name="npixels" subparam="true">
    <description>Weighting npixels</description>
    <any type="variant"/>
    <value type="string">default</value>
  </param>

  <param type="any" name="restoringbeam" subparam="true">
    <description>Output Gaussian restoring beam for CLEAN image</description>
    <any type="variant"/>
    <value type="string">default</value>
  </param>

  <param type="any" name="nterms" subparam="true">
    <description>Number of terms in Taylor expansion for mfs clean</description>
    <any type="variant"/>
    <value type="string">default</value>
  </param>

  <param type="string" name="uvrange" subparam="true">
    <description>Select data within uvrange</description>
    <value>default</value>
  </param>

  <param type="any" name="maxthreshiter" subparam="true">
    <description>Maximum number of cleanbox/threshold iterations</description>
    <any type="variant"/>
    <value type="string">default</value>
  </param>

  <param type="string" name="pipelinemode">
    <description>The pipeline operating mode</description>
    <value>automatic</value>
    <allowed kind="enum">
      <value>automatic</value>
      <value>interactive</value>
      <value>getinputs</value>
    </allowed>
  </param>

  <param type="bool" name="dryrun" subparam="true">
    <description>Run the task (False) or display the command(True)</description>
    <value>False</value>
  </param>

  <param type="bool" name="acceptresults" subparam="true">
    <description>Add the results to the pipeline context</description>
   <value>True</value>
  </param>


  <constraints>

    <when param="pipelinemode">
      <equals type="string" value="automatic">
      </equals>
      <equals type="string" value="interactive">
        <default param="vis"><value type="stringArray"></value></default>
        <default param="field"><value type="string"></value></default>
        <default param="intent"><value type="string"></value></default>
        <default param="spw"><value type="string"></value></default>
        <default param="imagename"><value type="string"></value></default>
        <default param="phasecenter"><value type="string"></value></default>
        <default param="start"><value type="string"></value></default>
        <default param="width"><value type="string"></value></default>
        <default param="nchan"><value type="string">default</value></default>
        <default param="restfreq"><value type="string"></value></default>
        <default param="weighting"><value type="string">default</value></default>
        <default param="robust"><value type="string">default</value></default>
        <default param="noise"><value type="string">default</value></default>
        <default param="npixels"><value type="string">default</value></default>
        <default param="restoringbeam"><value type="string">default</value></default>
        <default param="nterms"><value type="string">default</value></default>
        <default param="uvrange"><value type="string">default</value></default>
        <default param="maxthreshiter"><value type="string">default</value></default>
        <default param="dryrun"><value type="bool">False</value></default>
        <default param="acceptresults"><value type="bool">True</value></default>
      </equals>
      <equals type="string" value="getinputs">
        <default param="vis"><value type="stringArray"></value></default>
        <default param="field"><value type="string"></value></default>
        <default param="intent"><value type="string"></value></default>
        <default param="spw"><value type="string"></value></default>
        <default param="imagename"><value type="string"></value></default>
        <default param="phasecenter"><value type="string"></value></default>
        <default param="start"><value type="string"></value></default>
        <default param="width"><value type="string"></value></default>
        <default param="nchan"><value type="string">default</value></default>
        <default param="restfreq"><value type="string"></value></default>
        <default param="weighting"><value type="string">default</value></default>
        <default param="robust"><value type="string">default</value></default>
        <default param="noise"><value type="string">default</value></default>
        <default param="npixels"><value type="string">default</value></default>
        <default param="restoringbeam"><value type="string">default</value></default>
        <default param="nterms"><value type="string">default</value></default>
        <default param="uvrange"><value type="string">default</value></default>
        <default param="maxthreshiter"><value type="string">default</value></default>
      </equals>
    </when>

    <when param="mode">
      <equals type="string" value="">
      </equals>
      <equals type="string" value="mfs">
      </equals>
      <equals type="string" value="velocity">
        <default param="outframe"><value type="string"></value></default>
      </equals>
      <equals type="string" value="frequency">
        <default param="outframe"><value type="string"></value></default>
      </equals>
    </when>

  </constraints>

</input>

<output>
    <param type="any" name="results">
        <description>The output results object</description>
        <any type="variant"/>
        <value></value>
    </param>
</output>
<returns type="void"/>


<example>

Create a list of images to be cleaned.

Keyword Arguments


pipelinemode -- The pipeline operating mode. In 'automatic' mode the pipeline
    determines the values of all context defined pipeline inputs automatically.
    In 'interactive' mode the user can set the pipeline context defined
    parameters manually.  In 'getinputs' mode the user can check the settings
    of all pipeline parameters without running the task.
    default: 'automatic'.

--- pipeline parameter arguments which can be set in any pipeline mode

mode -- Frequency specification:
    default: 'mfs'
    example:
        mode='mfs' produce one image from all specified data
        mode='frequency', channels are specified in frequency
        mode='velocity', channels are specified in velocity

cell -- Cell size (x, y)
    default '' Compute cell size based on the UV coverage of all the fields
    to be imaged.
    example: cell=['0.5arcsec', '0.5arcsec']

imsize -- Image size in pixels (x, y)
    (but has to be even and have factors 2,3,5,7 only).
    default: '' The default is derived as follows:
         1. Determine 'phasecenter' value and spread of field centres
            around it. 
         2. Set size of image to cover spread of field centers plus
            a border of width 0.75 * beam radius (to first null).
         3. Divide x and y extents by 'cell' values to arrive at
            the numbers of pixels required. 

---- pipeline context defined parameter arguments which can be set only in
     'interactive mode'

vis -- The list of input measurement sets. Defaults to the list of measurement
    sets specified in the h_init or hif_importdata sets.
    default '': use all measurement sets in the context 
    example: vis='ngc5921.ms'
             vis=['ngc5921a.ms', ngc5921b.ms', 'ngc5921c.ms']

intent -- Select intents for which associated fields will be imaged.
    default: 'TARGET'
    example: 'TARGET', 'PHASE,BANDPASS'

field -- Select fields to image. Use field name(s) NOT id(s). Mosaics
    are assumed to have common field names.  If intent is specified then
    only fields with data matching the intent will be selected. The fields
    will be selected from measurement sets in 'vis'.
    default: ''
    example: '3C279', 'Centaurus*', '3C279,J1427-421'

spw -- Select spectral window/channels.
    default: '' Images will be computed for all science spectral windows.

phasecenter -- Direction measure or field_id for the mosaic center.
    default: '' The phasecenter is derived by creating  an array of field
        center directions of those fields to be imaged together and deriving
	the mean direction of the array.
    example: TBD


--- pipeline task execution modes
dryrun -- Run the commands (True) or generate the commands to be run but
   do not execute (False).
   default: False

acceptresults -- Add the results of the task to the pipeline context (True) or
   reject them (False).
   default: True

Output

results -- If pipeline mode is 'getinputs' then None is returned. Otherwise
    the results object for the pipeline task is returned.

Description

Generate a list of images to be cleaned.

By default the image cellsize is computed by using im.advise to calculate the
minimum cell size consistent with the UV coverage.

By default the image size is computed using a heuristic based in the single
dish beam size.

Issues

TBD

Examples

1. Make a list of clean task commands to image all fields with TARGET
intent in all of the science spectral windows.

    hif_makecleanlist()

2. Make a list of clean task commands to image all fields with PHASE and TARGET
intent in all of the science spectral windows.

    hif_makecleanlist(intent='PHASE,TARGET')

3. Make a list of clean task commands to image all fields with PHASE intent 
n a single spectral window.

    hif_makecleanlist(intent='PHASE',spw='1')

</example>

</task>
</casaxml>

