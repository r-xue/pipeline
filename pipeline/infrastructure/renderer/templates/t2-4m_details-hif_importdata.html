<%!
rsc_path = "../"
import operator
import os

import pipeline.infrastructure.renderer.htmlrenderer as hr
import pipeline.infrastructure.utils as utils
%>
<%inherit file="t2-4m_details-base.html"/>

<%block name="header" />

<%block name="title">Stage ${hr.get_stage_number(result)} Task Details</%block>

<h1>Stage ${hr.get_stage_number(result)}: Import Data</h1>

<h2>Results</h2>
<h3>Imported Data</h3>
<p>Data from ${num_mses} measurement set${'s were' if num_mses != 1 else ' was'} registered with the pipeline.</p>

<table class="minimalist" summary="Imported Measurement Sets">
	<caption>Imported Measurement Sets</caption>
    <thead>
	    <tr>
	        <th>File</th>
	        <th>Measurement Set</th>
	        <th>SchedBlock ID</th>
		</tr>
	</thead>
	<tbody>
% for importdata_result in result:
	% for ms in importdata_result.mses:
		<tr>
			<td>${importdata_result.inputs['vis']}</td>
			<td>${ms.basename}</td>
			<td>${ms.schedblock_id}</td>
		</tr>
	% endfor
% endfor
	</tbody>
</table>

<h3>Imported Flux Densities</h3>
% if flux_imported:
<p>The following flux densities were imported from the ASDM into the pipeline context:</p>
<table class="minimalist" summary="Flux density results">
	<caption>Flux densities imported from ASDM</caption>
    <thead>
	    <tr>
	        <th scope="col" rowspan="2">Measurement Set</th>
	        <th scope="col" rowspan="2">Field</th>
	        <th scope="col" rowspan="2">SpW</th>
	        <th scope="col" colspan="4">Flux Density</th>
		</tr>
		<tr>
	        <th scope="col">I</th>
	        <th scope="col">Q</th>
	        <th scope="col">U</th>
	        <th scope="col">V</th>
	    </tr>
	</thead>
	<tbody>
% for setjy_result in setjy_results:
	% for field in setjy_result.measurements:
		% for flux in sorted(setjy_result.measurements[field], key=lambda m: m.spw.id):
		<tr>
			<td>${os.path.basename(setjy_result.vis)}</td>
			<td>${field}</td>
			<td>${flux.spw.id}</td>
			<td>${str(flux.I)}</td>
			<td>${str(flux.Q)}</td>
			<td>${str(flux.U)}</td>
			<td>${str(flux.V)}</td>
		</tr>
		% endfor
	% endfor
% endfor
	</tbody>
</table>
% else:
<p>No flux densities were imported.</p>
% endif
