<%!
rsc_path = ""

import os.path
import pydoc
import numpy as np
import sys

import pipeline.infrastructure as infrastructure
import pipeline.infrastructure.casatools as casatools
import pipeline.infrastructure.displays as displays
import pipeline.infrastructure.filenamer as filenamer
import pipeline.infrastructure.renderer.logger as logger
import pipeline.infrastructure.renderer.htmlrenderer as hr
import pipeline.infrastructure.renderer.rendererutils as hrutils

LOG = infrastructure.get_logger(__name__)
%>
<%inherit file="t2-4m_details-base.html"/>

<%block name="title">Flag antennas with low gain</%block>

## generate the plots
<%
try:
    r = result[0]
    stage_dir = os.path.join(pcontext.report_dir, 'stage%d' % (r.stage_number))
    plots_dir = stage_dir
    if not os.path.exists(plots_dir):
        os.mkdir(plots_dir)

    plots = []
    for r in result:
        if r.view:
            # display the view first
            # plot() returns the list of Plots it has generated
            LOG.info('Plotting')
            plots.append(displays.ImageDisplay().plot(pcontext, r,
              reportdir=plots_dir))

    # Group the Plots by axes and plot types; each logical grouping will
    # be contained in a PlotGroup
    plot_groups = logger.PlotGroup.create_plot_groups(plots)
    # Write the thumbnail pages for each plot grouping to disk
    for plot_group in plot_groups:
        renderer = hr.PlotGroupRenderer(pcontext, r, plot_group)
        plot_group.filename = renderer.filename
        with renderer.get_file() as fileobj:
            fileobj.write(renderer.render())

except Exception, e:
    print 'hif_lowgainflag html template exception:', e
    raise e
%>
 
% if plot_groups:
<h2>Plots</h2>
<ul>
        % for plot_group in plot_groups:
	        % if plot_group.title == 'Time vs Antenna1':
		   <li><a class="replace" href="${os.path.join(dirname, plot_group.filename)}">${plot_group.title}</a>
                   shows the images used for flagging.</li>
                % endif
        % endfor
</ul>
% endif

% if htmlreports:
<h2>Flags</h2>
<table class="table table-bordered">
	<thead>
	    <tr>
    	    <th>Flagcmds</th>
    	</tr>
    </thead>
    <tbody>
	    % for file,reports in htmlreports.items():
	    <tr>
	        <td><a class="replace-pre" href=${reports[0]}>${file}</a></td>
	    </tr>
	    % endfor
	</tbody>
</table>
% endif

