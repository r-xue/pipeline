<casaxml xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd file:///opt/casa/code/xmlcasa/xml/casa.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://casa.nrao.edu/schema/psetTypes.html">

<task category="pipeline" name="hsd_blflag" type="function">
<shortdescription>Flag spectra based on predefined criteria of single dish pipeline</shortdescription>

<description>
</description>
<input>
    <param name="iteration" type="int">
        <description>Number of iteration to perform sigma clipping to calculate threshold</description>
        <value>5</value>
    </param>

    <param name="edge" type="intVec">
        <description>Number of edge channels to be excluded from statistic calculation to flag data</description>
        <value><value>0</value><value>0</value></value>
    </param>


    <param name="flag_tsys" type="bool">
        <description>Flag data by Tsys value</description>
        <value>True</value>
    </param>
        
    <param subparam="true" name="tsys_thresh" type="double">
        <description>Threshold for Tsys flag</description>
        <value>3.0</value>
    </param>
        
    <param name="flag_weath" type="bool">
        <description>Flag data by weather (not implemented yet)</description>
        <value>False</value>
    </param>

    <param subparam="true" name="weath_thresh" type="double">
        <description>Threshold for weather flag</description>
        <value>3.0</value>
    </param>

    <param name="flag_prfre" type="bool">
        <description>Flag data by EXPECTED RMS of pre-fit spectra</description>
        <value>True</value>
    </param>

    <param subparam="true" name="prfre_thresh" type="double">
        <description>Threshold for EXPECTED RMS of pre-fit spectra flag</description>
        <value>3.0</value>
    </param>

    <param name="flag_pofre" type="bool">
        <description>Flag data by EXPECTED RMS of post-fit spectra</description>
        <value>True</value>
    </param>

    <param subparam="true" name="pofre_thresh" type="double">
        <description>Threshold for EXPECTED RMS of post-fit spectra flag</description>
        <value>1.3333</value>
    </param>

    <param name="flag_prfr" type="bool">
        <description>Flag data by RMS of pre-fit spectra</description>
        <value>True</value>
    </param>

    <param subparam="true" name="prfr_thresh" type="double">
        <description>Threshold for RMS of pre-fit flag</description>
        <value>4.5</value>
    </param>

    <param name="flag_pofr" type="bool">
        <description>Flag data by RMS of post-fit spectra</description>
        <value>True</value>
    </param>

    <param subparam="true" name="pofr_thresh" type="double">
        <description>Threshold for RMS of post-fit spectra flag</description>
        <value>4.0</value>
    </param>

    <param name="flag_prfrm" type="bool">
        <description>Flag data by running mean of pre-fit spectra</description>
        <value>True</value>
    </param>

    <param subparam="true" name="prfrm_thresh" type="double">
        <description>Threshold for running mean of pre-fit spectra flag</description>
        <value>5.5</value>
    </param>

    <param subparam="true" name="prfrm_nmean" type="int">
        <description>Number of channels for running mean of pre-fit spectra flag</description>
        <value>5</value>
    </param>

    <param name="flag_pofrm" type="bool">
        <description>Flag data by running mean of post-fit spectra</description>
        <value>True</value>
    </param>

    <param subparam="true" name="pofrm_thresh" type="double">
        <description>Threshold for running mean of post-fit spectra flag</description>
        <value>5.0</value>
    </param>

    <param subparam="true" name="pofrm_nmean" type="int">
        <description>Number of channels for running mean of post-fit spectra flag</description>
        <value>5</value>
    </param>

    <param name="flag_user" type="bool">
        <description>Flag data by user flag (not implemented yet)</description>
        <value>False</value>
    </param>

    <param subparam="true" name="user_thresh" type="double">
        <description>Threshold for user flag</description>
        <value>5.0</value>
    </param>

    <param name="plotflag" type="bool">
        <description>Create plots for flagging</description>
        <value>True</value>
    </param>

    <param name="pipelinemode" type="string">
        <description>The pipeline operating  mode</description>
        <value>automatic</value>
        <allowed kind="enum">
            <value>automatic</value>
            <value>interactive</value>
            <value>getinputs</value>
        </allowed>
    </param>

    <param subparam="true" name="infiles" type="stringVec">
        <description>List of input files to be flagged (\'\'=all)</description>
        <value/>
    </param>

    <param subparam="true" name="antenna" type="string">
            <description>select data by antenna names or ids, e.g. \'PM03,PM04\' (\'\'=all)</description>
            <value type="string"/>
    </param>
    <param subparam="true" name="field" type="string">
            <description>select data by field names or ids, e.g. \'M100,Sgr*\' (\'\'=all)</description>
            <value type="string"/>
    </param>
    <param subparam="true" name="spw" type="string">
            <description>select data by spectral windows, e.g. \'3,5,7\' (\'\'=all)</description>
            <value type="string"/>
    </param>

    <param subparam="true" name="pol" type="string">
            <description>select data by polarizations, e.g. \'XX,YY\' (\'\'=all)</description>
            <value type="string"/>
    </param>

    <param subparam="true" name="dryrun" type="bool">
        <description>Run the task (False) or display the task command (True)</description>
        <value>False</value>
    </param>

    <param subparam="true" name="acceptresults" type="bool">
        <description>Add the results into the pipeline context</description>
        <value>True</value>
    </param>

    <param subparam="true" name="parallel" type="string">
        <description>Execute using CASA HPC functionality, if available.</description>
            <value>automatic</value>
            <allowed kind="enum">
                <value>automatic</value>
                <value>true</value>
                <value>false</value>
            </allowed>
    </param>

    <constraints>
        <when param="flag_tsys">
            <equals value="True" type="bool">
                <default param="tsys_thresh"><value type="double">3.0</value></default>
            </equals>
            <equals value="False" type="bool">
            </equals>
        </when>
        <when param="flag_weath">
            <equals value="False" type="bool">
            </equals>
            <equals value="True" type="bool">
                <default param="weath_thresh"><value type="double">3.0</value></default>
            </equals>
        </when>
        <when param="flag_prfre">
            <equals value="True" type="bool">
                <default param="prfre_thresh"><value type="double">3.0</value></default>
            </equals>
            <equals value="False" type="bool">
            </equals>
        </when>
        <when param="flag_pofre">
            <equals value="True" type="bool">
                <default param="pofre_thresh"><value type="double">1.3333</value></default>
            </equals>
            <equals value="False" type="bool">
            </equals>
        </when>
        <when param="flag_prfr">
            <equals value="True" type="bool">
                <default param="prfr_thresh"><value type="double">4.5</value></default>
            </equals>
            <equals value="False" type="bool">
            </equals>
        </when>
        <when param="flag_pofr">
            <equals value="True" type="bool">
                <default param="pofr_thresh"><value type="double">4.0</value></default>
            </equals>
            <equals value="False" type="bool">
            </equals>
        </when>
        <when param="flag_prfrm">
            <equals value="True" type="bool">
                <default param="prfrm_thresh"><value type="double">5.5</value></default>
                <default param="prfrm_nmean"><value type="int">5</value></default>
            </equals>
            <equals value="False" type="bool">
            </equals>
        </when>
        <when param="flag_pofrm">
            <equals value="True" type="bool">
                <default param="pofrm_thresh"><value type="double">5.0</value></default>
                <default param="pofrm_nmean"><value type="int">5</value></default>
            </equals>
            <equals value="False" type="bool">
            </equals>
        </when>
        <when param="flag_user">
            <equals value="False" type="bool">
            </equals>
            <equals value="True" type="bool">
                <default param="user_thresh"><value type="double">5.0</value></default>
                            </equals>
        </when>
        <when param="pipelinemode">
            <equals value="automatic" type="string">
            </equals>
            <equals value="interactive" type="string">
                <default param="infiles"><value type="stringVec"/></default>
                <default param="antenna"><value type="string"/></default>
                <default param="field"><value type="string"/></default>
                <default param="spw"><value type="string"/></default>
                <default param="pol"><value type="string"/></default>
                <default param="dryrun"><value type="bool">False</value></default>
                <default param="acceptresults"><value type="bool">True</value></default>
                <default param="parallel"><value type="string">automatic</value></default>
            </equals>
            <equals value="getinputs" type="string">
                <default param="infiles"><value type="stringVec"/></default>
                <default param="antenna"><value type="string"/></default>
                <default param="field"><value type="string"/></default>
                <default param="spw"><value type="string"/></default>
                <default param="pol"><value type="string"/></default>
            </equals>
        </when>
    </constraints>

</input>


<returns>any</returns>


<example>

Keyword arguments:

---- pipeline parameter arguments which can be set in any pipeline mode
iteration -- Number of iterations to perform sigma clipping to calculate
       threshold value of flagging.
       default: 5

edge -- Number of channels to be dropped from the edge.
       The value must be a list of integer with length of one or two.
       If list length is one, same number will be applied both side of 
       the band.
       default: [0,0]
       example: [10,20], [10]

flag_tsys -- Activate (True) or deactivate (False) Tsys flag.
       default: True

tsys_thresh -- Threshold value for Tsys flag.
       default: 3.0

flag_weath -- Activate (True) or deactivate (False) weather flag. 
       Since weather flagging is not implemented yet, setting True 
       has no effect at the moment.
       default: False

weath_thresh -- Threshold value for weather flag.
       default: 3.0

flag_prfre -- Activate (True) or deactivate (False) flag by expected rms 
       of pre-fit spectra.
       default: True

prfre_thresh -- Threshold value for flag by expected rms of pre-fit 
       spectra. 
       default: 3.0 

flag_pofre -- Activate (True) or deactivate (False) flag by expected rms 
       of post-fit spectra.
       default: True

pofre_thresh -- Threshold value for flag by expected rms of post-fit 
       spectra. 
       default: 1.3333

flag_prfr -- Activate (True) or deactivate (False) flag by rms of pre-fit 
       spectra.
       default: True

prfr_thresh -- Threshold value for flag by rms of pre-fit spectra. 
       default: 4.5

flag_pofr -- Activate (True) or deactivate (False) flag by rms of post-fit 
       spectra.
       default: True

pofr_thresh -- Threshold value for flag by rms of post-fit spectra. 
       default: 4.0

flag_prfrm -- Activate (True) or deactivate (False) flag by running mean 
       of pre-fit spectra.
       default: True

prfrm_thresh -- Threshold value for flag by running mean of pre-fit 
       spectra. 
       default: 5.5

prfrm_nmean -- Number of channels for running mean of pre-fit spectra.
       default: 5

flag_pofrm -- Activate (True) or deactivate (False) flag by running mean 
       of post-fit spectra.
       default: True

pofrm_thresh -- Threshold value for flag by running mean of post-fit 
       spectra. 
       default: 5.0

pofrm_nmean -- Number of channels for running mean of post-fit spectra.
                       default: 5

flag_user -- Activate (True) or deactivate (False) user-defined flag. 
       Since user flagging is not implemented yet, setting True 
       has no effect at the moment.
       default: False

user_thresh -- Threshold value for flag by user-defined rule.
       default: 3.0

plotflag -- True to plot result of data flagging.
       default: True

pipelinemode -- The pipeline operating mode. In 'automatic' mode the 
       pipeline determines the values of all context defined pipeline 
       inputs automatically.  In interactive mode the user can set the 
       pipeline context defined parameters manually. In 'getinputs' mode 
       the user can check the settings of all pipeline parameters without 
       running the task.
       default: 'automatic'.

---- pipeline context defined parameter argument which can be set only in
'interactive mode' or 'getinputs' modes 
                
infiles -- ASDM or MS files to be processed. This parameter behaves as 
       data selection parameter. The name specified by infiles must be 
       registered to context before you run hsd_blflag.
       default: [] (process all data in context)

antenna -- Data selection by antenna names or ids.
   default: '' (all antennas)
   example: 'PM03,PM04'
   
field -- Data selection by field names or ids.
   default: '' (all fields)
   example: '*Sgr*,M100'
   
spw -- Data selection by spw ids.
   default: '' (all spws)
   example: '3,4' (spw 3 and 4)

pol -- Data selection by polarizations.
   default: '' (all polarizations)
   example: 'XX,YY' (correlation XX and YY)

--- pipeline task execution modes
dryrun -- Run the commands (True) or generate the commands to be run but
                       do not execute (False).
       default: True

acceptresults -- Add the results of the task to the pipeline context 
       (True) or reject them (False).
       default: True


Output:

results -- If pipeline mode is 'getinputs' then None is returned. Otherwise
       the results object for the pipeline task is returned.


Description

The hsd_blflag
6. Flagging 
Data are flagged based on several flagging rules. Available rules are: 
expected rms, calculated rms, and running mean of both pre-fit and 
post-fit spectra. Tsys flagging is also available. 

In addition, the heuristics script creates many plots for each stage. 
Those plots are included in the weblog.


Issues


Examples
                                
</example>
</task>
</casaxml>
