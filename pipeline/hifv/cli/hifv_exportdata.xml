<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd file:///opt/casa/code/xmlcasa/xml/casa.xsd">

<task category="pipeline" name="hifv_exportdata" type="function">
<shortdescription>Prepare interferometry data for export</shortdescription>
<description>
The hifv_exportdata task for the VLA CASA pipeline exports the data defined
in the pipeline context and exports it to the data products directory, 
converting and or packing it as necessary.

The current version of the task exports the following products

o an XML file containing the pipeline processing request
o a tar file per ASDM / MS containing the final flags version OR the MS if tarms is False
o a text file per ASDM / MS containing the final calibration apply list
o a FITS image for each selected calibrator source image
o a FITS image for each selected science target source image
o a tar file per session containing the caltables for that session
o a tar file containing the file web log
o a text file containing the final list of CASA commands


Issues

Support for merging the calibration state information into the pipeline
context / results structure and retrieving it still needs to be added.

Support for merging the clean results into the pipeline context / results
structure and retrieving it still needs to be added.

Support for creating the final pipeline results entity still needs to
be added.

Session information is not currently handled by the pipeline context.
By default all ASDMs are combined into one session.

Output:

results -- If pipeline mode is 'getinputs' then None is returned. Otherwise
   the results object for the pipeline task is returned.

</description>
<input>
    <param name="vis" subparam="true" type="stringVec">
	<shortdescription>List of input visibility data</shortdescription>
        <description>List of visibility data files for which flagging and calibration
        information will be exported. Defaults to the list maintained in the
        pipeline context. Not available in pipelinemode='automatic'.
        example: vis=['X227.ms', 'X228.ms']</description>
	<value/>
    </param>

    <param name="session" subparam="true" type="stringVec">
	<shortdescription>List of sessions one per visibility file</shortdescription>
        <description>List of sessions one per visibility file. Currently defaults
        to a single virtual session containing all the visibility files in vis.
        In the future, this will default to the set of observing sessions defined
        in the context. Not available in pipelinemode='automatic'.
        example: session=['session1', 'session2']</description>
	<value/>
    </param>

    <param name="imaging_products_only" type="bool">
	<shortdescription>Export science target imaging products only</shortdescription>
	<description>Export science target imaging products only</description>
	<value>False</value>
    </param>

    <param name="exportmses" type="bool">
	<shortdescription>Export MeasurementSets</shortdescription>
        <description>Export the final MeasurementSets instead of the final flags,
        calibration tables, and calibration instructions.</description>
	<value>False</value>
    </param>

    <param name="tarms" type="bool">
	<shortdescription>Tar the MS</shortdescription>
        <description>Tar final MeasurementSets</description>
	<value>True</value>
    </param>

    <param name="exportcalprods" subparam="true" type="bool">
	<shortdescription>Export flags and caltables in addition to MeasurementSets.</shortdescription>
        <description>Export flags and caltables in addition to MeasurementSets.
        this parameter is only valid when exportmses = True.</description>
	<value>False</value>
    </param>

    <param name="pprfile" subparam="true" type="string">
	<shortdescription>The pipeline processing request file to be exported</shortdescription>
        <description>Name of the pipeline processing request to be exported. Defaults
        to a file matching the template 'PPR_*.xml'. Not available in pipelinemode='automatic'.
        example: pprfile=['PPR_GRB021004.xml']</description>
	<value/>
    </param>

    <param name="calintents" subparam="true" type="string">
	<shortdescription>The calibrator source target intents to be exported</shortdescription>
        <description>List of calibrator image types to be exported. Defaults to
        all standard calibrator intents, 'BANDPASS', 'PHASE', 'FLUX'.
        Not available in pipelinemode='automatic'.
        example: 'PHASE'</description>
	<value/>
    </param>

    <param name="calimages" subparam="true" type="stringVec">
	<shortdescription>List of calibrator images to be exported</shortdescription>
        <description>List of calibrator images to be exported. Defaults to all
        calibrator images recorded in the pipeline context.
        Not available in pipelinemode='automatic'.
        example: calimages=['3C454.3.bandpass', '3C279.phase']</description>
	<value/>
    </param>

    <param name="targetimages" subparam="true" type="stringVec">
	<shortdescription>List of target images to be exported</shortdescription>
        <description>List of science target images to be exported. Defaults to all
        science target images recorded in the pipeline context.
        Not available in pipelinemode='automatic'.
        example: targetimages=['NGC3256.band3', 'NGC3256.band6']</description>
	<value/>
    </param>

    <param name="products_dir" subparam="true" type="string">
	<shortdescription>The data products directory</shortdescription>
        <description>Name of the data products subdirectory. Defaults to './'
        Not available in pipelinemode='automatic'.
        example: '../products'</description>
	<value/>
    </param>

    <param name="gainmap" type="bool">
	<shortdescription>VLASS gainmap True/False</shortdescription>
        <description>The value of gainmap parameter in hifv_restoredata task put in
        casa_piperestorescript.py</description>
	<value>False</value>
    </param>

    <param name="pipelinemode" type="string">
	<shortdescription>The pipeline operating mode</shortdescription>
        <description>The pipeline operating mode. In 'automatic' mode the pipeline
        determines the values of all context defined pipeline inputs automatically.
        In 'interactive' mode the user can set the pipeline context defined
        parameters manually.  In 'getinputs' mode the user can check the settings
        of all pipeline parameters without running the task.</description>
	<value>automatic</value>
	<allowed kind="enum">
	    <value>automatic</value>
	    <value>interactive</value>
	    <value>getinputs</value>
	</allowed>
    </param>

    <param name="dryrun" subparam="true" type="bool">
	<shortdescription>Run the task (False) or display task command (True)</shortdescription>
        <description>Run the task (False) or display task command (True).
        Only available in pipelinemode='interactive'.</description>
        <value>False</value>
    </param>

    <param name="acceptresults" subparam="true" type="bool">
	<shortdescription>Add the results into the pipeline context</shortdescription>
        <description>Add the results of the task to the pipeline context (True) or
        reject them (False). Only available in pipelinemode='interactive'.</description>
	<value>True</value>
    </param>

    <constraints>
	<when param="exportmses">
	    <equals type="bool" value="False">
	    </equals>
	    <equals type="bool" value="True">
		<default param="exportcalprods"><value type="bool">False</value></default>
	    </equals>
	</when>
	<when param="pipelinemode">
	    <equals type="string" value="automatic">
	    </equals>
	    <equals type="string" value="interactive">
		<default param="vis"><value type="stringVec"/></default>
		<default param="session"><value type="stringVec"/></default>
		<default param="pprfile"><value type="string"/></default>
		<default param="calintents"><value type="string"/></default>
		<default param="calimages"><value type="stringVec"/></default>
		<default param="targetimages"><value type="stringVec"/></default>
		<default param="products_dir"><value type="string"/></default>
		<default param="dryrun"><value type="bool">False</value></default>
		<default param="acceptresults"><value type="bool">True</value></default>
	    </equals>
	    <equals type="string" value="getinputs">
		<default param="vis"><value type="stringVec"/></default>
		<default param="session"><value type="stringVec"/></default>
		<default param="pprfile"><value type="string"/></default>
		<default param="calintents"><value type="string"/></default>
		<default param="calimages"><value type="stringVec"/></default>
		<default param="targetimages"><value type="stringVec"/></default>
		<default param="products_dir"><value type="string"/></default>
	    </equals>
	</when>
    </constraints>

</input>


<returns>any</returns>


<example>

1. Export the pipeline results for a single session to the data products
directory

    !mkdir ../products
    hifv_exportdata (products_dir='../products')

2. Export the pipeline results to the data products directory specify that
only the gain calibrator images be saved.

    !mkdir ../products
    hifv_exportdata (products_dir='../products', calintents='*PHASE*')

</example>
</task>
</casaxml>
