

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pipeline.extern package &mdash; Pipeline unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/custom_theme.css?v=678032d9" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=3f1b9271"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Pipeline Tasks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_tasks/pipeline_tasks.html">Pipeline Heuristics Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Task (sphinx-autosummary)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.h.cli.html">pipeline.h.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hif.cli.html">pipeline.hif.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hifa.cli.html">pipeline.hifa.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hifv.cli.html">pipeline.hifv.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hsd.cli.html">pipeline.hsd.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.hsdn.cli.html">pipeline.hsdn.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.domain.html">pipeline.domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_autosummary/pipeline.infrastructure.launcher.html">pipeline.infrastructure.launcher</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Heuristics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../heuristics/field_parameter.html">Field parameter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../heuristics/FlaggingTasks.html">Pipeline Flagging Tasks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Releases etc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Past Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modular.html">Run the Pipeline in a Conda environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencies.html">Dependencies of <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Pipeline Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basics.html"><code class="docutils literal notranslate"><span class="pre">pipeline.domain</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html#module-pipeline.infrastructure.launcher"><code class="docutils literal notranslate"><span class="pre">pipeline.infrastructure.launcher</span></code> module</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Task Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html"><code class="docutils literal notranslate"><span class="pre">pipeline.hifa.tasks</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html#module-pipeline.hif.tasks"><code class="docutils literal notranslate"><span class="pre">pipeline.hif.tasks</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html#module-pipeline.hif"><code class="docutils literal notranslate"><span class="pre">pipeline.hif</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../task_classes.html#pipeline-inheritance-diagrams">Pipeline Inheritance Diagrams</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/ways_to_run_the_pipeline.html">Ways to run the Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/comparing_pipeline_executions.html">Comparing pipeline executions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/building_the_pipeline.html">Building the pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/ALMA-Imaging-Workflow.html">ALMA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/VLA-Imaging-Workflow.html">VLA interferometry imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/VLASS-SE-CONT-Imaging-Workflow.html">VLASS-SE-CONT imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/VLASS-SE-CUBE-Imaging-Workflow.html">VLASS-SE-CUBE imaging workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/selfcal_workflow.html">VLASS Selfcal &amp; Restore workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/pipeline_tests.html">Pipeline testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/DataType_Testing.html">DataType Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/QA_scores.html">Pipeline Quality Assurance (QA) Score Class Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/DeveloperDocumentation.html">Pipeline developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/python3_conversion_notes.html">Python 3 conversion notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develdocmd/recipes.html">Pipeline Recipes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples Notes (from Jupyter Notebooks)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/test1.html">test</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Notes (from .rst)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/test2.html">Example 1</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">pipeline.extern package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/_apidoc/pipeline.extern.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pipeline-extern-package">
<h1>pipeline.extern package<a class="headerlink" href="#pipeline-extern-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-pipeline.extern.SDcalatmcorr">
<span id="pipeline-extern-sdcalatmcorr-module"></span><h2>pipeline.extern.SDcalatmcorr module<a class="headerlink" href="#module-pipeline.extern.SDcalatmcorr" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.atmcorr">
<span class="sig-name descname"><span class="pre">atmcorr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CORRECTED_DATA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atmtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxalt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lapserate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-5.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaleht</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jyperkfactor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dobackup</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forcespws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forcefield</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forcemetricline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blinedeg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blinenclip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blinensigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxonlyspw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minpeaklevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotsfolder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diffsmooth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.002</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">isize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotbline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defatmtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defmaxalt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deflapserate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-5.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defscaleht</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decisionmetric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'intabsdiff'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#atmcorr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.atmcorr" title="Link to this definition"></a></dt>
<dd><p>Task to apply CSV-3320 correction for atmospheric lines.
Parameter list:
ms: (first argument) MS file to be processed
output: Compute the metrics over the skyline residuals and return them
for best parameter evaluation. Output in this case is a tuple (models, metrics) where models is an array
of the models used, and metrics is a dictionary containing arrays of metric results for each one
of the models for each field and SPW, structured like: metrics[FIELDID][SPW]
Keyword arguments:
datacolumn: Column to apply correction to, options: ‘DATA’, ‘CORRECTED_DATA’(default)
iant: Antenna number to get pointing direction (antenna having mount issues should
be avoided). Also used to test atmospheric residuals. Default is 0.
jyperkfactor: Dictionary of Jy/K factors for each EB, antenna and SPW. Default will
assume a factor of 1.0. To be obtained from getJyperKfromCSV() function
dobackup: Whether to do a backup of the MS before applying the correction.
(True/False) Default is True.
forcespws: Force the list of SPWs to process. If not specified, task will do all SPWs.
forcefield: Force the FIELD ID to process. If not specified task will pick the first one.
blinedeg: Degree of the baseline fitting polynomial.
blinenclip: Number of sigma clipping iterations to use in the baseline fitting routine.
blinensigma: Significance in number of sigmas for the sigma clipping routine that fit the
baseline polynomial.
maxonlyspw: Whether to select the SPW with largest skyline only. (Default: True)
timestamp: Timestamp string to use for the model plots folder
plotsfolder: Explicit folder name for model plots folder. If given, timestamp will be ignored.
Following parameters define the atmospheric model. For runmode = ‘try’, the parameters below
can be vectors, in that case the task will try all combinations and return a tuple of the list
of models and the results of the metrics for each model on the residual of skylines.
amttype: Atmosphere type paremeter for model in at module (1: tropical, 2: mid lat summer,
3: mid lat winter, etc). Default is 2
maxalt: maxAltitude parameter for model, in km. default is 120 (km)
lapserate: Lapse Rate dTem_dh parameter for at (lapse rate; K/km). Default is -5.6
scaleht: h0 parameter for at (water scale height; km). Default is 2.0</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.binnedstats">
<span class="sig-name descname"><span class="pre">binnedstats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Aerr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#binnedstats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.binnedstats" title="Link to this definition"></a></dt>
<dd><p>Return a tuple of arrays (of size nbins) of median and sigmas
calculated from robuststats() from chopping the array A in nbins pieces.
Alternatively, bins can be explicitly be given with the bins parameter in the form:
bins = [[x0, x1], [x2, x3], …]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.bootstrap">
<span class="sig-name descname"><span class="pre">bootstrap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrictype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'intabsdiff'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#bootstrap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.bootstrap" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.calcmetric">
<span class="sig-name descname"><span class="pre">calcmetric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rawsample</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawsigmasample</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrictype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'intabsdiff'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothbox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#calcmetric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.calcmetric" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.createCasaTool">
<span class="sig-name descname"><span class="pre">createCasaTool</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mytool</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#createCasaTool"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.createCasaTool" title="Link to this definition"></a></dt>
<dd><p>A wrapper to handle the changing ways in which casa tools are invoked.
For CASA &lt; 6, it relies on “from taskinit import <a href="#id1"><span class="problematic" id="id2">*</span></a>” in the preamble above.
mytool: a tool name, like tbtool
Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.enlargesel">
<span class="sig-name descname"><span class="pre">enlargesel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#enlargesel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.enlargesel" title="Link to this definition"></a></dt>
<dd><p>Enlarge selection by “box” pixels around each selected pixel
in “sel” vector.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.fitbaseline">
<span class="sig-name descname"><span class="pre">fitbaseline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialbins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detectionsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(-99.0,</span> <span class="pre">5.0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minbinfracsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targetchi2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxoutlierfrac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlierprobmu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlierprobsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bordertokeep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#fitbaseline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.fitbaseline" title="Link to this definition"></a></dt>
<dd><p>Fit baseline to function y(x) (having error dy(x)).
Starts partitioning domain in ‘initialbins’ and the subdividing bins up to
a fractional size ‘minbinfracsize’ of the total number of channels.
Returns PPoly instance with fit.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.flattenlist">
<span class="sig-name descname"><span class="pre">flattenlist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.flattenlist" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getAntennaFlagFrac">
<span class="sig-name descname"><span class="pre">getAntennaFlagFrac</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fieldid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwsetup</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getAntennaFlagFrac"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getAntennaFlagFrac" title="Link to this definition"></a></dt>
<dd><p>Get flagging fraction for each antenna, in a vector listed ordered by order given in spwsetup dictionary.
ms: Input MS
fieldid: Field ID used to select data
spwid: SPW used to select data
spwsetup: Spectral setup dictionary, as obtained from getSpecSetup()</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getCalAtmData">
<span class="sig-name descname"><span class="pre">getCalAtmData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spws</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwsetup</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getCalAtmData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getCalAtmData" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getJyperKfromCSV">
<span class="sig-name descname"><span class="pre">getJyperKfromCSV</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jyperkfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'jyperk.csv'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mssuffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getJyperKfromCSV"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getJyperKfromCSV" title="Link to this definition"></a></dt>
<dd><p>Get Jy/K factor from the indicated CSV file.
Assumes columns in the file are MS,Antenna,Spwid,Polarization,Factor
and that the first line is the header.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getJyperKfromCaltable">
<span class="sig-name descname"><span class="pre">getJyperKfromCaltable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mslist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getJyperKfromCaltable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getJyperKfromCaltable" title="Link to this definition"></a></dt>
<dd><p>Get Jy/K factors from pipeline caltables. Will determine the MS list and tables from pipeline context.</p>
<p>This method could raise RuntimeError when Jy/K caltable associated with any of given MS does not exist.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getSBData">
<span class="sig-name descname"><span class="pre">getSBData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">asdm</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getSBData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getSBData" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getSpecSetup">
<span class="sig-name descname"><span class="pre">getSpecSetup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">myms</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwlist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getSpecSetup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getSpecSetup" title="Link to this definition"></a></dt>
<dd><p>Task to gather spectral setup information.
myms: MS to be processed.
spwlist: List of SPW to be included in queries, if left empty, all science SPWs
will be considered.
intentlist: List of intents to be included in the queries. By default is <em>OBSERVE_TARGET</em>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getSpwList">
<span class="sig-name descname"><span class="pre">getSpwList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msmd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OBSERVE_TARGET#ON_SOURCE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sqld</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getSpwList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getSpwList" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getTimeStamp">
<span class="sig-name descname"><span class="pre">getTimeStamp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timefmt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'{0:04d}{1:02d}{2:02d}{3:02d}{4:02d}{5:02d}'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getTimeStamp"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getTimeStamp" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.getskylines">
<span class="sig-name descname"><span class="pre">getskylines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tauspec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwsetup</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fraclevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minpeaklevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwbordertoavoid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">taudeg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#getskylines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.getskylines" title="Link to this definition"></a></dt>
<dd><p>Get position of sky lines and line widths from the optical depth.
fraclevel: fraction of the maximum of the optical depth to look for.
If fraclevel=0.5 (default), the width results will be the HWHM.
minpeaklevel: Minimum relative opacity at a given peak (relative to median opacity)
to consider a line. Lines smaller than this level are ignored. (default 0.05)
spwbordertoavoid: Fractional border of the SPW to avoid for peak detection.
Default is 0.025 (2.5% of SPW BW)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.gradeskylines">
<span class="sig-name descname"><span class="pre">gradeskylines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">skylines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cntrweight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#gradeskylines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.gradeskylines" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.makeNANmetrics">
<span class="sig-name descname"><span class="pre">makeNANmetrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fieldid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmodels</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#makeNANmetrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.makeNANmetrics" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.makePlot">
<span class="sig-name descname"><span class="pre">makePlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmavedata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skychansel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scisrcsel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">isize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">highbuf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lowbuf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atmhighbuf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diffsmoothbox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ischosen</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">takediff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlabel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylabel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#makePlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.makePlot" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.noisenormdata">
<span class="sig-name descname"><span class="pre">noisenormdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmdataon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antson</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmatm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antatm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tsys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#noisenormdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.noisenormdata" title="Link to this definition"></a></dt>
<dd><p>Compute a noise-normalized data for source selection. To be used by selsource() function.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.onlineChannelAveraging">
<span class="sig-name descname"><span class="pre">onlineChannelAveraging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msmd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#onlineChannelAveraging"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.onlineChannelAveraging" title="Link to this definition"></a></dt>
<dd><p>For Cycle 3-onward data, determines the channel averaging factor from
the ratio of the effective channel bandwidth to the channel width.
spw: a single value, or a list; if Nonne, then uses science spws
Returns: single value for a single spw, or a list for a list of spws
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.redPipeSDatmcorr">
<span class="sig-name descname"><span class="pre">redPipeSDatmcorr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atmtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxalt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lapserate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-5.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaleht</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decisionmetric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'intabsdiff'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dobackup</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pcode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'0000.1.00000.S'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mousstatusuid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'uid://A000/X000/X000'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metricspws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metricfield</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metricline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minpeaklevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diffsmooth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.002</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#redPipeSDatmcorr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.redPipeSDatmcorr" title="Link to this definition"></a></dt>
<dd><p>Task to run SD pipeline, applying CSV-3320 correction for atmospheric lines
between stage hsd_applycal and hsd_baseline.
Keyword arguments:
iant: Antenna number to get pointing direction (antenna having mount issues should
be avoided). Default is 0.
amttype: Atmosphere type paremeter for model in at module (1: tropical, 2: mid lat summer,
3: mid lat winter, etc). Default is list [1, 2, 3, 4]
maxalt: maxAltitude parameter for model, in km. default is 120 (km)
lapserate: Lapse Rate dTem_dh parameter for at (lapse rate; K/km). Default is -5.6
scaleht: h0 parameter for at (water scale height; km). Default is 2.0
decisionmetric: Metric to use to take the decision on best model selection (see selectModelParams())
metricspws: List of SPWs to use for model selection. Parameter gets passed to task selectModelParams() as forcespws.
metricfield: List of Field to use for model selection. Currently only supported one.
Parameter gets passed to task selectModelParams() as forcefield.
dobackup: Whether to do a backup of the MS before applying the correction.
(True/False) Default is True
pcode: Project Code to enter into the pipeline context.
mousstatusuid: MOUS status uid to enter into the pipeline context.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.robuststats">
<span class="sig-name descname"><span class="pre">robuststats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#robuststats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.robuststats" title="Link to this definition"></a></dt>
<dd><p>Return median and estimate standard deviation
of numpy array A using median statistics.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.segmentEdges">
<span class="sig-name descname"><span class="pre">segmentEdges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sortdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#segmentEdges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.segmentEdges" title="Link to this definition"></a></dt>
<dd><p>Return edges of sequence of values with gaps
Assumes 1D array “seq” is ordered. Otherwise one should sort it first.
seq: Sequence of values to search gaps in.
gap: Gap size to consider.
label: Label to put in the numpy array returned.
sortdata: Whether to sort data in the seq vector.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.selectModelParams">
<span class="sig-name descname"><span class="pre">selectModelParams</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mslist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jyperkfactor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decisionmetric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'intabsdiff'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atmtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">4]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxalt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[120]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lapserate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[-5.6]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaleht</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resultsfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotsfolder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forcespws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forcefield</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forcemetricline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blinedeg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blinenclip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blinensigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxonlyspw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minpeaklevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestamp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diffsmooth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.002</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">isize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">300</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defatmtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defmaxalt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deflapserate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-5.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defscaleht</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotbline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#selectModelParams"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.selectModelParams" title="Link to this definition"></a></dt>
<dd><p>Positional parameters: mslist, context
mslist: List of MS filenames to be processed.
context: Pipeline context associated to this reduction.
decisionmetric: Metric to use to take the decision on best model selection,
options:’maxabs’ (Maximum of absolute residual value, calculated after baseline subtraction),</p>
<blockquote>
<div><p>‘intabs’ (integral of absolute residual value, calculated after baseline subtraction),
‘maxabsdiff’ (Maximum absolute value of residual derivative)
‘intabsdiff’ (integral of absolute value of residual derivative)
‘intsqdiff’ (integral of square value of residual derivative)</p>
</div></blockquote>
<p>Quantities are calculate over a selection of channels around the skylines.
iant, atmtype, maxalt, lapserate, scaleht: see parameters description in atmcorr()
defatmtype, defmaxalt, deflapserate, defscaleht: Parameters for default model in case no best fit is possible.
minpeaklevel: Comparative minimum depth of an atmospheric line (as measured in the optical depth tau)</p>
<blockquote>
<div><p>to be considered while searching for sky lines. Will only consider lines above this threshold.
This parameters is given in units relative to the median value of tau over the SPW.</p>
</div></blockquote>
<dl class="simple">
<dt>diffsmooth: Size of smoothing box applied during the calculation of the metrics that use derivatives.</dt><dd><p>Size if given as a fraction of SPW.</p>
</dd>
</dl>
<p>psize, isize: Point size and image size used for making diagnostic plots.
resultsfile: Text output file containing models, metrics calculated and chosen best model.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.selectRanges">
<span class="sig-name descname"><span class="pre">selectRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeseq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rangetable</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#selectRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.selectRanges" title="Link to this definition"></a></dt>
<dd><p>Return selection boolean array for a time sequence, given a table of time ranges.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.selsource">
<span class="sig-name descname"><span class="pre">selsource</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwsetup</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmdataon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antson</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmatm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antatm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tsys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ndegree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nclips</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothbox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.03</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extpenalty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxmasked</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#selsource"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.selsource" title="Link to this definition"></a></dt>
<dd><p>Select science target channels and return boolean vector with selection. Task attempts polynomial
fits to a baseline of normalized (to Tsys) noise and detect upwards outliers (variance higher than expected
from Tsys level). Final best fit gets determined by chi^2 (including extpenalty factor)
Positional params: From MS selection:</p>
<blockquote>
<div><p>nu: (freq. vector of SPW), tmdataon (time vector of dataon data selection),
antson: (vector of antenna column of dataon data selection),
dataon: (masked array of selected data),
Data from CALATMOSPHERE table:
tmatm: (vector of times of sel. rows), antatm (vector of antenna IDs of sel. rows)
tsys: (Tsys table), trec (T Receiver table), tau (optical depth table)</p>
</div></blockquote>
<p>Keyword params:
ndegree: Maximum degree of polynomial used to fit noise baseline (default=7)
nclips: Maximum number of sigma clipping iterations to try in noise baseline fitting (default=5)
nsigma: number of sigmas for science source channel selection. (default=3.0)
smoothbox: Number of pixels to enlarge science target selection around pixels initially selected through</p>
<blockquote>
<div><p>the nsigma excess. Given as fraction of SPW width. (default=0.03)</p>
</div></blockquote>
<p>extpenalty: Factor to add a penalty to chi^2 of the fits, equal to extpenalty*(channel_range/number_of_channels)
where channel_range is the range of channels of detected science sources. This factor aims at favoring more
compact detections. (default=1.0)
verbose: Return all fits’ selections, fit coefficient and chi^2’s instead of only the best fit. Also produces
plots for each fit. (default=False)
maxmasked: Maximum fraction of data allowed to be masked. If higher than this, return a vector with no selection.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.selsource2">
<span class="sig-name descname"><span class="pre">selsource2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwsetup</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nu</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmdataon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antson</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmatm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antatm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tsys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothselbox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxmasked</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ndegree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nclips</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#selsource2"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.selsource2" title="Link to this definition"></a></dt>
<dd><p>Select science target channels and return boolean vector with selection. Task attempts polynomial
fits to a baseline of normalized (to Tsys) noise and detect upwards outliers (variance higher than expected
from Tsys level). Final best fit gets determined by chi^2 (including extpenalty factor)
Positional params: From MS selection:</p>
<blockquote>
<div><p>nu: (freq. vector of SPW), tmdataon (time vector of dataon data selection),
antson: (vector of antenna column of dataon data selection),
dataon: (masked array of selected data),
Data from CALATMOSPHERE table:
tmatm: (vector of times of sel. rows), antatm (vector of antenna IDs of sel. rows)
tsys: (Tsys table), trec (T Receiver table), tau (optical depth table)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.sigclipfit">
<span class="sig-name descname"><span class="pre">sigclipfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Asig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitdeg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nclips</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bordertokeep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">progdegree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothselbox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#sigclipfit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.sigclipfit" title="Link to this definition"></a></dt>
<dd><p>Return polynomial model parameters done to vector A and residuals from the fit.
x: x coordinate
A: Data set vector.
Asig: Data sigma vector. Should include variance due to skylines and science target emission.
fitdeg: Fitting polynomial degree.
nclips: Number of sigma clipping iterations.
nsigma: Number of sigmas in sigma clipping iterations. Positive float or two-value tuple.
bordertokeep: Fraction of channels to keep in the borders
progdegree: Whether to increase polynomial fit progressively in each iteration.
smoothselbox: Enlarge each outlier detection with a box of this size (as fraction of SPW).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.skysel">
<span class="sig-name descname"><span class="pre">skysel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">skylines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linestouse</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidpeak</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#skysel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.skysel" title="Link to this definition"></a></dt>
<dd><p>Create selection array from dictionary of skylines list.
avoidpeak: Parameter to avoid a range around the line peak as fraction of FWHM</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.SDcalatmcorr.smooth">
<span class="sig-name descname"><span class="pre">smooth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box_pts</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/SDcalatmcorr.html#smooth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.SDcalatmcorr.smooth" title="Link to this definition"></a></dt>
<dd><p>Smooth using boxcar convolution.</p>
</dd></dl>

</section>
<section id="module-pipeline.extern.TsysDataClassFile">
<span id="pipeline-extern-tsysdataclassfile-module"></span><h2>pipeline.extern.TsysDataClassFile module<a class="headerlink" href="#module-pipeline.extern.TsysDataClassFile" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.ATMtrans">
<span class="sig-name descname"><span class="pre">ATMtrans</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scans</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spws</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ifld</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#ATMtrans"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.ATMtrans" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.TsysData">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">TsysData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsystable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oldobject</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_pickle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_polarization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#TsysData"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.TsysData" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py exception">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.TsysData.IntentException">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">IntentException</span></span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#TsysData.IntentException"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.TsysData.IntentException" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.TsysData.filter_statistics_and_dif">
<span class="sig-name descname"><span class="pre">filter_statistics_and_dif</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">statistics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_n_extreme</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polarizations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#TsysData.filter_statistics_and_dif"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.TsysData.filter_statistics_and_dif" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.TsysData.get_valid_antennae">
<span class="sig-name descname"><span class="pre">get_valid_antennae</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#TsysData.get_valid_antennae"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.TsysData.get_valid_antennae" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.TsysData.tsysmap">
<span class="sig-name descname"><span class="pre">tsysmap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsystable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msmdtool_instance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OBSERVE_TARGET#ON_SOURCE'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#TsysData.tsysmap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.TsysData.tsysmap" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.chanfreq_records_to_functions">
<span class="sig-name descname"><span class="pre">chanfreq_records_to_functions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">chan_records</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#chanfreq_records_to_functions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.chanfreq_records_to_functions" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.getImageSBFreqs">
<span class="sig-name descname"><span class="pre">getImageSBFreqs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwin</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#getImageSBFreqs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.getImageSBFreqs" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given the spectral window, find the LO frequency and return the frequencies of
the image sideband. Specifically, return the inputs needed for ATMtrans() in
order to properly show the atmospheric transmission for bands 9 and 10 where the
image sideband atomospheric window also contributes to the spectral window.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>spwin<span class="classifier">int</span></dt><dd><p>The spectral window for which the image sideband frequencies are needed.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>fSB<span class="classifier">numpy.array</span></dt><dd><p>The frequencies of the image sideband. These will be properly arranged
(i.e. they will be opposite in direction to the input spectral window
frequencies).</p>
</dd>
<dt>chansepSB<span class="classifier">float</span></dt><dd><p>The separation between channels (channel width).</p>
</dd>
<dt>fCenterSB<span class="classifier">float</span></dt><dd><p>The mean frequency (center) of the image sideband.</p>
</dd>
<dt>fWidthSB<span class="classifier">float</span></dt><dd><p>The total bandwidth of the image sideband (will be equal to the input
spectral window).</p>
</dd>
</dl>
</dd>
<dt>Note: This has been taken from Todd Hunter’s AU tools, specifically au.interpretLOs,</dt><dd><p>au.getLOs, and plotbandpass3.py - CalcAtmTranmission.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.getband">
<span class="sig-name descname"><span class="pre">getband</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#getband"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.getband" title="Link to this definition"></a></dt>
<dd><p>Identify the Band for specific frequency (in GHz)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.TsysDataClassFile.weather_function">
<span class="sig-name descname"><span class="pre">weather_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msfile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/TsysDataClassFile.html#weather_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.TsysDataClassFile.weather_function" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-pipeline.extern.XmlObjectifier">
<span id="pipeline-extern-xmlobjectifier-module"></span><h2>pipeline.extern.XmlObjectifier module<a class="headerlink" href="#module-pipeline.extern.XmlObjectifier" title="Link to this heading"></a></h2>
<p>This module is used to create native Python objects representing an XML document
rendering the elements into a hierarchical tree. Name spaces can optionally be
mapped into the element names by specifying ‘mapNameSpaces = 1’. Leading
characters can be omitted in the name space mapping using the ‘skipChars’
argument.</p>
<p>Characters that are not allowed in Python names (‘.’, ‘-’, ‘/’, ‘:’) are mapped
to ‘_’.</p>
<p>The resulting Python object can be modified and serialized into XML again using
the ‘writexml’ method.</p>
<p>Example usage:</p>
<p>import XmlObjectifier
xmlObject = XmlObjectifier.XmlObject(xmlString = &lt;XML string&gt;,</p>
<blockquote>
<div><p>skipChars = &lt;string&gt;)</p>
</div></blockquote>
<p>or</p>
<dl class="simple">
<dt>xmlObject = XmlObjectifier.XmlObject(fileName = ‘&lt;file name&gt;’,</dt><dd><p>skipChars = &lt;string&gt;)</p>
</dd>
</dl>
<p>This example XML document:</p>
<p>&lt;?xml version=”1.0” encoding=”ISO-8859-1”?&gt;
&lt;!– edited with XMLSPY v5 U (<a class="reference external" href="http://www.xmlspy.com">http://www.xmlspy.com</a>) by D. Muders (MPIfR) –&gt;
&lt;TelCalResult xmlns=”Alma/TelCalResult”</p>
<blockquote>
<div><p>xmlns:xsi=”http://www.w3.org/2001/XMLSchema-instance”
xsi:schemaLocation=”Alma/TelCalResult/TelCalResult-single.xsd”&gt;</p>
<blockquote>
<div><dl class="simple">
<dt>&lt;TelCalResultEntity entityId=”2718281828” entityIdEncrypted=””</dt><dd><p>entityVersion=”0.1”/&gt;</p>
</dd>
</dl>
<p>&lt;TelCalResultRef entityId=”2718281827”/&gt;
&lt;SchedBlockRef entityId=”31415926534”/&gt;
&lt;TelCalResultDetail&gt;</p>
<blockquote>
<div><p>&lt;ResultKind&gt;FocusOffset&lt;/ResultKind&gt;
&lt;ScanID&gt;1789&lt;/ScanID&gt;
&lt;NumAntennas&gt;2&lt;/NumAntennas&gt;
&lt;AntennaID&gt;64&lt;/AntennaID&gt;
&lt;AntennaID&gt;42&lt;/AntennaID&gt;
&lt;FocusOffset&gt;-0.25&lt;/FocusOffset&gt;
&lt;FocusOffset&gt;-0.34&lt;/FocusOffset&gt;</p>
</div></blockquote>
<p>&lt;/TelCalResultDetail&gt;</p>
</div></blockquote>
</div></blockquote>
<p>&lt;/TelCalResult&gt;</p>
<p>can then be navigated in the Python object like this:</p>
<p>#!/usr/bin/env python3</p>
<p>import XmlObjectifier</p>
<dl>
<dt>def printInfo(focusResult):</dt><dd><p>scanID = focusResult.TelCalResult.TelCalResultDetail.ScanID.getValue()
kind = focusResult.TelCalResult.TelCalResultDetail.ResultKind.getValue()
numAnts = focusResult.TelCalResult.TelCalResultDetail.NumAntennas.getValue()</p>
<p>print(‘This is a %s result entity. Scan ID: %d. Number of antennas: %d</p>
</dd>
</dl>
<p>‘ % (kind, scanID, numAnts))</p>
<blockquote>
<div><dl class="simple">
<dt>for ant in range(numAnts):</dt><dd><p>antID =             focusResult.TelCalResult.TelCalResultDetail.AntennaID[ant].getValue()
focusOffset =             focusResult.TelCalResult.TelCalResultDetail.FocusOffset[ant].getValue()
print(‘Antenna #%d focus offset: %.1f’ % (antID, focusOffset))</p>
</dd>
</dl>
</div></blockquote>
<p># Objectify XML
focusResult = XmlObjectifier.XmlObject(fileName = ‘FocusResult.xml’)</p>
<p># Print object summary
print(‘Original focus result:
‘)
printInfo(focusResult)</p>
<p># Optionally modify elements
focusResult.TelCalResult.TelCalResultDetail.ScanID.setValue(1790)
focusResult.TelCalResult.TelCalResultDetail.AntennaID[0].setValue(24)
focusResult.TelCalResult.TelCalResultDetail.FocusOffset[0].setValue(0.3)
focusResult.TelCalResult.TelCalResultDetail.AntennaID[1].setValue(25)
focusResult.TelCalResult.TelCalResultDetail.FocusOffset[1].setValue(0.5)</p>
<p># Print object summary
print(’</p>
<p>New focus result:
‘)
printInfo(focusResult)</p>
<p># Write XML to a new file
f = open(‘FocusResultNew.xml’, ‘w+’)
focusResult.writexml(f, ‘’)
f.close()</p>
<dl class="py class">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">XmlElement</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">element</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapNameSpaces</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nameSpaceMapping</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipChars</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/XmlObjectifier.html#XmlElement"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Element</span></code></p>
<p>Creates an object representing an XML tag/element with all of its content.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.childNodes">
<span class="sig-name descname"><span class="pre">childNodes</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.childNodes" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.getAttribute">
<span class="sig-name descname"><span class="pre">getAttribute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/XmlObjectifier.html#XmlElement.getAttribute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.getAttribute" title="Link to this definition"></a></dt>
<dd><p>Overwrites the inherited method and returns a value of the right type.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.getValue">
<span class="sig-name descname"><span class="pre">getValue</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/XmlObjectifier.html#XmlElement.getValue"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.getValue" title="Link to this definition"></a></dt>
<dd><p>Returns the included TEXT, if present.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.namespaceURI">
<span class="sig-name descname"><span class="pre">namespaceURI</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.namespaceURI" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.nextSibling">
<span class="sig-name descname"><span class="pre">nextSibling</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.nextSibling" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.nodeName">
<span class="sig-name descname"><span class="pre">nodeName</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.nodeName" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.ownerDocument">
<span class="sig-name descname"><span class="pre">ownerDocument</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.ownerDocument" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.parentNode">
<span class="sig-name descname"><span class="pre">parentNode</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.parentNode" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.prefix">
<span class="sig-name descname"><span class="pre">prefix</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.prefix" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.previousSibling">
<span class="sig-name descname"><span class="pre">previousSibling</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.previousSibling" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.setValue">
<span class="sig-name descname"><span class="pre">setValue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/XmlObjectifier.html#XmlElement.setValue"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.setValue" title="Link to this definition"></a></dt>
<dd><p>Sets the included TEXT.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlElement.tagName">
<span class="sig-name descname"><span class="pre">tagName</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlElement.tagName" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlObject">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">XmlObject</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xmlString</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileName</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipChars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapNameSpaces</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/XmlObjectifier.html#XmlObject"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlObject" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Document</span></code></p>
<p>Creates an object representing the XML document wich is to be objectified.
The XML string passed to the constructor is preferred over any specified
XML file.</p>
<p>Optionally the name space mapping can be turned on by passing mapNameSpaces = 1.</p>
<p>Leading characters in the name space definitions can be skipped in the mapping
by passing the optional “skipChars” argument.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlObject.childNodes">
<span class="sig-name descname"><span class="pre">childNodes</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlObject.childNodes" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlObject.doctype">
<span class="sig-name descname"><span class="pre">doctype</span></span><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlObject.doctype" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.XmlObjectifierError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">XmlObjectifierError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/XmlObjectifier.html#XmlObjectifierError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.XmlObjectifier.XmlObjectifierError" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.XmlObjectifier.castType">
<span class="sig-name descname"><span class="pre">castType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/XmlObjectifier.html#castType"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.XmlObjectifier.castType" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-pipeline.extern.adopted">
<span id="pipeline-extern-adopted-module"></span><h2>pipeline.extern.adopted module<a class="headerlink" href="#module-pipeline.extern.adopted" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.adopted.MAD">
<span class="sig-name descname"><span class="pre">MAD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.6745</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/adopted.html#MAD"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.adopted.MAD" title="Link to this definition"></a></dt>
<dd><p>Median Absolute Deviation along given axis of an array:</p>
<p>median(abs(a - median(a))) / c</p>
<p>c = 0.6745 is the constant to convert from MAD to std; it is used by
default</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.adopted.call_qa_time">
<span class="sig-name descname"><span class="pre">call_qa_time</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">form</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">showform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/adopted.html#call_qa_time"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.adopted.call_qa_time" title="Link to this definition"></a></dt>
<dd><p>This is a wrapper for qa.time(), which in casa 4.0.0 returns a list
of strings instead of just a scalar string.
- Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.adopted.getMJD">
<span class="sig-name descname"><span class="pre">getMJD</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/adopted.html#getMJD"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.adopted.getMJD" title="Link to this definition"></a></dt>
<dd><p>Returns the current MJD.  See also getCurrentMJDSec().
-Todd</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.adopted.getMedianPWV">
<span class="sig-name descname"><span class="pre">getMedianPWV</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myTimes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">999999999999]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/adopted.html#getMedianPWV"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.adopted.getMedianPWV" title="Link to this definition"></a></dt>
<dd><p>Extracts the PWV measurements from the WVR on all antennas for the
specified time range.  The time range is input as a two-element list of
MJD seconds (default = all times).  First, it tries to find the ASDM_CALWVR
table in the ms.  If that fails, it then tries to find the
ASDM_CALATMOSPHERE table in the ms.  If that fails, it then tried to find
the CalWVR.xml in the specified ASDM, or failing that, an ASDM of the
same name (-.ms).  If neither of these exist, then it tries to find
CalWVR.xml in the present working directory. If it still fails, it looks
for CalWVR.xml in the .ms directory.  Thus, you only need to copy this
xml file from the ASDM into your ms, rather than the entire ASDM. Returns
the median and standard deviation in millimeters.
Returns:
The median PWV, and the median absolute deviation (scaled to match rms)
For further help and examples, see <a class="reference external" href="https://safe.nrao.edu/wiki/bin/view/ALMA/GetMedianPWV">https://safe.nrao.edu/wiki/bin/view/ALMA/GetMedianPWV</a>
– Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.adopted.readPWVFromASDM_CALATMOSPHERE">
<span class="sig-name descname"><span class="pre">readPWVFromASDM_CALATMOSPHERE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/adopted.html#readPWVFromASDM_CALATMOSPHERE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.adopted.readPWVFromASDM_CALATMOSPHERE" title="Link to this definition"></a></dt>
<dd><p>Reads the PWV via the water column of the ASDM_CALATMOSPHERE table.
- Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.adopted.readpwv">
<span class="sig-name descname"><span class="pre">readpwv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">asdm</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/adopted.html#readpwv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.adopted.readpwv" title="Link to this definition"></a></dt>
<dd><p>This function assembles the dictionary returned by readwvr() into arrays
containing the PWV measurements written by TelCal into the ASDM.
Units are in meters.
– Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.adopted.readwvr">
<span class="sig-name descname"><span class="pre">readwvr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sdmfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/adopted.html#readwvr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.adopted.readwvr" title="Link to this definition"></a></dt>
<dd><p>This function reads the CalWVR.xml table from the ASDM and returns a
dictionary containing: ‘start’, ‘end’, ‘startmjd’, ‘endmjd’,
‘startmjdsec’, ‘endmjdsec’,
‘timerange’, ‘antenna’, ‘water’, ‘duration’.
‘water’ is the zenith PWV in meters.
This function is called by readpwv(). – Todd Hunter</p>
</dd></dl>

</section>
<section id="module-pipeline.extern.almahelpers">
<span id="pipeline-extern-almahelpers-module"></span><h2>pipeline.extern.almahelpers module<a class="headerlink" href="#module-pipeline.extern.almahelpers" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.SpwInfo">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">SpwInfo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwId</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#SpwInfo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.SpwInfo" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.SpwInfo.setSpwId">
<span class="sig-name descname"><span class="pre">setSpwId</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spwId</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#SpwInfo.setSpwId"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.SpwInfo.setSpwId" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.SpwInfo.setTable">
<span class="sig-name descname"><span class="pre">setTable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msfile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#SpwInfo.setTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.SpwInfo.setTable" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.SpwInfo.setTableAndSpwId">
<span class="sig-name descname"><span class="pre">setTableAndSpwId</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwId</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#SpwInfo.setTableAndSpwId"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.SpwInfo.setTableAndSpwId" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.SpwMap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">SpwMap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">calSpwId</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#SpwMap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.SpwMap" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This object is basically set up to hold the information needed</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.areIdentical">
<span class="sig-name descname"><span class="pre">areIdentical</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spwInfo1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwInfo2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#areIdentical"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.areIdentical" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.calantsub">
<span class="sig-name descname"><span class="pre">calantsub</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">incaltable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outcaltable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#calantsub"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.calantsub" title="Link to this definition"></a></dt>
<dd><p>Substitute cal solutions by antenna
Input:</p>
<blockquote>
<div><p>incaltable  Input caltable
outcaltable Output caltable (if ‘’, overwrite result on incaltable)
spw         Spectral Window selection (no channel selection permitted)
scan        Scan selection
ant         Antenna (indices) which need replaced solutions
subant      Antenna (indices) with which to replace those in ant</p>
</div></blockquote>
<p>This function provides a means to replace solutions by antenna,
e.g., to substitute one antenna’s Tsys spectra with another.</p>
<p>The processing can be limited to specific spectral windows and/or
scans.  The spw and scan parameters should be specified in the
standard MS selection manner (comma-separated integers in a string),
except no channel selection is supported.</p>
<p>The ant parameter specifies one or more antenna indices
(comma-separated in a string) for which solutions are to be
replaced.  The subant parameter lists the antenna indices
from which the substitute solutions are to be obtained. E.g.,
ant=’3,5,7’,subant=’6,8,10’ will cause the solutions from
antenna id 6 to be copied to antenna id 5, id 8 to id 5 and id 10
to id 7.  The number of antennas specified in ant and subant
must match.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.editIntents">
<span class="sig-name descname"><span class="pre">editIntents</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msName</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newintents</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#editIntents"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.editIntents" title="Link to this definition"></a></dt>
<dd><p>Change the observation intents for a specified field.
Inputs:
* field: required argument (integer or string ID, or name)
* scan: optional, can be a single integer, integer list, or comma-delimited string list
* append: set to True to add the specified intent to the existing intents
* newintents: enter as a python list, or as single comma-delimited string
* valid intents: the first 12 are simply a shorthand way to specify the latter 12</p>
<blockquote>
<div><blockquote>
<div><p>‘AMPLITUDE’, ‘ATMOSPHERE’, ‘BANDPASS’, ‘CHECK_SOURCE’, ‘WVR’,
‘DELAY’, ‘FLUX’, ‘FOCUS’, ‘PHASE’, ‘POINTING’, ‘SIDEBAND_RATIO’, ‘TARGET’,
‘CALIBRATE_AMPLI’, ‘CALIBRATE_ATMOSPHERE’, ‘CALIBRATE_BANDPASS’,
‘CALIBRATE_DELAY’, ‘CALIBRATE_FLUX’, ‘CALIBRATE_FOCUS’,
‘CALIBRATE_PHASE’, ‘CALIBRATE_POINTING’, ‘CALIBRATE_SIDEBAND_RATIO’,
‘OBSERVE_TARGET’, ‘CALIBRATE_WVR’, ‘OBSERVE_CHECK_SOURCE’</p>
</div></blockquote>
<p>The modifier #ON_SOURCE will be added to all specified intents.</p>
</div></blockquote>
<ul class="simple">
<li><ol class="upperalpha simple" start="20">
<li><p>Hunter</p></li>
</ol>
</li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.editIntentscsv">
<span class="sig-name descname"><span class="pre">editIntentscsv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">intentcsv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dryrun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#editIntentscsv"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.editIntentscsv" title="Link to this definition"></a></dt>
<dd><p>Reads a list of parameters from a csv text file and runs editIntents on them.
File format:
# any number of comment lines
vis,field,scan,”WVR,BANDPASS”
vis,field,,’FLUX,WVR’
…</p>
<ul class="simple">
<li><p>field is a required argument, while scan is optional</p></li>
<li><dl class="simple">
<dt>scan: can be a single integer, integer list, or comma-delimited string list</dt><dd><p>multiple scans or intents must be quoted, either single or double quote</p>
</dd>
</dl>
</li>
</ul>
<p>-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.fixsyscaltimes">
<span class="sig-name descname"><span class="pre">fixsyscaltimes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newinterval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#fixsyscaltimes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.fixsyscaltimes" title="Link to this definition"></a></dt>
<dd><p>Fix TIME,INTERVAL columns in MS SYSCAL subtable
Input:</p>
<blockquote>
<div><p>vis          the MS containing the offending SYSCAL subtable
newinterval  the interval to use in revised entries</p>
<p>This function is intended to repair MS SYSCAL tables that suffer from
multiple TIME values (over antennas) per Tsys measurement.  The gencal
task (mode=’tsys’ expects all antennas to share the same TIME value
for each Tsys measurement (and this is usually true).  The function
finds those measurements that have multiple TIMEs and replaces them
with a common TIME value which takes the value
mean(oldTIME-INTERVAL/2)+newinterval/2.
Usually (always?), oldTIME-INTERVAL/2 is constant over antennas
and represents the physical timestamp of the Tsys measurment.
If the function finds no pathological timestamps, it does not
revise the table.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.genImageName">
<span class="sig-name descname"><span class="pre">genImageName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imtype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mfs'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targettype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sci'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stokes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'I'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">modtext</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'manual'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#genImageName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.genImageName" title="Link to this definition"></a></dt>
<dd><p>Generate image name to be used in clean command
following the ALMA archive conventions (see SCIREQ-110, draft recommendations v4.8).</p>
<blockquote>
<div><p>vis         = MS to be imaged (to extract object name, SPW frequencies
spw         = ID of SPW to be imaged</p>
<blockquote>
<div><p>If several SPWs are imaged at once, enter list of SPWs.</p>
</div></blockquote>
<dl class="simple">
<dt>field       = ID of field to be imaged (to extract object name).</dt><dd><p>in case of mosaic, give any ID of field belonging to the mosaic</p>
</dd>
<dt>imtype      = image type, ‘mfs’ (default) - aggregate bandwidth</dt><dd><p>‘cont’ - mfs with lines excluded
‘cube’ - spectrally resolved cube</p>
</dd>
<dt>targettype  = ‘sci’ (default) for science target</dt><dd><p>‘bp’ for bandpass calibrator
‘ph’ for phase calibrator
‘chk’ for checksource
‘amp’ for flux calibrator</p>
</dd>
<dt>stokes      = ‘I’ (default) for Stokes I image</dt><dd><p>any combination of ‘I’, ‘Q’, ‘U’, ‘V’, ‘P’, ‘A’</p>
</dd>
<dt>mous        = ‘’ (default) normally this is filled by the archive.</dt><dd><p>But if you know the MOUS UID, enter it in the format with “_”
e.g.  uid___A001_X888_X66</p>
</dd>
<dt>modtext     = ‘manual’ (default) - this string can be used to add text,</dt><dd><p>i.e. a modification, to the standard file name.
It is appended at the end of the name.</p>
</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.trimSpwmap">
<span class="sig-name descname"><span class="pre">trimSpwmap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spwMap</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#trimSpwmap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.trimSpwmap" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almahelpers.tsysspwmap">
<span class="sig-name descname"><span class="pre">tsysspwmap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tsystable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tsysChanTol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almahelpers.html#tsysspwmap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almahelpers.tsysspwmap" title="Link to this definition"></a></dt>
<dd><p>Generate default spwmap for ALMA Tsys, including TDM-&gt;FDM associations
Input:</p>
<blockquote>
<div><p>vis        the target MeasurementSet
tsystable  the input Tsys caltable (w/ TDM Tsys measurements)
trim       if True (the default), return minimum-length spwmap;</p>
<blockquote>
<div><p>otherwise the spwmap will be exhaustive and include
the high-numbered (and usually irrelevant) wvr
spws</p>
</div></blockquote>
<p>relax      (not yet implemented)</p>
</div></blockquote>
<dl>
<dt>Output:</dt><dd><p>spw list to use in applycal spwmap parameter for the Tsys caltable</p>
<p>This function takes the Tsys Caltable you wish to apply to a
MeasurementSet and generates a “applycal-ready” spwmap that
provides the appropriate information regarding the transfer
Tsys calibration from TDM spectral windows to FDM spectral
windows.  To execute the function:</p>
<p>tsysmap=tsysspwmap(vis=’my.ms’,tsystable=’mytsys.cal’)</p>
<p>tsysmap can then be supplied to the applycal spwmap parameter
to ensure proper Tsys calibration application.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pipeline.extern.almarenorm">
<span id="pipeline-extern-almarenorm-module"></span><h2>pipeline.extern.almarenorm module<a class="headerlink" href="#module-pipeline.extern.almarenorm" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ACreNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">caltable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.ATMcorrection">
<span class="sig-name descname"><span class="pre">ATMcorrection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inscan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inspw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infld</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calscan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.ATMcorrection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.ATMcorrection" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.ATMtrans">
<span class="sig-name descname"><span class="pre">ATMtrans</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iscan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ispw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ifld</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.ATMtrans"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.ATMtrans" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>This function will return the atmospheric model for the input spectral window
and scan. In the case of a Band 9 or 10 spectral window, the atmospheric model
for the image sideband is also returned.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>iscan<span class="classifier">int</span></dt><dd><p>The user input scan from which to get the atmospheric model. This is used
to find the observation time, elevation, and weather information.</p>
</dd>
<dt>ispw<span class="classifier">int</span></dt><dd><p>The user input spectral window.</p>
</dd>
<dt>ifld<span class="classifier">int</span><span class="classifier">OPTIONAL</span></dt><dd><p>The user input field ID. This is optional but in the case of mosaics, can
make the atmospheric model slightly more accurate.
Default: None</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>Setting to True will output additional information as the atmospheric profile
is calculated.
Default: False</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>numpy.array
(transmission, transmission_SB): numpy.arrays : ONLY FOR BANDS 9 AND 10</p>
<blockquote>
<div><p>This is a 1-D array with the same length as the number of channels of the input
scan/spw. The values of the array consist of the atmospheric transmission by
channel as a fraction between 0.0 and 1.0.</p>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>transmission</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.calcChanRanges">
<span class="sig-name descname"><span class="pre">calcChanRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwdiv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'odd'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onlyfdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.calcChanRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.calcChanRanges" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.calcFixReNorm">
<span class="sig-name descname"><span class="pre">calcFixReNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">AntUse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scanin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fldin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doplot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotDivisions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.calcFixReNorm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.calcFixReNorm" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This function takes in a renormalization spectrum and performs a
set of heuristics to check for outliers caused by issues with the
autocorrelations (e.g. birdies). Outlier channels are replaced with
the median spectrum. If many channels are found to be outliers
(greater than 10 consecutive channels or &gt;10% of total spectrum),
then the whole median spectrum of that correlation is used for the
replacement instead.</p>
<p>Note that this operates on the input renormalization spectrum
directly! Therefore the input spectrum will be directly adjusted.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">dictionary</span></dt><dd><p>The renormalization spectrum as created by the renormalize()
method.</p>
</dd>
<dt>AntUse<span class="classifier">list of strings</span></dt><dd><p>This is a list of antennas to investigate for outliers. The
checkOutlierAnt method will return an appropriate list to
be used as input here.</p>
</dd>
<dt>scanin<span class="classifier">string</span></dt><dd><p>The scan number to check.</p>
</dd>
<dt>spwin<span class="classifier">string</span></dt><dd><p>The spw number to check.</p>
</dd>
<dt>fldin<span class="classifier">string</span></dt><dd><p>The field number to check.</p>
</dd>
<dt>doplot<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, produce plots that show original spectrum
and replaced values.
Default: True</p>
</dd>
<dt>plotDivisions<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then include vertical lines of the plots that
show where the spectrum was divided up during the fitting
process of the calcReNorm1 method.
Default: True</p>
</dd>
<dt>hardcopy<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, save a hardcopy of the produced plot to disk.
Default: True</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, produce additional output.
Default: False</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>The input renormalization spectrum, R, is operated on directly.
No additional output is generated.</p>
</dd>
<dt>Notes for Improvement:</dt><dd><p>If AntUse is not defined, could default to running checkOutlierAnt
method by default.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.calcMaxConseq">
<span class="sig-name descname"><span class="pre">calcMaxConseq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">linelist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.calcMaxConseq"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.calcMaxConseq" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.calcReNorm1">
<span class="sig-name descname"><span class="pre">calcReNorm1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkFit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doplot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iden</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.calcReNorm1"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.calcReNorm1" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Perform a simple polynomial fit to the renormalization scaling
spectrum to remove any residual baseline ripples. Used within the
renormalize method to fit a baseline to each segment of the full
spectrum.</p>
<p>Note that this operates directly on the input spectrum!</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">numpy.array</span></dt><dd><p>Scaling spectrum for a specific scan, spw, field and pol.</p>
</dd>
<dt>doplot<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, produce a plot showing the polynomial fits
that have been applied to the data.</p>
</dd>
<dt>iden<span class="classifier">str</span><span class="classifier">OPTIONAL</span></dt><dd><p>An optional identifier to append to image names to make them
unique, otherwise they will get written over.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>None directly, but note that the input scaling spectrum will be
adjusted directly.</p>
</dd>
<dt>Notes for Improvement:</dt><dd><p>In some cases, there are segments where an ATM feature is near the
edge of the segment and leaves just a few channels of data. Thus,
there are a few valid channels, then a gap, then the rest of the
segment data. The few channels of data will sometimes end up
just outside the threshold and then end up skewed wildly and can
result in false application. One could force the fit to always
include data from both sides of an ATM feature but what if it’s
a real feature? Force a wider segment?</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.calcRenormLegendre">
<span class="sig-name descname"><span class="pre">calcRenormLegendre</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nseg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.calcRenormLegendre"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.calcRenormLegendre" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Perform a fit to the renormalization spectrum to flatten the
profile and make it so that outside of spectral features the
data is unchanged (i.e. multiplied by 1.0). Here, Legendre
polynomials are used for the fitting process.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">numpy.array</span></dt><dd><p>This is the segment of renormalization spectrum you wish to
perform a fit on.</p>
</dd>
<dt>nseg<span class="classifier">integer</span></dt><dd><p>This is the number of segments that calcChannelRanges()
suggested. This function will decide on the order of the fit
based on the number of segments and the self.nfit parameter
as self.nfit*nseg.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.calcSetEdge">
<span class="sig-name descname"><span class="pre">calcSetEdge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.calcSetEdge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.calcSetEdge" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.chanfreqs">
<span class="sig-name descname"><span class="pre">chanfreqs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ispw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.chanfreqs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.chanfreqs" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.channel_ranges">
<span class="sig-name descname"><span class="pre">channel_ranges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TDM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.channel_ranges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.channel_ranges" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given a list of channels, this will return a list of ranges that
describe them accounting for a buffer and gap in input that can be assumed
as consecutive.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.checkOutlierAnt">
<span class="sig-name descname"><span class="pre">checkOutlierAnt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.checkOutlierAnt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.checkOutlierAnt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Perform a check of each antenna in a renormalization spectrum
dictionary and return a list of possibly problematic antenna
that may need flagging due to outlier data (e.g. from birdies).</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">dictionary</span></dt><dd><dl class="simple">
<dt>The renormalization spectrum as created by the renormalize()</dt><dd><p>method.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>AntChk<span class="classifier">list of strings</span></dt><dd><p>A list of antennas that may contain problematic data which
can be used as input for the calcFixReNorm method.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.close" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.convertPlotsToPDF">
<span class="sig-name descname"><span class="pre">convertPlotsToPDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_summary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_heuristics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.convertPlotsToPDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.convertPlotsToPDF" title="Link to this definition"></a></dt>
<dd><p>Super hacky way to create PDFs of created plots so that we can display them in the weblog.
Simply calls the bash commands “montage” (to create super plots of pngs), “convert” (to
then convert those super plots into pdfs), and “pdfunite” (to combine all pdfs into one).</p>
<dl class="simple">
<dt>Imports:</dt><dd><dl class="simple">
<dt>target<span class="classifier">string</span></dt><dd><p>Name of the target field that matches the filename target</p>
</dd>
<dt>spw<span class="classifier">str (or int, the type is forced)</span></dt><dd><p>The spectral window of the files that need to be converted to a PDF.</p>
</dd>
<dt>include_summary<span class="classifier">boolean (OPTIONAL)</span></dt><dd><p>If set to True, the summary plot averaging over all scans/fields will be included.
Default: True</p>
</dd>
<dt>include_heuristics<span class="classifier">boolean (OPTIONAL)</span></dt><dd><p>If set to True, the per antenna heuristics plots will be included in the PDFs.
Default: False</p>
</dd>
</dl>
</dd>
<dt>Output:</dt><dd><p>The target/spw matched plots are montaged and transformed into a PDF and placed into the
./RN_plots directory. The name of the PDF is put into the self.rnpipestats dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.findNearest">
<span class="sig-name descname"><span class="pre">findNearest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.findNearest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.findNearest" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given an array and a value that falls within that array, find
the nearest value or index within the array to that value.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>array<span class="classifier">list of floats or ints</span></dt><dd><p>An array for which to evaluate.</p>
</dd>
<dt>value<span class="classifier">float or int</span></dt><dd><p>The value you wish to find the closest match to within
the array.</p>
</dd>
<dt>index<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If True, return the index location within array that is
closest to the value. Otherwise, return the value of that
index.
Default: False</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.fitAtmLines">
<span class="sig-name descname"><span class="pre">fitAtmLines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ATMprof</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.fitAtmLines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.fitAtmLines" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given an atmospheric profile, find the features caused by water/ozone/etc
and fit a Lorentizian profile to it, returning the center and gamma scale.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>ATMprof<span class="classifier">numpy.ndarray</span></dt><dd><p>An atmospheric profile as returned by ATMtrans()</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If True, then information about the fit will be printed to the terminal.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>centers<span class="classifier">list of floats</span></dt><dd><p>The center channel of found features.</p>
</dd>
<dt>scales<span class="classifier">list of floats</span></dt><dd><p>The gamma scale factor of found features.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This utilizes the scipy package, specifically scipy.signal.find_peaks and
scipy.optimize.curve_fit.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.fixCalTable">
<span class="sig-name descname"><span class="pre">fixCalTable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.fixCalTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.fixCalTable" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>This function will be invoked when data wobble around the renorm
threshold value such that some scans do not trigger renorm while
some do. When fillTable is set to True, this causes there to be
some scans with all values set to 1.0 and others to have valid
entries. The renormalize() method will go back and rewrite those
rows but this messes up the caltable if the data are already
written. Therefore, this will delete the already added rows.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>num_rows<span class="classifier">int</span></dt><dd><p>The number of rows to delete.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>None. The table is directly modified.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getACdata">
<span class="sig-name descname"><span class="pre">getACdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rowave</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stateid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getACdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getACdata" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getBscan">
<span class="sig-name descname"><span class="pre">getBscan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getBscan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getBscan" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getBtsysscan">
<span class="sig-name descname"><span class="pre">getBtsysscan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getBtsysscan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getBtsysscan" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getImageSBFreqs">
<span class="sig-name descname"><span class="pre">getImageSBFreqs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spwin</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getImageSBFreqs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getImageSBFreqs" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given the spectral window, find the LO frequency and return the frequencies of
the image sideband. Specifically, return the inputs needed for ATMtrans() in
order to properly show the atmospheric transmission for bands 9 and 10 where the
image sideband atomospheric window also contributes to the spectral window.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>spwin<span class="classifier">int</span></dt><dd><p>The spectral window for which the image sideband frequencies are needed.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>fSB<span class="classifier">numpy.array</span></dt><dd><p>The frequencies of the image sideband. These will be properly arranged
(i.e. they will be opposite in direction to the input spectral window
frequencies).</p>
</dd>
<dt>chansepSB<span class="classifier">float</span></dt><dd><p>The separation between channels (channel width).</p>
</dd>
<dt>fCenterSB<span class="classifier">float</span></dt><dd><p>The mean frequency (center) of the image sideband.</p>
</dd>
<dt>fWidthSB<span class="classifier">float</span></dt><dd><p>The total bandwidth of the image sideband (will be equal to the input
spectral window).</p>
</dd>
</dl>
</dd>
<dt>Note: This has been taken from Todd Hunter’s AU tools, specifically au.interpretLOs,</dt><dd><p>au.getLOs, and plotbandpass3.py - CalcAtmTranmission.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getPhscan">
<span class="sig-name descname"><span class="pre">getPhscan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getPhscan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getPhscan" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getStateIdsForIntent">
<span class="sig-name descname"><span class="pre">getStateIdsForIntent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">intent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getStateIdsForIntent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getStateIdsForIntent" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getTsysSpectra">
<span class="sig-name descname"><span class="pre">getTsysSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getTsysSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getTsysSpectra" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getXCflags">
<span class="sig-name descname"><span class="pre">getXCflags</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'FLAG'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getXCflags"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getXCflags" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.getband">
<span class="sig-name descname"><span class="pre">getband</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.getband"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.getband" title="Link to this definition"></a></dt>
<dd><p>Identify the Band for specific frequency (in GHz)</p>
<p>Note that the Band 2/3 identification is currently not
guaranteed to be correct.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.interpretExcludechan">
<span class="sig-name descname"><span class="pre">interpretExcludechan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ranges</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.interpretExcludechan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.interpretExcludechan" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Pupose:</dt><dd><p>As an option to the self.renormalize() method, a user may input
channel ranges to be excluded from the analysis via the excludechan
option. Additionally, if the atmAutoExclude option is enabled the
renormalize method will attempt to fix any atmospheric features
that it thinks to be problematic. Those channel ranges, either
input or generated, are added to a dictionary and then need to be
interpreted correctly for both the exclusion and later plotting.</p>
</dd>
<dt>Inputs:</dt><dd><dl>
<dt>ranges<span class="classifier">list</span></dt><dd><p>This is a list of the different ranges within a single spectral
window that need to be excluded. The expected format is:</p>
<p>[“low_channel~high_channel”; “low_channel~high_channel”; …]</p>
</dd>
<dt>spw<span class="classifier">integer</span></dt><dd><p>This is the spectral window number. This is only needed if the
inputs of ranges are in frequency but must always be given.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>starts<span class="classifier">list</span></dt><dd><p>A list containing the starting channels for each range to be
excluded.</p>
</dd>
<dt>ends<span class="classifier">list</span></dt><dd><p>A list containing the ending channels for each range to be
excluded.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.merge_dicts">
<span class="sig-name descname"><span class="pre">merge_dicts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.merge_dicts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.merge_dicts" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given two dictionaries, merge them together such that common
keys do not get overwritten. The main purpose is for merging
user input excludechan ranges with ATM excludechan ranges.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>dict1, dict2<span class="classifier">dictionaries</span></dt><dd><p>The two dictionaries to merge together.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>The merged dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.normChanAxis">
<span class="sig-name descname"><span class="pre">normChanAxis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.normChanAxis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.normChanAxis" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.onlineBinningFactor">
<span class="sig-name descname"><span class="pre">onlineBinningFactor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.onlineBinningFactor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.onlineBinningFactor" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Return the online channel binning factor for the relevant spectral
windows. Note that for early data (&lt;Cycle 3) this will return the
wrong values (i.e. it always returns 1).</p>
<p>This is only used in the Hanning smoothing application of ATM
corrections which is currently not implemented.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.plotRelTsysSpectra">
<span class="sig-name descname"><span class="pre">plotRelTsysSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normByB</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">64000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwdiv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retflchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.plotRelTsysSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.plotRelTsysSpectra" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.plotScanStats">
<span class="sig-name descname"><span class="pre">plotScanStats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.plotScanStats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.plotScanStats" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.plotSpectra">
<span class="sig-name descname"><span class="pre">plotSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">titlein</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotDivisions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">createpdf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">includeSummary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotOriginal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shadeAtm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">showExcluded</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.plotSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.plotSpectra" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This function makes a summary plot of the renormalization spectrum
for every spectral window that has been evaluated for a
renormalization correction. The plots are a cumulative average over
all scans and fields for each antenna and correlation. For sources
that have multiple fields per scan (mosaics), only those fields
that exceed the threshold are shown in the plot. This also means
that even single pointings that oscillate around the threshold will
have only those scans that exceed the threshold included in the
summary plot created. Additionally, any antenna that were fully
flagged during calibration will have their renormalization values
set to 1.0.</p>
<p>Note that renormalization() must be run before this can be run.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>plotATM<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to include the ATM transmission curves
in the plots. The bandpass is used as the representative ATM
transmission curve. Note that in Bands 9 and 10, the image
sideband transmission curve is also shown as a black line.
Default: True</p>
</dd>
<dt>titlein: string: OPTIONAL</dt><dd><p>This allows one to introduce their own title text.
Default: None</p>
</dd>
<dt>plotDivisions: boolean: OPTIONAL</dt><dd><p>This is a boolean switch to include vertical lines at all
locations where the spectral window was broken up during the
calcReNorm() stage when the spectral window renormalization
spectrum was fit to flatten the spectrum.
Default: True</p>
</dd>
<dt>hardcopy<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to create a hardcopy of the plot as a
PNG file. If this is set to False, the plots will be shown
interactively but not saved.
Default: True</p>
</dd>
<dt>createpdf<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to create a PDF of the summary plot
using the convertPlotsToPDF() method. This will only trigger
if hardcopy is also set to True.
Default: True</p>
</dd>
<dt>includeSummary<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to include the summary plot in the
created PDF. As such, this is only evaluated if both hardcopy
and createpdf are set to True.
Default: True</p>
</dd>
<dt>plotOriginal<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to overplot the original data before
any ATM correction was performed.
Default: True</p>
</dd>
<dt>shadeAtm<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, this will shade the region of the spectrum
influenced by atmospheric features. Features are found and
fitted if plotATM=True, otherwise this option has no effect.
Default: True</p>
</dd>
<dt>showExcluded<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then areas of the spectrum that have been
excluded via the excludechan option in renormalize() will
be shown.
Default: True</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.plotSpwStats">
<span class="sig-name descname"><span class="pre">plotSpwStats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.plotSpwStats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.plotSpwStats" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.plotSpws">
<span class="sig-name descname"><span class="pre">plotSpws</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.plotSpws"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.plotSpws" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.plotdiagSpectra">
<span class="sig-name descname"><span class="pre">plotdiagSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scanin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fldin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotDivisions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_atm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shadeAtm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">showExcluded</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.plotdiagSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.plotdiagSpectra" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>This creates diagnotic spectra at the per field per spectral window level for each scan.
Each antenna and correlation are plotted for each field.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">numpy.array</span></dt><dd><p>This is the renormalization spectrum that you wish to plot. Requires data in the form
of a numpy array in the shape [correlation, channel, antenna] such that [0,:,0] would
be the 0-th correlation (XX), all channels, for the 0-th antenna (e.g. DA45) and would
be the found renormalization spectrum.</p>
</dd>
<dt>scanin<span class="classifier">int</span></dt><dd><p>This is the scan number which corresponds to the renormalization spectrum supplied.</p>
</dd>
<dt>spwin<span class="classifier">int</span></dt><dd><p>This is the spectral window number which corresponds to the renormalization spectrum
supplied.</p>
</dd>
<dt>fldin<span class="classifier">int</span></dt><dd><p>This is the field number which corresponds to the normalization spectrum supplied.</p>
</dd>
<dt>plotATM<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This option will plot (or not) the atmospheric transmission profile for the input
spectrum.
Default: True</p>
</dd>
<dt>plotDivisions<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This option will plot (or not) the division lines as vertical, grey, dotted lines
at all the locations where the renormalization spectrum was broken up during the
fitting stage.
Default: True</p>
</dd>
<dt>threshLine<span class="classifier">float or None</span><span class="classifier">OPTIONAL</span></dt><dd><p>This option allows the user to draw a line of the plot to represent the threshold
level.
Default: None</p>
</dd>
<dt>N_atm<span class="classifier">numpy.array OR None</span><span class="classifier">OPTIONAL</span></dt><dd><p>Similar to R above, this is the renormalization spectrum that you want to plot except
this should be the renormalization spectrum that has not had any atmospheric corrections
applited to it. If provided, then this “original” data will be plotted showing the
differences between this and the renormalization spectrum that will be applied.
Default: None</p>
</dd>
<dt>shadeAtm<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, this will find atmospheric features, fit them with a Lorentzian
profile and shade the regions of the spectrum influenced by the feature.
Default: True</p>
</dd>
<dt>showExcluded<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then areas of the spectrum that have been excluded via the
excludechan option in renormalize() will be shown.
Default: True</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormMedianPWV">
<span class="sig-name descname"><span class="pre">renormMedianPWV</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">myTimes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">99999999999]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormMedianPWV"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormMedianPWV" title="Link to this definition"></a></dt>
<dd><p>Extracts the PWV measurements from the WVR on all antennas all times.
First, it tries to find the ASDM_CALWVR
table in the ms.  If that fails, it then tries to find the
ASDM_CALATMOSPHERE table in the ms.
Returns:
The median PWV
For further help and examples, see <a class="reference external" href="https://safe.nrao.edu/wiki/bin/view/ALMA/GetMedianPWV">https://safe.nrao.edu/wiki/bin/view/ALMA/GetMedianPWV</a>
– Todd Hunter - aU version
– Luke Maud - copied and stripped down for almarenorm to make independent of
the analysis utilities</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormPWVFromASDM_CALATMOSPHERE">
<span class="sig-name descname"><span class="pre">renormPWVFromASDM_CALATMOSPHERE</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormPWVFromASDM_CALATMOSPHERE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormPWVFromASDM_CALATMOSPHERE" title="Link to this definition"></a></dt>
<dd><p>Reads the PWV via the water column of the ASDM_CALATMOSPHERE table in MS.
- Todd Hunter - aU version
- Luke Maud copied and edited for almarenorm so independent of analysisUtils</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormWeather">
<span class="sig-name descname"><span class="pre">renormWeather</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormWeather"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormWeather" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Returns the weather conditions and time stamps of a given scan.
This is heavily adapted from Todd Hunter’s analysisUtils code,
au.getWeather() function.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>scan<span class="classifier">integer</span></dt><dd><p>The scan number.</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to true, some additional output is printed to screen.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>[conditions, myTimes]</dt><dd><dl class="simple">
<dt>conditions<span class="classifier">dictionary</span></dt><dd><p>Includes the average temperature (Celcius), humidity (%),
and Pressure (mB) for the given scan.</p>
</dd>
<dt>myTimes<span class="classifier">numpy.array</span></dt><dd><p>List of times during the given scan.</p>
</dd>
</dl>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormWeatherStationNames">
<span class="sig-name descname"><span class="pre">renormWeatherStationNames</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormWeatherStationNames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormWeatherStationNames" title="Link to this definition"></a></dt>
<dd><p>Returns a dictionary keyed by ALMA weather station ID, with the value
equal to the station name (e.g. ‘WSTBn’).
vis: single measurement set
-Todd Hunter - aU version
-Luke Maud copied and modified/stripped down
from analysisUtils to make almarenorm.py independent</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormalize">
<span class="sig-name descname"><span class="pre">renormalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludespws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targscans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludeants</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludechan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excflagged</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixOutliers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mededge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atmAutoExclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkFalsePositives</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correctATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.85</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwdiv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'odd'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthreshspw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkLineForest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useDynamicSegments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CORRECTED_DATA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">createCalTable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fillTable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">docorr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">docorrThresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usePhaseAC</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antHeuristicsSpectra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diagSpectra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormalize" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This is the main function of the ACreNorm class. It takes the
autocorrelations and evaluates them to see if a rescaling of the
crosscorrelation data is necessary. It does this by looping over
the science targets on a per spw, per scan, per field, per antenna,
per correlation basis. It takes the autocorrelations of the target
and divides them by a calibrator’s autocorrelations (by default the
bandpass) and any peaks above 2% in the resultant spectrum are
caused by actual detections of the science target and therefore
need to be corrected in the crosscorrelation data.</p>
</dd>
<dt>Inputs:</dt><dd><p>This function has many options for evaluating the autocorrelations
and applying solutions if necessary but no inputs are necessary
for operation. Some options are highly experimental and not
recommended for blind usage, they have been noted below.</p>
<dl>
<dt>excludespws<span class="classifier">list of integers</span></dt><dd><blockquote>
<div><p>If not empty, any spw specified will be removed from analysis
if that spw is one of the science spws.
Example: excludespws = [21]
Default: excludespws = []</p>
</div></blockquote>
<dl class="simple">
<dt>spws<span class="classifier">list of integers</span></dt><dd><p>If not empty, only perform renormalization on the spws that
are specified. Note that these must be science spws or they
will be ignored.
Example: spws = [21,23]
Default: spws = []</p>
</dd>
</dl>
</dd>
<dt>targscans<span class="classifier">list of integers</span></dt><dd><p>If not empty, only perform renormalization on the target scans
that are specified. Note that these scans must contain science
data or they will be ignored.
Example: targscans = [18,21,24,27]
Default: targscans = []</p>
</dd>
</dl>
<dl>
<dt>excludeants<span class="classifier">list of integers</span></dt><dd><p>Specified antennas will be ignored in all analysis and
application. This is intended to be used if any antenna are
problematic in the interferometric data or need manually
flagging. This is normally done via the excflagged option but
if the data were just imported then flags are not available
and this can be used instead. Excluded antennas have their
scaling spectra set to 1.0.
Example: excludeants = [10,32]
Default: excludeants = []</p>
</dd>
<dt>excludechan<span class="classifier">dictionary</span></dt><dd><p>If problematic data is found across a series of channels (often
from atmospheric features) then the spw and channel ranges can
be specified in either channel or frequency space (TOPO, GHz).
Excluded channels have their scaling spectra set to 1.0.
Example: excludechan={‘22’:’100~150;800~850’, ‘24’:’100~200’}</p>
<blockquote>
<div><p>excludechan={‘22’:’230.1GHz~230.2GHz’}</p>
</div></blockquote>
<p>Default: excludechan={}</p>
</dd>
<dt>excflagged<span class="classifier">boolean</span></dt><dd><p>Excluded flagged antenna by reading the crosscorrelation flag
tables per spw, per scan, and per field. Antennas are excluded
if fully flagged. Only useful after the data are fully
calibrated. Fully flagged antenna will have thier scaling
spectra set to 1.0.
Default: excflagged = True</p>
</dd>
<dt>fixOutliers<span class="classifier">boolean</span></dt><dd><p>Check antennas individually per scan, field, and correlation
for outlier data compared to the median spectrum across all
antennas for that correlation on a channel-by-channel basis.
Outlier data is set to the median spectrum value of the
corresponding correlation.
Default: fixOutliers = True</p>
</dd>
<dt>mededge<span class="classifier">float</span></dt><dd><p>Percentage of edge channels to set to the median spectrum
value to prevent edge effects from influencing results.
Default: mededge = 0.01     (i.e. 1%)</p>
</dd>
</dl>
<dl class="simple">
<dt>atmAutoExclude<span class="classifier">boolean</span></dt><dd><p>This option works in conjunction with the checkFalsePositives
option to identify problematic sections of the spectrum where
the atmosphere may be causing issues. If set to True, this will
automatically exclude those sections of the spectrum where
there are atmospheric features using the same method as the
excludechan option.
Default: atmAutoExclude = True</p>
</dd>
<dt>checkFalsePositives<span class="classifier">boolean</span></dt><dd><p>This will automatically find atmospheric lines in the spectrum
and check those regions to see if there is a renorm signal
above the threshold. If there is, it is assumed to be a “false
positive” signal caused by the ATM feature and will trigger a
warning as well as a suggested region to exclude from analysis.
Default: checkFalsePositives = True</p>
</dd>
<dt>correctATM<span class="classifier">boolean</span><span class="classifier">EXPERIMENTAL - NOT RECOMMENDED</span></dt><dd><p>This will get the transmission profiles for the bandpass (or
phase) and target(s) and create a ratio of those profiles and
apply it to the scaling spectrum. Becuase the bandpass (or
phase) and target(s) autocorrelations are compared in
establishing the scaling spectra, there can be issues where
transmission is low and/or the source elevations are different
by a significant amount resulting in very different atmospheric
effects. This option acts to fix this discrpancy so that
atmospheric features are handled correction.
NOTE: Although a good idea, in practice it appears to have
little effect and sometimes does more harm.
Default: correctATM = False</p>
</dd>
<dt>limATM<span class="classifier">float</span></dt><dd><p>Set the transmission limit for atmospheric features so that
only when features are below the set limit are they mitigated.
This helps with computation time as there are diminishing
returns on dealing with minor atmospheric features.
Default: limATM = 0.85</p>
</dd>
<dt>plotATM<span class="classifier">boolean</span></dt><dd><p>If set to True, plot the atmospheric transmission curve on a
secondary y-axis.
Default: plotATM = True</p>
</dd>
</dl>
<dl>
<dt>bwdiv<span class="classifier">None, ‘odd’, int</span></dt><dd><p>If a spw needs to be broken up into chunks (see bwthresh), this
option determines the behavior of the division process. The
input here will be applied to all spws. There are three input
options available:</p>
<blockquote>
<div><ol class="arabic simple">
<li><dl class="simple">
<dt>None - This will use powers of 2 based on taking the</dt><dd><p>full spw bandwidth and dividing by bwthresh option.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>‘odd’ - This follows the process of (1) but attempts to</dt><dd><p>force an odd number of segments of equal size.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>int - This will divide the spw bandwidth by the input</dt><dd><p>integer to create segments of equal size.</p>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
<p>NOTE: For options (2) and (3) there is a possiblity that the
total number of channels does not evenly divide into an
integer number of channels. For example, 2048 channels divided
by 3 segments is 682 channels per segment with a remainder of 2
channels. In these cases, the mededge option is considered as
this will flag a number of edge channels anyway. If the number
of channels in the remainder is smaller than the flagged region
then the solution is kept, otherwise the solution defaults to
option (1).</p>
<p>NOTE: The total number of segments is capped at 7 which will
override any input here.</p>
<dl class="simple">
<dt>Examples: bwdiv = None</dt><dd><p>bwdiv = ‘odd’
bwdiv = 4</p>
</dd>
</dl>
<p>Default: bwdiv = ‘odd’</p>
</dd>
<dt>bwthresh<span class="classifier">float</span></dt><dd><p>The maximum bandwidth (in Hz) to fit a baseline to, beyond this
limit the spw will be broken into chunks to fit separately.
NOTE: The maximum number of segments is capped at 7. This will
override this setting for wide spws.
Default: bwthresh = 120e6</p>
</dd>
<dt>bwthreshspw<span class="classifier">dictionary</span></dt><dd><p>This allows the user to input specific settings of the bwthresh
option on a per spw basis, spws not specifed here will default
to the bwthresh option setting.
Example: bwthreshspw = {‘22’:’250e6’, ‘24’:’500e6’}
Default: {}</p>
</dd>
<dt>checkLineForest<span class="classifier">boolean</span></dt><dd><p>Each segment goes through a process of masking to find and
ignore potential lines. Atmospheric features are also ignored.
After this masking, this option will enable to a check to make
sure that &gt;50% of the remaining segment bandwidth is available
for fitting a baseline to. If not, then a warning is issued and
if useDynamicSegments is also set to True, then the segment
size will be increased to include more bandwidth.
NOTE: This only works if useDynamicSegments is also True.
Default: True</p>
</dd>
<dt>nfit<span class="classifier">int</span></dt><dd><p>This is the order of the polynomial that is used to fit the
scaling spectrum in order to flatten or baseline it.
Default: nfit = 5</p>
</dd>
<dt>useDynamicSegments<span class="classifier">boolean</span></dt><dd><p>If set to True, then after fitting the scaling spectrum, check
for issues at the segment boundaries by looking for values
&gt;1.05 in the resultant scaling spectrum that are within 10
channels or 10 MHz (whichever is larger). If any values are
found, then decrease the number of segments by 2 and try again.
This process is repeated until a good solution is found or
only 1 segment remains.
Default: True</p>
</dd>
</dl>
<dl class="simple">
<dt>datacolumn<span class="classifier">string</span></dt><dd><p>Specify the data column of the MS to apply the corrections to.
If this is run post-calibration, then the CORRECTED_DATA column
will exist and will need to be corrected by the scaling
spectrum calculated here. This is preferred as the code will be
able to take advantage of any flagging performed during
calibration (if the excflagged option is set to True).
Alternatively, if this is run pre-calibration, then the DATA
column of the MS can be selected, this however will modify the
raw data directly so it is not recommended.
Default: datacolumn = ‘CORRECTED_DATA’</p>
</dd>
<dt>docorr<span class="classifier">boolean</span></dt><dd><p>DEPRECATED - Now performs the same function as createCalTable.</p>
</dd>
<dt>createCalTable<span class="classifier">boolean</span></dt><dd><p>Specify whether or not to create a calibration table which can
then be applied to the MS via an applycal.
Default: createCalTable=False</p>
</dd>
<dt>fillTable<span class="classifier">boolean</span></dt><dd><p>This is a sub-parameter of createCalTable in that it does nothing
unless createCalTable is set to True. If this option is set to
True then targets, spws, scans, and fields where renorm is not
needed will still be added to the final calibration table. This
also includes TDM spws.
Default: False</p>
</dd>
<dt>docorrThresh<span class="classifier">None or float</span></dt><dd><p>The threshold above which to apply the scaling spectrum to the
data. It has been determined by ALMA that datasets that do not
have any residuals in their scaling spectra above 2% do not
need to be corrected. As such, the default is set to 1.02
across all Bands.
Example: docorrThresh = 1.01
Default: docorrThresh = None   (this results in 1.02 being set)</p>
</dd>
<dt>usePhaseAC<span class="classifier">boolean</span><span class="classifier">EXPERIMENTAL - USE WITH CAUTION</span></dt><dd><p>The bandpass calibrator is used by default to create the
scaling spectrum as it, by definition, should have no spectral
features. However, because it can be very far away in elevation
it can cause significant residuals due to atmospheric effects.
In those cases, it may be useful to use the Phase calibrator
instead as it must be within 3 degrees of the target. Note
however that the phase calibrator is not guaranteed to be free
of line emission or be free of wide-spread emission from the
target itself for cases like Orion where CO is pervasive.
If this option is set to True, then the phase calibrator will
be used to create the scaling spectra instead of the bandpass.
Default: False</p>
</dd>
</dl>
<dl class="simple">
<dt>antHeuristicsSpectra<span class="classifier">boolean</span></dt><dd><p>Create additional heuristics plots per antenna for diagnosing
and fixing bad autocorrelation data as described by the
fixOutliers option.
Default: True</p>
</dd>
<dt>diagSpectra<span class="classifier">boolean</span></dt><dd><p>Create additional diagnostic spectra for each spw, scan, and
field with both X and Y correlations and all antennas on the
same plot along with the median spectra per correlation. These
plots show the actual correction that is applied per antenna.
Defualt: True</p>
</dd>
<dt>fthresh<span class="classifier">float</span></dt><dd><p>This is the threshold above which to show an alarm trigger in
print statements and logs as “<a href="#id3"><span class="problematic" id="id4">**</span></a><a href="#id5"><span class="problematic" id="id6">*</span></a>”. Stands for “fractional
alarm” threshold.
Default: 0.01   (i.e. 1%)</p>
</dd>
</dl>
<dl class="simple">
<dt>verbose<span class="classifier">boolean</span></dt><dd><p>Print additional messages to the terminal that normally only go
into the log file along with some “debug” type statements.
Default: False</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>Varies by the options selected above but at minimum the scaling
spectra are calculated and optionally a cal table is produced.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormcomputeAzElFromRADecMJD">
<span class="sig-name descname"><span class="pre">renormcomputeAzElFromRADecMJD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raDec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mjd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormcomputeAzElFromRADecMJD"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormcomputeAzElFromRADecMJD" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Computes the azimuth and elevation for a specified RA, Dec, and MJD
for ALMA observations using the CASA measures tool.</p>
<p>Adapted from Todd Hunter’s AU tool computeAzElFromRADecMJD.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>raDec<span class="classifier">list or tuple</span></dt><dd><p>Must be in radians: [ra,dec]</p>
</dd>
<dt>mjd<span class="classifier">float</span></dt><dd><p>Must be in days.</p>
</dd>
</dl>
</dd>
<dt>Output:</dt><dd><p>The azimuth and elevation are returned as a list in degrees.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormdirection2radec">
<span class="sig-name descname"><span class="pre">renormdirection2radec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">direction</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormdirection2radec"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormdirection2radec" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><dl class="simple">
<dt>Convert a direction dictionary to a sexadecimal string of format:</dt><dd><p>HH:MM:SS.SSSSS, +DDD:MM:SS.SSSSSS</p>
</dd>
</dl>
<p>Adapted from Todd Hunter’s AU tool direction2radec.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>direction<span class="classifier">dictionary</span></dt><dd><p>This input is what is returned from the msmd tool of a pointing,
i.e. the return of msmdtool().phasecenter.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>The RA, Dec pointing direction as a string in sexadecimal format.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormfindClosestTime">
<span class="sig-name descname"><span class="pre">renormfindClosestTime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mytimes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mytime</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormfindClosestTime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormfindClosestTime" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.renormradec2rad">
<span class="sig-name descname"><span class="pre">renormradec2rad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">radecstring</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.renormradec2rad"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.renormradec2rad" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Convert a sky position from a single RA/Dec sexagesimal string
to RA and Dec in radians.</p>
<p>Adapted from Todd Hunter’s AU tool radec2rad.</p>
</dd>
<dt>Inputs:</dt><dd><dl>
<dt>radecstring: string</dt><dd><p>Any leading ‘J2000’ string is removed before consideration.</p>
<p>The RA and Dec portions can be separated by a comma or a space.</p>
<p>The RA portion of the string must be colon-delimited, space-
delimited, or ‘h/m/s’ delimited.</p>
<p>The Dec portion of the string can be either “:”, “.” or space-
delimited. If it is “.” delimited, then it must have degrees,
minutes, <em>and</em> seconds.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The RA and Dec are retuned as a tuple in radians.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.stats">
<span class="sig-name descname"><span class="pre">stats</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.stats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.stats" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.suggestAtmExclude">
<span class="sig-name descname"><span class="pre">suggestAtmExclude</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_command</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.suggestAtmExclude"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.suggestAtmExclude" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given that renormalization() has been run with the checkFalsePositives=True
flag, the self.atmMask attribute has been filled with information where
there are atmospheric features in the spectrum. This function will merge
the masks from all scans and suggest channel ranges that one may input back
into renormalization() using the excludechan parameter.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>target<span class="classifier">string</span></dt><dd><p>The target source evaluated in renormalization()</p>
</dd>
<dt>spw<span class="classifier">string</span></dt><dd><p>The spectral window you wish to evaluate a mask for assuming that it
was also run in the renormalization() call.</p>
</dd>
<dt>return_command<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then a string is returned with the correct syntax to
put into the excludechan option of a self.renormalization() call.
Default: False</p>
</dd>
<dt>return_dict<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then a dictionary is returned with the correct syntax
to fill the excludechan parameter of the self.renormalize() method.
Default: False
NOTE: This takes priority over return_command if both are set to True.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>A list of list pairs suggesting ranges for input into the excludechan
option of renormalization().</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.writeCalTable">
<span class="sig-name descname"><span class="pre">writeCalTable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iter_n</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.writeCalTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.writeCalTable" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This function takes in a Renormalization Spectrum and writes that
solution to a calibration table. The table is essentially another
Tsys calibration table.</p>
</dd>
<dt>Inputs:</dt><dd><dl>
<dt>spw<span class="classifier">integer</span></dt><dd><p>Spw that relates to the data.</p>
</dd>
<dt>field<span class="classifier">integer</span></dt><dd><p>Field ID number that relates to the data.</p>
</dd>
<dt>scan<span class="classifier">integer</span></dt><dd><p>Scan number that relates to the data.</p>
</dd>
<dt>N<span class="classifier">np.array</span></dt><dd><p>A 3-D numpy array of shape</p>
<p>(number polarization : number channels : number antenna)</p>
<p>that contains the renormalization spectrum to be written to
the calibration table.</p>
</dd>
<dt>iter_n<span class="classifier">integer</span></dt><dd><p>A book-keeping value that keeps track of how many times we
have written to the table to avoid over-writing data.</p>
</dd>
</dl>
</dd>
<dt>Output:</dt><dd><p>None, the calibration table initialized by self.renormalize() is
updated with the contents of input N and all related metadata.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.writeTsysFlags">
<span class="sig-name descname"><span class="pre">writeTsysFlags</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsys_flags</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.writeTsysFlags"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.writeTsysFlags" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given the list from the writeTsysTemps method that makes a list of
flag template compatible strings, this code simply writes a PL
style flag template file at the most detailed level, i.e. spw and
channel per scan triggered.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.writeTsysTemps">
<span class="sig-name descname"><span class="pre">writeTsysTemps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dictIn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rettemplist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.writeTsysTemps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.writeTsysTemps" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Uses the dictionary from the Tsys Plotting code and will return a
list with each element being a line to be entered into the
tsystemplate in PL style</p>
<p>Optionally, an input dictionary in correct syntax can be passed.</p>
<p>Using retflchan=True in the plotRelTsysSpectra() method will save
the dictionary to the argument of the call if you want a manual
view of the dict or to see and edit and input manually into this
flag_lines code.</p>
<p>NOTE: This is to be used with caution as it has not been validated
yet and is mainly for helping with manual DR only!!!</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>dictIn<span class="classifier">dictionary</span><span class="classifier">OPTIONAL</span></dt><dd><p>If desired, a user may input a dictionary of flags. If one is
not input, then the output of self.plotRelTsysSpectra() is used
instead.
Default: None</p>
</dd>
<dt>rettemplist<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then the flags constructed during this script,
in addition to being written to a file via self.writeTsysFlags(),
will be returned as a list of strings.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>A file of Tsys flags is written via the self.writeTsysFlags() method.
Additionally, if rettemplist=True, a list of strings is returned that
contains all the flagging commands.</p>
</dd>
<dt>Suggestions for Improvement:</dt><dd><ul class="simple">
<li><p>Syntax is not currently explicity checked for the dictIn option.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.ACreNorm.xyplots">
<span class="sig-name descname"><span class="pre">xyplots</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#ACreNorm.xyplots"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.ACreNorm.xyplots" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm.alma_renorm">
<span class="sig-name descname"><span class="pre">alma_renorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">create_cal_table</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">None</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludechan</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atm_auto_exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthreshspw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">caltable</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm.html#alma_renorm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm.alma_renorm" title="Link to this definition"></a></dt>
<dd><p>Interface function for ALMA Pipeline: this runs the ALMA renormalization
heuristic for input vis, and returns statistics and metadata required by
the Pipeline renormalization task.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul>
<li><p><strong>vis</strong> – path to the measurement set to renormalize.</p></li>
<li><p><strong>spw</strong> – Spectral Window IDs to process.</p></li>
<li><p><strong>create_cal_table</strong> – save renorm corrections to a calibration table.</p></li>
<li><p><strong>threshold</strong> – the threshold above which the scaling must exceed for the
renormalization correction to be applied. If set to None, then use
a pre-defined threshold appropriate for the ALMA Band.</p></li>
<li><p><strong>excludechan</strong> – dictionary with keys set to SpW IDs (as string), and
values set to channels to exclude for that SpW.</p></li>
<li><p><strong>correct_atm</strong> – this will get the transmission profiles for the SPW
bandpass (or phase) and target(s) because the BP (or phase) and
target(s) autocorr are compared in establishing the scaling in
cases spectra, there can be issues where transmission is low and
the source elevations are tens of degrees different. Often the ATM
is not divided out well and leads to incorrect scaling in ATM
regions. This option acts to fix this discrepancy so ATM are
handled correctly.</p></li>
<li><p><strong>atm_auto_exclude</strong> – if True, then spectral regions found during the
“check for false positives” algorithm will be excluded from the</p>
<blockquote>
<div><p>spectrum.</p>
</div></blockquote>
</li>
<li><p><strong>bwthreshspw</strong> – disctionary with keys set to SpW IDs (as string),
and values set to a bandwidth (in Hz) to use for dividing
up the SpWs, e.g. 120e6</p></li>
<li><p><strong>caltable</strong> – Name of the caltable that renorm will create and write
results to.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Returns: 8-tuple containing:</dt><dd><ul class="simple">
<li><p>boolean declaring whether data are all TDM</p></li>
<li><p>ATM exclusion command</p></li>
<li><p>ATM warning</p></li>
<li><p>boolean declaring whether the renormalization correction was saved
to a calibration table.</p></li>
<li><p>dictionary containing factors for Pipeline QA.</p></li>
<li><p>dictionary containing renormalization statistics indexed by source
and SpW.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pipeline.extern.almarenorm_pl2023">
<span id="pipeline-extern-almarenorm-pl2023-module"></span><h2>pipeline.extern.almarenorm_pl2023 module<a class="headerlink" href="#module-pipeline.extern.almarenorm_pl2023" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ACreNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.ATMcorrection">
<span class="sig-name descname"><span class="pre">ATMcorrection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inscan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inspw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">infld</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calscan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.ATMcorrection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.ATMcorrection" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.ATMtrans">
<span class="sig-name descname"><span class="pre">ATMtrans</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iscan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ispw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ifld</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.ATMtrans"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.ATMtrans" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>This function will return the atmospheric model for the input spectral window
and scan. In the case of a Band 9 or 10 spectral window, the atmospheric model
for the image sideband is also returned.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>iscan<span class="classifier">int</span></dt><dd><p>The user input scan from which to get the atmospheric model. This is used
to find the observation time, elevation, and weather information.</p>
</dd>
<dt>ispw<span class="classifier">int</span></dt><dd><p>The user input spectral window.</p>
</dd>
<dt>ifld<span class="classifier">int</span><span class="classifier">OPTIONAL</span></dt><dd><p>The user input field ID. This is optional but in the case of mosaics, can
make the atmospheric model slightly more accurate.
Default: None</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>Setting to True will output additional information as the atmospheric profile
is calculated.
Default: False</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>numpy.array
(transmission, transmission_SB): numpy.arrays : ONLY FOR BANDS 9 AND 10</p>
<blockquote>
<div><p>This is a 1-D array with the same length as the number of channels of the input
scan/spw. The values of the array consist of the atmospheric transmission by
channel as a fraction between 0.0 and 1.0.</p>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>transmission</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.applyReNorm">
<span class="sig-name descname"><span class="pre">applyReNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rN</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CORRECTED_DATA'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.applyReNorm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.applyReNorm" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.calcChanRanges">
<span class="sig-name descname"><span class="pre">calcChanRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwdiv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'odd'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onlyfdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.calcChanRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.calcChanRanges" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.calcFixReNorm">
<span class="sig-name descname"><span class="pre">calcFixReNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">AntUse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scanin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fldin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doplot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotDivisions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.calcFixReNorm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.calcFixReNorm" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This function takes in a renormalization spectrum and performs a
set of heuristics to check for outliers caused by issues with the
autocorrelations (e.g. birdies). Outlier channels are replaced with
the median spectrum. If many channels are found to be outliers
(greater than 10 consecutive channels or &gt;10% of total spectrum),
then the whole median spectrum of that correlation is used for the
replacement instead.</p>
<p>Note that this operates on the input renormalization spectrum
directly! Therefore the input spectrum will be directly adjusted.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">dictionary</span></dt><dd><p>The renormalization spectrum as created by the renormalize()
method.</p>
</dd>
<dt>AntUse<span class="classifier">list of strings</span></dt><dd><p>This is a list of antennas to investigate for outliers. The
checkOutlierAnt method will return an appropriate list to
be used as input here.</p>
</dd>
<dt>scanin<span class="classifier">string</span></dt><dd><p>The scan number to check.</p>
</dd>
<dt>spwin<span class="classifier">string</span></dt><dd><p>The spw number to check.</p>
</dd>
<dt>fldin<span class="classifier">string</span></dt><dd><p>The field number to check.</p>
</dd>
<dt>doplot<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, produce plots that show original spectrum
and replaced values.
Default: True</p>
</dd>
<dt>plotDivisions<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then include vertical lines of the plots that
show where the spectrum was divided up during the fitting
process of the calcReNorm1 method.
Default: True</p>
</dd>
<dt>hardcopy<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, save a hardcopy of the produced plot to disk.
Default: True</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, produce additional output.
Default: False</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>The input renormalization spectrum, R, is operated on directly.
No additional output is generated.</p>
</dd>
<dt>Notes for Improvement:</dt><dd><p>If AntUse is not defined, could default to running checkOutlierAnt
method by default.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.calcMaxConseq">
<span class="sig-name descname"><span class="pre">calcMaxConseq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">linelist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.calcMaxConseq"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.calcMaxConseq" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.calcReNorm1">
<span class="sig-name descname"><span class="pre">calcReNorm1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkFit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doplot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iden</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.calcReNorm1"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.calcReNorm1" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Perform a simple polynomial fit to the renormalization scaling
spectrum to remove any residual baseline ripples. Used within the
renormalize method to fit a baseline to each segment of the full
spectrum.</p>
<p>Note that this operates directly on the input spectrum!</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">numpy.array</span></dt><dd><p>Scaling spectrum for a specific scan, spw, field and pol.</p>
</dd>
<dt>doplot<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, produce a plot showing the polynomial fits
that have been applied to the data.</p>
</dd>
<dt>iden<span class="classifier">str</span><span class="classifier">OPTIONAL</span></dt><dd><p>An optional identifier to append to image names to make them
unique, otherwise they will get written over.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>None directly, but note that the input scaling spectrum will be
adjusted directly.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.calcRenormLegendre">
<span class="sig-name descname"><span class="pre">calcRenormLegendre</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nseg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.calcRenormLegendre"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.calcRenormLegendre" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Perform a fit to the renormalization spectrum to flatten the
profile and make it so that outside of spectral features the
data is unchanged (i.e. multiplied by 1.0). Here, Legendre
polynomials are used for the fitting process.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">numpy.array</span></dt><dd><p>This is the segment of renormalization spectrum you wish to
perform a fit on.</p>
</dd>
<dt>nseg<span class="classifier">integer</span></dt><dd><p>This is the number of segments that calcChannelRanges()
suggested. This function will decide on the order of the fit
based on the number of segments and the self.nfit parameter
as self.nfit*nseg.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.calcSetEdge">
<span class="sig-name descname"><span class="pre">calcSetEdge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.calcSetEdge"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.calcSetEdge" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.chanfreqs">
<span class="sig-name descname"><span class="pre">chanfreqs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ispw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.chanfreqs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.chanfreqs" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.channel_ranges">
<span class="sig-name descname"><span class="pre">channel_ranges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TDM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.channel_ranges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.channel_ranges" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given a list of channels, this will return a list of ranges that
describe them accounting for a buffer and gap in input that can be assumed
as consecutive.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.checkApply">
<span class="sig-name descname"><span class="pre">checkApply</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.checkApply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.checkApply" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.checkOutlierAnt">
<span class="sig-name descname"><span class="pre">checkOutlierAnt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.checkOutlierAnt"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.checkOutlierAnt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Perform a check of each antenna in a renormalization spectrum
dictionary and return a list of possibly problematic antenna
that may need flagging due to outlier data (e.g. from birdies).</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">dictionary</span></dt><dd><dl class="simple">
<dt>The renormalization spectrum as created by the renormalize()</dt><dd><p>method.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>AntChk<span class="classifier">list of strings</span></dt><dd><p>A list of antennas that may contain problematic data which
can be used as input for the calcFixReNorm method.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.close"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.close" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.convertPlotsToPDF">
<span class="sig-name descname"><span class="pre">convertPlotsToPDF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_summary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_heuristics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.convertPlotsToPDF"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.convertPlotsToPDF" title="Link to this definition"></a></dt>
<dd><p>Super hacky way to create PDFs of created plots so that we can display them in the weblog.
Simply calls the bash commands “montage” (to create super plots of pngs), “convert” (to
then convert those super plots into pdfs), and “pdfunite” (to combine all pdfs into one).</p>
<dl class="simple">
<dt>Imports:</dt><dd><dl class="simple">
<dt>target<span class="classifier">string</span></dt><dd><p>Name of the target field that matches the filename target</p>
</dd>
<dt>spw<span class="classifier">str (or int, the type is forced)</span></dt><dd><p>The spectral window of the files that need to be converted to a PDF.</p>
</dd>
<dt>include_summary<span class="classifier">boolean (OPTIONAL)</span></dt><dd><p>If set to True, the summary plot averaging over all scans/fields will be included.
Default: True</p>
</dd>
<dt>include_heuristics<span class="classifier">boolean (OPTIONAL)</span></dt><dd><p>If set to True, the per antenna heuristics plots will be included in the PDFs.
Default: False</p>
</dd>
</dl>
</dd>
<dt>Output:</dt><dd><p>The target/spw matched plots are montaged and transformed into a PDF and placed into the
./RN_plots directory. The name of the PDF is put into the self.rnpipestats dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.findNearest">
<span class="sig-name descname"><span class="pre">findNearest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.findNearest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.findNearest" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given an array and a value that falls within that array, find
the nearest value or index within the array to that value.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>array<span class="classifier">list of floats or ints</span></dt><dd><p>An array for which to evaluate.</p>
</dd>
<dt>value<span class="classifier">float or int</span></dt><dd><p>The value you wish to find the closest match to within
the array.</p>
</dd>
<dt>index<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If True, return the index location within array that is
closest to the value. Otherwise, return the value of that
index.
Default: False</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.fitAtmLines">
<span class="sig-name descname"><span class="pre">fitAtmLines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ATMprof</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.fitAtmLines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.fitAtmLines" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given an atmospheric profile, find the features caused by water/ozone/etc
and fit a Lorentizian profile to it, returning the center and gamma scale.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>ATMprof<span class="classifier">numpy.ndarray</span></dt><dd><p>An atmospheric profile as returned by ATMtrans()</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If True, then information about the fit will be printed to the terminal.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>centers<span class="classifier">list of floats</span></dt><dd><p>The center channel of found features.</p>
</dd>
<dt>scales<span class="classifier">list of floats</span></dt><dd><p>The gamma scale factor of found features.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This utilizes the scipy package, specifically scipy.signal.find_peaks and
scipy.optimize.curve_fit.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getACdata">
<span class="sig-name descname"><span class="pre">getACdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rowave</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stateid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getACdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getACdata" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getBscan">
<span class="sig-name descname"><span class="pre">getBscan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getBscan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getBscan" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getBtsysscan">
<span class="sig-name descname"><span class="pre">getBtsysscan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getBtsysscan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getBtsysscan" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getImageSBFreqs">
<span class="sig-name descname"><span class="pre">getImageSBFreqs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spwin</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getImageSBFreqs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getImageSBFreqs" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given the spectral window, find the LO frequency and return the frequencies of
the image sideband. Specifically, return the inputs needed for ATMtrans() in
order to properly show the atmospheric transmission for bands 9 and 10 where the
image sideband atomospheric window also contributes to the spectral window.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>spwin<span class="classifier">int</span></dt><dd><p>The spectral window for which the image sideband frequencies are needed.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>fSB<span class="classifier">numpy.array</span></dt><dd><p>The frequencies of the image sideband. These will be properly arranged
(i.e. they will be opposite in direction to the input spectral window
frequencies).</p>
</dd>
<dt>chansepSB<span class="classifier">float</span></dt><dd><p>The separation between channels (channel width).</p>
</dd>
<dt>fCenterSB<span class="classifier">float</span></dt><dd><p>The mean frequency (center) of the image sideband.</p>
</dd>
<dt>fWidthSB<span class="classifier">float</span></dt><dd><p>The total bandwidth of the image sideband (will be equal to the input
spectral window).</p>
</dd>
</dl>
</dd>
<dt>Note: This has been taken from Todd Hunter’s AU tools, specifically au.interpretLOs,</dt><dd><p>au.getLOs, and plotbandpass3.py - CalcAtmTranmission.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getPhscan">
<span class="sig-name descname"><span class="pre">getPhscan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getPhscan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getPhscan" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getStateIdsForIntent">
<span class="sig-name descname"><span class="pre">getStateIdsForIntent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">intent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getStateIdsForIntent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getStateIdsForIntent" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getTsysSpectra">
<span class="sig-name descname"><span class="pre">getTsysSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getTsysSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getTsysSpectra" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getXCdata">
<span class="sig-name descname"><span class="pre">getXCdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CORRECTED_DATA'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getXCdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getXCdata" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getXCflags">
<span class="sig-name descname"><span class="pre">getXCflags</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'FLAG'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getXCflags"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getXCflags" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.getband">
<span class="sig-name descname"><span class="pre">getband</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freq</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.getband"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.getband" title="Link to this definition"></a></dt>
<dd><p>Identify the Band for specific frequency (in GHz)</p>
<p>Note that the Band 2/3 identification is currently not
guaranteed to be correct.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.interpretExcludechan">
<span class="sig-name descname"><span class="pre">interpretExcludechan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ranges</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.interpretExcludechan"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.interpretExcludechan" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Pupose:</dt><dd><p>As an option to the self.renormalize() method, a user may input
channel ranges to be excluded from the analysis via the excludechan
option. Additionally, if the atmAutoExclude option is enabled the
renormalize method will attempt to fix any atmospheric features
that it thinks to be problematic. Those channel ranges, either
input or generated, are added to a dictionary and then need to be
interpreted correctly for both the exclusion and later plotting.</p>
</dd>
<dt>Inputs:</dt><dd><dl>
<dt>ranges<span class="classifier">list</span></dt><dd><p>This is a list of the different ranges within a single spectral
window that need to be excluded. The expected format is:</p>
<p>[“low_channel~high_channel”; “low_channel~high_channel”; …]</p>
</dd>
<dt>spw<span class="classifier">integer</span></dt><dd><p>This is the spectral window number. This is only needed if the
inputs of ranges are in frequency but must always be given.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><dl class="simple">
<dt>starts<span class="classifier">list</span></dt><dd><p>A list containing the starting channels for each range to be
excluded.</p>
</dd>
<dt>ends<span class="classifier">list</span></dt><dd><p>A list containing the ending channels for each range to be
excluded.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.merge_dicts">
<span class="sig-name descname"><span class="pre">merge_dicts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dict2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.merge_dicts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.merge_dicts" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given two dictionaries, merge them together such that common
keys do not get overwritten. The main purpose is for merging
user input excludechan ranges with ATM excludechan ranges.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>dict1, dict2<span class="classifier">dictionaries</span></dt><dd><p>The two dictionaries to merge together.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>The merged dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.normChanAxis">
<span class="sig-name descname"><span class="pre">normChanAxis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.normChanAxis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.normChanAxis" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.onlineBinningFactor">
<span class="sig-name descname"><span class="pre">onlineBinningFactor</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.onlineBinningFactor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.onlineBinningFactor" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Return the online channel binning factor for the relevant spectral
windows. Note that for early data (&lt;Cycle 3) this will return the
wrong values (i.e. it always returns 1).</p>
<p>This is only used in the Hanning smoothing application of ATM
corrections which is currently not implemented.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.plotRelTsysSpectra">
<span class="sig-name descname"><span class="pre">plotRelTsysSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normByB</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">64000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwdiv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retflchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.plotRelTsysSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.plotRelTsysSpectra" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.plotScanStats">
<span class="sig-name descname"><span class="pre">plotScanStats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.plotScanStats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.plotScanStats" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.plotSpectra">
<span class="sig-name descname"><span class="pre">plotSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">titlein</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotDivisions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">createpdf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">includeSummary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotOriginal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shadeAtm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">showExcluded</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.plotSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.plotSpectra" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This function makes a summary plot of the renormalization spectrum
for every spectral window that has been evaluated for a
renormalization correction. The plots are a cumulative average over
all scans and fields for each antenna and correlation. For sources
that have multiple fields per scan (mosaics), only those fields
that exceed the threshold are shown in the plot. This also means
that even single pointings that oscillate around the threshold will
have only those scans that exceed the threshold included in the
summary plot created. Additionally, any antenna that were fully
flagged during calibration will have their renormalization values
set to 1.0.</p>
<p>Note that renormalization() must be run before this can be run.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>plotATM<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to include the ATM transmission curves
in the plots. The bandpass is used as the representative ATM
transmission curve. Note that in Bands 9 and 10, the image
sideband transmission curve is also shown as a black line.
Default: True</p>
</dd>
<dt>titlein: string: OPTIONAL</dt><dd><p>This allows one to introduce their own title text.
Default: None</p>
</dd>
<dt>plotDivisions: boolean: OPTIONAL</dt><dd><p>This is a boolean switch to include vertical lines at all
locations where the spectral window was broken up during the
calcReNorm() stage when the spectral window renormalization
spectrum was fit to flatten the spectrum.
Default: True</p>
</dd>
<dt>hardcopy<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to create a hardcopy of the plot as a
PNG file. If this is set to False, the plots will be shown
interactively but not saved.
Default: True</p>
</dd>
<dt>createpdf<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to create a PDF of the summary plot
using the convertPlotsToPDF() method. This will only trigger
if hardcopy is also set to True.
Default: True</p>
</dd>
<dt>includeSummary<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to include the summary plot in the
created PDF. As such, this is only evaluated if both hardcopy
and createpdf are set to True.
Default: True</p>
</dd>
<dt>plotOriginal<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This is a boolean switch to overplot the original data before
any ATM correction was performed.
Default: True</p>
</dd>
<dt>shadeAtm<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, this will shade the region of the spectrum
influenced by atmospheric features. Features are found and
fitted if plotATM=True, otherwise this option has no effect.
Default: True</p>
</dd>
<dt>showExcluded<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then areas of the spectrum that have been
excluded via the excludechan option in renormalize() will
be shown.
Default: True</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.plotSpwStats">
<span class="sig-name descname"><span class="pre">plotSpwStats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.plotSpwStats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.plotSpwStats" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.plotSpws">
<span class="sig-name descname"><span class="pre">plotSpws</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hardcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.plotSpws"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.plotSpws" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.plotdiagSpectra">
<span class="sig-name descname"><span class="pre">plotdiagSpectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scanin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fldin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotDivisions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_atm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shadeAtm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">showExcluded</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.plotdiagSpectra"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.plotdiagSpectra" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>This creates diagnotic spectra at the per field per spectral window level for each scan.
Each antenna and correlation are plotted for each field.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>R<span class="classifier">numpy.array</span></dt><dd><p>This is the renormalization spectrum that you wish to plot. Requires data in the form
of a numpy array in the shape [correlation, channel, antenna] such that [0,:,0] would
be the 0-th correlation (XX), all channels, for the 0-th antenna (e.g. DA45) and would
be the found renormalization spectrum.</p>
</dd>
<dt>scanin<span class="classifier">int</span></dt><dd><p>This is the scan number which corresponds to the renormalization spectrum supplied.</p>
</dd>
<dt>spwin<span class="classifier">int</span></dt><dd><p>This is the spectral window number which corresponds to the renormalization spectrum
supplied.</p>
</dd>
<dt>fldin<span class="classifier">int</span></dt><dd><p>This is the field number which corresponds to the normalization spectrum supplied.</p>
</dd>
<dt>plotATM<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This option will plot (or not) the atmospheric transmission profile for the input
spectrum.
Default: True</p>
</dd>
<dt>plotDivisions<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>This option will plot (or not) the division lines as vertical, grey, dotted lines
at all the locations where the renormalization spectrum was broken up during the
fitting stage.
Default: True</p>
</dd>
<dt>threshLine<span class="classifier">float or None</span><span class="classifier">OPTIONAL</span></dt><dd><p>This option allows the user to draw a line of the plot to represent the threshold
level.
Default: None</p>
</dd>
<dt>N_atm<span class="classifier">numpy.array OR None</span><span class="classifier">OPTIONAL</span></dt><dd><p>Similar to R above, this is the renormalization spectrum that you want to plot except
this should be the renormalization spectrum that has not had any atmospheric corrections
applited to it. If provided, then this “original” data will be plotted showing the
differences between this and the renormalization spectrum that will be applied.
Default: None</p>
</dd>
<dt>shadeAtm<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, this will find atmospheric features, fit them with a Lorentzian
profile and shade the regions of the spectrum influenced by the feature.
Default: True</p>
</dd>
<dt>showExcluded<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then areas of the spectrum that have been excluded via the
excludechan option in renormalize() will be shown.
Default: True</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.putXCdata">
<span class="sig-name descname"><span class="pre">putXCdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CORRECTED_DATA'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.putXCdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.putXCdata" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.recordApply">
<span class="sig-name descname"><span class="pre">recordApply</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scanout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fldout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.recordApply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.recordApply" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This will write to the history of the dataset upon application of
renorm (i.e. self.renormalize(docorr=True)). Within the
renormalize() method, a check of the MS HISTORY table is performed
to ensure that double application is avoided.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>scanout, spwout, fldout<span class="classifier">int</span><span class="classifier">OPTIONAL</span></dt><dd><p>The scan, spw, and field numbers where renormalization was
applied. If set to None then a generic message is filled.</p>
</dd>
</dl>
<p>Default: None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormMedianPWV">
<span class="sig-name descname"><span class="pre">renormMedianPWV</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">myTimes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">99999999999]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormMedianPWV"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormMedianPWV" title="Link to this definition"></a></dt>
<dd><p>Extracts the PWV measurements from the WVR on all antennas all times.
First, it tries to find the ASDM_CALWVR
table in the ms.  If that fails, it then tries to find the
ASDM_CALATMOSPHERE table in the ms.
Returns:
The median PWV
For further help and examples, see <a class="reference external" href="https://safe.nrao.edu/wiki/bin/view/ALMA/GetMedianPWV">https://safe.nrao.edu/wiki/bin/view/ALMA/GetMedianPWV</a>
– Todd Hunter - aU version
– Luke Maud - copied and stripped down for almarenorm to make independent of
the analysis utilities</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormPWVFromASDM_CALATMOSPHERE">
<span class="sig-name descname"><span class="pre">renormPWVFromASDM_CALATMOSPHERE</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormPWVFromASDM_CALATMOSPHERE"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormPWVFromASDM_CALATMOSPHERE" title="Link to this definition"></a></dt>
<dd><p>Reads the PWV via the water column of the ASDM_CALATMOSPHERE table in MS.
- Todd Hunter - aU version
- Luke Maud copied and edited for almarenorm so independent of analysisUtils</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormWeather">
<span class="sig-name descname"><span class="pre">renormWeather</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormWeather"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormWeather" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Returns the weather conditions and time stamps of a given scan.
This is heavily adapted from Todd Hunter’s analysisUtils code,
au.getWeather() function.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>scan<span class="classifier">integer</span></dt><dd><p>The scan number.</p>
</dd>
<dt>verbose<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to true, some additional output is printed to screen.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>[conditions, myTimes]</dt><dd><dl class="simple">
<dt>conditions<span class="classifier">dictionary</span></dt><dd><p>Includes the average temperature (Celcius), humidity (%),
and Pressure (mB) for the given scan.</p>
</dd>
<dt>myTimes<span class="classifier">numpy.array</span></dt><dd><p>List of times during the given scan.</p>
</dd>
</dl>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormWeatherStationNames">
<span class="sig-name descname"><span class="pre">renormWeatherStationNames</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormWeatherStationNames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormWeatherStationNames" title="Link to this definition"></a></dt>
<dd><p>Returns a dictionary keyed by ALMA weather station ID, with the value
equal to the station name (e.g. ‘WSTBn’).
vis: single measurement set
-Todd Hunter - aU version
-Luke Maud copied and modified/stripped down
from analysisUtils to make almarenorm.py independent</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormalize">
<span class="sig-name descname"><span class="pre">renormalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludespws</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targscans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludeants</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludechan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excflagged</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixOutliers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mededge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atmAutoExclude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkFalsePositives</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correctATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.85</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotATM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwdiv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'odd'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthreshspw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkLineForest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nfit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useDynamicSegments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datacolumn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CORRECTED_DATA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">docorr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">docorrThresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usePhaseAC</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">antHeuristicsSpectra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diagSpectra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fthresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormalize" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>This is the main function of the ACreNorm class. It takes the
autocorrelations and evaluates them to see if a rescaling of the
crosscorrelation data is necessary. It does this by looping over
the science targets on a per spw, per scan, per field, per antenna,
per correlation basis. It takes the autocorrelations of the target
and divides them by a calibrator’s autocorrelations (by default the
bandpass) and any peaks above 2% in the resultant spectrum are
caused by actual detections of the science target and therefore
need to be corrected in the crosscorrelation data.</p>
</dd>
<dt>Inputs:</dt><dd><p>This function has many options for evaluating the autocorrelations
and applying solutions if necessary but no inputs are necessary
for operation. Some options are highly experimental and not
recommended for blind usage, they have been noted below.</p>
<dl>
<dt>excludespws<span class="classifier">list of integers</span></dt><dd><blockquote>
<div><p>If not empty, any spw specified will be removed from analysis
if that spw is one of the science spws.
Example: excludespws = [21]
Default: excludespws = []</p>
</div></blockquote>
<dl class="simple">
<dt>spws<span class="classifier">list of integers</span></dt><dd><p>If not empty, only perform renormalization on the spws that
are specified. Note that these must be science spws or they
will be ignored.
Example: spws = [21,23]
Default: spws = []</p>
</dd>
</dl>
</dd>
<dt>targscans<span class="classifier">list of integers</span></dt><dd><p>If not empty, only perform renormalization on the target scans
that are specified. Note that these scans must contain science
data or they will be ignored.
Example: targscans = [18,21,24,27]
Default: targscans = []</p>
</dd>
</dl>
<dl>
<dt>excludeants<span class="classifier">list of integers</span></dt><dd><p>Specified antennas will be ignored in all analysis and
application. This is intended to be used if any antenna are
problematic in the interferometric data or need manually
flagging. This is normally done via the excflagged option but
if the data were just imported then flags are not available
and this can be used instead. Excluded antennas have their
scaling spectra set to 1.0.
Example: excludeants = [10,32]
Default: excludeants = []</p>
</dd>
<dt>excludechan<span class="classifier">dictionary</span></dt><dd><p>If problematic data is found across a series of channels (often
from atmospheric features) then the spw and channel ranges can
be specified in either channel or frequency space (TOPO, GHz).
Excluded channels have their scaling spectra set to 1.0.
Example: excludechan={‘22’:’100~150;800~850’, ‘24’:’100~200’}</p>
<blockquote>
<div><p>excludechan={‘22’:’230.1GHz~230.2GHz’}</p>
</div></blockquote>
<p>Default: excludechan={}</p>
</dd>
<dt>excflagged<span class="classifier">boolean</span></dt><dd><p>Excluded flagged antenna by reading the crosscorrelation flag
tables per spw, per scan, and per field. Antennas are excluded
if fully flagged. Only useful after the data are fully
calibrated. Fully flagged antenna will have thier scaling
spectra set to 1.0.
Default: excflagged = True</p>
</dd>
<dt>fixOutliers<span class="classifier">boolean</span></dt><dd><p>Check antennas individually per scan, field, and correlation
for outlier data compared to the median spectrum across all
antennas for that correlation on a channel-by-channel basis.
Outlier data is set to the median spectrum value of the
corresponding correlation.
Default: fixOutliers = True</p>
</dd>
<dt>mededge<span class="classifier">float</span></dt><dd><p>Percentage of edge channels to set to the median spectrum
value to prevent edge effects from influencing results.
Default: mededge = 0.01     (i.e. 1%)</p>
</dd>
</dl>
<dl class="simple">
<dt>atmAutoExclude<span class="classifier">boolean</span></dt><dd><p>This option works in conjunction with the checkFalsePositives
option to identify problematic sections of the spectrum where
the atmosphere may be causing issues. If set to True, this will
automatically exclude those sections of the spectrum where
there are atmospheric features using the same method as the
excludechan option.
Default: atmAutoExclude = True</p>
</dd>
<dt>checkFalsePositives<span class="classifier">boolean</span></dt><dd><p>This will automatically find atmospheric lines in the spectrum
and check those regions to see if there is a renorm signal
above the threshold. If there is, it is assumed to be a “false
positive” signal caused by the ATM feature and will trigger a
warning as well as a suggested region to exclude from analysis.
Default: checkFalsePositives = True</p>
</dd>
<dt>correctATM<span class="classifier">boolean</span><span class="classifier">EXPERIMENTAL - NOT RECOMMENDED</span></dt><dd><p>This will get the transmission profiles for the bandpass (or
phase) and target(s) and create a ratio of those profiles and
apply it to the scaling spectrum. Becuase the bandpass (or
phase) and target(s) autocorrelations are compared in
establishing the scaling spectra, there can be issues where
transmission is low and/or the source elevations are different
by a significant amount resulting in very different atmospheric
effects. This option acts to fix this discrpancy so that
atmospheric features are handled correction.
NOTE: Although a good idea, in practice it appears to have
little effect and sometimes does more harm.
Default: correctATM = False</p>
</dd>
<dt>limATM<span class="classifier">float</span></dt><dd><p>Set the transmission limit for atmospheric features so that
only when features are below the set limit are they mitigated.
This helps with computation time as there are diminishing
returns on dealing with minor atmospheric features.
Default: limATM = 0.85</p>
</dd>
<dt>plotATM<span class="classifier">boolean</span></dt><dd><p>If set to True, plot the atmospheric transmission curve on a
secondary y-axis.
Default: plotATM = True</p>
</dd>
</dl>
<dl>
<dt>bwdiv<span class="classifier">None, ‘odd’, int</span></dt><dd><p>If a spw needs to be broken up into chunks (see bwthresh), this
option determines the behavior of the division process. The
input here will be applied to all spws. There are three input
options available:</p>
<blockquote>
<div><ol class="arabic simple">
<li><dl class="simple">
<dt>None - This will use powers of 2 based on taking the</dt><dd><p>full spw bandwidth and dividing by bwthresh option.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>‘odd’ - This follows the process of (1) but attempts to</dt><dd><p>force an odd number of segments of equal size.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>int - This will divide the spw bandwidth by the input</dt><dd><p>integer to create segments of equal size.</p>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
<p>NOTE: For options (2) and (3) there is a possiblity that the
total number of channels does not evenly divide into an
integer number of channels. For example, 2048 channels divided
by 3 segments is 682 channels per segment with a remainder of 2
channels. In these cases, the mededge option is considered as
this will flag a number of edge channels anyway. If the number
of channels in the remainder is smaller than the flagged region
then the solution is kept, otherwise the solution defaults to
option (1).</p>
<p>NOTE: The total number of segments is capped at 7 which will
override any input here.</p>
<dl class="simple">
<dt>Examples: bwdiv = None</dt><dd><p>bwdiv = ‘odd’
bwdiv = 4</p>
</dd>
</dl>
<p>Default: bwdiv = ‘odd’</p>
</dd>
<dt>bwthresh<span class="classifier">float</span></dt><dd><p>The maximum bandwidth (in Hz) to fit a baseline to, beyond this
limit the spw will be broken into chunks to fit separately.
NOTE: The maximum number of segments is capped at 7. This will
override this setting for wide spws.
Default: bwthresh = 120e6</p>
</dd>
<dt>bwthreshspw<span class="classifier">dictionary</span></dt><dd><p>This allows the user to input specific settings of the bwthresh
option on a per spw basis, spws not specifed here will default
to the bwthresh option setting.
Example: bwthreshspw = {‘22’:’250e6’, ‘24’:’500e6’}
Default: {}</p>
</dd>
<dt>checkLineForest<span class="classifier">boolean</span></dt><dd><p>Each segment goes through a process of masking to find and
ignore potential lines. Atmospheric features are also ignored.
After this masking, this option will enable to a check to make
sure that &gt;50% of the remaining segment bandwidth is available
for fitting a baseline to. If not, then a warning is issued and
if useDynamicSegments is also set to True, then the segment
size will be increased to include more bandwidth.
NOTE: This only works if useDynamicSegments is also True.
Default: True</p>
</dd>
<dt>nfit<span class="classifier">int</span></dt><dd><p>This is the order of the polynomial that is used to fit the
scaling spectrum in order to flatten or baseline it.
Default: nfit = 5</p>
</dd>
<dt>useDynamicSegments<span class="classifier">boolean</span></dt><dd><p>If set to True, then after fitting the scaling spectrum, check
for issues at the segment boundaries by looking for values
&gt;1.05 in the resultant scaling spectrum that are within 10
channels or 10 MHz (whichever is larger). If any values are
found, then decrease the number of segments by 2 and try again.
This process is repeated until a good solution is found or
only 1 segment remains.
Default: True</p>
</dd>
</dl>
<dl class="simple">
<dt>datacolumn<span class="classifier">string</span></dt><dd><p>Specify the data column of the MS to apply the corrections to.
If this is run post-calibration, then the CORRECTED_DATA column
will exist and will need to be corrected by the scaling
spectrum calculated here. This is preferred as the code will be
able to take advantage of any flagging performed during
calibration (if the excflagged option is set to True).
Alternatively, if this is run pre-calibration, then the DATA
column of the MS can be selected, this however will modify the
raw data directly so it is not recommended.
Default: datacolumn = ‘CORRECTED_DATA’</p>
</dd>
<dt>docorr<span class="classifier">boolean</span></dt><dd><p>Specify whether or not to apply the calculated scaling spectrum
to the MS. If a correction is applied, a history note is
written into the MS indicating application, this is checked for
before application to prevent double application.
Default: docorr=False</p>
</dd>
<dt>docorrThresh<span class="classifier">None or float</span></dt><dd><p>The threshold above which to apply the scaling spectrum to the
data. It has been determined by ALMA that datasets that do not
have any residuals in their scaling spectra above 2% do not
need to be corrected. As such, the default is set to 1.02
across all Bands.
Example: docorrThresh = 1.01
Default: docorrThresh = None   (this results in 1.02 being set)</p>
</dd>
<dt>usePhaseAC<span class="classifier">boolean</span><span class="classifier">EXPERIMENTAL - USE WITH CAUTION</span></dt><dd><p>The bandpass calibrator is used by default to create the
scaling spectrum as it, by definition, should have no spectral
features. However, because it can be very far away in elevation
it can cause significant residuals due to atmospheric effects.
In those cases, it may be useful to use the Phase calibrator
instead as it must be within 3 degrees of the target. Note
however that the phase calibrator is not guaranteed to be free
of line emission or be free of wide-spread emission from the
target itself for cases like Orion where CO is pervasive.
If this option is set to True, then the phase calibrator will
be used to create the scaling spectra instead of the bandpass.
Default: False</p>
</dd>
</dl>
<dl class="simple">
<dt>antHeuristicsSpectra<span class="classifier">boolean</span></dt><dd><p>Create additional heuristics plots per antenna for diagnosing
and fixing bad autocorrelation data as described by the
fixOutliers option.
Default: True</p>
</dd>
<dt>diagSpectra<span class="classifier">boolean</span></dt><dd><p>Create additional diagnostic spectra for each spw, scan, and
field with both X and Y correlations and all antennas on the
same plot along with the median spectra per correlation. These
plots show the actual correction that is applied per antenna.
Defualt: True</p>
</dd>
<dt>fthresh<span class="classifier">float</span></dt><dd><p>This is the threshold above which to show an alarm trigger in
print statements and logs as “<a href="#id7"><span class="problematic" id="id8">**</span></a><a href="#id9"><span class="problematic" id="id10">*</span></a>”. Stands for “fractional
alarm” threshold.
Default: 0.01   (i.e. 1%)</p>
</dd>
</dl>
<dl class="simple">
<dt>verbose<span class="classifier">boolean</span></dt><dd><p>Print additional messages to the terminal that normally only go
into the log file along with some “debug” type statements.
Default: False</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>Varies by the options selected above but at minimum the scaling
spectra are calculated and optionally applied directly to the data.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormcomputeAzElFromRADecMJD">
<span class="sig-name descname"><span class="pre">renormcomputeAzElFromRADecMJD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raDec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mjd</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormcomputeAzElFromRADecMJD"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormcomputeAzElFromRADecMJD" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Computes the azimuth and elevation for a specified RA, Dec, and MJD
for ALMA observations using the CASA measures tool.</p>
<p>Adapted from Todd Hunter’s AU tool computeAzElFromRADecMJD.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>raDec<span class="classifier">list or tuple</span></dt><dd><p>Must be in radians: [ra,dec]</p>
</dd>
<dt>mjd<span class="classifier">float</span></dt><dd><p>Must be in days.</p>
</dd>
</dl>
</dd>
<dt>Output:</dt><dd><p>The azimuth and elevation are returned as a list in degrees.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormdirection2radec">
<span class="sig-name descname"><span class="pre">renormdirection2radec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">direction</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormdirection2radec"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormdirection2radec" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><dl class="simple">
<dt>Convert a direction dictionary to a sexadecimal string of format:</dt><dd><p>HH:MM:SS.SSSSS, +DDD:MM:SS.SSSSSS</p>
</dd>
</dl>
<p>Adapted from Todd Hunter’s AU tool direction2radec.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>direction<span class="classifier">dictionary</span></dt><dd><p>This input is what is returned from the msmd tool of a pointing,
i.e. the return of msmdtool().phasecenter.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>The RA, Dec pointing direction as a string in sexadecimal format.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormfindClosestTime">
<span class="sig-name descname"><span class="pre">renormfindClosestTime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mytimes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mytime</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormfindClosestTime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormfindClosestTime" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.renormradec2rad">
<span class="sig-name descname"><span class="pre">renormradec2rad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">radecstring</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.renormradec2rad"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.renormradec2rad" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Convert a sky position from a single RA/Dec sexagesimal string
to RA and Dec in radians.</p>
<p>Adapted from Todd Hunter’s AU tool radec2rad.</p>
</dd>
<dt>Inputs:</dt><dd><dl>
<dt>radecstring: string</dt><dd><p>Any leading ‘J2000’ string is removed before consideration.</p>
<p>The RA and Dec portions can be separated by a comma or a space.</p>
<p>The RA portion of the string must be colon-delimited, space-
delimited, or ‘h/m/s’ delimited.</p>
<p>The Dec portion of the string can be either “:”, “.” or space-
delimited. If it is “.” delimited, then it must have degrees,
minutes, <em>and</em> seconds.</p>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The RA and Dec are retuned as a tuple in radians.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.stats">
<span class="sig-name descname"><span class="pre">stats</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.stats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.stats" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.suggestAtmExclude">
<span class="sig-name descname"><span class="pre">suggestAtmExclude</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_command</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.suggestAtmExclude"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.suggestAtmExclude" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given that renormalization() has been run with the checkFalsePositives=True
flag, the self.atmMask attribute has been filled with information where
there are atmospheric features in the spectrum. This function will merge
the masks from all scans and suggest channel ranges that one may input back
into renormalization() using the excludechan parameter.</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>target<span class="classifier">string</span></dt><dd><p>The target source evaluated in renormalization()</p>
</dd>
<dt>spw<span class="classifier">string</span></dt><dd><p>The spectral window you wish to evaluate a mask for assuming that it
was also run in the renormalization() call.</p>
</dd>
<dt>return_command<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then a string is returned with the correct syntax to
put into the excludechan option of a self.renormalization() call.
Default: False</p>
</dd>
<dt>return_dict<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then a dictionary is returned with the correct syntax
to fill the excludechan parameter of the self.renormalize() method.
Default: False
NOTE: This takes priority over return_command if both are set to True.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>A list of list pairs suggesting ranges for input into the excludechan
option of renormalization().</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.writeTsysFlags">
<span class="sig-name descname"><span class="pre">writeTsysFlags</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsys_flags</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.writeTsysFlags"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.writeTsysFlags" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Purpose:</dt><dd><p>Given the list from the writeTsysTemps method that makes a list of
flag template compatible strings, this code simply writes a PL
style flag template file at the most detailed level, i.e. spw and
channel per scan triggered.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.writeTsysTemps">
<span class="sig-name descname"><span class="pre">writeTsysTemps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dictIn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rettemplist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.writeTsysTemps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.writeTsysTemps" title="Link to this definition"></a></dt>
<dd><dl>
<dt>Purpose:</dt><dd><p>Uses the dictionary from the Tsys Plotting code and will return a
list with each element being a line to be entered into the
tsystemplate in PL style</p>
<p>Optionally, an input dictionary in correct syntax can be passed.</p>
<p>Using retflchan=True in the plotRelTsysSpectra() method will save
the dictionary to the argument of the call if you want a manual
view of the dict or to see and edit and input manually into this
flag_lines code.</p>
<p>NOTE: This is to be used with caution as it has not been validated
yet and is mainly for helping with manual DR only!!!</p>
</dd>
<dt>Inputs:</dt><dd><dl class="simple">
<dt>dictIn<span class="classifier">dictionary</span><span class="classifier">OPTIONAL</span></dt><dd><p>If desired, a user may input a dictionary of flags. If one is
not input, then the output of self.plotRelTsysSpectra() is used
instead.
Default: None</p>
</dd>
<dt>rettemplist<span class="classifier">boolean</span><span class="classifier">OPTIONAL</span></dt><dd><p>If set to True, then the flags constructed during this script,
in addition to being written to a file via self.writeTsysFlags(),
will be returned as a list of strings.</p>
</dd>
</dl>
</dd>
<dt>Outputs:</dt><dd><p>A file of Tsys flags is written via the self.writeTsysFlags() method.
Additionally, if rettemplist=True, a list of strings is returned that
contains all the flagging commands.</p>
</dd>
<dt>Suggestions for Improvement:</dt><dd><ul class="simple">
<li><p>Syntax is not currently explicity checked for the dictIn option.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.ACreNorm.xyplots">
<span class="sig-name descname"><span class="pre">xyplots</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">N</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#ACreNorm.xyplots"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.ACreNorm.xyplots" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.almarenorm_pl2023.alma_renorm">
<span class="sig-name descname"><span class="pre">alma_renorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">None</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excludechan</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correct_atm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atm_auto_exclude</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bwthreshspw</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span></span></span><a class="reference internal" href="../_modules/pipeline/extern/almarenorm_pl2023.html#alma_renorm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.almarenorm_pl2023.alma_renorm" title="Link to this definition"></a></dt>
<dd><p>Interface function for ALMA Pipeline: this runs the ALMA renormalization
heuristic for input vis, and returns statistics and metadata required by
the Pipeline renormalization task.</p>
<dl class="field-list">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul>
<li><p><strong>vis</strong> – path to the measurement set to renormalize.</p></li>
<li><p><strong>spw</strong> – Spectral Window IDs to process.</p></li>
<li><p><strong>apply</strong> – apply the correction or not.</p></li>
<li><p><strong>threshold</strong> – the threshold above which the scaling must exceed for the
renormalization correction to be applied. If set to None, then use
a pre-defined threshold appropriate for the ALMA Band.</p></li>
<li><p><strong>excludechan</strong> – dictionary with keys set to SpW IDs (as string), and
values set to channels to exclude for that SpW.</p></li>
<li><p><strong>correct_atm</strong> – this will get the transmission profiles for the SPW
bandpass (or phase) and target(s) because the BP (or phase) and
target(s) autocorr are compared in establishing the scaling in
cases spectra, there can be issues where transmission is low and
the source elevations are tens of degrees different. Often the ATM
is not divided out well and leads to incorrect scaling in ATM
regions. This option acts to fix this discrepancy so ATM are
handled correctly.</p></li>
<li><p><strong>atm_auto_exclude</strong> – if True, then spectral regions found during the
“check for false positives” algorithm will be excluded from the</p>
<blockquote>
<div><p>spectrum.</p>
</div></blockquote>
</li>
<li><p><strong>bwthreshspw</strong> – disctionary with keys set to SpW IDs (as string),
and values set to a bandwidth (in Hz) to use for dividing
up the SpWs, e.g. 120e6</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Returns: 8-tuple containing:</dt><dd><ul class="simple">
<li><p>boolean declaring whether data are all TDM</p></li>
<li><p>ATM exclusion command</p></li>
<li><p>ATM warning</p></li>
<li><p>boolean declaring whether the renormalization correction was found
to have already been applied.</p></li>
<li><p>boolean declaring whether a corrected data column was found.</p></li>
<li><p>boolean declaring whether the renormalization correction was applied.</p></li>
<li><p>dictionary containing factors for Pipeline QA.</p></li>
<li><p>dictionary containing renormalization statistics indexed by source
and SpW.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-pipeline.extern.findContinuum">
<span id="pipeline-extern-findcontinuum-module"></span><h2>pipeline.extern.findContinuum module<a class="headerlink" href="#module-pipeline.extern.findContinuum" title="Link to this heading"></a></h2>
<p>This file implements the algorithm to determine continuum channel ranges to
use from an ALMA image cube (dirty or clean) in CASA format.  All dependencies
on what were originally analysisUtils functions have been pasted into this
file for convenience.  This function is meant to be run inside CASA.
Simple usage:</p>
<blockquote>
<div><p>import findContinuum as fc
fc.findContinuum(‘my_dirty_cube.image’)</p>
</div></blockquote>
<p>This file can be found in a typical pipeline distribution directory, e.g.:
/lustre/naasc/sciops/comm/rindebet/pipeline/branches/trunk/pipeline/extern
As of March 7, 2019 (version 3.36), it is compatible with both python 2 and 3.</p>
<p>Code changes for Pipeline2025 (as of July 24, 2024)
0) Fix crash in recalcMomDiffSNR (not used by pipeline)
1) Prevent crash due to no pyfits module available in CASA 6.6.6.
2) Change <a href="#id82"><span class="problematic" id="id83">np.string_</span></a> to <a href="#id84"><span class="problematic" id="id85">np.bytes_</span></a></p>
<p>Code changes for Pipeline2024 (as of July 30, 2024)
0) No longer disable onlyExtraMask when returnBluePoints==True
1) No longer search for vis in cube dir if not specified, only if vis==’auto’
2) Remove two print statements at import
3) Restore PL2022 behavior of allowing autoLower if returnBluePoints==True
4) add tooManyPixels parameter to control amendMaskDecision
5) widen selections narrower than 4 to make them visible but with thinner linewidth
6) add useBaseline option (default to ‘auto’)
7) force use of middleChannels in extraMask/onlyExtraMask/autoLower/autoLower2
8) import copy
9) change algorithm in robustMADofContinuumRanges to avoid problems with</p>
<blockquote>
<div><p>taking median of the MADs of lots of narrow ranges; fit slope to medians
to remove impact of slope on the global MAD of all findcont channels,
and use peakSNR&gt;7 instead of 15.   2023-08-08</p>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Allow transition names of “Continuum(ID=X)” for X&gt;0 to also be considered
continuum if there is only (at most) one appearance of “ID=”  2023-08-08</p></li>
<li><p>Add chans parameter to imageSNR.   2024-04-29</p></li>
<li><p>Fix for PIPE-2034 (incorrect AllCont display)  2024-04-29</p></li>
<li><p>Fix for PIPE-2158 (warningStrings is now always a list of length 2, but see 15) 2024-04-29</p></li>
<li><p>Fix for PIPE-1644 (reverted plot now shows the difSNR value)  2024-04-30</p></li>
<li><p>Fix for PIPE-1629 (pb mask is applied to joint.mask and joint.mask2) and
further fix PIPE-2158     2024-04-30</p></li>
<li><p>New code for PIPE-2171 (write dirtyCubeStats.txt file)   2024-05-09</p></li>
<li><p>Fix for PIPE-1579 (annulus fully inscribed)   2024-05-09</p></li>
<li><p>Fix for PIPE-1657 (speed up pbmom calculation)  2024-05-09</p></li>
<li><p>Add CASA version to end of name of dirtyCubeStats_CASAx.y.z.txt file. 2024-05-23</p></li>
<li><p>Reduce the length of cyan line for single channel case    2024-06-01</p></li>
<li><p>Fix for PIPE-2188 (try harder to avoid LowSpread)  2024-06-03</p></li>
<li><p>Fix for PIPE-1992: if dynamic range of mom0 is high (&gt;90), raise the mom0minsnr mask threshold to 8</p></li>
<li><p>Add spectralDynamicRangeString to first line of legend</p></li>
<li><p>Final fix for PIPE-1629 (pb mask is applied to jointMask when it is pb-based)</p></li>
</ol>
<p>Code changes for Pipeline2023 (as of June 12, 2023)
0) Enable amendMaskIterations=4: .autoLower2 will run if LowBW not yet reached
1) Set amendMaskIterations=’auto’ to invoked amendMaskIterations=4
2) Set madRatioCheck to False instead of True when middle channels used as baseline
3) Add parameter for momDiffLevelForProceeding with default of 8.0
4) Use scalingFactor = 6/7 in extraMask and .onlyExtraMask if groups &gt; 32
5) Add minGroupsForSFCAdjustment as a control parameter, with default of 7
6) Add maxGroups as a control parameter, with a default of 15
7) When entering autoLower, use 6/7 instead of 5/7 if momDiffSNR&lt;momDiffApproachLevel
8) Add myia option to imageChannelFrequencies (to support recalcMomDiffSNR)
9) Compute mom0 and mom8 at the same time in findContinuum, plotPickleFile,</p>
<blockquote>
<div><p>recalcMomDiffSNR, and meanSpectrumFromMom0Mom8JointMask()</p>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Fix plotPickleFile crash for single channel ranges</p></li>
<li><p>Support a list of intersectRanges in recalcMomDiffSNR</p></li>
<li><p>Add useUncorrectedMedian as a manual usage option</p></li>
</ol>
<p>13) Add dotted cyan line marking the median of the selected continuum channels
and display its value in the second line of the legend
14) Elevate storeExtraMask as a main control parameter
15) Add returnBluePoints, enableInitialQuadratic and removeOutlierBaselineChannels
as main control parameters.
16) Add skipCubeNoise option
17) Add returnMomDiffSNR option (for hif_findcont to set to True)
18) import astropy.io.fits as pyfits, if possible
19) fix for PIPE-1636 (set nbin=1 if ‘cont’ found in transition name), incl. search for vis in cube dir
20) Add ‘auto’ option to enableInitialQuadratic (but keep True as the default)
21) import gaussian_filter from scipy.ndimage (instead of scipy.ndimage.filters)
22) Fix onlyExtraMaskYesOrNo to allow YesMom when skipCubeNoise is set to True by the user
23) Raise momDiffLevel by 3.5 (from 8 to 11.5) for 7m SingleContinuum to get more AllCont
24) Avoid fix for CAS-13894 in casa &gt;= 6.5.3
25) Add amendMaskIterations as parameter to compute4LetterCodeAndUpdateLegend
26) Add spectralDynamicRangeBandWidth parameter for PIPE-1566 with default=None</p>
<p>Code changes for Pipeline2022 from PIPE-1221: (as of August 21, 2022)
0) fix for PIPE-1227 (look for .virtspw first)
1) Do not remove pbmom if it already exists (for speeding up manual use case)
2) import pickle and add useJointMaskPrior control parameter for mom0mom8jointMask
3) PIPE-1433: set definition for TDM for VLA data, add telescope parameter
4) add optional img parameter to plotPickleFile (for manual use case)
5) add optional window parameter and automatic smooth when nbin&gt;1 (PIPE-848)
6) add optional intersectRanges parameter to plotPickleFile (for manual use case)
7) fix for PIPE-1518 and PIPE-1498
8) abbreviate Frequency to Freq. in the upper x-axis label to make room for nbin
9) add removal of median in calculation of initialPeakOverMad (PIPE-848)
10) Show horizontal cyan line even for ranges that are only one channel wide
11) add control parameter for peakOverMadCriterion, set to 65
12) add control parameter for minPeakOverMadForSFCAdjustment, set to 25
13) add additional clause for momDiffSNR&lt;15 in order to adjust sFC in .autoLower
14) prevent undefined var if returnSFC=True
15) in autoLower, change scalingFactor for sFC from 5/7 to 6/7
16) in [‘.extraMask’,’.onlyExtraMask’,’.autoLower’], set finalSigmaFindContinuum
17) skyThresholds adjusted to 5.0, 0.40
18) change maxMadRatioForSFCAdjustmentInLaterIterations from 1.20 to 1.18
19) in .extraMask, reset sigmaFindContinuum to sigmaFindContinuumForExtraMask=2.5
20) fix crash in representativeSpw, remove call to isSingleContinuum
21) do not revert if momDiffSNR &lt; momDiffLevel
22) cast spw list intersection to int (since msmd produces inconsistent types)
23) fix crash in cubeFrameToTopo when vis not specified</p>
<p>Code changes for Pipeline2021 from PIPE-824: (as of July 20, 2021)
0) fix for PRTSPR-50321
1) change .rstrip(‘.image’)+’.mask’ to .replace(‘.image’,’.mask’)
2) fix for PIPE-1181 (protection for all joint mask pixels between pb=0.20-21)
3) add nbin=1 parameter in preparation for PIPE-849
4) fix for PIPE-1211 (does not revert to first range in Result6)
5) add separate ALL_CONTINUUM fraction threshold of 0.91 for nchan&lt;75 (PIPE-825)
6) fix for PIPE-1213 (and correction to roundFigures, unused by current PL)</p>
<p>Code changes for Pipeline2020:
0) fix for PIPE-554 (bug found in cube imaging of calibrators by ARI-L project)
1) fix for PIPE-525 (divide by zero in a 130-target MOUS)
2) new feature PIPE-702 (expand mask if mom8fc image has emission outside it)
3) Add warning messages for too little bandwidth or too little spread.
4) if outdir is specified and does not exist, stop and print error message.
5) Modified the is_binary() function to work in both python 2 and 3.
6) Add LSRK frequency ranges in a new final line of the .dat file
7) Increase to 2 significant digits on sigmaFC in the png name
8) Allow manually specified narrow value to be used everywhere instead of ‘auto’
9) Print Final selection message to casa log
10) fix bug in convertSelectionIntoChannelList (only relevant if avoidance used)
11) allow single value in convertSelection
12) fix bug in avoidance range when gaps were trimmed (not relevant to PL)
13) remove warning about no beam in cube header
14) Add totalChannels &amp; medianWidthOfRanges parameters+logic to pickAutoTrimChannels()
15) Insure that channel ranges are in increasing order if a second range is added to a solo range
16) add imstatListit=False to all imstat calls
17) add minor ticks to lower x-axis (channel number) of the plot
18) added 21 new control parameters to findContinuum (default values listed) for a total of 98:</p>
<blockquote>
<div><ul class="simple">
<li><p>returnWarnings=False (PL 2020 might set this to True if Dirk has time)</p></li>
<li><p>sigmaFindContinuumMode=’auto’ (split from sigmaFindContinuum)</p></li>
<li><p>returnSigmaFindContinuum=False</p></li>
<li><p>enableRejectNarrowInnerWindows=True (to be able to disable it manually)</p></li>
<li><p>avoidExtremaInNoiseCalcForJointMask=False</p></li>
<li><p>buildMom8fc=True</p></li>
<li><p>momentdir=’’</p></li>
<li><p>amendMaskIterations=’auto’</p></li>
<li><p>skipchan=1</p></li>
<li><p>checkIfMaskWouldHaveBeenAmended=False</p></li>
<li><p>fontsize=10</p></li>
<li><p>thresholdForSame=0.01 (to control the new 4-letter codes)</p></li>
<li><p>keepIntermediatePngs=True</p></li>
<li><p>enableOnlyExtraMask=True</p></li>
<li><p>useMomentDiff=True</p></li>
<li><p>smallBandwidthFraction=0.05</p></li>
<li><p>smallSpreadFraction=0.33</p></li>
<li><p>skipAmendMask=False (for manual usage)</p></li>
<li><p>useAnnulus=True</p></li>
<li><p>cubeSigmaThreshold=7.5</p></li>
<li><p>npixThreshold=7 (for onlyExtraMask)</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="19">
<li><p>Added 27 new functions:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>round_half_up (to support the same rounding in python 3 as 2)</p></li>
<li><p>byteDecode (to convert bytes to string for python 3)</p></li>
<li><p>imageSNR</p></li>
<li><p>imageSNRAnnulus</p></li>
<li><p>plotChannelSelections</p></li>
<li><p>compute4LetterCodeAndUpdateLegend</p></li>
<li><p>compute4LetterCode</p></li>
<li><p>cubeNoiseLevel</p></li>
<li><p>updateChannelRangesOnPlot</p></li>
<li><p>computeNpixCubeMedian</p></li>
<li><p>computeNpixMom8Median</p></li>
<li><p>computeNpixMom8MedianBadAtm</p></li>
<li><p>replaceLineFullRangesWithNoise</p></li>
<li><p>gatherWarnings</p></li>
<li><p>tooLittleBandwidth</p></li>
<li><p>tooLittleSpread</p></li>
<li><p>computeSpread</p></li>
<li><p>amendMaskYesOrNo</p></li>
<li><p>extraMaskYesOrNo</p></li>
<li><p>onlyExtraMaskYesOrNo</p></li>
<li><p>invertChannelRanges</p></li>
<li><p>robustMADofContinuumRanges</p></li>
<li><p>findWidestContiguousListInChannelRange</p></li>
<li><p>imagePercentileNoMask (not used by PL because avoidExtremaInNoiseCalcForJointMask=False)</p></li>
<li><p>combineContDat (not used by pipeline)</p></li>
<li><p>getSpwFromPipelineImageName (not used by pipeline)</p></li>
<li><p>getFieldnameFromPipelineImageName (not used by pipeline)</p></li>
</ul>
</div></blockquote>
<p>-Todd Hunter</p>
<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.CalcAtmTransmissionForImage">
<span class="sig-name descname"><span class="pre">CalcAtmTransmissionForImage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">airmass</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pwv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spectralaxis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'transmission'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">altitude</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#CalcAtmTransmissionForImage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.CalcAtmTransmissionForImage" title="Link to this definition"></a></dt>
<dd><p>This function is called by atmosphereVariation.
Supported telescopes are VLA and ALMA (needed for default weather and PWV)
img: name of CASA image
value: ‘transmission’ or ‘tsky’
chanInfo: a list containing nchan, firstFreqHz, lastFreqHz, channelWidthHz
pwv: in mm
P: in mbar
H: in percent
T: in Kelvin
Returns:
2 arrays: frequencies (in GHz) and values (Kelvin, or transmission: 0..1)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.ExpandYLimitsForLegend">
<span class="sig-name descname"><span class="pre">ExpandYLimitsForLegend</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#ExpandYLimitsForLegend"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.ExpandYLimitsForLegend" title="Link to this definition"></a></dt>
<dd><p>Called by runFindContinuum.
Make room for legend text at bottom and top of existing plot.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.MAD">
<span class="sig-name descname"><span class="pre">MAD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.6745</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#MAD"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.MAD" title="Link to this definition"></a></dt>
<dd><p>This function is called by removeInitialQuadraticIfNeeded, findContinuumChannels,
meanSpectrum, computeStatisticalSpectrumFromMask, plotStatisticalSpectrumFromMask
and runFindContinuum.
Median Absolute Deviation along given axis of an array:</p>
<blockquote>
<div><p>median(abs(a - median(a))) / c</p>
</div></blockquote>
<p>c = 0.6745 is the constant to convert from MAD to std</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.aboveBelow">
<span class="sig-name descname"><span class="pre">aboveBelow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">avgSpectrumNansReplaced</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#aboveBelow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.aboveBelow" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Given an array of values (i.e. a spectrum) and a threshold value, this
function computes and returns 6 items:
* the number of channels above that threshold (group 1)
* the number of channels below that threshold (group 2)
* the ratio of these numbers (i.e., #ChanAboveThreshold / #ChanBelowThreshold))
* sum of the intensities in group (1)
* sum of the intensities in group (2)
* the ratio of these sums  (i.e., FluxAboveThreshold / FluxBelowThreshold)</p>
<blockquote>
<div><blockquote>
<div><p>(This value is not currently used by the calling function.)
Example with 24 channels where 3 have positive spikes, and rest are zero:</p>
<blockquote>
<div><p>3      2      3        channelsAbove = 3</p>
</div></blockquote>
</div></blockquote>
<dl class="simple">
<dt>+threshold=+1 ……………………   sumAbove = (3-1) + (2-1) + (3-1) = 5</dt><dd><p>zero —————————   channelsBelow = 21</p>
</dd>
</dl>
<p>-threshold=-1 ……………………   sumBelow = 21*(1-0) = 21</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.allContinuumSelected">
<span class="sig-name descname"><span class="pre">allContinuumSelected</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.925</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fraction2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.91</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#allContinuumSelected"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.allContinuumSelected" title="Link to this definition"></a></dt>
<dd><p>Returns True if only one range is selected and that range covers sufficient
bandwidth (default fraction = 92.5%)
nchan: number of channels in the spectrum
fraction: for nchan &gt;= 75 (default = 0.925 which is 92.5%)
fraction2: for nchan &lt; 75 (default = 0.91)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.amendMaskYesOrNo">
<span class="sig-name descname"><span class="pre">amendMaskYesOrNo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">badAtmosphere</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momSNR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momSNRCube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Npix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixBadAtm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixCube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TenEventSigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MADMomOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MADCubeOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momLevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momLevelBadAtm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cubeLevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixCube2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fractionNegativePixels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Npix2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Npix2BadAtm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipCubeNoise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tooManyPixels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">850</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#amendMaskYesOrNo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.amendMaskYesOrNo" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
median: median of mom8fc img if fc(useMomentDiff=False), or momDiff (mom8-mom0scaled) if useMomentDiff=True
momSNR: SNR of mom8fc img if fc(useMomentDiff=False), or momDiff (mom8-mom0scaled) if useMomentDiff=True
etc.
badAtmosphere: either a boolean or a string (‘goodAtm’ or ‘badAtm’)
momLevel: for the non-badAtmosphere case, this is passed in from momDiffLevelForProceeding</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.atmosphereVariation">
<span class="sig-name descname"><span class="pre">atmosphereVariation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">airmass</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pwv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">removeSlope</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#atmosphereVariation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.atmosphereVariation" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum.
Computes the absolute and percentage variation in atmospheric transmission
and sky temperature across an image cube.
Returns 5 values: max(Trans)-min(Trans), and as percentage of mean,</p>
<blockquote>
<div><p>Max(Tsky)-min(Tsky), and as percentage of mean,
standard devation of Tsky</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.avgOverCube">
<span class="sig-name descname"><span class="pre">avgOverCube</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pixels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAbsoluteValue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usermask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useIAGetProfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#avgOverCube"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.avgOverCube" title="Link to this definition"></a></dt>
<dd><p>This function was used by Cycle 4 and 5 pipeline from meanSpectrum(),
but will not be used in the Cycle 6 default heuristic of
‘mom0mom8jointMask’.
Computes the average spectrum across a multi-dimensional
array read from an image cube, ignoring any NaN values.
Inputs:
pixels: a 3D array (with degenerate Stokes axis dropped)
threshold: value in Jy
median: if True, compute the median instead of the mean
mask: use pixels inside this spatial mask (i.e. with value==1 or True) to compute</p>
<blockquote>
<div><p>the average (the spectral mask is taken as the union of all channels)
This is the mask located inside the image cube specified in findContinuum(img=’’)</p>
</div></blockquote>
<p>usermask: this array results from the mask specified in findContinuum(mask=’’) parameter
If threshold is specified, then it only includes pixels
with an intensity above that value.
Returns:
* average spectrum
* percentage of pixels not masked
Note: This function assumes that the spectral axis is the final axis.</p>
<blockquote>
<div><p>If it is not, there is no single setting of the axis parameter that
can make it work.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.buildMeanSpectrumFilename">
<span class="sig-name descname"><span class="pre">buildMeanSpectrumFilename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumMethod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakFilterFWHM</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amendMaskIterationName</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#buildMeanSpectrumFilename"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.buildMeanSpectrumFilename" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum and runFindContinuum.
Creates the name of the meanSpectrumFile to search for and/or create.
Returns: a string</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.byteDecode">
<span class="sig-name descname"><span class="pre">byteDecode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buffer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#byteDecode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.byteDecode" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.casaRestToTopo">
<span class="sig-name descname"><span class="pre">casaRestToTopo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">restFrequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restFrequency2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fieldid</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#casaRestToTopo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.casaRestToTopo" title="Link to this definition"></a></dt>
<dd><p>Converts a range of SOURCE frame frequencies to TOPO channels in a
specified measurement set.  The input frequencies should be the
center frequencies of the edge channels in the cube.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.casaVersionCompare">
<span class="sig-name descname"><span class="pre">casaVersionCompare</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">comparitor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">versionString</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#casaVersionCompare"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.casaVersionCompare" title="Link to this definition"></a></dt>
<dd><p>This function is called by meanSpectrum.
Uses cu.compare_version in CASA5, uses string comparison in CASA4 and 6.
(but is not used by meanSpectrumMethod=’mom0mom8jointMask’ which is</p>
<blockquote>
<div><p>the Pipeline default)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.casalogPost">
<span class="sig-name descname"><span class="pre">casalogPost</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mystring</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'INFO'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#casalogPost"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.casalogPost" title="Link to this definition"></a></dt>
<dd><p>Generates an INFO message prepended with the version number of findContinuum.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.centralArcsecArgumentMismatch">
<span class="sig-name descname"><span class="pre">centralArcsecArgumentMismatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centralArcsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#centralArcsecArgumentMismatch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.centralArcsecArgumentMismatch" title="Link to this definition"></a></dt>
<dd><p>This function is called by checkForMismatch.
Determines if the requested centralArcsec value does not match what was used to
generate the specified meanSpectrumFile.
Returns: True or False</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.channelSelectionRangesToIndexArray">
<span class="sig-name descname"><span class="pre">channelSelectionRangesToIndexArray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#channelSelectionRangesToIndexArray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.channelSelectionRangesToIndexArray" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Convert a channel selection range string to integer array of indices.
e.g.:  ‘3~8;10~11’ -&gt; [3,4,5,6,7,8,10,11]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.channelsInLargestGroup">
<span class="sig-name descname"><span class="pre">channelsInLargestGroup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#channelsInLargestGroup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.channelsInLargestGroup" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Returns the number of channels in the largest group of channels in a
CASA selection string.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.checkForMismatch">
<span class="sig-name descname"><span class="pre">checkForMismatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useThresholdWithMask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitsTable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centralArcsec</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#checkForMismatch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.checkForMismatch" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Returns True if there is a mismatch between the pre-existing
meanSpectrumFile and the requested parameters.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.checkForTriangularWavePattern">
<span class="sig-name descname"><span class="pre">checkForTriangularWavePattern</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">triangleFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.83</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#checkForTriangularWavePattern"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.checkForTriangularWavePattern" title="Link to this definition"></a></dt>
<dd><p>+++++++ This function is not used for meanSpectrumMethod == ‘mom0mom8jointMask’.
Fit and remove linear slopes to each half of the spectrum, then comparse
the MAD of the residual to the MAD of the original spectrum
pad: fraction of total channels to ignore on each edge (e.g. 20: 1/20th)
triangleFraction: MAD of dual-linfit residual must be less than this fraction*originalMAD
Returns:
* Boolean: whether triangular pattern meets the threshold
* value: either False (if slope test failed) or a float (the ratio of the MADs)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.combineContDat">
<span class="sig-name descname"><span class="pre">combineContDat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contdatlist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cont.dat'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fieldname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#combineContDat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.combineContDat" title="Link to this definition"></a></dt>
<dd><p>Takes a list of <a href="#id11"><span class="problematic" id="id12">*</span></a>.dat files created by findContinuum for a single field/spw
and pulls the line that contains LSRK frequency ranges from each one, and
writes it to a new cont.dat file suitable for the pipeline that contains an
entry for each spw of that field.
contdatlist: a list or comma-delimited string of the .dat files, or of</p>
<blockquote>
<div><p>the cube names (to which ‘_findContinuum.dat’ will be appended)</p>
</div></blockquote>
<p>fieldname: use this value if specified, otherwise parse from filename
spw: integer or string integer, use this value if specified, otherwise parse</p>
<blockquote>
<div><p>from the filename</p>
</div></blockquote>
<p>Note: It assumes that none of the files originate from an ALLcont spw, so it will
never write the “ALL” line that the pipeline triggers on.  But this feature could be
added by calling the following function if there is only one range of channels read:</p>
<blockquote>
<div><p>allContinuumSelected(selection, nchan, fraction=ALL_CONTINUUM_CRITERION)</p>
</div></blockquote>
<p>We would only need to know nchan.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.compute4LetterCode">
<span class="sig-name descname"><span class="pre">compute4LetterCode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom8fcPeak</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcPeak0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcPeakOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcPeakOutside0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcSum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcSum0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcMAD</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcMAD0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnRatios</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffSNR</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#compute4LetterCode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.compute4LetterCode" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
threshold: to use for Peak, PeakOutside, and Sum;  double this value is used for MAD (i.e. 2%)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.compute4LetterCodeAndUpdateLegend">
<span class="sig-name descname"><span class="pre">compute4LetterCodeAndUpdateLegend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom8fcPeak</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcPeak0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcPeakOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcPeakOutside0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcSum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcSum0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcMAD</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcMAD0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresholdForSame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">areaString</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labelDescs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amendMaskDecision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraMaskDecision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraMaskDecision2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">autoLowerDecision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intersectionOfSelections</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useMomentDiff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warnings</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelRanges</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaUsedToAmendMask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffSNR</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipDecisionCode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">addedSelection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">autoLower2Decision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amendMaskIterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#compute4LetterCodeAndUpdateLegend"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.compute4LetterCodeAndUpdateLegend" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
Add a variable length code and a 4-letter code to the end of the last line of the upper legend.
useMomentDiff: specified in the call to findContinuum()
Returns:  labelDescs, areaString, mycode</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeBandwidth">
<span class="sig-name descname"><span class="pre">computeBandwidth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelWidth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeBandwidth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeBandwidth" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum and findContinuum.
selection: a string of format:  ‘5~6;9~20’
channelWidth: in Hz
Returns: bandwidth in GHz</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeMadSpectrum">
<span class="sig-name descname"><span class="pre">computeMadSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeMadSpectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeMadSpectrum" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>+++++++ This function is not used for meanSpectrumMethod == ‘mom0mom8jointMask’.</dt><dd><p>Only used by checkForTriangularWavePattern.</p>
</dd>
</dl>
<p>Uses the imstat task to compute an array containing the MAD spectrum of a cube.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeMedianCorrectionFactor">
<span class="sig-name descname"><span class="pre">computeMedianCorrectionFactor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">baselineMode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeMedianCorrectionFactor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeMedianCorrectionFactor" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels and medianCorrected.
Computes the effect due to the fact that taking the median of the
N%ile lowest points of a Gaussian noise datastream will be lower than the true
median of all the points.  This is (TrueMedian-ObservedMedian)/ObservedMAD</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeNpixCubeMedian">
<span class="sig-name descname"><span class="pre">computeNpixCubeMedian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom8fcMedian</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cubeLevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MADCubeOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMaskTest</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeNpixCubeMedian"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeNpixCubeMedian" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
jointMaskTest: can be a mask, a mask statement or compound mask statement</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeNpixMom8Median">
<span class="sig-name descname"><span class="pre">computeNpixMom8Median</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom8fcMedian</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8level</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcMAD</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMaskTest</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeNpixMom8Median"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeNpixMom8Median" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
mom8fcMedian: the median of the moment8 image being used
mom8level: a sigma value to use
mom8fcMAD: a scaled MAD
jointMaskTest: can be a mask, a mask statement or compound mask statement</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeNpixMom8MedianBadAtm">
<span class="sig-name descname"><span class="pre">computeNpixMom8MedianBadAtm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mom8fcMedian</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8levelBadAtm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fcMAD</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8fc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMaskTest</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeNpixMom8MedianBadAtm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeNpixMom8MedianBadAtm" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
jointMaskTest: can be a mask, a mask statement or compound mask statement</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeSpread">
<span class="sig-name descname"><span class="pre">computeSpread</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelWidth</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeSpread"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeSpread" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.computeStatisticalSpectrumFromMask">
<span class="sig-name descname"><span class="pre">computeStatisticalSpectrumFromMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointmask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbimg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statistic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalizeByMAD</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projectCode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">higherAnnulusLevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lowerAnnulusLevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMaskForNormalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#computeStatisticalSpectrumFromMask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.computeStatisticalSpectrumFromMask" title="Link to this definition"></a></dt>
<dd><p>New heuristic for Cycle 6 pipeline.  It is called by meanSpectrumFromMom0Mom8JointMask
Uses ia.getprofile to compute the mean spectrum of a cube within a
masked area.
jointmask: a 2D or 3D mask image indicating which pixels shall be used</p>
<blockquote>
<div><p>or an expression with &lt; or &gt; along with a 2D or 3D mask image</p>
</div></blockquote>
<p>jointMaskForNormalize: a 2D or 3D mask image to be used when normalizeByMAD==True
pbimg: the path to the primary beam of this cube, or a 2D primary beam with an expression
statistic: passed to ia.getprofile via the ‘function’ parameter
normalizeByMAD: if True, then create the inverse of the jointmask and</p>
<blockquote>
<div><p>normalize the spectrum by the spectrum of ‘xmadm’ (scaled MAD)
computed on the inverse mask</p>
</div></blockquote>
<p>subimage: if True, then raise the pb level annulus by 0.2
Returns: three arrays: channels, freqs(Hz), intensities, and a Boolean</p>
<blockquote>
<div><p>which says if normalization was applied</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.convertChannelListIntoSelection">
<span class="sig-name descname"><span class="pre">convertChannelListIntoSelection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#convertChannelListIntoSelection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.convertChannelListIntoSelection" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
Converts a list of channels into casa selection string syntax.
channels: a list of channels
trim: the number of channels to trim off of each edge of a block of channels</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.convertColonDelimitersToHMSDMS">
<span class="sig-name descname"><span class="pre">convertColonDelimitersToHMSDMS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mystring</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usePeriodsForDeclination</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#convertColonDelimitersToHMSDMS"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.convertColonDelimitersToHMSDMS" title="Link to this definition"></a></dt>
<dd><p>This function is called by rad2radec.
Converts HH:MM:SS.SSS, +DD:MM:SS.SSS  to  HHhMMmSS.SSSs, +DDdMMmSS.SSSs</p>
<blockquote>
<div><p>or HH:MM:SS.SSS +DD:MM:SS.SSS   to  HHhMMmSS.SSSs +DDdMMmSS.SSSs
or HH:MM:SS.SSS, +DD:MM:SS.SSS  to  HHhMMmSS.SSSs, +DD.MM.SS.SSS
or HH:MM:SS.SSS +DD:MM:SS.SSS   to  HHhMMmSS.SSSs +DD.MM.SS.SSS</p>
</div></blockquote>
<p>s: whether or not to include the trailing ‘s’ in both axes</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.convertSelectionIntoChannelList">
<span class="sig-name descname"><span class="pre">convertSelectionIntoChannelList</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#convertSelectionIntoChannelList"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.convertSelectionIntoChannelList" title="Link to this definition"></a></dt>
<dd><p>Converts an arbitrary CASA selection string into an array of channel numbers
‘0~1;4~6’ –&gt; np.array([0,4,5])
Ignores any initial spw number that preceeds a colon.  Will fail if there is more than one colon.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.cornersEmptyEdgesNotEmpty">
<span class="sig-name descname"><span class="pre">cornersEmptyEdgesNotEmpty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pbcube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">middleChannel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#cornersEmptyEdgesNotEmpty"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.cornersEmptyEdgesNotEmpty" title="Link to this definition"></a></dt>
<dd><p>Checks if the four corner pixels of an image are masked while the four
middle edge pixels are not masked –&gt; True, otherwise False</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.countChannels">
<span class="sig-name descname"><span class="pre">countChannels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#countChannels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.countChannels" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Counts the number of channels in a CASA channel selection string.
If multiple spws are found, then it returns a dictionary of counts:
e.g. “1:5~20;30~40”  yields 27; or  ‘6~30’ yields 25</p>
<blockquote>
<div><p>“1:5~20;30~40,2:6~30” yields {1:27, 2:25}</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.countChannelsInRanges">
<span class="sig-name descname"><span class="pre">countChannelsInRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#countChannelsInRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.countChannelsInRanges" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Counts the number of channels in one spw of a CASA channel selection string
and return a list of numbers.
e.g. “5~20;30~40”  yields [16,11]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.countMaskedPixels">
<span class="sig-name descname"><span class="pre">countMaskedPixels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#countMaskedPixels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.countMaskedPixels" title="Link to this definition"></a></dt>
<dd><p>The mask internal to an image will have a value of False where masked,
and True where not masked.
To count non-zero pixels in a clean 1/0 mask, use au.nonzeroPixels.
axes: set to [0,1,2] to get a per-channel count (only works for useImstat)
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.countPixelsAboveZero">
<span class="sig-name descname"><span class="pre">countPixelsAboveZero</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbmom</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useImstat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#countPixelsAboveZero"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.countPixelsAboveZero" title="Link to this definition"></a></dt>
<dd><p>This function is called by meanSpectrumFromMom0Mom8JointMask.
Returns number of pixels &gt; a specified threshold.
pbmom: if specified, and useImstat==True, then also require pb&gt;0.21
Note that the value of 0.21 is also used in findOuterAnnulusForPBCube and should be changed in parallel
value: threshold (default=0)
Total pixels: spatial * spectral * Stokes
Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.countUnmaskedPixels">
<span class="sig-name descname"><span class="pre">countUnmaskedPixels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useImstat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#countUnmaskedPixels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.countUnmaskedPixels" title="Link to this definition"></a></dt>
<dd><p>This function is called by meanSpectrumFromMom0Mom8JointMask.
Returns number of unmasked pixels in an multi-dimensional image, i.e.
where the internal mask is True.
Total pixels: spatial * spectral * Stokes
Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.createNoisyQuadratic">
<span class="sig-name descname"><span class="pre">createNoisyQuadratic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#createNoisyQuadratic"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.createNoisyQuadratic" title="Link to this definition"></a></dt>
<dd><p>Function meant simply to test removeStatContQuadratic.
n: number of points in synthetic noise spectrum
nsigma: passed to removeStatContQuadratic</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.create_casa_quantity">
<span class="sig-name descname"><span class="pre">create_casa_quantity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">myqatool</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#create_casa_quantity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.create_casa_quantity" title="Link to this definition"></a></dt>
<dd><p>This function is called by CalcAtmTransmissionForImage, frames, and lsrkToRest.
A wrapper to handle the changing ways in which casa quantities are invoked.
Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.cubeFrameToTopo">
<span class="sig-name descname"><span class="pre">cubeFrameToTopo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freqrange</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanwidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#cubeFrameToTopo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.cubeFrameToTopo" title="Link to this definition"></a></dt>
<dd><p>This function is called by CalcAtmTransmissionForImage and writeContDat.
Reads the date of observation, central RA and Dec,
and observatory from an image cube and then calls lsrkToTopo to
return the specified frequency range in TOPO, and the name of the original
frame that was converted (which will not be a REST-frame cube’s frame if
vis not specified).
If the cube is in REST frame, it calls casaRestToTopo(), and if the cube is
in LSRK frame, it calls lsrkToTopo().
freqrange: desired range of frequencies (empty string or list = whole cube)</p>
<blockquote>
<div><p>floating point list of two frequencies, or a delimited string
(delimiter = ‘,’, ‘~’ or space)</p>
</div></blockquote>
<p>prec: in fractions of Hz (only used to display the value when verbose=True)
chanwidth: unused
vis: read date of observation from the specified measurement set (instead of from img)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.cubeNoiseLevel">
<span class="sig-name descname"><span class="pre">cubeNoiseLevel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#cubeNoiseLevel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.cubeNoiseLevel" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
Computes median of the per-channel scaled MAD within the standard noise annulus
and outside the specified mask
chans: channel selection string (passed to imstat)
mask: either mask image to use (e.g. the string passed to imstat will be ‘“mask” == 0’)</p>
<blockquote>
<div><p>or a proper mask string containing &gt;, &lt; or ==</p>
</div></blockquote>
<dl class="simple">
<dt>percentile: compute this percentile value of the per-channel scaled MAD</dt><dd><p>(examples: 50 = median,  90 = close to the highest value)
if it is a list, then a list of values is returned</p>
</dd>
<dt>Returns: median of MAD, median</dt><dd><p>or [list of MADs], median</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.cutSomeNarrowRanges">
<span class="sig-name descname"><span class="pre">cutSomeNarrowRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nkeep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">240</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#cutSomeNarrowRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.cutSomeNarrowRanges" title="Link to this definition"></a></dt>
<dd><p>Remove the N narrowest ranges from a channel selection string to avoid
CAS-13894 crash of immoments.
selection: e.g. ‘14~18;50~60’
nkeep: number of ranges to keep (failures of imstat have been seen at 244</p>
<blockquote>
<div><p>and 245)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.drawYlabel">
<span class="sig-name descname"><span class="pre">drawYlabel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typeOfMeanSpectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumMethod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumThreshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakFilterFWHM</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useThresholdWithMask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalized</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#drawYlabel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.drawYlabel" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Draws a descriptive y-axis label based on the origin and type of mean spectrum used.
Returns: None</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.extraMaskYesOrNo">
<span class="sig-name descname"><span class="pre">extraMaskYesOrNo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">badAtmosphere</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momSNR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momSNRCube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixMom</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixMomBadAtm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixCubeAnywhere</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TenEventSigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MADMomOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MADCubeOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffLevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffLevelBadAtm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cubeLevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#extraMaskYesOrNo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.extraMaskYesOrNo" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.  Also used for autoLower decision logic.
badAtmosphere: either a boolean or a string (‘goodAtm’ or ‘badAtm’)
momSNR: SNR outside the mask, i.e. will be momDiffSNR if useMomentDiff=True (which PL uses)
NpixMom: unused now
NpixMomBadAtm: unused now
NpixCubeAnywhere: unused now
momDiffLevel: for the non-badAtmosphere case, this is passed in from momDiffLevelForProceeding
MADCubeOutside: not currently used in this function!</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.fieldIDForName">
<span class="sig-name descname"><span class="pre">fieldIDForName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#fieldIDForName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.fieldIDForName" title="Link to this definition"></a></dt>
<dd><p>Returns field ID for source name, ignoring those fields which are not used
to observe the main target and calibrator intents (when those intents are
also observed).
Note: the following simple mechanism will fail if there is an ATMOSPHERE-only field
fieldnames = mymsmd.fieldnames()
fieldid = fieldnames.index(source)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.findChannelsInChannelRangeWithComparableIntensity">
<span class="sig-name descname"><span class="pre">findChannelsInChannelRangeWithComparableIntensity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelRange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuumChannels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intensity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">withinSigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#findChannelsInChannelRangeWithComparableIntensity"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.findChannelsInChannelRangeWithComparableIntensity" title="Link to this definition"></a></dt>
<dd><p>Finds channels in a portion of the spectrum (intensity) whose intensity is
within the range of intensities of the blue points (channels) by some sigma
beyond the min and max.
channels: list of blue points channel numbers
intensity: intensity of whole spectrum (an array)
channelRange: range of channels to look for widest set of blue points [first,final]
continuumChannels: current selection of continuuum channels
withinSigma: fix for PIPE-2188
Returns: a list of channels, possibly non-contiguous, sorted low to high</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.findContinuum">
<span class="sig-name descname"><span class="pre">findContinuum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psfcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minbeamfrac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transition</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselineModeA</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'min'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselineModeB</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'min'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaCube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.19</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuumMode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">png</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pngBasename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanBufferChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAbsoluteValue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trimChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuumThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">narrow</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">titleText</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrimFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centralArcsec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alternateDirectory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotAtmosphere</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'transmission'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">airmass</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pwv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelFractionForSlopeRemoval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.75</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumMethod</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mom0mom8jointMask'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakFilterFWHM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skyTempThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skyTransmissionThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxGroupsForSkyThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minBandwidthFractionForSkyThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regressionTest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quadraticFit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">triangleFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.83</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxMemory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tdmSkyTempThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.65</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negativeThresholdFactor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">singleContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">applyMaskToMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotBaselinePoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">madRatioUpperLimit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">madRatioLowerLimit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projectCode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useIAGetProfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useThresholdWithMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dpi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">150</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalizeByMAD</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnSnrs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwriteMoments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minPeakOverMadForSFCAdjustment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minPixelsInJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">userJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signalRatioTier1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.967</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">snrThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">23</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom0minsnr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8minsnr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwriteMasks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rmStatContQuadratic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quadraticNsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectionalMaskPhase2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">makeMovie</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnAllContinuumBoolean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allowBluePruning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnSigmaFindContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enableRejectNarrowInnerWindows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidExtremaInNoiseCalcForJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buildMom8fc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momentdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amendMaskIterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkIfMaskWouldHaveBeenAmended</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresholdForSame</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keepIntermediatePngs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnWarnings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enableOnlyExtraMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useMomentDiff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smallBandwidthFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smallSpreadFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipAmendMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAnnulus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cubeSigmaThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npixThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useJointMaskPrior</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">telescope</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALMA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flat'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxMadRatioForSFCAdjustment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.18</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxMadRatioForSFCAdjustmentInLaterIterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.18</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuumForExtraMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffLevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakOverMadCriterion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">65</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffLevelForProceeding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minGroupsForSFCAdjustment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxGroups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffApproachLevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom08simultaneous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useUncorrectedMedian</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storeExtraMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnBluePoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">removeOutlierBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enableInitialQuadratic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipCubeNoise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnMomDiffSNR</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spectralDynamicRangeBandWidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tooManyPixels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">850</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useBaseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#findContinuum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.findContinuum" title="Link to this definition"></a></dt>
<dd><p>This function calls functions to:
1) compute a representative ‘mean’ spectrum of a dirty cube
2) find the continuum channels
3) plot the results and writes a text file with channel ranges and frequency ranges
It calls runFindContinuum up to 2 times.
If meanSpectrumMethod != ‘mom0mom8jointMask’, then it runs it a second
time with a reduced field size if it finds only one range of continuum
channels.</p>
<p>Please note that the channel ranges do not necessarily map back to
the visibility spectra in the measurement set(s).  In order to produce
channel ranges that are guaranteed to map back correctly, then you must
supply a list of all desired measurement sets to the vis parameter.  In
this case, the final line in the .dat file created will contain the
channel list in the correct frequency frame and order.</p>
<section id="returns">
<h3>Returns:<a class="headerlink" href="#returns" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>A channel selection string suitable for the spw parameter of clean.</p></li>
<li><p>The name of the final png produced.</p></li>
<li><p>The aggregate bandwidth in continuum in GHz.</p></li>
</ul>
<dl>
<dt>If returnAllContinuumBoolean = True, then it also returns a Boolean desribing</dt><dd><p>if it thinks the whole spectrum is continuum (True) or not (False)
Cycle 7 pipeline usage should set returnAllContinuumBoolean = True</p>
</dd>
<dt>If returnWarnings = True, then it also returns a list of warning strings,</dt><dd><p>which may be empty [], for tooLittleBandwidth and/or tooLittleSpread (PL2020+)
and the name of the joint mask image (PL2022+)</p>
</dd>
<dt>If returnSnrs = True, then it also returns two more lists: mom0snrs and mom8snrs,</dt><dd><p>and the max baseline (floating point meters) inferred from the psf image</p>
</dd>
<dt>if returnSigmaFindContinuum = True (new in PL2020), then it also returns 17 more things:</dt><dd><blockquote>
<div><ol class="arabic simple">
<li><p>the final value used for sigmaFindContinuum (PL2022: at the end of the .original stage)</p></li>
<li><p>the Boolean intersectionOfSelections</p></li>
<li><p>number of central ranges that were (or would have been) dropped, summed
over all runs of findContinuumChannels by the final run of runFindContinuum.</p></li>
<li><p>the result of amendMaskYesOrNo (if it was run;  False otherwise)</p></li>
<li><p>the result of extraMaskYesOrNo (if it was run;  False otherwise)</p></li>
<li><p>the result of extraMaskYesOrNo test 2 (if it was run;  False otherwise)</p></li>
<li><p>the result of autoLower</p></li>
<li><p>the name of the finalMomDiff image (if amendMask=True) else the final mom8fc image</p></li>
<li><p>the logic path code (for amendMask) (pathCode)</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>the 4-letter code (for amendMask) (momDiffCode)</p></li>
<li><p>the SNR in the final momDiff image (momDiffSNR)</p></li>
<li><p>name of meanSpectrumFile produced</p></li>
<li><p>name of the “_findContinuum.dat” file produced</p></li>
<li><p>positiveThreshold (upper black dotted line)</p></li>
<li><p>negativeThreshold (lower black dotted line)</p></li>
<li><p>median (solid black line)</p></li>
<li><p>median of selected continuum channels (dotted cyan line)</p></li>
</ol>
</dd>
<dt>If returnMomDiffSNR = True (new in PL2023) and returnSigmaFindContinuum &amp; returnSNRs=False</dt><dd><p>then also return the momDiffSNR value.</p>
</dd>
<dt>PL2023 use case (returnWarnings=True, returnAllContinuumBoolean=True returnMomDiffSNR=True)</dt><dd><p>will return:
selection, png, aggregateBandwidth, allContinuum, warningStrings, jointMask, momDiffSNR</p>
</dd>
</dl>
</section>
<section id="required-inputs">
<h3>Required Inputs:<a class="headerlink" href="#required-inputs" title="Link to this heading"></a></h3>
<dl>
<dt>img: the image cube to operate upon (as opposed to specifying a</dt><dd><blockquote>
<div><p>pre-existing meanSpectrumFile from a previous run)</p>
</div></blockquote>
<p>–or–</p>
</dd>
<dt>meanSpectrumFile: an alternative pre-existing ASCII text file to use</dt><dd><p>for the mean spectrum, instead of operating on the img to create one.</p>
</dd>
<dt>Note: if you specify meanSpectrumFile and vis, you must also specify img, but</dt><dd><blockquote>
<div><p>only its metadata will be used.</p>
</div></blockquote>
<p>Parameters relevant only to meanSpectrumFile:
* invert: if True, then invert the sign of intensity and add the minimum</p>
</dd>
</dl>
</section>
<section id="optional-inputs-see-also-general-parameters-below">
<h3>Optional inputs (see also General Parameters below):<a class="headerlink" href="#optional-inputs-see-also-general-parameters-below" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>spw: the spw name or number (integer or string integer) to put in the x-axis label;</dt><dd><p>also, it will be used to select the spw for which to generate topo channels for the
<a href="#id13"><span class="problematic" id="id14">*</span></a>.dat file if vis is also specified; if vis is specified and spw is
not, then it will search the name of the image for an spw number
and use it for generating the topo channel list.</p>
</dd>
</dl>
<p>transition: the name of the spectral transition (for the plot title)
avoidance: a CASA channel selection string to avoid selecting (for manual use);</p>
<blockquote>
<div><p>invoked at the end of each execution of runFindContinuum()</p>
</div></blockquote>
<dl>
<dt>meanSpectrumMethod: ‘auto’, ‘mom0mom8jointMask’, ‘peakOverMad’, ‘peakOverRms’,</dt><dd><dl>
<dt>‘meanAboveThreshold’, ‘meanAboveThresholdOverRms’, ‘meanAboveThresholdOverMad’,</dt><dd><p>where ‘peak’ refers to the peak in a spatially-smoothed version of cube
‘auto’ invokes ‘meanAboveThreshold’ unless sky temperature range</p>
<blockquote>
<div><p>(max-min) from the atmospheric model is more than skyTempThreshold
in which case it invokes ‘peakOverMad’ instead</p>
</div></blockquote>
<p>ALMA Cycle 5 used ‘auto’, while ALMA Cycle 6 will use ‘mom0mom8jointMask’</p>
<ul>
<li><dl class="simple">
<dt>nbin: if greater than NBIN_THRESHOLD (4), then smooth spectrum by this</dt><dd><p>many channels</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>spectralDynamicRangeBandWidth: frequency string with units;</dt><dd><p>compute nbin based on this value (overrides nbin parameter),
example: ‘5.1MHz’</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>window: the smoothing window to use with nbin (one of: ‘gauss’,</dt><dd><p>‘flat’,’hanning’,’hamming’,’bartlett’,’blackman’)</p>
</dd>
</dl>
</li>
<li><p>minPeakOverMadForSFCAdjustment: scalar value</p></li>
<li><dl class="simple">
<dt>pbcube: the primary beam response for img, but only used by</dt><dd><p>meanSpectrumMethod=’mom0mom8jointMask’. If not specified,
it will be searched for by changing file suffix from .residual to .pb</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>psfcube: the psf response for img, but only used by</dt><dd><p>meanSpectrumMethod=’mom0mom8jointMask’. If not specified,
it will be searched for by changing file suffix from .residual to .psf,
if still not found, then pruneMask will default to 6 pixels</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>minbeamfrac: only used if psfcube is specified and meanSpectrumMethod=’mom0mom8jointMask’</dt><dd><p>floating point value or ‘auto’ for 0.3 for 12m and 0.1 for 7m (maxBaseline&lt;60m)
Set to zero to prevent pruning of the joint mask entirely; otherwise pruneMask
will use np.max([4,minbeamfrac*pixelsPerBeam])</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>minPixelsInJointMask: if fewer than these pixels are found (after pruning), then</dt><dd><p>use all pixels above pb=0.3 (or equivalent higher value on mitigated images).
This option was essentially obseleted by the addition of pruneMask with the
knowledge of beamsize from psfcube.  To avoid having any effect, it should be set
to &lt; minbeamfrac*minPixelsPerBeam, which is typically 0.5*7=3.5; so use 3 or less.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>userJointMask: if specified, use this joint mask instead of computing one</dt><dd><p>(this option is meant for test purposes only, typically <a href="#id15"><span class="problematic" id="id16">*</span></a>.mask2_bi)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>useJointMaskPrior: if True, and if the &lt;img&gt;_mom0mom8jointMaskPrior.pkl file exists,</dt><dd><p>then it will skip the creation of joint.mask and joint.mask2 on the first
iteration of amendMask to save some time.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>normalizeByMAD: can be True, False or ‘auto’ (default);</dt><dd><dl class="simple">
<dt>if ‘auto’, then if atmospheric transmission varies enough across the spw,</dt><dd><p>set to True, otherwise set to False.</p>
</dd>
<dt>If True, then request normalization of the resulting mean spectrum by the</dt><dd><p>xmadm spectrum using an outer annulus and outside the joint mask.  The
nominal annulus is the 0.2-0.3 pb response, but the range will
automatically be scaled upward with minimum value in the pb cube,
in order to preserve the fractional number of pixels contained in
a single field’s 0.2-0.3 annulus.</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><p>mom0minsnr: sets the threshold for the mom0 image (i.e. median + mom0minsnr*scaledMAD)</p></li>
<li><p>mom8minsnr: sets the threshold for the mom8 image (i.e. median + mom8minsnr*scaledMAD)</p></li>
<li><p>snrThreshold: if SNR is higher than this, then run a phase 2 mask calculation</p></li>
<li><dl class="simple">
<dt>bidirectionalMaskPhase2: True=extend mask to negative values beyond threshold;</dt><dd><p>False=Cycle6+ behavior (True was tried but gives worse results in some cases)</p>
</dd>
</dl>
</li>
<li><dl>
<dt>enableInitialQuadratic: if True, assess the need for quadratic removal, and use</dt><dd><p>the old-style method to remove it; if ‘auto’, then set to True only
if the lowercase version of the source name includes venus, mars,</p>
<blockquote>
<div><p>jupiter, saturn, uranus, or neptune</p>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>rmStatContQuadratic: if True, then do not do the initialQuadratic removal (if</dt><dd><p>enabled and deemed necessary), but instead always perform the new-style
quadratic removal</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>makeMovie: if True, then make a png for each quadratic fit as channels are</dt><dd><p>removed one-by-one (in the rmStatContQuadratic option)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>quadraticNsigma: the stopping threshold to use when ignoring outliers prior to</dt><dd><p>fitting the quadratic (in the rmStatContQuadratic option). To more quickly test
different values, be sure to set the meanSpectrumFile option and overwrite=False)</p>
</dd>
</dl>
</li>
<li><p>allowBluePruning: use continuum range pruning heuristic added in Cycle 6 (default=True)</p></li>
<li><dl class="simple">
<dt>amendMaskIterations (new in PL2020): if ‘auto’, then choose 0 for TDM and 3 for FDM;</dt><dd><p>if 0, then do not attempt any amendMask (i.e. mimic the Cycle 7 pipeline release)
if &gt;=1, then when finished the initial findContinuum trial, create a mom8fc image and
mom0fc image scaled by nchan and chanwidth in kms, and subtract them to create momDiff
image. If the momDiff image has sufficient signal remaining in it, then expand the
joint mask, and repeat the findContinuum process with this expanded mask as the
userJointMask;  if &gt;=2, and there is still sufficient signal in the new momDiff image from
the second run of findContinuum, then check if further analysis of the extra portion of the
mask is necessary. If so, first check if intersecting the ranges of the first two rounds
eliminates the excess, otherwise create a new spectrum from it and pass it into a third
round of findContinuum with this as the meanSpectrum file.  If &gt;=3, and there is stil
sufficient signal in the new momDiff, image then set sigmaFindContinuumMode=’autolower’
and sigmaFindContinuum=most recent value, and run another round of findContinuum.
If &gt;= 4, and and there is sufficient signal in the new momDiff, run another round
of autolower.</p>
</dd>
</dl>
</li>
<li><p>skipAmendMask: if True, then skip the test for amend mask, and move on to onlyExtraMask</p></li>
<li><dl class="simple">
<dt>skipCubeNoise: if True, then do not run cubeNoiseLevel, instead set MADCubeOutside to</dt><dd><p>DISABLE_CUBE_NOISE and the cubeMedian to zero</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tooManyPixels: value of pixels in mask beyond which amendMask will not</dt><dd><p>proceed, and causes result code ‘P#’</p>
</dd>
</dl>
</li>
<li><p>storeExtraMask: if True, the write the extraMask as a mask image (for debugging)</p></li>
<li><dl class="simple">
<dt>momDiffLevel: if amendMaskIterations&gt;0, sets the level above which pixels are counted.</dt><dd><p>For SingleContinuum 7m spws, the value is automatically incremented by 3.5. It is not
recommended to change this parameter, as it affects many heuristics. Change the next one.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>momDiffLevelForProceeding: if amendMaskIterations&gt;0, sets the level above pixels must be</dt><dd><p>in the mom8-mom0 image difference to be counted when determining whether to amend the mask.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>useAnnulus: if amendMaskIterations&gt;0, sets whether median/MAD in imageSNR be assessed in</dt><dd><p>annulus but outside the jointmask (True) or simply outside the joint mask (False)</p>
</dd>
</dl>
</li>
<li><p>subimage: if True, then add 0.2 to both radii of the annulus</p></li>
<li><p>enableOnlyExtraMask: if False, then do not do the extraMask or onlyExtraMask iterations</p></li>
<li><p>useMomentDiff: if False, use the mom8fc image to assess AmendMask decision instead of momDiff</p></li>
<li><dl class="simple">
<dt>checkIfMaskWouldHaveBeenAmended (new in PL2020): if True, then if amendMaskIterations=0,</dt><dd><p>then it will still check to see if the mask would have been amended and return the
result (assuming that returnSigmaFindContinuum==True) – for test purposes only</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>maxMadRatioForSFCAdjustment: one of the controls for lowering sigmaFindContinuum in</dt><dd><p>the .original amendMask iteration</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>maxMadRatioForSFCAdjustmentInLaterIterations: one of the controls for lowering</dt><dd><p>sigmaFindContinuum in amendMask iterations after the .original iteration</p>
</dd>
</dl>
</li>
</ul>
<ul>
<li><dl class="simple">
<dt>maxGroups: maximum number of continuum regions below which the potential reduction</dt><dd><p>factor of sigmaFindContinuum will be scaled by (1 - groups/maxGroups)**(bandwidth/1875e6)
via the following equation:</p>
</dd>
</dl>
<p>sFC_factor = np.max([scalingFactor/7.0, (1-groups/float(maxGroups)) ** (spwBandwidth/1.875e9)])</p>
</li>
</ul>
<ul class="simple">
<li><dl class="simple">
<dt>skyTempThreshold: rms value in Kelvin (for FDM spectra&lt;1000MHz), above which</dt><dd><p>the meanSpectrumMethod is changed in ‘auto’ mode to peakOverMad; and above
which normalizeByMAD is set True in meanSpectrumMethod=’mom0mom8jointMask’
when normalizeByMAD=’auto’ mode</p>
</dd>
</dl>
</li>
<li><p>tdmSkyTempThreshold: rms value in Kelvin (for TDM and 1875MHz FDM spectra)</p></li>
<li><dl class="simple">
<dt>skyTransmissionThreshold: threshold on (max-min)/mean, above which the</dt><dd><p>meanSpectrumMethod is changed in ‘auto’ mode to peakOverMad;  and above
which normalizeByMAD is set True in meanSpectrumMethod=’mom0mom8jointMask’
when normalizeByMAD=’auto’ mode</p>
</dd>
</dl>
</li>
<li><p>overwriteMoments: if True, then overwrite any existing moment0 or moment8 image</p></li>
<li><p>overwriteMasks: if True, then overwrite any existing moment0 or moment8 mask image</p></li>
<li><p>rmStatContQuadratic: if True, then fit and remove quadratic after removing outliers</p></li>
<li><dl class="simple">
<dt>outdir: directory to write the .mom0 and .mom8 images, .png, .dat and meanSpectrum</dt><dd><p>(default is same directory as the cube)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>avoidExtremaInNoiseCalcForJointMask (new in PL2020): experimental Boolean to avoid</dt><dd><p>pixels &lt;5%ile and &gt;95%ile in the chauvenet imstat of mom0 and mom8 images</p>
</dd>
</dl>
</li>
</ul>
<ul class="simple">
<li><dl class="simple">
<dt>triangleFraction: remove a triangle shape if the MAD of the dual-linfit residual</dt><dd><p>is less than this fraction*originalMAD; set this parameter to zero to turn it off.</p>
</dd>
</dl>
</li>
</ul>
<ul class="simple">
<li><p>maxMemory: behave as if the machine has this many GB of memory</p></li>
<li><dl class="simple">
<dt>nanBufferChannels: when removing or replacing NaNs, do this many extra channels</dt><dd><p>beyond their extent</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>channelFractionForSlopeRemoval: if this many channels are initially selected,</dt><dd><p>then fit and remove a linear slope and re-identify continuum channels
Set to 1 to turn off.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>quadraticFit: if True, fit quadratic polynomial to the noise regions when</dt><dd><p>deemed appropriate; Otherwise, fit only a linear slope</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>centralArcsec: radius of central box within which to compute the mean spectrum</dt><dd><p>default=’auto’ means start with whole field, then reduce to 1/10 if only
one window is found (unless mask is specified); or ‘fwhm’ for the central square
with the same radius as the PB FWHM; or a floating point value in arcseconds</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>mask: a mask image preferably equal in shape to the parent image that is used to determine</dt><dd><p>the region to compute the noise (outside the mask, i.e. mask=0) and
(in the ‘meanAboveThresholdMethod’) the mean spectrum (inside the mask, i.e. mask=1).
The spatial union of all masked pixels in all channels is used as the mask for each channel.
Option ‘auto’ will look for the &lt;filename&gt;.mask that matches the &lt;filename&gt;.image
and if it finds it, it will use it; otherwise it will use no mask.
If the mask does not match in shape but is multi-channel, it will be regridded to match
and written out as &lt;filename&gt;.mask.regrid.
If it matches spatially but is single-channel, this channel will be used for all.
To convert a .crtf file to a mask, use:
makemask(mode=’copy’, inpimage=img, inpmask=’chariklo.crtf’, output=img+’.mask’)</p>
</dd>
</dl>
</li>
<li><p>applyMaskToMask: if True, apply the mask inside the user mask image to set its masked pixels to 0</p></li>
</ul>
<ul class="simple">
<li><dl class="simple">
<dt>peakFilterFWHM: value (in pixels) to presmooth each plane with a Gaussian kernel of</dt><dd><p>this width.  Set to 1 to not do any smoothing.
Default = 10 which is typically about 2 synthesized beams.</p>
</dd>
</dl>
</li>
</ul>
<ul>
<li><dl class="simple">
<dt>useAbsoluteValue: passed to meanSpectrum, then avgOverCube – take absolute value of</dt><dd><p>the cube before producing mean spectrum</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>useThresholdWithMask: if False, then just take mean rather than meanAboveThreshold</dt><dd><p>when a mask has been specified</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>useIAGetProfile: if True, then for baselineMode=’min’, use ia.getprofile instead of</dt><dd><p>ia.getregion and subsequent arithmetic (faster, less memory exhaustive)</p>
</dd>
</dl>
</li>
<li><p>continuumThreshold: if specified, begin by using only pixels above this intensity level</p></li>
<li><dl class="simple">
<dt>sigmaCube: multiply this value by the MAD to get the threshold above</dt><dd><p>which a voxel is included in the mean spectrum.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>baselineModeA: ‘min’ or ‘edge’, method to define the baseline in meanSpectrum()</dt><dd><ul class="simple">
<li><p>percentile: control parameter for ‘min’</p></li>
</ul>
<p>Parameters relevant to ‘edge’:
* nBaselineChannels: if integer, then the number of channels to use in:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>computing the mean spectrum with the ‘meanAboveThreshold’ methods.</p></li>
<li><p>computing the MAD of the lowest/highest channels in findContinuumChannels
if float, then the fraction of channels to use (i.e. the percentile)
default = 0.19, which is 24 channels (i.e. 12 on each side) of a TDM window</p></li>
</ol>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
<ul class="simple">
<li><dl class="simple">
<dt>keepIntermediatePngs: if True, keep changing the png name to avoid overwriting them; only</dt><dd><p>the final one is returned</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>thresholdForSame: fractional value used to determine if the residual in the mom8fc image</dt><dd><p>improved (‘L’), worsened (‘H’) or stayed the same (‘S’)</p>
</dd>
</dl>
</li>
<li><p>cubeSigmaThreshold: minimum cube SNR for onlyExtraMask to trigger</p></li>
<li><p>npixThreshold: minimum momDiff pixels for onlyExtraMask to trigger</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="parameters-for-function-findcontinuumchannels-which-is-called-by-all-meanspectrum-heuristics">
<h3>Parameters for function findContinuumChannels (which is called by all meanSpectrum heuristics):<a class="headerlink" href="#parameters-for-function-findcontinuumchannels-which-is-called-by-all-meanspectrum-heuristics" title="Link to this heading"></a></h3>
<dl>
<dt>baselineModeB: ‘min’ (default) or ‘edge’, method to define the baseline</dt><dd><p>Parameters only relevant if baselineModeB=’min’:
* dropBaselineChannels: percentage of extreme values to drop
* removeOutlierBaselineChannels: after dropBaselineChannels, remove &gt;4*scMAD</p>
<blockquote>
<div><p>outliers;  options: ‘high’, ‘low’, ‘both’, or ‘’ == none/False</p>
</div></blockquote>
</dd>
<dt>useBaseline: ‘low’, ‘middle’, ‘high’ or ‘auto’; auto tries to automatically pick ‘low’ for</dt><dd><p>spectra that are emission-line dominated, ‘high’ if absorption line dominated, or ‘both’ if
both types of lines are present</p>
</dd>
<dt>nBaselineChannels: if integer, then the number of channels to use in computing</dt><dd><p>standard deviation/MAD of the baseline channels (i.e. the blue points in the plot)
if float, then it is the fraction of channels to use (i.e. the percentile)</p>
</dd>
<dt>sigmaFindContinuum: starting value for sigmaFindContinuum; passed to findContinuumChannels,</dt><dd><p>‘auto’ starts with value:
TDM: singleContinuum: 9, meanAboveThreshold: 4.5, peakOverMAD: 6.5,</p>
<blockquote>
<div><p>mom0mom8jointMask: 7.2</p>
</div></blockquote>
<dl class="simple">
<dt>FDM: meanAboveThreshold: 3.5, peakOverMAD: 6.0,</dt><dd><dl class="simple">
<dt>mom0mom8jointMask: nchan&lt;750: 4.2 (strong lines) or 4.5 (weak lines)</dt><dd><p>nchan&gt;=759: 2.5 (strong lines) or 3.2 (weak lines)</p>
</dd>
</dl>
</dd>
</dl>
<p>and adjusts it depending on results</p>
</dd>
</dl>
<p>sigmaFindContinuumMode (new in PL2020): ‘auto’, ‘autolower’, ‘fixed’
trimChannels: after doing best job of finding continuum, remove this many</p>
<blockquote>
<div><p>channels from each edge of each block of channels found (for margin of safety)
If it is a float between 0..1, then trim this fraction of channels in each
group (rounding up). If it is ‘auto’ (default), use 0.1 but not more than
maxTrim channels, and not more than maxTrimFraction</p>
</div></blockquote>
<dl>
<dt>narrow: the minimum number of channels that a group of channels must have to survive</dt><dd><dl class="simple">
<dt>if 0&lt;narrow&lt;1, then it is interpreted as the fraction of all</dt><dd><p>channels within identified blocks</p>
</dd>
</dl>
<p>if ‘auto’, then use int(ceil(log10(nchan)))</p>
</dd>
<dt>maxTrim: in trimChannels=’auto’, this is the max channels to trim per group for</dt><dd><p>TDM spws; it is automatically scaled upward for FDM spws.</p>
</dd>
</dl>
<p>maxTrimFraction: in trimChannels=’auto’, the max fraction of channels to trim per group
singleContinuum: if True, treat the cube as having come from a Single_Continuum setup;</p>
<blockquote>
<div><p>For testing purpose, if None, then check the contents of vis (if specified).</p>
</div></blockquote>
<dl class="simple">
<dt>negativeThresholdFactor: scale the nominal negative threshold by this factor (to</dt><dd><p>adjust the sensitivity to absorption features: smaller values=more sensitive)</p>
</dd>
<dt>signalRatioTier1: threshold for signalRatio, above which we desensitize the level to</dt><dd><p>consider line emission in order to avoid small differences in noise levels from
affecting the result (e.g. that occur between serial and parallel tclean cubes)
signalRatio=1 means: no lines seen, while closer to zero: more lines seen</p>
</dd>
<dt>enableRejectNarrowInnerWindows (new in PL2020): if True, then remove any inner groups</dt><dd><p>of channels that are narrower than both edge windows (when there are 3-15 groups)</p>
</dd>
</dl>
</section>
<section id="general-parameters">
<h3>General parameters:<a class="headerlink" href="#general-parameters" title="Link to this heading"></a></h3>
<p>verbose: if True, then print additional information during processing
useUncorrectedMedian: if True, then do not adjust the median (solid black line) upward</p>
<blockquote>
<div><p>from the median of the baseline points (dashed blue line)</p>
</div></blockquote>
<dl class="simple">
<dt>returnBluePoints: if True, then simply set the continuum ranges to the baseline points</dt><dd><p>(i.e. the blue points) inside each run of findContinuumChannels().  If using
mom0mom8jointMask with amendMask option, then also stop after amendMask (and
automatically disable the onlyExtraMask step, even if enableOnlyExtraMask=True)</p>
</dd>
<dt>momentdir (new in PL2020): alternative directory to look for (and write) the</dt><dd><p>moment 0&amp;8 images</p>
</dd>
</dl>
<p>png: the name of the png to produce (’’ yields default name)
pngBasename: if True, then remove the directory from img name before generating png name
source: the name of the source, to be shown in the title of the spectrum.</p>
<blockquote>
<div><p>if None, then use imhead(‘object’)</p>
</div></blockquote>
<dl>
<dt>overwrite: if True, or ASCII file does not exist, then recalculate the mean spectrum</dt><dd><blockquote>
<div><p>writing it to &lt;img&gt;.meanSpectrum</p>
</div></blockquote>
<p>if False, then read the mean spectrum from the existing ASCII file</p>
</dd>
</dl>
<p>separator: the character to use to separate groups of channels in the string returned
titleText: default is img name and transition and the control parameter values
plotAtmosphere: ‘’, ‘tsky’, or ‘transmission’
airmass: for plot of atmospheric transmission
skipchan (newly-exposed in PL2020): used in making the spectral plot, the number of highest</p>
<blockquote>
<div><p>and lowest intensity channels to avoid when constructing the y-axis range</p>
</div></blockquote>
<p>pwv: in mm (for plot of atmospheric transmission)
vis: comma-delimited list or python list of measurement sets to use to convert channel</p>
<blockquote>
<div><p>ranges to topocentric frequency ranges (for use in uvcontfit or uvcontsub)
or ‘auto’ which will look for any/all vis in the cube directory</p>
</div></blockquote>
<p>plotBaselinePoints: if True, then plot the baseline-defining points as black dots
fontsize (newly-exposed in PL2020): size to use for channel ranges, axis labels and plot legend
dpi: dots per inch to use in writing the png (106 produces 861x649 pixels)</p>
<blockquote>
<div><p>150 produces 1218x918</p>
</div></blockquote>
<dl class="simple">
<dt>projectCode: a string to prepend to the title of the plot (useful for regression testing</dt><dd><p>where you can put the page number from the full PDF when running only a subset)</p>
</dd>
<dt>buildMom8fc (new in PL2020): if True, then when finished, generate “mom8fc” and “mom0fc”</dt><dd><p>images using selected channels</p>
</dd>
</dl>
<p>smallBandwidthFraction: threshold for returning a warning for too little bandwidth found
smallSpreadFraction: threshold for returning a warning for too little bandwidth spread found
telescope: name of telescope to use (if no image is passed from which to</p>
<blockquote>
<div><p>read it from the header)</p>
</div></blockquote>
<p>window: the smoothing window to apply to the mean spectrum (when nbin&gt;4)
mom08simultaneous: if True, set moments=[0,8] in one call to immoments instead of two</p>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.findContinuumChannels">
<span class="sig-name descname"><span class="pre">findContinuumChannels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselineMode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'min'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trimChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">narrow</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrimFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakOverMad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitResult</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxGroupsForMaxTrimAdjustment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lowHighBaselineThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lineSNRThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negativeThresholdFactor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">madRatioUpperLimit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">madRatioLowerLimit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projectCode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fCCiteration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signalRatioTier1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.965</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signalRatioTier2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.94</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuumMode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enableRejectNarrowInnerWindows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useUncorrectedMedian</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnBluePoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">removeOutlierBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amendMaskIterationName</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useBaseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#findContinuumChannels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.findContinuumChannels" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Trys to find continuum channels in a spectrum, based on a threshold or
some number of edge channels and their median and standard deviation.
Inputs:
spectrum: a one-dimensional array of intensity values
nBaselineChannels: number of channels over which to compute standard deviation/MAD
sigmaFindContinuum: value to multiply the standard deviation by then add</p>
<blockquote>
<div><p>to median to get threshold.  Default = 3.</p>
</div></blockquote>
<dl class="simple">
<dt>narrow: the minimum number of channels in a contiguous block to accept</dt><dd><dl class="simple">
<dt>if 0&lt;narrow&lt;1, then it is interpreted as the fraction of all</dt><dd><p>channels within identified blocks</p>
</dd>
</dl>
</dd>
</dl>
<p>nanmin: the value that NaNs were replaced by in previous steps
baselineMode: ‘min’ or ‘edge’,  ‘edge’ will use nBaselineChannels/2 from each edge
trimChannels: if integer, use that number of channels.  If float between</p>
<blockquote>
<div><p>0 and 1, then use that fraction of channels in each contiguous list
(rounding up). If ‘auto’, then use 0.1 but not more than maxTrim channels.
The ‘auto’ mode can also cause trimChannels to be set to 13 or 6 in certain
circumstances (when moderately strong lines are present).</p>
</div></blockquote>
<p>maxTrim: if trimChannels=’auto’, this is the max channels to trim per group for TDM spws; it is automatically scaled upward for FDM spws.
maxTrimFraction: in trimChannels=’auto’, the max fraction of channels to trim per group
separator: the character to use to separate groups of channels in the string returned
negativeThresholdFactor: scale the nominal negative threshold by this factor (to adjust</p>
<blockquote>
<div><p>sensitivity to absorption features: smaller values=more sensitive)</p>
</div></blockquote>
<p>dropBaselineChannels: percentage of extreme values to drop in baseline mode ‘min’
madRatioUpperLimit, madRatioLowerLimit: if ratio of MADs (MAD of all baseline channels /</p>
<blockquote>
<div><p>MAD of baseline channels with extreme channels dropped) is between these values, then
apply dropBaselineChannels when defining the MAD of the baseline range</p>
</div></blockquote>
<dl class="simple">
<dt>fitResult: coefficients from linear or quadratic fit, only relevant when meanSpectrumMethod is</dt><dd><p>not ‘mom0mom8jointMask’</p>
</dd>
<dt>signalRatioTier1: threshold for signalRatio, above which we desensitize the level to</dt><dd><p>consider line emission in order to avoid small differences in noise levels from
affecting the result (e.g. that occur between serial and parallel tclean cubes)
signalRatio=1 means: no lines seen, while closer to zero: more lines seen</p>
</dd>
<dt>signalRatioTier2: second threshold for signalRatio, used for FDM spws (nchan&gt;192) and</dt><dd><p>for cases of peakOverMad &lt; 5.  Should be &lt; signalRatioTier1.</p>
</dd>
</dl>
<p>sigmaFindContinuumMode: if ‘auto’, then do not desensitize with signalRatioTier1
removeOutlierBaselineChannels: after dropBaselineChannels, remove &gt;4*scMAD</p>
<blockquote>
<div><p>outliers;  options: ‘high’, ‘low’, ‘both’/True, or ‘’ which means none/False</p>
</div></blockquote>
<dl class="simple">
<dt>returnBluePoints: if True, then simply set the continuum ranges to the baseline points</dt><dd><p>(i.e. the blue points) instead of what the other heuristics might have found</p>
</dd>
<dt>useBaseline: ‘low’, ‘middle’, ‘high’ or ‘auto’; auto tries to automatically pick ‘low’ for</dt><dd><p>spectra that are emission-line dominated, ‘high’ if absorption line dominated, or ‘both’ if
both types of lines are present</p>
</dd>
</dl>
<p>Returns:
1  list of channels to use (separated by the specified separator)
2  list converted to ms channel selection syntax
3  positive threshold used
4  median of the baseline-defining channels
5  number of groups found
6  correctionFactor used
7  inferred true median
8  scaled MAD of the baseline-defining channels
9  correction factor applied to get the inferred true median
10 negative threshold used
11 lineStrength factor
12 singleChannelPeaksAboveSFC: how many cases where only a single channel exceeds the threshold
13 allGroupsAboveSFC
14 spectralDiff (percentage of median)
15 value of trimChannels parameter
16 Boolean describing whether the low values were used as the baseline
17 value of the narrow parameter
18 tuple containing the channel numbers of the baseline channels, and their respective y-axis values
19 value of madRatio: MAD/MAD_after_dropping_extreme_channels</p>
<blockquote>
<div><p>This value will be larger if there are many tall single channel peaks.</p>
</div></blockquote>
<p>20 number of ranges it dropped (or would have dropped if it was enabled)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.findOuterAnnulusForPBCube">
<span class="sig-name descname"><span class="pre">findOuterAnnulusForPBCube</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pbcube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imstatListit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imstatVerbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#findOuterAnnulusForPBCube"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.findOuterAnnulusForPBCube" title="Link to this definition"></a></dt>
<dd><p>Given a PB cube, finds the minimum sensitivity value, then computes the
corresponding higher value to form an annulus.  Returns 0.2-0.3 for normal
images that have not been mitigated.  The factor of 1.15 below will
effectively mimic a corresponding higher range.  For example:
CASA &lt;247&gt;: au.gaussianBeamResponse(au.gaussianBeamOffset(0.5)/1.15, fwhm=1)
Out[247]: 0.59207684245045789
CASA &lt;248&gt;: au.gaussianBeamResponse(au.gaussianBeamOffset(0.8)/1.15, fwhm=1)
Out[248]: 0.8447381483786558
subimage: if True, then add 0.2 to both radii of the annulus</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.findSpectralAxis">
<span class="sig-name descname"><span class="pre">findSpectralAxis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#findSpectralAxis"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.findSpectralAxis" title="Link to this definition"></a></dt>
<dd><p>This function is called by computeStatisticalSpectrumFromMask, getImageInfo,
findContinuum and numberOfChannelsInCube.
Finds the spectral axis number of an image tool instance, or an image.
img: string or iatool instance</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.findWidestContiguousListInChannelRange">
<span class="sig-name descname"><span class="pre">findWidestContiguousListInChannelRange</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelRange</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuumChannels</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#findWidestContiguousListInChannelRange"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.findWidestContiguousListInChannelRange" title="Link to this definition"></a></dt>
<dd><p>Given a list of channels, find the longest contiguous list in the first half or second half
example:
CASA &lt;43&gt;: fc.findWidestContiguousListInChannelRange([2,3,7,8,9,12,13,14,15], [10,20], [7,8,9])
Out[43]: [12, 13, 14, 15]
channels: list of blue points channel numbers
channelRange: range of channels to look for widest set of blue points
continuumChannels: current selection of continuuum channels
Returns: a list of contiguous channels</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.findWidestContiguousListInOtherHalf">
<span class="sig-name descname"><span class="pre">findWidestContiguousListInOtherHalf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lowerHalf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#findWidestContiguousListInOtherHalf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.findWidestContiguousListInOtherHalf" title="Link to this definition"></a></dt>
<dd><p>Given a list of channels, find the longest contiguous list in the first half or second half
example:
CASA &lt;43&gt;: fc.findWidestContiguousListInOtherHalf([2,3,7,8,9,12,13,14,15], True, 20)
Out[43]: [12, 13, 14, 15]
channels: list of blue points channel numbers
lowerHalf: a Boolean (True for lower half, False for upper half)
nchan: total channels in spectrum</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.flattenMask">
<span class="sig-name descname"><span class="pre">flattenMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#flattenMask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.flattenMask" title="Link to this definition"></a></dt>
<dd><p>Takes a multi-channel CASA image mask and propagates all pixels to a
new single plane image mask
outfile: default name = &lt;mask&gt;.flattened
- Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.frames">
<span class="sig-name descname"><span class="pre">frames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">velocity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">286.7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datestring</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'2005/11/01/00:00:00'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'05:35:28.105'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'-069.16.10.99'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equinox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'J2000'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observatory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALMA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myme</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myqa</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">restFreq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">345.79599</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">veltype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'optical'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#frames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.frames" title="Link to this definition"></a></dt>
<dd><p>This function is called by restToTopo.
Converts an optical velocity into barycentric, LSRK and TOPO frames.
Converts a radio LSRK velocity into TOPO frame.
Inputs:
velocity: in km/s
datestring:  “YYYY/MM/DD/HH:MM:SS”
ra: “05:35:28.105”
dec: “-069.16.10.99”
equinox: “J2000”
observatory: “ALMA”
prec: precision to display (digits to the right of the decimal point)
veltype: ‘radio’ or ‘optical’
restFreq: in Hz, GHz or a string with units
Returns:
* TOPO frequency in Hz
* difference between LSRK-TOPO in km/sec
* difference between LSRK-TOPO in Hz</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.gatherWarnings">
<span class="sig-name descname"><span class="pre">gatherWarnings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smallBandwidthFraction</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smallSpreadFraction</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#gatherWarnings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.gatherWarnings" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
Return list of warning strings (often empty).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.gauss_kern">
<span class="sig-name descname"><span class="pre">gauss_kern</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#gauss_kern"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.gauss_kern" title="Link to this definition"></a></dt>
<dd><p>Returns a normalized 2D gauss kernel array for convolutions.  Used by smooth.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.gaussianBeamOffset">
<span class="sig-name descname"><span class="pre">gaussianBeamOffset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">response</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#gaussianBeamOffset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.gaussianBeamOffset" title="Link to this definition"></a></dt>
<dd><p>++++ This function is used by pipeline in computeStatisticalSpectrumFromMask().
Computes the radius at which the response of a Gaussian
beam drops to the specified level.  For the inverse
function, see gaussianBeamResponse.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.gaussianBeamResponse">
<span class="sig-name descname"><span class="pre">gaussianBeamResponse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#gaussianBeamResponse"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.gaussianBeamResponse" title="Link to this definition"></a></dt>
<dd><p>++++ This function is used by pipeline in computeStatisticalSpectrumFromMask().
Computes the gain at the specified radial offset from the center
of a Gaussian beam. For the inverse function, see gaussianBeamOffset.
Required inputs:
radius: in arcseconds
fwhm: in arcseconds</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getDateObs">
<span class="sig-name descname"><span class="pre">getDateObs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myia</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getDateObs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getDateObs" title="Link to this definition"></a></dt>
<dd><p>This function is called by cubeFrameToTopo.
Returns string of format: ‘2014/05/22/08:47:05’ suitable for lsrkToTopo</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getEquinox">
<span class="sig-name descname"><span class="pre">getEquinox</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myia</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getEquinox"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getEquinox" title="Link to this definition"></a></dt>
<dd><p>This function is called by cubeFrameToTopo.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getFieldnameFromPipelineImageName">
<span class="sig-name descname"><span class="pre">getFieldnameFromPipelineImageName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getFieldnameFromPipelineImageName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getFieldnameFromPipelineImageName" title="Link to this definition"></a></dt>
<dd><p>Extracts the field name from the pipeline image file name.
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getFreqType">
<span class="sig-name descname"><span class="pre">getFreqType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getFreqType"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getFreqType" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum and cubeFrameToTopo.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getImageInfo">
<span class="sig-name descname"><span class="pre">getImageInfo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnBeamAreaPerChannel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getImageInfo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getImageInfo" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum and meanSpectrum.
Extract the beam and pixel information from a CASA image.
This was copied from getFitsBeam in analysisUtils.py.
Returns: A list of 12 things: bmaj, bmin, bpa, cdelt1, cdelt2,</p>
<blockquote>
<div><blockquote>
<div><p>naxis1, naxis2, frequency, shape, crval1, crval2, maxBaseline,
telescope name</p>
</div></blockquote>
<p>Beam angles are in arcseconds (bpa in degrees), crvals are in radians
Frequency is in GHz and is the central frequency
MaxBaseline is in meters, inferred from freq and beamsize (will be zero for .residual images)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getMaxpixpos">
<span class="sig-name descname"><span class="pre">getMaxpixpos</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getMaxpixpos"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getMaxpixpos" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum, but only in Cycle 4+5 heuristic.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getMemorySize">
<span class="sig-name descname"><span class="pre">getMemorySize</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getMemorySize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getMemorySize" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum and runFindContinuum.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getObservationStart">
<span class="sig-name descname"><span class="pre">getObservationStart</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obsid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getObservationStart"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getObservationStart" title="Link to this definition"></a></dt>
<dd><p>Reads the start time of the observation from the OBSERVATION table (using tb tool)
and reports it in MJD seconds.
obsid: if -1, return the start time of the earliest obsID
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getObservationStartDate">
<span class="sig-name descname"><span class="pre">getObservationStartDate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obsid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'-'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">measuresToolFormat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getObservationStartDate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getObservationStartDate" title="Link to this definition"></a></dt>
<dd><p>Uses the tb tool to read the start time of the observation and reports the date.
See also getObservationStartDay.
Returns: ‘2013-01-31 07:36:01 UT’
measuresToolFormat: if True, then return ‘2013/01/31/07:36:01’, suitable for lsrkToTopo
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getObservatoryName">
<span class="sig-name descname"><span class="pre">getObservatoryName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getObservatoryName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getObservatoryName" title="Link to this definition"></a></dt>
<dd><p>+++++++ This function is not used by pipeline, because it is only used by getScienceSpws.
Returns the observatory name in the specified ms.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getScienceSpwBandwidths">
<span class="sig-name descname"><span class="pre">getScienceSpwBandwidths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OBSERVE_TARGET#ON_SOURCE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sqld</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnDict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnMHz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getScienceSpwBandwidths"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getScienceSpwBandwidths" title="Link to this definition"></a></dt>
<dd><p>Returns: an array of bandwidths (in Hz) in order sorted by spw ID
returnDict: if True, then return a dictionary keyed by spw ID
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getScienceSpws">
<span class="sig-name descname"><span class="pre">getScienceSpws</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OBSERVE_TARGET#ON_SOURCE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnString</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnListOfStrings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sqld</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnFreqRanges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getScienceSpws"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getScienceSpws" title="Link to this definition"></a></dt>
<dd><p>Return a list of spws with the specified intent.  For ALMA data,
it ignores channel-averaged and SQLD spws.
intent: either full intent name including #subIntent, or an abbreviated key, like ‘PHASE’
returnString: if True, return ‘1,2,3’</p>
<blockquote>
<div><p>if False, return [1,2,3]</p>
</div></blockquote>
<dl class="simple">
<dt>returnListOfStrings: if True, return [‘1’,’2’,’3’]  (amenable to tclean spw parameter)</dt><dd><p>if False, return [1,2,3]</p>
</dd>
<dt>returnFreqRanges: if True, returns a dictionary keyed by spw ID, with values</dt><dd><p>equal to the frequency of the middle of the min and max channel (Hz)</p>
</dd>
</dl>
<p>– Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getScienceSpwsForFrequency">
<span class="sig-name descname"><span class="pre">getScienceSpwsForFrequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nearestOnly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getScienceSpwsForFrequency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getScienceSpwsForFrequency" title="Link to this definition"></a></dt>
<dd><p>Returns a list of science spws that cover a given frequency.
vis: name of measurement set
frequency: in Hz, GHz, or a string with units
nearestOnly: if True, the return only one spw (nearest to center)
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getSpwFromPipelineImageName">
<span class="sig-name descname"><span class="pre">getSpwFromPipelineImageName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getSpwFromPipelineImageName"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getSpwFromPipelineImageName" title="Link to this definition"></a></dt>
<dd><p>Extracts the spw ID from the pipeline image file name.
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getTelescope">
<span class="sig-name descname"><span class="pre">getTelescope</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myia</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getTelescope"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getTelescope" title="Link to this definition"></a></dt>
<dd><p>This function is called by CalcAtmTransmissionForImage and cubeFrameToTopo.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.getcube">
<span class="sig-name descname"><span class="pre">getcube</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cubelist.txt'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#getcube"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.getcube" title="Link to this definition"></a></dt>
<dd><p>++++ This function is not used by pipeline.
Translates a PDF page number to a cube name, for regression purposes,
by reading the specified file.
filename: a file containing 2-column lines like:  ‘1 mycube.residual’</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.grep">
<span class="sig-name descname"><span class="pre">grep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#grep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.grep" title="Link to this definition"></a></dt>
<dd><p>This function is called only by maskArgumentMismatch and centralArcsecArgumentMismatch.
Runs grep for string &lt;arg&gt; in a subprocess and reports stdout and stderr.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.help">
<span class="sig-name descname"><span class="pre">help</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">match</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#help"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.help" title="Link to this definition"></a></dt>
<dd><p>Print an alphabetized list of all the defined functions at the top level in
this python file.
match: limit the list to those functions containing this string (case insensitive)
– Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.imageChannelFrequency">
<span class="sig-name descname"><span class="pre">imageChannelFrequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myia</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#imageChannelFrequency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.imageChannelFrequency" title="Link to this definition"></a></dt>
<dd><p>Returns the frequency (in GHz) of the specified channel of any CASA or FITS
image cube with a spectral axis.
channel: can be a scalar or a list/vector, if None then return list for all channels,</p>
<blockquote>
<div><p>if -1 then return the final channel</p>
</div></blockquote>
<p>Returns: value in GHz; scalar (if one channel) or array (if more than 1 channel)
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.imagePercentileNoMask">
<span class="sig-name descname"><span class="pre">imagePercentileNoMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentiles</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#imagePercentileNoMask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.imagePercentileNoMask" title="Link to this definition"></a></dt>
<dd><p>percentiles: a single value or a list
Returns: a single value or a list</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.imageSNR">
<span class="sig-name descname"><span class="pre">imageSNR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maskWithAnnulus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAnnulus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">applyMaskToAll</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnAllStats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usepb</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chans</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#imageSNR"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.imageSNR" title="Link to this definition"></a></dt>
<dd><p>Uses imstat (which automatically applies the internal mask, i.e avoids the
black edges of the image) to compute (max-median)/scaledMAD
axes: passed to imstat (use [0,1,2] to get a vector SNR per channel)
img: a 2D image or a cube
mask: additional mask image (or expression) to apply when computing everything but max
maskWithAnnulus: additional mask image (or expression) to use for median and MAD</p>
<blockquote>
<div><p>if useAnnulus==True (but always take the smaller of the 2 possible MADs)</p>
</div></blockquote>
<p>applyMaskToAll: also apply the provided mask when computing the max (default=False=anywhere)
returnAllStats: if True, then also return the peak, median and scaledMAD where the</p>
<blockquote>
<div><p>peak has <em>not</em> had the median subtracted (in contrast to the SNR)</p>
</div></blockquote>
<p>usepb: (optional) name of a single-plane pb image to include in the mask (at &gt;0.23 level)
-ToddHunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.imageSNRAnnulus">
<span class="sig-name descname"><span class="pre">imageSNRAnnulus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mymomDiff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMaskTest</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMaskTestWithAnnulus</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">applyMaskToAll</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#imageSNRAnnulus"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.imageSNRAnnulus" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.intersectChannelSelections">
<span class="sig-name descname"><span class="pre">intersectChannelSelections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#intersectChannelSelections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.intersectChannelSelections" title="Link to this definition"></a></dt>
<dd><p>Take the intersection of two ranges.
e.g. ‘3~8;10~11’, ‘5~9’  -&gt;  ‘5~8’</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.invertChannelRanges">
<span class="sig-name descname"><span class="pre">invertChannelRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">invertstring</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">startchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#invertChannelRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.invertChannelRanges" title="Link to this definition"></a></dt>
<dd><p>Takes a CASA channel selection string and inverts it.
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.isSingleContinuum">
<span class="sig-name descname"><span class="pre">isSingleContinuum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OBSERVE_TARGET'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#isSingleContinuum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.isSingleContinuum" title="Link to this definition"></a></dt>
<dd><p>+++++++ This function is not used by pipeline, rather it is an expected input parameter.
Checks whether an spw was defined as single continuum in the OT by
looking at the transition name in the SOURCE table of a measurement set.
vis: a single measurement set, a comma-delimited list, or a python list</p>
<blockquote>
<div><p>(only the first one will be used)</p>
</div></blockquote>
<p>Optional parameters:
spw: can be integer ID or string integer ID; if not specified, then it</p>
<blockquote>
<div><p>will use the first science spw</p>
</div></blockquote>
<p>source: passed to transitions(); if not specified, it will use the first one
intent: if source is blank then use first one with matching intent and spw
mymsmd: an existing instance of the msmd tool</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.is_binary">
<span class="sig-name descname"><span class="pre">is_binary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#is_binary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.is_binary" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Return true if the given filename appears to be binary.
Works in python 2.7 and 3</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.linfit">
<span class="sig-name descname"><span class="pre">linfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yerror</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pinit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">0]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#linfit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.linfit" title="Link to this definition"></a></dt>
<dd><p>This function is called by atmosphereVariation in Cycle 4+5+6 and by
runFindContinuum in Cycle 4+5.
Basic linear function fitter with error bars in y-axis data points.
Uses scipy.optimize.leastsq().  Accepts either lists or arrays.
.. rubric:: Example</p>
<p>lf = au.linfit()
lf.linfit(x, y, yerror, pinit)</p>
<dl class="simple">
<dt>Input:</dt><dd><p>x, y: x and y axis values
yerror: uncertainty in the y-axis values (vector or scalar)
pinit contains the initial guess of [slope, intercept]</p>
</dd>
<dt>Output:</dt><dd><p>The fit result as: [slope, y-intercept]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.locatePBCube">
<span class="sig-name descname"><span class="pre">locatePBCube</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cube</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#locatePBCube"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.locatePBCube" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.lsrkToRest">
<span class="sig-name descname"><span class="pre">lsrkToRest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lsrkFrequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">velocityLSRK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datestring</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equinox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'J2000'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observatory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALMA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#lsrkToRest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.lsrkToRest" title="Link to this definition"></a></dt>
<dd><p>This function is called by lsrkToTopo.
Converts an LSRK frequency, LSRK velocity, and observing date/direction
to the corresponding frequency in the rest frame.
Inputs:
lsrkFrequency: floating point value in Hz or GHz, or a string with units
velocityLSRK: floating point value in km/s
datestring:  “YYYY/MM/DD/HH:MM:SS” (format = image header keyword ‘date-obs’)
ra: string “HH:MM:SS.SSSS”
dec: string “DD.MM.SS.SSSS” or “DD:MM:SS.SSSS” (colons will be replaced with .)
prec: only used to display the value when verbose=True
Returns: the Rest frequency in Hz</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.lsrkToTopo">
<span class="sig-name descname"><span class="pre">lsrkToTopo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lsrkFrequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datestring</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equinox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'J2000'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observatory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALMA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#lsrkToTopo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.lsrkToTopo" title="Link to this definition"></a></dt>
<dd><p>This function is called by cubeFrameToTopo.
Converts an LSRKfrequency and observing date/direction
to the corresponding frequency in the TOPO frame.
Inputs:
lsrkFrequency: floating point value in Hz or GHz, or a string with units
datestring:  “YYYY/MM/DD/HH:MM:SS” (format = image header keyword ‘date-obs’)
ra: string “HH:MM:SS.SSSS”
dec: string “DD.MM.SS.SSSS” or “DD:MM:SS.SSSS” (colons will be replaced with .)
prec: only used to display the value when verbose=True
Returns: the TOPO frequency in Hz</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.makeUvcontsub">
<span class="sig-name descname"><span class="pre">makeUvcontsub</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'*.dat'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitorder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useFrequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#makeUvcontsub"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.makeUvcontsub" title="Link to this definition"></a></dt>
<dd><p>+++++++ This function is not used anywhere else in this file.
Takes a list of output files from findContinuum and builds an spw selection
for uvcontsub, then prints the resulting commands to the screen.
files: a list of files, either a comma-delimited string, a python list, or a wildcard string
fitorder: passed through to the uvcontsub
useFrequency: if True, then produce selection string in frequency; otherwise use channels</p>
<blockquote>
<div><p>Note: frequencies in the findContinuum .dat file are topo, which is what uvcontsub wants.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.maskArgumentMismatch">
<span class="sig-name descname"><span class="pre">maskArgumentMismatch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useThresholdWithMask</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#maskArgumentMismatch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.maskArgumentMismatch" title="Link to this definition"></a></dt>
<dd><p>This function is called by checkForMismatch.
Determines if the requested mask does not match what was used to generate
the specified meanSpectrumFile.
Returns: True or False</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.maxLengthOfLists">
<span class="sig-name descname"><span class="pre">maxLengthOfLists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lists</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#maxLengthOfLists"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.maxLengthOfLists" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
lists: a list if lists
Returns: an integer that is the length of the longest list</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.meanSpectrum">
<span class="sig-name descname"><span class="pre">meanSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaCube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanBufferChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAbsoluteValue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselineMode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'edge'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuumThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centralArcsec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumMethod</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'peakOverRms'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakFilterFWHM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">applyMaskToMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useIAGetProfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useThresholdWithMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#meanSpectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.meanSpectrum" title="Link to this definition"></a></dt>
<dd><p>This function is not used by Cycle 6 pipeline, but remains as a manual user
option. Computes a threshold and then uses it to compute the average
spectrum across a CASA image cube, via the specified method.
Inputs:
nBaselineChannels: number of channels to use as the baseline in</p>
<blockquote>
<div><p>the ‘meanAboveThreshold’ methods.</p>
</div></blockquote>
<dl class="simple">
<dt>baselineMode: how to select the channels to use as the baseline:</dt><dd><dl class="simple">
<dt>‘edge’: use an equal number of channels on each edge of the spw</dt><dd><p>‘min’: use the percentile channels with the lowest absolute intensity</p>
</dd>
</dl>
</dd>
<dt>sigmaCube: multiply this value by the rms to get the threshold above which a pixel</dt><dd><p>is included in the mean spectrum</p>
</dd>
<dt>nanBufferChannels: when removing or replacing NaNs, do this many extra channels</dt><dd><p>beyond their actual extent</p>
</dd>
</dl>
<p>useAbsoluteValue: passed to avgOverCube
percentile: used with baselineMode=’min’
continuumThreshold: if specified, only use pixels above this intensity level
meanSpectrumFile: name of ASCII file to produce to speed up future runs
centralArcsec: default=-1 means whole field, or a floating point value in arcsec
mask: a mask image (e.g. from clean); restrict calculations to pixels with mask=1
chanInfo: the list returned by numberOfChannelsInCube
meanSpectrumMethod: ‘peakOverMad’, ‘peakOverRms’, ‘meanAboveThreshold’,</p>
<blockquote>
<div><p>‘meanAboveThresholdOverRms’, or ‘meanAboveThresholdOverMad’</p>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>‘meanAboveThreshold’: uses a selection of baseline channels to compute the</dt><dd><p>rms to be used as a threshold value (similar to constructing a moment map).</p>
</dd>
</dl>
</li>
<li><p>‘meanAboveThresholdOverRms/Mad’: scale spectrum by RMS or MAD</p></li>
<li><dl class="simple">
<dt>‘peakOverRms/Mad’ computes the ratio of the peak in a spatially-smoothed</dt><dd><p>version of cube to the RMS or MAD.  Smoothing is set by peakFilterFWHM.</p>
</dd>
</dl>
</li>
</ul>
<dl class="simple">
<dt>peakFilterFWHM: value used by ‘peakOverRms’ and ‘peakOverMad’ to presmooth</dt><dd><p>each plane with a Gaussian kernel of this width (in pixels)
Set to 1 to not do any smoothing.</p>
</dd>
<dt>useIAGetProfile: if True, then for peakOverMad, or meanAboveThreshold with</dt><dd><p>baselineMode=’min’, then use ia.getprofile instead of ia.getregion
and the subsequent arithmetic (because it should be faster)</p>
</dd>
<dt>useThresholdWithMask: if False, then just take mean rather than meanAboveThreshold</dt><dd><p>when a mask has been specified</p>
</dd>
</dl>
<p>nbin: this argument is accepted but not used (not yet implemented for this older mode)
Returns 8 items:</p>
<blockquote>
<div><ul class="simple">
<li><p>avgspectrum (vector)</p></li>
<li><p>avgspectrumAboveThresholdNansRemoved (vector)</p></li>
<li><p>avgspectrumAboveThresholdNansReplaced (vector)</p></li>
<li><p>threshold (scalar)</p></li>
<li><p>edgesUsed: 0=lower, 1=upper, 2=both</p></li>
<li><p>nchan (scalar)</p></li>
<li><p>nanmin (the value used to replace NaNs)</p></li>
<li><p>percentagePixelsNotMasked</p></li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.meanSpectrumFromMom0Mom8JointMask">
<span class="sig-name descname"><span class="pre">meanSpectrumFromMom0Mom8JointMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psfcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minbeamfrac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projectCode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwriteMoments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwriteMasks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalizeByMAD</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minPixelsInJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialQuadraticImprovementThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">userJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">snrThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">23</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom0minsnr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8minsnr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rmStatContQuadratic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectionalMaskPhase2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidExtremaInNoiseCalcForJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momentdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statistic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbmom</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flat'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxBaseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">150</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom08simultaneous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enableInitialQuadratic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#meanSpectrumFromMom0Mom8JointMask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.meanSpectrumFromMom0Mom8JointMask" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum when meanSpectrumMethod=’mom0mom8jointMask’.
This is the new heuristic for Cycle 6 which creates the moment 0 and moment 8 images
for a cube, takes their union and determines the mean spectrum by calling
computeStatisticalSpectrumFromMask(), which uses ia.getprofile.
pbcube: if not specified, then assume ‘.residual’ should be replaced in the name by ‘.pb’
pbmom: if not specified, then assume ‘.pb’ should be replaced in the name by ‘.pbmom’
overwriteMoments: rebuild the mom0 and mom8 images even if they already exist
overwriteMasks: rebuild the mom0 and mom8 mask images even if they already exist
phase2: if True, then run a second phase if SNR is high
minPixelsInJointMask: if fewer than these pixels are found, then use all pixels above pb=0.3
userJointMask: if specified, use this joint mask instead of computing one; if it is a cube mask,</p>
<blockquote>
<div><p>as from tclean, then this function will form a flattened version first, and then use that</p>
</div></blockquote>
<p>snrThreshold: if SNR is higher than this, and phase2==True, then run a phase 2 mask calculation
mom0minsnr: sets the threshold for the mom0 image (i.e. median + mom0minsnr*scaledMAD of the whole image)
mom8minsnr: sets the threshold for the mom8 image (i.e. median + mom8minsnr*scaledMAD of thw whole image)
enableInitialQuadratic: if True, assess the need for quadratic removal, and use the</p>
<blockquote>
<div><p>old-style method to remove it</p>
</div></blockquote>
<dl class="simple">
<dt>rmStatContQuadratic: if True, then do not do the initialQuadratic removal (if enabled</dt><dd><p>and deemed necessary), but instead always perform the new-style quadratic removal</p>
</dd>
<dt>bidirectionalMaskPhase2: True=extend mask to negative values beyond threshold;</dt><dd><p>False=Cycle6+ behavior (True was tried but gives worse results in some cases)</p>
</dd>
</dl>
<p>outdir: directory to write the mom0, mom8, masks, .dat and mean spectrum text files
avoidExtremaInNoiseCalcForJointMask: experimental Boolean to avoid pixels &lt;5%ile and &gt;95%ile</p>
<blockquote>
<div><p>in the chauvenet imstat of mom0 and mom8 images</p>
</div></blockquote>
<p>momentdir: alternate directory to look for existing mom0 and mom8 images
mom08simultaneous: if True, set moments=[0,8] in one call to immoments instead of two
Returns: 17 things:</p>
<blockquote>
<div><ul class="simple">
<li><ol class="arabic simple">
<li><p>the meanSpectrum</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>a Boolean which states whether normalization was applied</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>the number of pixels in the mask</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="4">
<li><p>a Boolean for whether the mask reverted to pb-based</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="5">
<li><p>a Boolean for whether a quadratic was removed</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="6">
<li><p>the initialQuadraticImprovementRatio</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="7">
<li><p>the list of 3 mom0snrs</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="8">
<li><p>the list of 3 mom8snrs</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="9">
<li><p>the number of regions pruned</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="10">
<li><p>number of pixels in moment 8 mask</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="11">
<li><p>mom0peak (Jy*km/s)</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="12">
<li><p>mom8peak (Jy)</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="13">
<li><p>name of jointMask file</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="14">
<li><p>nbin</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="15">
<li><p>initialPeakOverMad</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="16">
<li><p>mom0peakOverMad</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="17">
<li><p>mom8peakOverMad</p></li>
</ol>
</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.medianCorrected">
<span class="sig-name descname"><span class="pre">medianCorrected</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">baselineMode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mad</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signalRatio</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useLowBaseline</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#medianCorrected"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.medianCorrected" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
Computes the true median of a datastream from the observed median and MAD
of the lowest Nth percentile points.
signalRatio: when there is a lot of signal, we need to reduce the</p>
<blockquote>
<div><p>correction factor because it is less like Gaussian noise
It is 1.0 if no lines are present, 0.25 if half the channels
have signal, etc.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.mjdSecondsToMJDandUT">
<span class="sig-name descname"><span class="pre">mjdSecondsToMJDandUT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mjdsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'-'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#mjdSecondsToMJDandUT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.mjdSecondsToMJDandUT" title="Link to this definition"></a></dt>
<dd><p>This function is called by mjdToUT.
Converts a value of MJD seconds into MJD, and into a UT date/time string.
prec: 6 means HH:MM:SS,  7 means HH:MM:SS.S
example: (56000.0, ‘2012-03-14 00:00:00 UT’)
Caveat: only works for a scalar input value</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.mjdToUT">
<span class="sig-name descname"><span class="pre">mjdToUT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mjd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_metool</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#mjdToUT"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.mjdToUT" title="Link to this definition"></a></dt>
<dd><p>This function is called by getDateObs.
Converts an MJD value to a UT date and time string
such as ‘2012-03-14 00:00:00 UT’
use_metool: whether or not to use the CASA measures tool if running from CASA.</p>
<blockquote>
<div><p>This parameter is simply for testing the non-casa calculation.</p>
</div></blockquote>
<p>-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.modifyContinuumChannels">
<span class="sig-name descname"><span class="pre">modifyContinuumChannels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">avgSpectrumNansReplaced</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minlevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxlevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intersectRanges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trimChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">narrow</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrimFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#modifyContinuumChannels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.modifyContinuumChannels" title="Link to this definition"></a></dt>
<dd><p>Re-assess spectrum using new minlevel and maxlevel
verbose: print the list of channel ranges after each stage of processing</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.nanmean">
<span class="sig-name descname"><span class="pre">nanmean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#nanmean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.nanmean" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels, runFindContinuum, and avgOverCube.
Takes the mean of an array, ignoring the nan entries</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.nanmedian">
<span class="sig-name descname"><span class="pre">nanmedian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#nanmedian"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.nanmedian" title="Link to this definition"></a></dt>
<dd><p>This function is called by MAD, avgOverCube, and meanSpectrum.
Compute the median along the given axis ignoring nan values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array_like</em>) – Input array.</p></li>
<li><p><strong>axis</strong> (<em>int or None, optional</em>) – Axis along which the median is computed. Default is 0.
If None, compute over the whole array <cite>x</cite>.</p></li>
<li><p><strong>preop</strong> (<em>function</em>) – function to apply on 1d slice after removing the NaNs and before
computing median</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>m</strong> – The median of <cite>x</cite> along <cite>axis</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">nanstd</span></code>, <a class="reference internal" href="#pipeline.extern.findContinuum.nanmean" title="pipeline.extern.findContinuum.nanmean"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nanmean</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.nanmedian</span></code></p>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">array(3.0)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">array(4.0)</span>
</pre></div>
</div>
<p>Example with axis:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">30.</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">array([[  0.,   1.,   2.,  nan,   4.,   5.],</span>
<span class="go">       [  6.,   7.,  nan,   9.,  10.,  11.],</span>
<span class="go">       [ 12.,  nan,  14.,  15.,  16.,  17.],</span>
<span class="go">       [ nan,  19.,  20.,  21.,  22.,  nan],</span>
<span class="go">       [ 24.,  25.,  26.,  27.,  nan,  29.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stats</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">array([  2. ,   9. ,  15. ,  20.5,  26. ])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.numberOfChannelsInCube">
<span class="sig-name descname"><span class="pre">numberOfChannelsInCube</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnFreqs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnChannelWidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myia</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#numberOfChannelsInCube"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.numberOfChannelsInCube" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum, cubeFrameToTopo,
computeStatisticalSpectrumFromMask, and meanSpectrum.
Finds the number of channels in a CASA image cube.
returnFreqs: if True, then also return the frequency of the center of the</p>
<blockquote>
<div><p>first and last channel (in Hz)</p>
</div></blockquote>
<p>returnChannelWidth: if True, then also return the channel width (in Hz)
verbose: if True, then print the frequencies of first and last channel
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.oneEvent">
<span class="sig-name descname"><span class="pre">oneEvent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">npts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positive</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#oneEvent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.oneEvent" title="Link to this definition"></a></dt>
<dd><p>This function is called by meanSpectrumFromMom0Mom8JointMask.
For a specified size of a Gaussian population of data, compute the sigma
that gives just less than one event, by using scipy.special.erfinv.
Inputs:
positive: if True, then only considers positive events.
events: how many events to allow
verbose: passed to sigmaEvent
Return:
sigma: floating point value</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.onlyExtraMaskYesOrNo">
<span class="sig-name descname"><span class="pre">onlyExtraMaskYesOrNo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">badAtmosphere</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffSNR</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffSNRCube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixMomDiff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixMomDiffBadAtm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">NpixCubeAnywhere</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">TenEventSigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffMAD</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">MADCubeOutside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cubePeak</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cubeMedian</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffLevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffLevelBadAtm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cubeLevel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npixThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipCubeNoise</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#onlyExtraMaskYesOrNo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.onlyExtraMaskYesOrNo" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
badAtmosphere: either a boolean or a string (‘goodAtm’ or ‘badAtm’)
momDiffSNR: SNR where peak is measured over whole image (instead of outside mask),</p>
<blockquote>
<div><p>(mom scaledMAD is in denominator)</p>
</div></blockquote>
<dl class="simple">
<dt>momDiffSNRCube: SNR where peak is measured over whole image (instead of outside mask),</dt><dd><p>(cube scaledMAD is in denominator)</p>
</dd>
</dl>
<p>NpixCubeAnywhere: unused now
momDiffLevel: for the non-badAtmosphere case, this is passed in from momDiffLevelForProceeding</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.parseFrequencyArgument">
<span class="sig-name descname"><span class="pre">parseFrequencyArgument</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bandwidth</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#parseFrequencyArgument"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.parseFrequencyArgument" title="Link to this definition"></a></dt>
<dd><p>This function is called by parseFrequencyArgumentToGHz, topoFreqToChannel and cubeFrameToTopo.
Converts a string frequency into floating point in Hz, based on the units.
If the units are not present, then the value is simply converted to float.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.parseFrequencyArgumentToGHz">
<span class="sig-name descname"><span class="pre">parseFrequencyArgumentToGHz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bandwidth</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#parseFrequencyArgumentToGHz"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.parseFrequencyArgumentToGHz" title="Link to this definition"></a></dt>
<dd><p>This function is called by frames and lsrkToRest.
Converts a frequency string into floating point in GHz, based on the units.
If the units are not present, then the value is assumed to be GHz if less
than 1000.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.parseFrequencyArgumentToHz">
<span class="sig-name descname"><span class="pre">parseFrequencyArgumentToHz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bandwidth</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#parseFrequencyArgumentToHz"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.parseFrequencyArgumentToHz" title="Link to this definition"></a></dt>
<dd><p>Converts a frequency string into floating point in Hz, based on the units.
If the units are not present, then the value is assumed to be GHz if less
than 1000 (in contrast to parseFrequencyArgument).
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pickAutoTrimChannels">
<span class="sig-name descname"><span class="pre">pickAutoTrimChannels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">totalChannels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">medianWidthOfRanges</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pickAutoTrimChannels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pickAutoTrimChannels" title="Link to this definition"></a></dt>
<dd><p>This function is called by splitListIntoContiguousListsAndTrim and pickTrimString.
Automatic choice of number of trimChannels as a function of the number
of potential continuum channels in an spw.
length: number of channels in the list of potential continuum channels
Returns: an integer or floating point value</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pickNarrow">
<span class="sig-name descname"><span class="pre">pickNarrow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pickNarrow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pickNarrow" title="Link to this definition"></a></dt>
<dd><p>This function is called by pickNarrowString and findContinuumChannels.
Automatically picks a setting for the narrow parameter of
findContinuumChannels() based on the number of channels in the spectrum.
Returns: an integer
Examples: This formula results in the following values:
length: 64,128,240,480,960,1920,3840,7680:
return:  2,  3,  3,  3,  3,   4,   4,   4  (ceil(log10)) <a href="#id17"><span class="problematic" id="id18">**</span></a>** current function <a href="#id19"><span class="problematic" id="id20">**</span></a><a href="#id21"><span class="problematic" id="id22">**</span></a></p>
<blockquote>
<div><p>2,  2,  2,  3,  3,   3,   4,   4  (round_half_up(log10))
1,  2,  2,  2,  2,   3,   3,   3  (floor(log10))
5,  5,  6,  7,  7,   8,   9,   9  (ceil(log))
4,  5,  5,  6,  7,   8,   8,   9  (round_half_up(log))
4,  4,  5,  6,  6,   7,   8,   8  (floor(log))</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pickNarrowString">
<span class="sig-name descname"><span class="pre">pickNarrowString</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">narrow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">narrowValueModified</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pickNarrowString"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pickNarrowString" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Generate a string describing the setting of the narrow parameter.
Returns: a string</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pickRandomError">
<span class="sig-name descname"><span class="pre">pickRandomError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pickRandomError"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pickRandomError" title="Link to this definition"></a></dt>
<dd><p>Picks a random value from a Gaussian distribution with mean 0 and standard deviation = 1.
seed: if specified, then first reseed with random.seed(seed)
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pickRandomErrors">
<span class="sig-name descname"><span class="pre">pickRandomErrors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nvalues</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pickRandomErrors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pickRandomErrors" title="Link to this definition"></a></dt>
<dd><p>Picks a series of random values from a Gaussian distribution with mean 0 and standard
deviation = 1 and returns it as an array.
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pickTrimString">
<span class="sig-name descname"><span class="pre">pickTrimString</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">totalChannels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trimChannels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pickTrimString"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pickTrimString" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Generate a string describing the setting of the trimChannels parameter.
totalChannels: total number of points in spectrum
trimChannels: string (e.g. ‘auto’) or integer (e.g. 20) or float (e.g. 0.1)
length: number of channels in the spectrum  (now unused)
selection: continuum channel selection string
Returns: a string</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pick_sFC_TDM">
<span class="sig-name descname"><span class="pre">pick_sFC_TDM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meanSpectrumMethod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">singleContinuum</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pick_sFC_TDM"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pick_sFC_TDM" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum.
Chooses the value of sigmaFindContinuum for TDM datasets based on
the meanSpectrumMethod and whether the user requested single continuum in
the Observing Tool.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.plotChannelSelections">
<span class="sig-name descname"><span class="pre">plotChannelSelections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avgspectrumAboveThreshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipchan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">medianTrue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">secondSelectionAdded</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lineColor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'c'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#plotChannelSelections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.plotChannelSelections" title="Link to this definition"></a></dt>
<dd><p>avgspectrumAboveThreshold: computed in runFindContinuum
medianTrue, threshold: computed by findContinuumChannels
Returns labelDescs: list of plot artists that may be removed and replaced later</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.plotMeanSpectrum">
<span class="sig-name descname"><span class="pre">plotMeanSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#plotMeanSpectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.plotMeanSpectrum" title="Link to this definition"></a></dt>
<dd><p>Not used by pipeline.
Reads a <a href="#id23"><span class="problematic" id="id24">*</span></a>.findcont.residual.meanSpectrum.&lt;method&gt; file and plots it as
intensity vs. channel.
plotfile: set to a string to generate a png
selection: channel selection string to draw in cyan horizontal lines,</p>
<blockquote>
<div><p>and its median intensity as a dotted cyan line</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.plotPickleFile">
<span class="sig-name descname"><span class="pre">plotPickleFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">priorValuesFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contdat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">narrow</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trimChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intersectRanges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">computeMomDiffSNR</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAnnulus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuumMode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'fixed'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minlevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxlevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrimFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#plotPickleFile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.plotPickleFile" title="Link to this definition"></a></dt>
<dd><p>Allows rapid feedback from adjusting the cut level of the pickle file
spectrum created by a previous run of findContinuum, and produces a
new _findContinuum.dat file.
priorValuesFile: pickle file from prior run of findContinuum</p>
<blockquote>
<div><p>The following things are used: the spectrum, jointMask.</p>
</div></blockquote>
<dl class="simple">
<dt>plotfile: if not defined, set it to jointMask+’_adjusted.png’</dt><dd><p>if it is a directory path, then prepend it</p>
</dd>
<dt>contdat: name of file to write; if not defined, set it to</dt><dd><p>jointMask+’_adjusted_findContinuum.dat’;
if it is a directory path, then prepend it to this default filename</p>
</dd>
</dl>
<p>img: full path to cube, in case it has been moved since creating the pickle
intersectRanges: if specified, don’t allow selections outside of these ranges,</p>
<blockquote>
<div><p>example: ‘60~80;200~300’</p>
</div></blockquote>
<p>computeMomDiffSNR: if specified, compute and return the momDiffSNR
useAnnulus: passed to fc.imageSNR
trimChannels: use 0 to avoid re-trimming ranges that were already trimmed</p>
<blockquote>
<div><p>in the initial run of findContinuum</p>
</div></blockquote>
<p>subimage: passed to findOuterAnnulusForPBCube() to raise annulus by 0.2
sigmaFindContinuumMode: passed to findContinuumChannels()
To invoke alternative method, set:
minlevel: level of lower dotted line of prior findContinuum run
maxlevel: level of upper dotted line of prior findContinuum run
median: level of solid line of prior findContinuum run (only needed to</p>
<blockquote>
<div><p>draw this level on the plot, or if fraction is specified)</p>
</div></blockquote>
<dl class="simple">
<dt>fraction: scale the median-to-min distance and median-to-max distance by this</dt><dd><p>fraction prior to running; if &gt;1.0, then also ignore intersectRanges</p>
</dd>
<dt>avoidance: passed to modifyContinuumChannels; thus, only used if minlevel/maxlevel/median</dt><dd><p>are set</p>
</dd>
</dl>
<p>grid: if True, draw dotted grid lines at the major tick marks
Note: only minlevel and maxlevel are ultimately passed to modifyContinuumChannels;</p>
<blockquote>
<div><p>fraction and median are merely a way to adjust them automatically.</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.plotSigmaCorrectionFactor">
<span class="sig-name descname"><span class="pre">plotSigmaCorrectionFactor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">19</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#plotSigmaCorrectionFactor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.plotSigmaCorrectionFactor" title="Link to this definition"></a></dt>
<dd><p>Makes a plot of sigmaCorrectionFactor for the principle options
for number of channels in an ALMA cube</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.plotStatisticalSpectrumFromMask">
<span class="sig-name descname"><span class="pre">plotStatisticalSpectrumFromMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">statistic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalizeByMAD</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">png</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jointMaskForNormalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#plotStatisticalSpectrumFromMask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.plotStatisticalSpectrumFromMask" title="Link to this definition"></a></dt>
<dd><p>Simple wrapper to call computeStatisticalSpectrumFromMask and plot it.
jointMask: either a mask image, or an expression with &lt; or &gt; on an mask</p>
<blockquote>
<div><p>image</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.polyfit">
<span class="sig-name descname"><span class="pre">polyfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yerror</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pinit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">0,</span> <span class="pre">0,</span> <span class="pre">0]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#polyfit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.polyfit" title="Link to this definition"></a></dt>
<dd><p>This function is called by removeInitialQuadraticIfNeeded in Cycle 6, and by
runFindContinuum in Cycle 4+5.
Basic second-order polynomial function fitter with error bars in y-axis data points.
Uses scipy.optimize.leastsq().  Accepts either lists or arrays.
Input:</p>
<blockquote>
<div><p>x, y: x and y axis values
yerror: uncertainty in the y-axis values (vector or scalar)
pinit contains the initial guess of [slope, intercept]
y = order2coeff*(x-xoffset)**2 + slope*(x-xoffset) + y-intercept</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>The fit result as: [xoffset, order2coeff, slope, y-intercept]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.printPickleFile">
<span class="sig-name descname"><span class="pre">printPickleFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">priorValuesFile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#printPickleFile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.printPickleFile" title="Link to this definition"></a></dt>
<dd><p>Prints the contents of the specified pickle file of prior values</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.propagateMaskToAllChannels">
<span class="sig-name descname"><span class="pre">propagateMaskToAllChannels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#propagateMaskToAllChannels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.propagateMaskToAllChannels" title="Link to this definition"></a></dt>
<dd><p>This function is called by meanSpectrum.
Takes a spectral mask array, and propagates every masked spatial pixel to
all spectral channels of the array.
Returns: a 2D mask (of the same spatial dimension as the input,</p>
<blockquote>
<div><p>but with only 1 channel)</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.pruneMask">
<span class="sig-name descname"><span class="pre">pruneMask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mymask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psfcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minbeamfrac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prunesize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbmom</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#pruneMask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.pruneMask" title="Link to this definition"></a></dt>
<dd><p>available in CASA &gt;= 5.4.0-X  (see CAS-11335)
Removes any regions smaller than prunesize contiguous pixels.
psfcube: if specified, then use minbeamfrac * pixelsPerBeam, otherwise use prunesize
prunesize: value used if psfcube is None; use 6 because pipeline size mitigation could</p>
<blockquote>
<div><p>produce images that have only 3 pixels across the beam, meaning only ~7-8 pts/beam</p>
</div></blockquote>
<p>nchan: number of channels to process, will always be 1 in findContinuum’s use case
overwrite: if True, replaces mymask with pruned mask, putting original in mymask.prepruned</p>
<blockquote>
<div><p>if False, is simply creates: mymask.pruned, but only if it pruned anything</p>
</div></blockquote>
<p>If all regions are pruned, it checks if it is ACA7m (maxBaseline &lt; 60m) and if so, tries
again with minbeamfrac*0.5.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.rad2radec">
<span class="sig-name descname"><span class="pre">rad2radec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">component</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replaceDecDotsWithColons</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hmsdms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delimiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">',</span> <span class="pre">'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prependEquinox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hmdm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#rad2radec"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.rad2radec" title="Link to this definition"></a></dt>
<dd><p>This function is called by cubeFrameToTopo.
Convert a position in RA/Dec from radians to sexagesimal string which
is comma-delimited, e.g. ‘20:10:49.01, +057:17:44.806’.
The position can either be entered as scalars via the ‘ra’ and ‘dec’
parameters, as a tuple via the ‘ra’ parameter, or as an array of shape (2,1)
via the ‘ra’ parameter.
replaceDecDotsWithColons: replace dots with colons as the Declination d/m/s delimiter
hmsdms: produce output of format: ‘20h10m49.01s, +057d17m44.806s’
hmdm: produce output of format: ‘20h10m49.01, +057d17m44.806’ (for simobserve)
delimiter: the character to use to delimit the RA and Dec strings output
prependEquinox: if True, insert “J2000” before coordinates (i.e. for clean or simobserve)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readContDat">
<span class="sig-name descname"><span class="pre">readContDat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readContDat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readContDat" title="Link to this definition"></a></dt>
<dd><p>Reads the channel selection for a _findContinuum.dat file</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readContDatAggregateContinuum">
<span class="sig-name descname"><span class="pre">readContDatAggregateContinuum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readContDatAggregateContinuum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readContDatAggregateContinuum" title="Link to this definition"></a></dt>
<dd><p>Reads the aggregate continuum from a _findContinuum.dat file.
Returns: value in GHz</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readContDatChanWidth">
<span class="sig-name descname"><span class="pre">readContDatChanWidth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readContDatChanWidth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readContDatChanWidth" title="Link to this definition"></a></dt>
<dd><p>Converts aggBW and channel number to chanWidth (in GHz).
This will differ slightly from fc.numberOfChannelsInCube(jointMask,returnChannelWidth=True)
due to precision of the frequency display in the file.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readContDatLSRKRanges">
<span class="sig-name descname"><span class="pre">readContDatLSRKRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readContDatLSRKRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readContDatLSRKRanges" title="Link to this definition"></a></dt>
<dd><p>Reads the LSRK ranges from a _findContinuum.dat file and returns one
string of format: ‘XXX.YYYYYYYYYGHz~XXX.YYYYYYYYYGHz;…’</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readContDatPNG">
<span class="sig-name descname"><span class="pre">readContDatPNG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readContDatPNG"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readContDatPNG" title="Link to this definition"></a></dt>
<dd><p>Reads the png name from a _findContinuum.dat file</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readMeanSpectrumFITSFile">
<span class="sig-name descname"><span class="pre">readMeanSpectrumFITSFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanBufferChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readMeanSpectrumFITSFile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readMeanSpectrumFITSFile" title="Link to this definition"></a></dt>
<dd><p>++++++ This function is not used by the pipeline.
Reads a spectrum from a FITS table, such as one output by the spectralcube
python module: <a class="reference external" href="https://spectral-cube.readthedocs.io/en/latest/index.html">https://spectral-cube.readthedocs.io/en/latest/index.html</a>
Returns: 8 items
* average spectrum
* average spectrum with the NaNs replaced with the minimum value
* threshold used (currently hardcoded to 0.0)
* edges used (currently hardcoded to 2)
* number of channels
* the minimum value
* first frequency
* last frequency</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readPreviousMeanSpectrum">
<span class="sig-name descname"><span class="pre">readPreviousMeanSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readPreviousMeanSpectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readPreviousMeanSpectrum" title="Link to this definition"></a></dt>
<dd><p>++++++ This function is not used by the pipeline.
Read a previous calculated mean spectrum and its parameters,
or an ASCII file created by the CASA viewer (or tt.ispec).
Note: only the intensity column(s) are returned, not the</p>
<blockquote>
<div><p>channel/frequency columns.</p>
</div></blockquote>
<p>This function will not typically be used by the pipeline, only manual users.
Returns: 11 things:</p>
<blockquote>
<div><p>avgspectrum, avgSpectrumNansReplaced, threshold,
edgesUsed, nchan, nanmin, firstFreq, lastFreq, centralArcsec,
mask, percentagePixelsNotMasked</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.readViewerOutputFile">
<span class="sig-name descname"><span class="pre">readViewerOutputFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#readViewerOutputFile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.readViewerOutputFile" title="Link to this definition"></a></dt>
<dd><p>++++++ This function is not used by the pipeline.
Reads an ASCII spectrum file produced by the CASA viewer or by tt.ispec.
Returns: 4 items: 2 arrays and 2 strings:
* array for x-axis, array for y-axis
* x-axis units, intensity units</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.recalcMomDiffSNR">
<span class="sig-name descname"><span class="pre">recalcMomDiffSNR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">priorValuesFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intersectRanges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAnnulus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">includeMom10</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#recalcMomDiffSNR"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.recalcMomDiffSNR" title="Link to this definition"></a></dt>
<dd><p>Allows rapid feedback for adjusting the channel ranges to use for momDiffSNR
priorValuesFile: a pickle file generated by findContinuum()
img: the cube (in case it has been moved and cannot be found automatically)</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The pbmom image is required to be present, either in the same directory
as the img, or the current working directory.</p></li>
<li><p>The joint mask listed in the priorValuesFile must also exist in the
current working directory.</p></li>
</ol>
</div></blockquote>
<dl class="simple">
<dt>intersectRanges: the selection of channels to use;  either a single string,</dt><dd><p>or a python list of strings to be intersected before using.  If you
would like to use LSRK frequency ranges instead, you can first use the
function au.imageFrequencyRangesToChannelRanges() to do the conversion
for your cube.</p>
</dd>
</dl>
<p>subimage: setting this True will raise the pb levels of the annulus by 0.2
useAnnulus: passed to fc.imageSNR
datfile: if present, then generate new datfile with the missing ranges</p>
<blockquote>
<div><p>removed</p>
</div></blockquote>
<p>outdir: if blank, then put it where the cube is
includeMom10: also compute moment 10 and mom10DiffSNR
Returns: new momDiffSNR, new AggBW (GHz), and (if includeMom10=True) the</p>
<blockquote>
<div><p>new mom10DiffSNR</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.rejectNarrowInnerWindowsChannels">
<span class="sig-name descname"><span class="pre">rejectNarrowInnerWindowsChannels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fCCiteration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#rejectNarrowInnerWindowsChannels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.rejectNarrowInnerWindowsChannels" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
If there are 3-15 groups of channels, then remove any inner window
that is narrower than both edge windows.
Returns: a list of channels</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.removeIfNecessary">
<span class="sig-name descname"><span class="pre">removeIfNecessary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">imgname</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#removeIfNecessary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.removeIfNecessary" title="Link to this definition"></a></dt>
<dd><p>If an image exists, remote its directory tree.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.removeInitialQuadraticIfNeeded">
<span class="sig-name descname"><span class="pre">removeInitialQuadraticIfNeeded</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">avgSpectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialQuadraticImprovementThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.6</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#removeInitialQuadraticIfNeeded"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.removeInitialQuadraticIfNeeded" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum when meanSpectrumMethod=’mom0mom8jointMask’.
Fits a quadratic to the specified spectrum, and removes it if the
MAD will improve by more than a factor of threshold</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.removeNaNs">
<span class="sig-name descname"><span class="pre">removeNaNs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replaceWithMin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanBufferChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replaceWithZero</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#removeNaNs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.removeNaNs" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>+++++++ This function is not used for meanSpectrumMethod == ‘mom0mom8jointMask’ by pipeline,</dt><dd><p>But it is called by readMeanSpectrumFITSFile available to manual users.</p>
</dd>
</dl>
<p>Remove or replace the nan values from an array.
replaceWithMin: if True, then replace NaNs with np.nanmin of array</p>
<blockquote>
<div><p>if False, then simply remove the NaNs</p>
</div></blockquote>
<dl class="simple">
<dt>replaceWithZero: if True, then replace NaNs with np.nanmin of array</dt><dd><p>if False, then simply remove the NaNs</p>
</dd>
</dl>
<p>nanBufferChannels: only active if replaceWithMin=True
Returns:
* new array
* if replaceWithMin=True, then also return the value used to replace NaNs</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.removeStatContQuadratic">
<span class="sig-name descname"><span class="pre">removeStatContQuadratic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnExtra</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minPercentage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">makeMovie</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keepContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#removeStatContQuadratic"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.removeStatContQuadratic" title="Link to this definition"></a></dt>
<dd><p>Iteratively removes outlier points down to nsigma, then fits a quadratic to the remaining
points, removes this quadratic from the full initial spectrum, and returns it, along
with the list of channels used for the fit and the fit evaluated at all channels.
minPercentage: stop removing outliers if number of remaining goes below this threshold
makeMovie: if True, then make a png for each quadratic fit as channels are removed one-by-one
img: only used to name the movie frame pngs</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.removeZeros">
<span class="sig-name descname"><span class="pre">removeZeros</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#removeZeros"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.removeZeros" title="Link to this definition"></a></dt>
<dd><p>+++++ This function is not used for meanSpectrumMethod=’mom0mom8jointMask’.
Takes an array, and replaces all appearances of 0.0 with the minimum value
of all channels not equal to 0.0.  This is used to reduce the bias caused
by the edge channels being 0.0 in the profiles returned by ia.getprofile.
If the absolute value of the minimum is greater than the absolute value of
the maximum, then set the channels to the maximum value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.replaceLineFullRangesWithNoise">
<span class="sig-name descname"><span class="pre">replaceLineFullRangesWithNoise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">intensity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">median</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaledMAD</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#replaceLineFullRangesWithNoise"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.replaceLineFullRangesWithNoise" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
intensity: an array of intensity values of <em>all</em> channels in the spectrum
selection: a channel selection string in CASA format, whose intensities should be replaced
median: of the channels <em>not</em> in the selection string (for the noise generation)
scaledMAD: of the channels <em>not</em> in the selection string (for the noise generation)
Returns: a new intensity array, of the same dimension as the input array</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.representativeFrequency">
<span class="sig-name descname"><span class="pre">representativeFrequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#representativeFrequency"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.representativeFrequency" title="Link to this definition"></a></dt>
<dd><p>Get the representative frequency from the ASDM_SBSUMMARY table of a
measurement set, if it has been imported with asis.
e.g. [representativeFrequency = 230.0348592858192 GHz, …]
verbose: if True, then also print the min/max acceptable angular resolutions
Returns the value in GHz.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.representativeSpwBandwidth">
<span class="sig-name descname"><span class="pre">representativeSpwBandwidth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'TARGET'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#representativeSpwBandwidth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.representativeSpwBandwidth" title="Link to this definition"></a></dt>
<dd><p>Uses updateSBSummary to learn the name of the representativeWindow, then
translates that name to a science spw ID using msmd.spwsfornames, and
finally a bandwidth.
Returns: spw ID, spw bandwidth in Hz (or 0 if no rep spw can be discerned),</p>
<blockquote>
<div><p>minimum science spw bandwidth, maximum science spw bandwidth</p>
</div></blockquote>
<p>-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.restToTopo">
<span class="sig-name descname"><span class="pre">restToTopo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">restFrequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">velocityLSRK</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datestring</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equinox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'J2000'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observatory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALMA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">veltype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'radio'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#restToTopo"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.restToTopo" title="Link to this definition"></a></dt>
<dd><p>This function is called by lsrkToTopo.
Converts a rest frequency, LSRK velocity, and observing date/direction
to the corresponding frequency in the TOPO frame.
Inputs:
restFrequency: floating point value in Hz or GHz, or a string with units
velocityLSRK: floating point value in km/s
datestring:  “YYYY/MM/DD/HH:MM:SS”
ra: string “HH:MM:SS.SSSS”
dec: string “DD.MM.SS.SSSS” or “DD:MM:SS.SSSS” (colons will be replaced with .)
prec: only used to display the value when verbose=True
Returns: the TOPO frequency in Hz</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.robustMADofContinuumRanges">
<span class="sig-name descname"><span class="pre">robustMADofContinuumRanges</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">myChannelList</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">myIntensity</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#robustMADofContinuumRanges"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.robustMADofContinuumRanges" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
myChannelList: subset of channels that are currently the continuum selection
intensity: list of intensities in <em>all</em> channels of the spectrum</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.roundFigures">
<span class="sig-name descname"><span class="pre">roundFigures</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">digits</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#roundFigures"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.roundFigures" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum and drawYlabel.
This function rounds a floating point value to a number of significant
figures.  Was originally taken from analysisUtils.
value: value to be rounded (between 1e-20 and 1e+20)
digits: number of significant digits, both before or after decimal point
Returns: a floating point value</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.round_half_up">
<span class="sig-name descname"><span class="pre">round_half_up</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#round_half_up"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.round_half_up" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.runFindContinuum">
<span class="sig-name descname"><span class="pre">runFindContinuum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pbcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psfcube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minbeamfrac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transition</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselineModeA</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'min'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baselineModeB</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'min'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaCube</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.19</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmaFindContinuumMode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">png</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pngBasename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanBufferChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useAbsoluteValue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trimChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">continuumThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">narrow</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">';'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">titleText</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrimFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centralArcsec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelWidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alternateDirectory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotAtmosphere</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'transmission'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">airmass</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pwv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelFractionForSlopeRemoval</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.75</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumMethod</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'peakOverMad'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakFilterFWHM</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fullLegend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meanSpectrumMethodMessage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minSlopeToRemove</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-08</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minGroupsForSFCAdjustment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regressionTest</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quadraticFit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">megapixels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">triangularPatternSeen</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxMemory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negativeThresholdFactor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">byteLimit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">singleContinuum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">applyMaskToMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotBaselinePoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">madRatioUpperLimit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">madRatioLowerLimit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">projectCode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useIAGetProfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useThresholdWithMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dpi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">150</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalizeByMAD</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwriteMoments</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialQuadraticImprovementThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minPeakOverMadForSFCAdjustment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxMadRatioForSFCAdjustment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxMadRatioForSFCAdjustmentInLaterIterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minPixelsInJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">userJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signalRatioTier1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.965</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signalRatioTier2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.94</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">snrThreshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">23</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom0minsnr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom8minsnr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwriteMasks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rmStatContQuadratic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quadraticNsigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bidirectionalMaskPhase2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plotQuadraticPoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">makeMovie</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allowBluePruning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enableRejectNarrowInnerWindows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avoidExtremaInNoiseCalcForJointMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amendMask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momentdir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amendMaskIterationName</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useJointMaskPrior</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'flat'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subimage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffSNR</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peakOverMadCriterion</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">85</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxGroups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">momDiffApproachLevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mom08simultaneous</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useUncorrectedMedian</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnBluePoints</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">removeOutlierBaselineChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enableInitialQuadratic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">useBaseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spectralDynamicRangeString</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#runFindContinuum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.runFindContinuum" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum.  It calls functions that:
1) compute the mean spectrum of a dirty cube
2) find the continuum channels
3) plot the results
Inputs: channelWidth: in Hz
Returns: 23 items
<a href="#id25"><span class="problematic" id="id26">*</span></a>1 A channel selection string suitable for the spw parameter of clean.
<a href="#id27"><span class="problematic" id="id28">*</span></a>2 The name of the png produced.
<a href="#id29"><span class="problematic" id="id30">*</span></a>3 The slope of the linear fit (or None if no fit attempted).
<a href="#id31"><span class="problematic" id="id32">*</span></a>4 The channel width in Hz (only necessary for the fitsTable option).
<a href="#id33"><span class="problematic" id="id34">*</span></a>5 nchan in the cube (only necessary to return this for the fitsTable option, will be computed otherwise).
<a href="#id35"><span class="problematic" id="id36">*</span></a>6 Boolean: True if it used low values as the baseline (as opposed to high values)
<a href="#id37"><span class="problematic" id="id38">*</span></a>7 SNRs in the moment0 image (raw, outside mask, outside phase2 mask)
<a href="#id39"><span class="problematic" id="id40">*</span></a>8 SNRs in the moment8 image (raw, outside mask, outside phase2 mask)
<a href="#id41"><span class="problematic" id="id42">*</span></a>9 Boolean: True if the middle-valued channels were used as the baseline (as opposed to low or high)
<a href="#id43"><span class="problematic" id="id44">*</span></a>10 list: selectionPreBluePruning
<a href="#id45"><span class="problematic" id="id46">*</span></a>11 float: finalSigmaFindContinuum
<a href="#id47"><span class="problematic" id="id48">*</span></a>12 string: name of jointMask
<a href="#id49"><span class="problematic" id="id50">*</span></a>13 float array: avgspectrumAboveThreshold
<a href="#id51"><span class="problematic" id="id52">*</span></a>14 float: the true median of the spectrum
<a href="#id53"><span class="problematic" id="id54">*</span></a>15 list: of plot artist descriptors (things to potentially remove and replot)
<a href="#id55"><span class="problematic" id="id56">*</span></a>16 axis instance: ax1 (lower x-axis)
<a href="#id57"><span class="problematic" id="id58">*</span></a>17 axis instance: ax2 (upper x-axis)
<a href="#id59"><span class="problematic" id="id60">*</span></a>18 float: threshold (the positive threshold for line detection)
<a href="#id61"><span class="problematic" id="id62">*</span></a>19 string: final line of upper text legend
<a href="#id63"><span class="problematic" id="id64">*</span></a>20 int: number of narrow central groups that were dropped (or would have been dropped</p>
<blockquote>
<div><p>if enableRejectNarrowWindows had been True, but wasn’t), summed over all runs
of findContinuumChannels()</p>
</div></blockquote>
<p><a href="#id65"><span class="problematic" id="id66">*</span></a>21 float: effectiveSigma (product of finalSigmaFindContinuum*correctionFactor)
<a href="#id67"><span class="problematic" id="id68">*</span></a>22 float: baselineMAD
<a href="#id69"><span class="problematic" id="id70">*</span></a>23 string: upper x-axis label
<a href="#id71"><span class="problematic" id="id72">*</span></a>24 list of int: allBaselineChannelsXY (channel numbers of baseline)
<a href="#id73"><span class="problematic" id="id74">*</span></a>25 int: nbin
<a href="#id75"><span class="problematic" id="id76">*</span></a>26 float: initialPeakOverMad
<a href="#id77"><span class="problematic" id="id78">*</span></a>27 float or None: negativeThreshold
Inputs:
img: the image cube to operate upon
spw: the spw name or number to put in the x-axis label
transition: the name of the spectral transition (for the plot title)
baselineModeA: ‘min’ or ‘edge’, method to define the baseline in meanSpectrum()
sigmaCube: multiply this value by the MAD to get the threshold above which a pixel</p>
<blockquote>
<div><p>is included in the mean spectrum</p>
</div></blockquote>
<dl class="simple">
<dt>nBaselineChannels: if integer, then the number of channels to use in:</dt><dd><ol class="loweralpha simple">
<li><p>computing the mean spectrum with the ‘meanAboveThreshold’ methods.</p></li>
<li><dl class="simple">
<dt>computing the MAD of the lowest/highest channels in findContinuumChannels</dt><dd><p>if float, then the fraction of channels to use (i.e. the percentile)
default = 0.19, which is 24 channels (i.e. 12 on each side) of a TDM window</p>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
<p>sigmaFindContinuum: passed to findContinuumChannels, ‘auto’ starts with 3.5
sigmaFindContinuumMode: ‘auto’, ‘autolower’, or ‘fixed’
verbose: if True, then print additional information during processing
png: the name of the png to produce (’’ yields default name)
pngBasename: if True, then remove the directory from img name before generating png name
nanBufferChannels: when removing or replacing NaNs, do this many extra channels</p>
<blockquote>
<div><p>beyond their extent</p>
</div></blockquote>
<dl class="simple">
<dt>source: the name of the source, to be shown in the title of the spectrum.</dt><dd><p>if None, then use the filename, up to the first underscore.</p>
</dd>
</dl>
<p>findContinuum: if True, then find the continuum channels before plotting
overwrite: if True, or ASCII file does not exist, then recalculate the mean spectrum</p>
<blockquote>
<div><blockquote>
<div><p>writing it to &lt;img&gt;.meanSpectrum</p>
</div></blockquote>
<p>if False, then read the mean spectrum from the existing ASCII file</p>
</div></blockquote>
<dl class="simple">
<dt>trimChannels: after doing best job of finding continuum, remove this many</dt><dd><p>channels from each edge of each block of channels found (for margin of safety)
If it is a float between 0..1, then trim this fraction of channels in each
group (rounding up). If it is ‘auto’, use 0.1 but not more than maxTrim channels
and not more than maxTrimFraction</p>
</dd>
</dl>
<p>percentile: control parameter used with baselineMode=’min’
continuumThreshold: if specified, only use pixels above this intensity level
narrow: the minimum number of channels that a group of channels must have to survive</p>
<blockquote>
<div><dl class="simple">
<dt>if 0&lt;narrow&lt;1, then it is interpreted as the fraction of all</dt><dd><p>channels within identified blocks</p>
</dd>
</dl>
<p>if ‘auto’, then use int(ceil(log10(nchan)))</p>
</div></blockquote>
<p>titleText: default is img name and transition and the control parameter values
meanSpectrumFile: an alternative ASCII text file to use for the mean spectrum.</p>
<blockquote>
<div><p>Must also set img=’’.</p>
</div></blockquote>
<dl class="simple">
<dt>meanSpectrumMethod: ‘peakOverMad’, ‘peakOverRms’, ‘meanAboveThreshold’,</dt><dd><dl class="simple">
<dt>‘meanAboveThresholdOverRms’, ‘meanAboveThresholdOverMad’,</dt><dd><p>where ‘peak’ refers to the peak in a spatially-smoothed version of cube</p>
</dd>
</dl>
</dd>
<dt>peakFilterFWHM: value used by ‘peakOverRms’ and ‘peakOverMad’ to presmooth</dt><dd><p>each plane with a Gaussian kernel of this width (in pixels)
Set to 1 to not do any smoothing.</p>
</dd>
<dt>centralArcsec: radius of central box within which to compute the mean spectrum</dt><dd><p>default=’auto’ means start with whole field, then reduce to 1/10 if only
one window is found (unless mask is specified); or ‘fwhm’ for the central square
with the same radius as the PB FWHM; or a floating point value in arcseconds</p>
</dd>
<dt>mask: a mask image equal in shape to the parent image that is used to determine the</dt><dd><p>region to compute the noise (outside the mask) and the mean spectrum (inside the mask)
option ‘auto’ will look for the &lt;filename&gt;.mask that matches the &lt;filename&gt;.image
and if it finds it, it will use it; otherwise it will use no mask</p>
</dd>
</dl>
<p>plotAtmosphere: ‘’, ‘tsky’, or ‘transmission’
airmass: for plot of atmospheric transmission
pwv: in mm (for plot of atmospheric transmission)
channelFractionForSlopeRemoval: if at least this many channels are initially selected, or</p>
<blockquote>
<div><p>if there are only 1-2 ranges found and the widest range has &gt; nchan*0.3 channels, then
fit and remove a linear slope and re-identify continuum channels.  Set to 1 to turn off.</p>
</div></blockquote>
<dl class="simple">
<dt>quadraticFit: if True, fit quadratic polynomial to the noise regions when appropriate;</dt><dd><p>otherwise fit only a linear slope</p>
</dd>
</dl>
<p>megapixels: simply used to label the plot
triangularPatternSeen: if True, then slightly boost sigmaFindContinuum if it is in ‘auto’ mode
maxMemory: only used to name the png if it is set
applyMaskToMask: if True, apply the mask inside the user mask image to set its masked pixels to 0
plotBaselinePoints: if True, then plot the baseline-defining points as black dots
dropBaselineChannels: percentage of extreme values to drop in baseline mode ‘min’
useIAGetProfile: if True, then for meanAboveThreshold and baselineMode=’min’, then</p>
<blockquote>
<div><p>use ia.getprofile instead of ia.getregion and subsequent arithmetic (faster)</p>
</div></blockquote>
<dl class="simple">
<dt>initialQuadraticImprovementThreshold: if removal of a quadratic from the raw meanSpectrum reduces</dt><dd><p>the MAD by this factor or more, then proceed with removing this quadratic (new Cycle 6 heuristic)</p>
</dd>
<dt>maxMadRatioForSFCAdjustment: madRatio must be below this value (among other things) in order</dt><dd><p>for automatic lowering of sigmaFindContinuum value to occur in .original iteration</p>
</dd>
<dt>maxMadRatioForSFCAdjustmentInLaterIterations: madRatio must be below this value (among other things) in order</dt><dd><p>for automatic lowering of sigmaFindContinuum value to occur in later iterations</p>
</dd>
<dt>avoidance: a CASA channel selection string to avoid selecting for continuum (for</dt><dd><p>manual use); invoked just before making the plot and returning</p>
</dd>
</dl>
<p>Parameters only relevant to mom0mom8jointMask:
mom0minsnr: sets the threshold for the mom0 image (i.e. median + mom0minsnr*scaledMAD)
mom8minsnr: sets the threshold for the mom8 image (i.e. median + mom8minsnr*scaledMAD)
snrThreshold: if SNR is higher than this, and phase2==True, then run a phase 2 mask calculation
minPixelsInJointMask: if fewer than these pixels are found, then use all pixels above pb=0.3</p>
<blockquote>
<div><p>(when meanSpectrumMethod = ‘mom0mom8jointMask’)</p>
</div></blockquote>
<p>overwriteMoments: if True, then overwrite any existing moment0 or moment8 image
overwriteMasks: if True, then overwrite any existing moment0 or moment8 mask image
enableInitialQuadratic: if True, assess the need for quadratic removal, and use the</p>
<blockquote>
<div><p>old-style method to remove it</p>
</div></blockquote>
<dl class="simple">
<dt>rmStatContQuadratic: if True, then do not do the initialQuadratic removal (if</dt><dd><p>enabled and deemed necessary), but instead always perform the new-style
quadratic removal</p>
</dd>
<dt>quadraticNsigma: the stopping threshold to use when ignoring outliers prior to fitting</dt><dd><p>fitting the quadratic (in the rmStatContQuadratic option). To more quickly test
different values, be sure to set the meanSpectrumFile option and overwrite=False)</p>
</dd>
</dl>
<p>bidirectionalMaskPhase2: True=extend mask to negative values beyond threshold; False=Cycle6 behavior
makeMovie: if True, then make a png for each quadratic fit as channels are</p>
<blockquote>
<div><p>removed one-by-one (in the rmStatContQuadratic option)</p>
</div></blockquote>
<p>outdir: where to write the .mom0 and .mom8 images, .dat, meanSpectrum, and the .png file
maxGroups: maximum number of continuum regions below which the potential reduction</p>
<blockquote>
<div><blockquote>
<div><p>factor of sigmaFindContinuum will be scaled by (1 - groups/maxGroups)**(bandwidth/1875e6)
via the following equation:</p>
</div></blockquote>
<p>sFC_factor = np.max([scalingFactor/7.0, (1-groups/float(maxGroups))**(spwBandwidth/1.875e9)])</p>
</div></blockquote>
<p>Parameters passed to findContinuumChannels (and only used in there):
useUncorrectedMedian: if True, then do not adjust the median (solid black line) upward</p>
<blockquote>
<div><p>from the median of the baseline points (dashed blue line)</p>
</div></blockquote>
<dl class="simple">
<dt>returnBluePoints: if True, then simply set the continuum ranges to the baseline points</dt><dd><p>(i.e. the blue points) instead of what the other heuristics might have found</p>
</dd>
</dl>
<p>baselineModeB: ‘min’ or ‘edge’, method to define the baseline in findContinuumChannels()
separator: the character to use to separate groups of channels in the string returned
maxTrim: in trimChannels=’auto’, this is the max channels to trim per group for TDM spws; it is automatically scaled upward for FDM spws.
maxTrimFraction: in trimChannels=’auto’, the max fraction of channels to trim per group
negativeThresholdFactor: scale the nominal negative threshold by this factor (to adjust</p>
<blockquote>
<div><p>sensitivity to absorption features: smaller values=more sensitive)</p>
</div></blockquote>
<dl class="simple">
<dt>signalRatioTier1: threshold for signalRatio, above which we desensitize the level to</dt><dd><p>consider line emission in order to avoid small differences in noise levels from
affecting the result (e.g. that occur between serial and parallel tclean cubes)
signalRatio=1 means: no lines seen, while closer to zero: more lines seen</p>
</dd>
<dt>signalRatioTier2: second threshold for signalRatio, used for FDM spws (nchan&gt;192) and</dt><dd><p>for cases of peakOverMad &lt; 5.  Should be &lt; signalRatioTier1.</p>
</dd>
</dl>
<p>dropBaselineChannels: percentage of extreme values to drop in baseline mode ‘min’
madRatioUpperLimit, madRatioLowerLimit: determines when dropBaselineChannels is used
mom08simultaneous: passed to meanSpectrumFromMom0Mom8JointMask
useBaseline: ‘low’, ‘middle’, ‘high’ or ‘auto’; auto tries to automatically pick ‘low’ for</p>
<blockquote>
<div><p>spectra that are emission-line dominated, ‘high’ if absorption line dominated, or ‘both’ if
both types of lines are present</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.sanitizeNames">
<span class="sig-name descname"><span class="pre">sanitizeNames</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newchar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'_'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#sanitizeNames"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.sanitizeNames" title="Link to this definition"></a></dt>
<dd><p>Replaces various special characters with specified character.
+++++++ This function is not used by pipeline, because it is only used by transitions() which is only used by isSingleContinuum.
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.setYLimitsAvoidingEdgeChannels">
<span class="sig-name descname"><span class="pre">setYLimitsAvoidingEdgeChannels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">avgspectrumAboveThreshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mad</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#setYLimitsAvoidingEdgeChannels"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.setYLimitsAvoidingEdgeChannels" title="Link to this definition"></a></dt>
<dd><p>Called by runFindContinuum to set the y-axis limits..
1) Avoid spikes in edge channels from skewing the plot limits, by</p>
<blockquote>
<div><p>setting plot limits on the basis of channels chan..-chan</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Enforce a maximum dynamic range (peak-median)/mad so that weak features
can be seen, allowing strongest ones to overflow the top.</p></li>
</ol>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.sigmaCorrectionFactor">
<span class="sig-name descname"><span class="pre">sigmaCorrectionFactor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">baselineMode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#sigmaCorrectionFactor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.sigmaCorrectionFactor" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
Computes the correction factor for the fact that the measured rms (or MAD)
on the N%ile lowest points of a datastream will be less than the true rms
(or MAD) of all points.
npts: nchan in the spw
Returns: a value between 0 and 1, which will be used to reduce the</p>
<blockquote>
<div><p>estimate of the population sigma based on the sample sigma</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.smooth">
<span class="sig-name descname"><span class="pre">smooth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'hanning'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newMethod</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#smooth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.smooth" title="Link to this definition"></a></dt>
<dd><p><a class="reference external" href="https://scipy-cookbook.readthedocs.io/items/SignalSmooth.html">https://scipy-cookbook.readthedocs.io/items/SignalSmooth.html</a>
Date: 2017-07-13</p>
<p>Smooth the data using a window with requested size.</p>
<p>This method is based on the convolution of a scaled window with the signal.
The signal is prepared by introducing reflected copies of the signal
(with the window size) in both ends so that transient parts are minimized
in the beginning and end part of the output signal.</p>
<dl>
<dt>input:</dt><dd><p>x: the input signal
window_len: the dimension of the smoothing window
window: the type of window from ‘flat’, ‘hanning’, ‘hamming’, ‘bartlett’, ‘blackman’</p>
<blockquote>
<div><p>flat window will produce a moving average smoothing.</p>
</div></blockquote>
</dd>
<dt>output:</dt><dd><p>the smoothed signal</p>
</dd>
</dl>
<p>example:</p>
<p>t = linspace(-2,2,0.1)
x = sin(t)+random.randn(len(t))*0.1
y = smooth(x)</p>
<p>see also:</p>
<p>numpy.hanning, numpy.hamming, numpy.bartlett, numpy.blackman, numpy.convolve
scipy.signal.lfilter</p>
<p>TODO: the window parameter could be the window itself if an array instead of a string</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.sortRangesByMax">
<span class="sig-name descname"><span class="pre">sortRangesByMax</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cube</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#sortRangesByMax"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.sortRangesByMax" title="Link to this definition"></a></dt>
<dd><p>Runs imstat on each individual channel range of a selection string, sorts the
result by ‘max’ and returns a sorted list of tuples: [‘maxpos’, ‘max’]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.splitListIntoContiguousLists">
<span class="sig-name descname"><span class="pre">splitListIntoContiguousLists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mylist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#splitListIntoContiguousLists"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.splitListIntoContiguousLists" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
Called by copyweights. See also splitListIntoHomogenousLists.
Converts [1,2,3,5,6,7] into [[1,2,3],[5,6,7]], etc.
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.splitListIntoContiguousListsAndRejectNarrow">
<span class="sig-name descname"><span class="pre">splitListIntoContiguousListsAndRejectNarrow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">narrow</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#splitListIntoContiguousListsAndRejectNarrow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.splitListIntoContiguousListsAndRejectNarrow" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
Split a list of channels into contiguous lists, and reject those that
have a small number of channels.
narrow: if &gt;=1, then interpret it as the minimum number of channels that</p>
<blockquote>
<div><blockquote>
<div><p>a group must have in order to survive</p>
</div></blockquote>
<dl class="simple">
<dt>if &lt;1, then interpret it as the minimum fraction of channels that</dt><dd><p>a group must have relative to the total number of channels</p>
</dd>
</dl>
</div></blockquote>
<p>Returns: a new single list (as an array)
Example:  [1,2,3,4,6,7,9,10,11] –&gt; [ 1,  2,  3,  4,  9, 10, 11]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.splitListIntoContiguousListsAndRejectZeroStd">
<span class="sig-name descname"><span class="pre">splitListIntoContiguousListsAndRejectZeroStd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#splitListIntoContiguousListsAndRejectZeroStd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.splitListIntoContiguousListsAndRejectZeroStd" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
Takes a list of numerical values, splits into contiguous lists and
removes those that have zero standard deviation in their associated values.
Note that values <em>must</em> hold the values of the whole array, while channels
can be a subset.
If nanmin is specified, then reject lists that contain more than 3
appearances of this value.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.splitListIntoContiguousListsAndTrim">
<span class="sig-name descname"><span class="pre">splitListIntoContiguousListsAndTrim</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">totalChannels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trimChannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxTrimFraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#splitListIntoContiguousListsAndTrim"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.splitListIntoContiguousListsAndTrim" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuumChannels.
Split a list of channels into contiguous lists, and trim some number
of channels from each edge.
totalChannels: number of channels in the spectrum
channels: a list of channels selected for potential continuum
trimChannels: if integer, use that number of channels.  If float between</p>
<blockquote>
<div><p>0 and 1, then use that fraction of channels in each contiguous list
(rounding up). If ‘auto’, then use 0.1 but not more than maxTrim
channels and not more than maxTrimFraction of channels.</p>
</div></blockquote>
<p>maxTrim and maxTrimChannels: used in ‘auto’ mode
Returns: a new single list</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.splitListIntoHomogeneousLists">
<span class="sig-name descname"><span class="pre">splitListIntoHomogeneousLists</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mylist</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#splitListIntoHomogeneousLists"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.splitListIntoHomogeneousLists" title="Link to this definition"></a></dt>
<dd><p>This function is called only by removeNaNs, and hence is not used in Cycle 6-onward pipeline.
Converts [1,1,1,2,2,3] into [[1,1,1],[2,2],[3]], etc.
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.submask">
<span class="sig-name descname"><span class="pre">submask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#submask"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.submask" title="Link to this definition"></a></dt>
<dd><p>This function is called by meanSpectrum, but only in Cycle 4+5 heuristic.
Takes a spectral mask array, and picks out a subcube defined by a
blc,trc-defined region
region: dictionary containing keys ‘blc’ and ‘trc’</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.surmiseRepresentativeSpw">
<span class="sig-name descname"><span class="pre">surmiseRepresentativeSpw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#surmiseRepresentativeSpw"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.surmiseRepresentativeSpw" title="Link to this definition"></a></dt>
<dd><p>Reads the representative frequency from the measurement set, then computes
which science spw(s) contains it.
Returns: spwID, repBW, repNchan, np.min(bandwidths), np.max(bandwidths)
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.tdmSpectrum">
<span class="sig-name descname"><span class="pre">tdmSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channelWidth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">telescope</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ALMA'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#tdmSpectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.tdmSpectrum" title="Link to this definition"></a></dt>
<dd><p>This function is called by runFindContinuum and findContinuum.
Use 15e6 instead of 15.625e6 because LSRK channel width can be slightly narrower than TOPO.
Works for single, dual, or full-polarization.
channelWidth: in Hz
Returns: True or False</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.tooLittleBandwidth">
<span class="sig-name descname"><span class="pre">tooLittleBandwidth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#tooLittleBandwidth"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.tooLittleBandwidth" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
Returns: a string if there is a warning, or None if not</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.tooLittleSpread">
<span class="sig-name descname"><span class="pre">tooLittleSpread</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#tooLittleSpread"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.tooLittleSpread" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
Returns: a string if there is a warning, or None if not</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.topoFreqRangeListToChannel">
<span class="sig-name descname"><span class="pre">topoFreqRangeListToChannel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contdatline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vispath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'./'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">freqlist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returnFlatlist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">writeChannelsInIncreasingOrder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#topoFreqRangeListToChannel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.topoFreqRangeListToChannel" title="Link to this definition"></a></dt>
<dd><p>++++ This function is used by pipeline in writeContDat()
Converts a semicolon-delimited string list of topocentric frequency ranges to
channel ranges in the specified ms.
contdatline: line cut-and-pasted from .dat file  (e.g. ‘my.ms 150.45~151.67GHz;151.45~152.67GHz’)
vispath: set the path to the measurement set whose name was read from contdatline
freqlist:  ‘150.45~151.67GHz;151.45~152.67GHz’
spw: integer ID or string ID
writeChannelsInIncreasingOrder: if True, then ensure that the list is in increasing order
Returns: a string like:  ‘29:134~136;200~204’
if flatlist==True, then return  [134,136,200,204]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.topoFreqToChannel">
<span class="sig-name descname"><span class="pre">topoFreqToChannel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">freqlist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#topoFreqToChannel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.topoFreqToChannel" title="Link to this definition"></a></dt>
<dd><p>++++ This function is used by pipeline in writeContDat()
Converts a python floating point list of topocentric frequency ranges to
channel ranges in the specified ms.
freqlist:  [150.45e9,151.67e9]  or [150.45, 151.67]
spw: integer ID
vis: reads the channel frequencies from this measurement set for the specified spw
Returns: a python list of channels</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.transitions">
<span class="sig-name descname"><span class="pre">transitions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'OBSERVE_TARGET'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mymsmd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#transitions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.transitions" title="Link to this definition"></a></dt>
<dd><p>+++++++ This function is not used by pipeline, because it is only used by
isSingleContinuum() and the pipeline passes the Boolean singleContinuum.
However, it is used by my regression, so it is important to pass the vis
which has the virtual spw == real spw, which is normally the first spw
observed.
Returns the list of transitions for specified spw (and source).
vis: measurement set
spw: can be integer ID or string integer ID
Optional parameters:
source: can be integer ID or string name; if not specified, use the first one
intent: if source is blank then use first one with matching intent and spw</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.updateChannelRangesOnPlot">
<span class="sig-name descname"><span class="pre">updateChannelRangesOnPlot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labelDescs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avgspectrumAboveThreshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skipchan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">medianTrue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positiveThreshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upperXlabel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelWidth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initialPeakOverMad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#updateChannelRangesOnPlot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.updateChannelRangesOnPlot" title="Link to this definition"></a></dt>
<dd><p>Used in Pipeline2020 going forward.
channelWidth: in Hz
Returns: new aggregate bandwidth in GHz</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.updateSBSummary">
<span class="sig-name descname"><span class="pre">updateSBSummary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">representativeFrequency</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minAcceptableAngResolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxAcceptableAngResolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dynamicRange</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">representativeBandwidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">representativeSource</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">representativeSPW</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxAllowedBeamAxialRatio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spectralDynamicRangeBandWidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#updateSBSummary"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.updateSBSummary" title="Link to this definition"></a></dt>
<dd><p>Updates the ASDM_SBSUMMARY table of a measurement set with one or more new
values.  If a value is not present in the existing table and also not
specified, then it will remain not present in the updated table.
representativeFrequency: float value in typical units (GHz),</p>
<blockquote>
<div><p>or string with units (space before units is optional)</p>
</div></blockquote>
<dl class="simple">
<dt>minAcceptableAngResolution: float value in typical units (arcsec),</dt><dd><p>or string with units (space before units is required)</p>
</dd>
<dt>maxAcceptableAngResolution: float value in typical units (arcsec),</dt><dd><p>or string with units (space before units is required)</p>
</dd>
</dl>
<p>dynamicRange: float value
representativeBandwidth: float value in typical units (GHz),</p>
<blockquote>
<div><p>or string with units (space before units is optional)</p>
</div></blockquote>
<p>representativeSource: string
representativeSPW: string
maxAllowedBeamAxialRatio: float
spectralDynamicRangeBandWidth: float value in typical units (MHz),</p>
<blockquote>
<div><p>or string with units (space before units is optional)</p>
</div></blockquote>
<p>Returns: dictionary keyed by parameter name
-Todd Hunter</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.version">
<span class="sig-name descname"><span class="pre">version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">showfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#version"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.version" title="Link to this definition"></a></dt>
<dd><p>Returns the CVS revision number.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.versionStringToArray">
<span class="sig-name descname"><span class="pre">versionStringToArray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">versionString</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#versionStringToArray"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.versionStringToArray" title="Link to this definition"></a></dt>
<dd><p>This function is called by casaVersionCompare.
Converts ‘5.3.0-22’ to np.array([5,3,0,22], dtype=np.int32)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.widenSelection">
<span class="sig-name descname"><span class="pre">widenSelection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eachside</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minwidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelWidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#widenSelection"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.widenSelection" title="Link to this definition"></a></dt>
<dd><p>Widen each component of a channel selection string on each side.
selection: channel selection string
eachside: how many channels to add on each side
minwidth: width of narrowest range to expand
channelWidth: width of channels in Hz
verbose: if True, print the new selection
nchan: if specified, then avoid going past the final channel (nchan-1)
Returns: new selection string</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.widenSelections">
<span class="sig-name descname"><span class="pre">widenSelections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">datfiles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eachside</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">minwidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#widenSelections"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.widenSelections" title="Link to this definition"></a></dt>
<dd><p>Read a list of _findContinuum.dat files, and widen each channel range
of the selection string by a number of channels on each side.
datfiles: python list of datfiles, or a comma-delimited or wildcard string
eachside: how many channels to add on each side
minwidth: width of narrowest range to expand
verbose: passed to widenSelection to print the new selection strings
nchan: if specified, then avoid going past the final channel (nchan-1)</p>
<blockquote>
<div><p>can be an int if single file is passed (or all spws have same nchan);
or a list of ints</p>
</div></blockquote>
<dl class="simple">
<dt>Returns: if only 1 file passed, it returns the new selection string; if</dt><dd><p>multiple files are passed, then return the bandwidth increase factor</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.widthOfMaskArcsec">
<span class="sig-name descname"><span class="pre">widthOfMaskArcsec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maskInfo</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#widthOfMaskArcsec"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.widthOfMaskArcsec" title="Link to this definition"></a></dt>
<dd><p>++++ This function is not used by pipeline when meanSpectrumMethod=’mom0mom8jointMask’ or if mask=’’
Finds width of the smallest central square that circumscribes all masked
pixels.  Returns the value in arcsec.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.writeContDat">
<span class="sig-name descname"><span class="pre">writeContDat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">png</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregateBandwidth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">firstFreq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lastFreq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelWidth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageInfo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">numchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chanInfo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lsrkwidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spw</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#writeContDat"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.writeContDat" title="Link to this definition"></a></dt>
<dd><p>This function is called by findContinuum.
Writes out an ASCII file called &lt;meanSpectrumFile&gt;_findContinuum.dat
that contains the selected channels, the png name and the aggregate
bandwidth in GHz.
Returns: name of file written
meanSpectrumFile: only used to generate the name of the .dat file, unless</p>
<blockquote>
<div><p>firstFreq &lt;= 0, in which case the readPreviousMeanSpectrum is called on it
(It splits off name before ‘.meanSpectrum’ and appends _findContinuum.dat)</p>
</div></blockquote>
<p>vis: if specified, then also write a line with the topocentric velocity ranges
spw: integer or string ID number; if specified (along with vis), then also write</p>
<blockquote>
<div><p>a final line with the topocentric channel ranges for this spw</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.findContinuum.writeMeanSpectrum">
<span class="sig-name descname"><span class="pre">writeMeanSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meanSpectrumFile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequency</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avgspectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avgSpectrumNansReplaced</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edgesUsed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nanmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centralArcsec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iteration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/findContinuum.html#writeMeanSpectrum"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.findContinuum.writeMeanSpectrum" title="Link to this definition"></a></dt>
<dd><p>This function is called by meanSpectrum.
Writes out the mean spectrum (and the key parameters used to create it),
so that it can quickly be restored.  This allows the manual user to quickly
experiment with different parameters of findContinuumChannels applied to
the same mean spectrum.
Units are Hz and Jy/beam.
meanSpectrumFile: name of file to create
threshold: this is interpreted as mom0threshold for meanSpectrumMethod=’mom0mom8jointMask’
edgesUsed: this is interpreted as numberPixelsInMask for meanSpectrumMethod=’mom0mom8jointMask’
nanmin:    this is interpreted as mom8threshold for meanSpectrumMethod=’mom0mom8jointMask’
frequency: list or array of frequencies
Returns: None</p>
</dd></dl>

</section>
<section id="module-pipeline.extern.tsys_contamination">
<span id="pipeline-extern-tsys-contamination-module"></span><h2>pipeline.extern.tsys_contamination module<a class="headerlink" href="#module-pipeline.extern.tsys_contamination" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.basic_atm_asymmetric_fit">
<span class="sig-name descname"><span class="pre">basic_atm_asymmetric_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transmission</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asym_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#basic_atm_asymmetric_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.basic_atm_asymmetric_fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.below_fit">
<span class="sig-name descname"><span class="pre">below_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_asym_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#below_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.below_fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.co_telluric_intervals">
<span class="sig-name descname"><span class="pre">co_telluric_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">normalized_spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequencies_mhz</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#co_telluric_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.co_telluric_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.complement_intervals">
<span class="sig-name descname"><span class="pre">complement_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#complement_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.complement_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.cross_model">
<span class="sig-name descname"><span class="pre">cross_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asym_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#cross_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.cross_model" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.detect_tsys_contamination">
<span class="sig-name descname"><span class="pre">detect_tsys_contamination</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bandpass</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sigma_atm_prominent_peak</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sigma_detection_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#detect_tsys_contamination"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.detect_tsys_contamination" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.difference_intervals">
<span class="sig-name descname"><span class="pre">difference_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#difference_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.difference_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.exp_rescale">
<span class="sig-name descname"><span class="pre">exp_rescale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#exp_rescale"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.exp_rescale" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.find_prominent_peaks_in_atm">
<span class="sig-name descname"><span class="pre">find_prominent_peaks_in_atm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_sigma_atm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">atm_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequencies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#find_prominent_peaks_in_atm"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.find_prominent_peaks_in_atm" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.find_repeated_peaks">
<span class="sig-name descname"><span class="pre">find_repeated_peaks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prominence</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prominence_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">difference_tolerance_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_from_peak</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#find_repeated_peaks"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.find_repeated_peaks" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.gaussian_line_fit">
<span class="sig-name descname"><span class="pre">gaussian_line_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#gaussian_line_fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.gaussian_line_fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.get_tsys_contaminated_intervals">
<span class="sig-name descname"><span class="pre">get_tsys_contaminated_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsysdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spwlist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fieldlist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">large_interval_warning_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sigma_atm_prominent_peak</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">savefigfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_n_extreme</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relative_detection_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sigma_detection_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#get_tsys_contaminated_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.get_tsys_contaminated_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.gline_and_baseline">
<span class="sig-name descname"><span class="pre">gline_and_baseline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#gline_and_baseline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.gline_and_baseline" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.intersection_intervals">
<span class="sig-name descname"><span class="pre">intersection_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#intersection_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.intersection_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.intervals_to_casa_string">
<span class="sig-name descname"><span class="pre">intervals_to_casa_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">intervals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaled_array</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'.0f'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#intervals_to_casa_string"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.intervals_to_casa_string" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.linear_trend">
<span class="sig-name descname"><span class="pre">linear_trend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'abs'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#linear_trend"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.linear_trend" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.lower_hug">
<span class="sig-name descname"><span class="pre">lower_hug</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#lower_hug"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.lower_hug" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.main">
<span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#main"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.main" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.make_tsyscontamination_html_log">
<span class="sig-name descname"><span class="pre">make_tsyscontamination_html_log</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'TsysCont'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#make_tsyscontamination_html_log"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.make_tsyscontamination_html_log" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.max_without_outliers">
<span class="sig-name descname"><span class="pre">max_without_outliers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#max_without_outliers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.max_without_outliers" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.median_abs_deviation">
<span class="sig-name descname"><span class="pre">median_abs_deviation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center=&lt;function</span> <span class="pre">median&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale=1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nan_policy='propagate'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#median_abs_deviation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.median_abs_deviation" title="Link to this definition"></a></dt>
<dd><p>Compute the median absolute deviation of the data along the given axis.
The median absolute deviation (MAD, <a class="footnote-reference brackets" href="#id81" id="id79" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>) computes the median over the
absolute deviations from the median. It is a measure of dispersion
similar to the standard deviation but more robust to outliers <a href="#id86"><span class="problematic" id="id80">[2]_</span></a>.
The MAD of an empty array is <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>.
.. versionadded:: 1.5.0
:Parameters: * <strong>x</strong> (<em>array_like</em>) – Input array or object that can be converted to an array.</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>axis</strong> (<em>int or None, optional</em>) – Axis along which the range is computed. Default is 0. If None, compute
the MAD over the entire array.</p></li>
<li><p><strong>center</strong> (<em>callable, optional</em>) – A function that will return the central value. The default is to use
np.median. Any user defined function used will need to have the
function signature <code class="docutils literal notranslate"><span class="pre">func(arr,</span> <span class="pre">axis)</span></code>.</p></li>
<li><p><strong>scale</strong> (<em>scalar or str, optional</em>) – The numerical value of scale will be divided out of the final
result. The default is 1.0. The string “normal” is also accepted,
and results in <cite>scale</cite> being the inverse of the standard normal
quantile function at 0.75, which is approximately 0.67449.
Array-like scale is also allowed, as long as it broadcasts correctly
to the output such that <code class="docutils literal notranslate"><span class="pre">out</span> <span class="pre">/</span> <span class="pre">scale</span></code> is a valid operation. The
output dimensions depend on the input array, <cite>x</cite>, and the <cite>axis</cite>
argument.</p></li>
<li><p><strong>nan_policy</strong> (<em>{‘propagate’, ‘raise’, ‘omit’}, optional</em>) – Defines how to handle when input contains nan.
The following options are available (default is ‘propagate’):
* ‘propagate’: returns nan
* ‘raise’: throws an error
* ‘omit’: performs the calculations ignoring nan values</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mad</strong> – If <code class="docutils literal notranslate"><span class="pre">axis=None</span></code>, a scalar is returned. If the input contains
integers or floats of smaller precision than <code class="docutils literal notranslate"><span class="pre">np.float64</span></code>, then the
output data-type is <code class="docutils literal notranslate"><span class="pre">np.float64</span></code>. Otherwise, the output data-type is
the same as that of the input.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>scalar or ndarray</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.std</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.var</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.median</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.stats.iqr</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.stats.tmean</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.stats.tstd</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.stats.tvar</span></code></p>
</div>
<p class="rubric">Notes</p>
<p>The <cite>center</cite> argument only affects the calculation of the central value
around which the MAD is calculated. That is, passing in <code class="docutils literal notranslate"><span class="pre">center=np.mean</span></code>
will calculate the MAD around the mean - it will not calculate the <em>mean</em>
absolute deviation.
The input array may contain <cite>inf</cite>, but if <cite>center</cite> returns <cite>inf</cite>, the
corresponding MAD for that data will be <cite>nan</cite>.</p>
<p class="rubric">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id81" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id79">1</a><span class="fn-bracket">]</span></span>
<p>“Median absolute deviation”,
<a class="reference external" href="https://en.wikipedia.org/wiki/Median_absolute_deviation">https://en.wikipedia.org/wiki/Median_absolute_deviation</a></p>
</aside>
</aside>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.merge_intervals">
<span class="sig-name descname"><span class="pre">merge_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">intervals</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#merge_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.merge_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.model_break">
<span class="sig-name descname"><span class="pre">model_break</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peaks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#model_break"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.model_break" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.modified_atmospheric_profile">
<span class="sig-name descname"><span class="pre">modified_atmospheric_profile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree_baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scales</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coefficients</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_coordinates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">split</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#modified_atmospheric_profile"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.modified_atmospheric_profile" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.no_nans">
<span class="sig-name descname"><span class="pre">no_nans</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#no_nans"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.no_nans" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.plot_source_bp_normalized_residuals">
<span class="sig-name descname"><span class="pre">plot_source_bp_normalized_residuals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source_tsys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bandpass_tsys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">frequencies</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalized_residuals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tsys_contamination_intervals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'science'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_label</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Tsys</span> <span class="pre">contamination'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'red'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_plot_title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">other_emphasized_intervals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">savefigfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sci_spw_intervals</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#plot_source_bp_normalized_residuals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.plot_source_bp_normalized_residuals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.positive_line_intervals">
<span class="sig-name descname"><span class="pre">positive_line_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">normalized_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detection_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_detection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#positive_line_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.positive_line_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.puff">
<span class="sig-name descname"><span class="pre">puff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">intervals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan_avoidance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#puff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.puff" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.refitting_intervals_bp_to_source">
<span class="sig-name descname"><span class="pre">refitting_intervals_bp_to_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalized_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detection_limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">edge</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_detection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#refitting_intervals_bp_to_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.refitting_intervals_bp_to_source" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.save_tsysdata">
<span class="sig-name descname"><span class="pre">save_tsysdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsysdata</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#save_tsysdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.save_tsysdata" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.search_expanded_interval">
<span class="sig-name descname"><span class="pre">search_expanded_interval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interval</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limit_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#search_expanded_interval"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.search_expanded_interval" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.separate_non_intersecting_sci_spw">
<span class="sig-name descname"><span class="pre">separate_non_intersecting_sci_spw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tsysdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chan_tsys_intervals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tsysspw</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#separate_non_intersecting_sci_spw"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.separate_non_intersecting_sci_spw" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.shift_bp_to_source">
<span class="sig-name descname"><span class="pre">shift_bp_to_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">interval</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip_snr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asym_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#shift_bp_to_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.shift_bp_to_source" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.smoother">
<span class="sig-name descname"><span class="pre">smoother</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector_for_smoothing</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vector_to_subtract_from</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sg'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#smoother"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.smoother" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.smoother_sigma">
<span class="sig-name descname"><span class="pre">smoother_sigma</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sg'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#smoother_sigma"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.smoother_sigma" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.union_intervals">
<span class="sig-name descname"><span class="pre">union_intervals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#union_intervals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.union_intervals" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pipeline.extern.tsys_contamination.width_fit_filter">
<span class="sig-name descname"><span class="pre">width_fit_filter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peaks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fwhm_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/pipeline/extern/tsys_contamination.html#width_fit_filter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pipeline.extern.tsys_contamination.width_fit_filter" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-pipeline.extern">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pipeline.extern" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020–2024, Pipeline Dev. Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>